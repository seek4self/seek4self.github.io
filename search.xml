<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Go-FAQ 翻译</title>
      <link href="language/go/go-faq-247d2da13bbf/"/>
      <url>language/go/go-faq-247d2da13bbf/</url>
      
        <content type="html"><![CDATA[<h2 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h2><h3 id="该项目的目的是什么？"><a href="#该项目的目的是什么？" class="headerlink" title="该项目的目的是什么？"></a>该项目的目的是什么？</h3><p>在 Go 诞生之时，也就是十年前，编程世界与今天不同。生产软件通常是用 C++ 或 Java 编写的，GitHub 不存在，大多数计算机还不是多处理器，除了 Visual Studio 和 Eclipse 之外，几乎没有 IDE 或其他高级工具可用，更不用说 Internet 上的免费。</p><p>同时，我们对使用我们所使用的语言开发服务器软件所需的过度复杂性感到沮丧。自从 C、C++ 和 Java 等语言首次开发以来，计算机已经变得非常快，但编程行为本身并没有那么先进。此外，很明显，多处理器正在变得普遍，但大多数语言对高效和安全地编程几乎没有帮助。</p><p>我们决定退后一步，思考随着技术的发展，未来几年软件工程将面临哪些主要问题，以及新语言如何帮助解决这些问题。例如，多核 CPU 的兴起认为一种语言应该为某种并发性或并行性提供一流的支持。为了使资源管理在大型并发程序中易于处理，需要垃圾收集或至少某种安全的自动内存管理。</p><p>这些考虑导致了 Go 的<a href="https://commandcenter.blogspot.com/2017/09/go-ten-years-and-climbing.html">一系列讨论</a>，首先是作为一组想法和需求，然后是作为一种语言。一个总体目标是 Go 通过启用工具、自动化诸如代码格式化之类的平凡任务以及消除在大型代码库上工作的障碍来做更多的工作来帮助工作的程序员。</p><p>文章 <a href="https://golang.google.cn/talks/2012/splash.article">Go at Google：软件工程服务中的语言设计</a>对 Go 的目标以及如何实现或至少接近这些目标进行了更广泛的描述。</p><h3 id="该项目的历史是什么？"><a href="#该项目的历史是什么？" class="headerlink" title="该项目的历史是什么？"></a>该项目的历史是什么？</h3><p>Robert Griesemer、Rob Pike 和 Ken Thompson 于 2007 年 9 月 21 日开始在白板上草拟一种新语言的目标。几天之内，这些目标就形成了一项计划，并且对它会是什么有了一个公平的想法。设计继续与不相关的工作并行。到 2008 年 1 月，Ken 开始着手开发一个用于探索想法的编译器。它生成 C 代码作为其输出。到年中，该语言已经成为一个全职项目，并且已经足够稳定，可以尝试生产编译器。 2008 年 5 月，Ian Taylor 使用草案规范独立开始了 Go 的 GCC 前端。 Russ Cox 于 2008 年底加入并帮助将语言和库从原型变为现实。</p><p>Go 于 2009 年 11 月 10 日成为公共开源项目。来自社区的无数人贡献了想法、讨论和代码。</p><p>现在全世界有数以百万计的 Go 程序员——gophers——而且每天都在增加。 Go 的成功远远超出了我们的预期。</p><h3 id="gopher-吉祥物的起源是什么？"><a href="#gopher-吉祥物的起源是什么？" class="headerlink" title="gopher 吉祥物的起源是什么？"></a>gopher 吉祥物的起源是什么？</h3><p>吉祥物和 Logo 由 Renée French 设计，他还设计了 Plan 9 兔子 Glenda。一篇关于地鼠的博客文章解释了它是如何从几年前她用于 WFMU T 恤设计的一个推导出来的。徽标和吉祥物受<a href="https://creativecommons.org/licenses/by/3.0/">知识共享署名 3.0</a> 许可保护。</p><p>gopher 有一张<a href="https://golang.google.cn/doc/gopher/modelsheet.jpg">模型表</a>，说明了他的特征以及如何正确表示它们。 2016 年 Renée 在 Gophercon 的一次演讲中首次展示了该模型表。他具有独特的功能；他是 Go gopher, 而不仅仅是任何旧的 gopher。</p><h3 id="语言是-Go-还是-Golang？"><a href="#语言是-Go-还是-Golang？" class="headerlink" title="语言是 Go 还是 Golang？"></a>语言是 Go 还是 Golang？</h3><p>该语言称为 Go。 “golang”这个名字的出现是因为该网站最初是 golang.org。 （当时没有 .dev 域。）不过，许多人使用 golang 名称，它作为标签很方便。例如，该语言的 Twitter 标签是“#golang”。无论如何，该语言的名称只是简单的 Go。</p><p>附注：虽然<a href="https://blog.golang.org/go-brand">官方 logo</a>有两个大写字母，但语言名称写的是 Go，而不是 GO。</p><h3 id="为什么要创造一种新的语言？"><a href="#为什么要创造一种新的语言？" class="headerlink" title="为什么要创造一种新的语言？"></a>为什么要创造一种新的语言？</h3><p>Go 的诞生源于对我们在 Google 所做工作的现有语言和环境的失望。编程变得太难了，语言的选择是部分原因。必须选择高效编译、高效执行或易于编程；所有这三种语言都没有以相同的主流语言提供。那些本可以通过转向动态类型语言（如 Python 和 JavaScript）而不是 C++ 或在较小程度上的 Java 来选择安全性和效率的程序员。</p><p>我们并不孤单。经过多年的编程语言环境相当平静之后，Go 是几种新语言（Rust、Elixir、Swift 等）中的第一种，它们使编程语言开发再次成为活跃的、几乎是主流的领域。</p><p>Go 通过尝试将解释型动态类型语言的编程易用性与静态类型编译语言的效率和安全性结合起来解决了这些问题。它还旨在实现现代化，支持网络和多核计算。最后，使用 Go 的目的是为了快速：在单台计算机上构建大型可执行文件最多需要几秒钟。为了实现这些目标，需要解决一些语言问题：一个富有表现力但轻量级的类型系统；并发和垃圾收集；死板的依赖规范；等等。库或工具无法很好地解决这些问题，需要一种新的语言。</p><p><a href="https://golang.google.cn/talks/2012/splash.article">Google 的 Go</a> 文章讨论了 Go 语言设计背后的背景和动机，并提供了有关此常见问题解答中提供的许多答案的更多详细信息。</p><h3 id="Go的祖先是什么？"><a href="#Go的祖先是什么？" class="headerlink" title="Go的祖先是什么？"></a>Go的祖先是什么？</h3><p>Go 主要属于 C 家族（基本语法），来自 Pascal/Modula/Oberon 家族（声明、包）的重要输入，以及受 Tony Hoare 的 CSP 启发的语言的一些想法，例如 Newsqueak 和 Limbo（并发）。但是，它是一种全面的新语言。在各个方面，语言的设计都是通过思考程序员做什么以及如何进行编程，至少是我们所做的编程，更有效，这意味着更多乐趣。</p><h3 id="设计的指导原则是什么？"><a href="#设计的指导原则是什么？" class="headerlink" title="设计的指导原则是什么？"></a>设计的指导原则是什么？</h3><p>在设计 Go 时，Java 和 C++ 是编写服务器最常用的语言，至少在 Google 是这样。我们觉得这些语言需要太多的记账和重复。一些程序员的反应是转向更动态、更流畅的语言，比如 Python，代价是效率和类型安全。我们认为应该可以在一种语言中实现效率、安全性和流畅性。</p><p>Go 试图减少单词的两种含义的输入量。在整个设计过程中，我们试图减少混乱和复杂性。没有前向声明，也没有头文件；一切都只声明一次。初始化是富有表现力的、自动的且易于使用的。语法简洁明了的关键字。重复 (foo.Foo* myFoo = new(foo.Foo)) 通过使用 := declare-and-initialize 构造的简单类型派生来减少。也许最根本的是，没有类型层次结构：类型只是，它们不必宣布它们的关系。这些简化让 Go 在不牺牲复杂性的情况下具有表现力且易于理解。</p><p>另一个重要原则是保持概念正交。可以为任何类型实现方法；结构代表数据，而接口代表抽象；等等。正交性使我们更容易理解事物结合时会发生什么。</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="谷歌在内部使用-Go-吗？"><a href="#谷歌在内部使用-Go-吗？" class="headerlink" title="谷歌在内部使用 Go 吗？"></a>谷歌在内部使用 Go 吗？</h3><p>是的。 Go 在 Google 内部的生产环境中被广泛使用。一个简单的例子是 <a href="https://golang.org/">golang.org</a> 背后的服务器。它只是在 <a href="https://developers.google.com/appengine/">Google App Engine</a> 的生产配置中运行的 godoc 文档服务器。</p><p>一个更重要的例子是 Google 的下载服务器 dl.google.com，它提供 Chrome 二进制文件和其他大型可安装文件，例如 apt-get 包。</p><p>Go 不是谷歌唯一使用的语言，远非如此，但它是许多领域的关键语言，包括<a href="https://golang.google.cn/talks/2013/go-sreops.slide">站点可靠性工程 (SRE)</a> 和大规模数据处理。</p><h3 id="还有哪些公司使用-Go？"><a href="#还有哪些公司使用-Go？" class="headerlink" title="还有哪些公司使用 Go？"></a>还有哪些公司使用 Go？</h3><p>Go 的使用在全球范围内都在增长，尤其是但绝不仅仅是在云计算领域。用 Go 编写的几个主要云基础设施项目是 Docker 和 Kubernetes，但还有更多。</p><p>不过，这不仅仅是云。 Go Wiki 包含一个定期更新的<a href="https://github.com/golang/go/wiki/GoUsers">页面</a>，其中列出了许多使用 Go 的公司。</p><p>Wiki 还有一个页面，其中包含指向使用该语言的公司和项目的<a href="https://github.com/golang/go/wiki/SuccessStories">成功故事</a>的链接。</p><h3 id="Go-程序是否与-C-C-程序链接？"><a href="#Go-程序是否与-C-C-程序链接？" class="headerlink" title="Go 程序是否与 C/C++ 程序链接？"></a>Go 程序是否与 C/C++ 程序链接？</h3><p>可以在同一个地址空间中同时使用 C 和 Go，但这不是一种天然的配合，可能需要特殊的接口软件。此外，将 C 与 Go 代码链接放弃了 Go 提供的内存安全和堆栈管理属性。有时绝对有必要使用 C 库来解决问题，但这样做总是会引入纯 Go 代码不存在的风险元素，因此请谨慎使用。</p><p>如果你确实需要在 Go 中使用 C，如何进行取决于 Go 编译器的实现。 Go 团队支持三种 Go 编译器实现。它们是 gc，默认编译器，gccgo，它使用 GCC 后端，以及一个不太成熟的 gollvm，它使用 LLVM 基础设施。</p><p>Gc 使用与 C 不同的调用约定和链接器，因此不能直接从 C 程序调用，反之亦然。 cgo 程序为“外部函数接口”提供了机制，以允许从 Go 代码安全调用 C 库。 SWIG 将此功能扩展到 C++ 库。</p><p>您还可以将 cgo 和 SWIG 与 Gccgo 和 gollvm 一起使用。由于它们使用传统的 API，因此也可以非常小心地将来自这些编译器的代码直接与 GCC/LLVM 编译的 C 或 C++ 程序链接起来。但是，安全地这样做需要了解所有相关语言的调用约定，以及从 Go 调用 C 或 C++ 时的堆栈限制。</p><h3 id="Go-支持哪些-IDE？"><a href="#Go-支持哪些-IDE？" class="headerlink" title="Go 支持哪些 IDE？"></a>Go 支持哪些 IDE？</h3><p>Go 项目不包含自定义 IDE，但语言和库的设计使分析源代码变得容易。因此，大多数知名的编辑器和 IDE 都直接或通过插件很好地支持 Go。</p><p>具有良好 Go 支持的知名 IDE 和编辑器列表包括 Emacs、Vim、VSCode、Atom、Eclipse、Sublime、IntelliJ（通过称为 Goland 的自定义变体）等等。很有可能你最喜欢的环境是 Go 编程的高效环境。</p><h3 id="Go-是否支持-Google-的协议缓冲区？"><a href="#Go-是否支持-Google-的协议缓冲区？" class="headerlink" title="Go 是否支持 Google 的协议缓冲区？"></a>Go 是否支持 Google 的协议缓冲区？</h3><p>一个单独的开源项目提供了必要的编译器插件和库。它可以在 <a href="https://github.com/golang/protobuf">github.com/golang/protobuf/</a> 上找到。</p><h3 id="我可以将-Go-主页翻译成另一种语言吗？"><a href="#我可以将-Go-主页翻译成另一种语言吗？" class="headerlink" title="我可以将 Go 主页翻译成另一种语言吗？"></a>我可以将 Go 主页翻译成另一种语言吗？</h3><p>绝对地。我们鼓励开发人员用他们自己的语言制作 Go 语言网站。但是，如果您选择将 Google 徽标或品牌添加到您的网站（它不会出现在 <a href="https://golang.google.cn/">golang.org</a> 上），您需要遵守 <a href="https://www.google.com/permissions/guidelines.html">www.google.com/permissions/guidelines.html</a> 上的指南</p><h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><h3 id="Go-有运行时吗？"><a href="#Go-有运行时吗？" class="headerlink" title="Go 有运行时吗？"></a>Go 有运行时吗？</h3><p>Go 确实有一个扩展的库，称为运行时，它是每个 Go 程序的一部分。运行时库实现了 Go 语言的垃圾收集、并发、堆栈管理和其他关键特性。尽管它在语言中更为核心，但 Go 的运行时类似于 C 库 libc。</p><p>然而，重要的是要理解 Go 的运行时不包括虚拟机，例如 Java 运行时提供的。 Go 程序被提前编译为本机机器代码（或 JavaScript 或 WebAssembly，对于某些变体实现）。因此，尽管该术语通常用于描述程序运行的虚拟环境，但在 Go 中，“运行时”一词只是提供关键语言服务的库的名称。</p><h3 id="Unicode-标识符是怎么回事？"><a href="#Unicode-标识符是怎么回事？" class="headerlink" title="Unicode 标识符是怎么回事？"></a>Unicode 标识符是怎么回事？</h3><p>在设计 Go 时，我们希望确保它不会过度以 ASCII 为中心，这意味着将标识符的空间从 7 位 ASCII 的范围中扩展出来。 Go 的规则——标识符字符必须是 Unicode 定义的字母或数字——易于理解和实现，但有一些限制。例如，组合字符被设计排除在外，并且排除了一些语言，如梵文。</p><p>这条规则还有另一个不幸的后果。由于导出的标识符必须以大写字母开头，因此根据定义，从某些语言中的字符创建的标识符不能被导出。目前唯一的解决方案是使用类似X日本语的东西，这显然不能令人满意。</p><p>自该语言的最早版本以来，人们一直在思考如何最好地扩展标识符空间以适应使用其他本地语言的程序员。究竟该做什么仍然是一个活跃的讨论话题，并且该语言的未来版本在标识符的定义上可能会更加自由。例如，它可能会采用 Unicode 组织对标识符的<a href="http://unicode.org/reports/tr31/">建议</a>中的一些想法。无论发生什么，都必须兼容地完成，同时保留（或扩展）字母大小写确定标识符可见性的方式，这仍然是我们最喜欢的 Go 特性之一。</p><p>目前，我们有一个简单的规则，以后可以在不破坏程序的情况下进行扩展，它可以避免肯定会因允许标识符不明确的规则而产生的错误。</p><h3 id="为什么-Go-没有功能-X？"><a href="#为什么-Go-没有功能-X？" class="headerlink" title="为什么 Go 没有功能 X？"></a>为什么 Go 没有功能 X？</h3><p>每种语言都包含新颖的功能，并省略了某人最喜欢的功能。 Go 的设计着眼于编程的便利性、编译的速度、概念的正交性以及支持并发和垃圾收集等特性的需求。您最喜欢的功能可能会因为不适合而丢失，因为它会影响编译速度或设计的清晰度，或者因为它会使基本系统模型变得过于困难。</p><p>如果 Go 缺少功能 X 让您感到困扰，请原谅我们并调查 Go 确实具有的功能。您可能会发现它们以有趣的方式弥补了 X 的缺失。</p><h3 id="Go-什么时候得到泛型类型？"><a href="#Go-什么时候得到泛型类型？" class="headerlink" title="Go 什么时候得到泛型类型？"></a>Go 什么时候得到泛型类型？</h3><p>Go 1.18 版本为语言添加了类型参数。这允许一种形式的多态或泛型编程。有关详细信息，请参<a href="https://golang.google.cn/ref/spec">阅语言规范</a>和<a href="https://golang.google.cn/design/43651-type-parameters">提案</a>。</p><h3 id="为什么-Go-最初发布时没有泛型类型？"><a href="#为什么-Go-最初发布时没有泛型类型？" class="headerlink" title="为什么 Go 最初发布时没有泛型类型？"></a>为什么 Go 最初发布时没有泛型类型？</h3><p>Go 旨在作为一种用于编写随时间推移易于维护的服务器程序的语言。 （有关更多背景信息，请参阅<a href="https://golang.google.cn/talks/2012/splash.article">本文</a>。）设计集中在可伸缩性、可读性和并发性等方面。多态编程在当时似乎对语言的目标并不重要，因此为了简单起见最初被排除在外。</p><p>泛型很方便，但它们的代价是类型系统和运行时的复杂性。开发一种我们认为赋予与复杂性成比例的价值的设计需要一段时间。</p><h3 id="为什么-Go-没有异常？"><a href="#为什么-Go-没有异常？" class="headerlink" title="为什么 Go 没有异常？"></a>为什么 Go 没有异常？</h3><p>我们认为，将异常耦合到控制结构，如 try-catch-finally 习惯用法，会导致代码复杂。它还倾向于鼓励程序员将太多的普通错误（例如无法打开文件）标记为异常。</p><p>Go 采用了不同的方法。对于简单的错误处理，Go 的多值返回可以很容易地报告错误而不会重载返回值。<a href="https://golang.google.cn/doc/articles/error_handling.html">规范的错误类型与 Go 的其他特性相结合</a>，使错误处理变得愉快，但与其他语言中的错误处理完全不同。</p><p>Go 还有一些内置函数可以发出信号并从真正的异常情况中恢复。恢复机制仅作为函数状态的一部分在错误后被拆除，这足以处理灾难，但不需要额外的控制结构，如果使用得当，可以产生干净的错误处理代码。</p><p>有关详细信息，请参阅<a href="https://golang.google.cn/doc/articles/defer_panic_recover.html">Defer, Panic, and Recover</a>文章。此外，<a href="https://blog.golang.org/errors-are-values">Errors are values</a> 博客文章描述了一种在 Go 中干净地处理错误的方法，通过演示，由于错误只是值，因此可以在错误处理中部署 Go 的全部功能。</p><h3 id="为什么-Go-没有断言？"><a href="#为什么-Go-没有断言？" class="headerlink" title="为什么 Go 没有断言？"></a>为什么 Go 没有断言？</h3><p>Go 不提供断言。不可否认，它们很方便，但我们的经验是，程序员将它们用作拐杖，以避免考虑正确的错误处理和报告。正确的错误处理意味着服务器继续运行而不是在发生非致命错误后崩溃。正确的错误报告意味着错误是直截了当的，使程序员免于解释大量的崩溃跟踪。当看到错误的程序员不熟悉代码时，精确的错误尤为重要。</p><p>我们知道这是一个争论点。 Go 语言和库中有许多与现代实践不同的地方，仅仅是因为我们觉得有时值得尝试不同的方法。</p><h3 id="为什么要在-CSP-的思想上构建并发？"><a href="#为什么要在-CSP-的思想上构建并发？" class="headerlink" title="为什么要在 CSP 的思想上构建并发？"></a>为什么要在 CSP 的思想上构建并发？</h3><p>随着时间的推移，并发和多线程编程以困难而闻名。我们认为这部分是由于复杂的设计（例如 <a href="https://en.wikipedia.org/wiki/POSIX_Threads">pthread</a>），部分是由于过分强调低级细节（例如互斥体、条件变量和内存屏障）。更高级别的接口可以实现更简单的代码，即使在幕后仍然存在互斥锁等。</p><p>为并发提供高级语言支持的最成功的模型之一来自 Hoare 的 Communicating Sequential Processes，或 CSP。 Occam 和 Erlang 是源自 CSP 的两种众所周知的语言。 Go 的并发原语源自家族树的不同部分，其主要贡献是将通道作为第一类对象的强大概念。几种早期语言的经验表明，<strong>CSP 模型非常适合过程语言框架</strong>。</p><h3 id="为什么使用-goroutine-而不是线程？"><a href="#为什么使用-goroutine-而不是线程？" class="headerlink" title="为什么使用 goroutine 而不是线程？"></a>为什么使用 goroutine 而不是线程？</h3><p>Goroutines 是使并发易于使用的一部分。这个想法已经存在了一段时间，它是<strong>将独立执行的函数（协程）多路复用到一组线程上</strong>。当协程阻塞时，例如通过调用阻塞系统调用，运行时会自动将同一操作系统线程上的其他协程移动到不同的可运行线程，这样它们就不会被阻塞。程序员看不到这些，这就是重点。结果，我们称之为 goroutine，可能非常廉价：除了堆栈内存之外，它们几乎没有开销，只有几千字节。</p><p>为了使堆栈变小，Go 的运行时使用可调整大小的有界堆栈。一个新创建的 goroutine 有几千字节，这几乎总是足够的。如果不是这样，运行时会自动增长（和缩小）用于存储堆栈的内存，从而允许许多 goroutines 存在于适度的内存中。 CPU 开销平均每个函数调用大约三个廉价指令。在同一个地址空间中创建数十万个 goroutine 是很实用的。如果 goroutines 只是线程，系统资源会以更少的数量耗尽。</p><h3 id="为什么-map-操作没有被定义为原子的？"><a href="#为什么-map-操作没有被定义为原子的？" class="headerlink" title="为什么 map 操作没有被定义为原子的？"></a>为什么 map 操作没有被定义为原子的？</h3><p>经过长时间的讨论，我们认为 map 的典型使用不需要多个 goroutine 的安全访问，在需要的情况下，map 可能是一些更大的数据结构或已经同步的计算的一部分。因此，要求所有映射操作都获取互斥锁会减慢大多数程序的速度并增加少数程序的安全性。然而，这不是一个容易的决定，因为这意味着不受控制的 map 访问可能会使程序崩溃。</p><p>该语言不排除原子映射更新。在需要时，例如在托管不受信任的程序时，实现可以互锁 map 访问。</p><p>只有在发生更新时， map 访问才是不安全的。只要所有的 goroutine 都只是读取——在 map 中查找元素，包括使用 for range 循环遍历它——而不是通过分配给元素或执行删除来更改 map，它们就可以安全地同时访问 map，而无需同步。</p><p>作为正确的 map 使用协助，该语言的一些实现包含一个特殊的检查，当 map 被并发执行不安全地修改时，该检查会在运行时自动报告。</p><h3 id="你会接受我的语言更改吗？"><a href="#你会接受我的语言更改吗？" class="headerlink" title="你会接受我的语言更改吗？"></a>你会接受我的语言更改吗？</h3><p>人们经常建议改进语言——<a href="https://groups.google.com/group/golang-nuts">邮件列表</a>包含丰富的此类讨论历史——但这些更改很少被接受。</p><p>尽管 Go 是一个开源项目，但语言和库受到<a href="https://golang.google.cn/doc/go1compat.html">兼容性承诺</a>的保护，该承诺防止破坏现有程序的更改，至少在源代码级别（程序可能需要偶尔重新编译以保持最新状态）。如果您的提案违反了 Go 1 规范，我们甚至无法接受这个想法，无论其优点如何。 Go 未来的主要版本可能与 Go 1 不兼容，但关于该主题的讨论才刚刚开始，有一点是肯定的：在此过程中引入的此类不兼容问题将非常少。此外，兼容性承诺鼓励我们为旧程序提供一条自动前进的路径，以便在出现这种情况时进行调整。</p><p>即使您的提案与 Go 1 规范兼容，它也可能不符合 Go 设计目标的精神。*<a href="https://golang.google.cn/talks/2012/splash.article">谷歌的 Go：软件工程服务中的语言设计</a>*一文解释了 Go 的起源及其设计背后的动机。</p><h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><h3 id="Go-是面向对象的语言吗？"><a href="#Go-是面向对象的语言吗？" class="headerlink" title="Go 是面向对象的语言吗？"></a>Go 是面向对象的语言吗？</h3><p>是，也不是。尽管 Go 有类型和方法并允许面向对象的编程风格，但没有类型层次结构。 Go 中的“接口”概念提供了一种不同的方法，我们认为这种方法易于使用，并且在某些方面更通用。还有一些方法可以将类型嵌入到其他类型中，以提供与子类化类似但不完全相同的东西。此外，Go 中的方法比 C++ 或 Java 中的方法更通用：它们可以为任何类型的数据定义，甚至是内置类型，例如普通的“unboxed”整数。它们不限于结构（类）。</p><p>此外，没有类型层次结构使得 Go 中的“对象”感觉比 C++ 或 Java 等语言更轻量。</p><h3 id="如何获得动态调用的方法？"><a href="#如何获得动态调用的方法？" class="headerlink" title="如何获得动态调用的方法？"></a>如何获得动态调用的方法？</h3><p>拥有动态调用方法的唯一方法是通过接口。结构或任何其他具体类型的方法总是静态解析。</p><h3 id="为什么没有类型继承？"><a href="#为什么没有类型继承？" class="headerlink" title="为什么没有类型继承？"></a>为什么没有类型继承？</h3><p>面向对象的编程，至少在最著名的语言中，涉及对类型之间关系的过多讨论，这些关系通常可以自动派生。 Go 采用了不同的方法。</p><p>不需要程序员提前声明两种类型是相关的，在 Go 中，类型自动满足任何指定其方法子集的接口。除了减少簿记之外，这种方法还具有真正的优势。类型可以同时满足多个接口，没有传统多重继承的复杂性。接口可以是非常轻量级的——具有一个甚至零个方法的接口可以表达一个有用的概念。如果出现新想法或进行测试，可以在事后添加接口——无需注释原始类型。因为类型和接口之间没有明确的关系，所以没有需要管理或讨论的类型层次结构。</p><p>可以使用这些想法来构建类似于类型安全的 Unix 管道的东西。例如，查看 <code>fmt.Fprintf</code> 如何将格式化打印到任何输出，而不仅仅是文件，或者 <code>bufio</code> 包如何与文件 I/O 完全分离，或者 <code>image</code> 包如何生成压缩图像文件。所有这些想法都源于表示单个方法（<code>Write</code>）的单个接口（<code>io.Writer</code>）。而这只是表面问题。 Go 的接口对程序的结构有着深远的影响。</p><p>这需要一些时间来适应，但这种隐含的类型依赖风格是 Go 最有成效的事情之一。</p><h3 id="为什么-len-是一个函数而不是一个方法？"><a href="#为什么-len-是一个函数而不是一个方法？" class="headerlink" title="为什么 len 是一个函数而不是一个方法？"></a>为什么 <code>len</code> 是一个函数而不是一个方法？</h3><p>我们讨论了这个问题，但决定将 <code>len</code> 和friends 实现为函数在实践中很好，并且不会使关于基本类型的接口（在Go 类型意义上）的问题复杂化。</p><h3 id="为什么-Go-不支持方法和运算符的重载？"><a href="#为什么-Go-不支持方法和运算符的重载？" class="headerlink" title="为什么 Go 不支持方法和运算符的重载？"></a>为什么 Go 不支持方法和运算符的重载？</h3><p>如果方法分派也不需要进行类型匹配，则它会被简化。使用其他语言的经验告诉我们，具有相同名称但不同签名的各种方法有时很有用，但在实践中也可能令人困惑和脆弱。仅按名称匹配并要求类型的一致性是 Go 类型系统中一个主要的简化决定。</p><p>关于运算符重载，它似乎比绝对要求更方便。同样，没有它，事情会变得更简单。</p><h3 id="为什么-Go-没有“实现”声明？"><a href="#为什么-Go-没有“实现”声明？" class="headerlink" title="为什么 Go 没有“实现”声明？"></a>为什么 Go 没有“实现”声明？</h3><p>Go 类型通过实现接口的方法来满足接口，仅此而已。此属性允许在无需修改现有代码的情况下定义和使用接口。它支持一种促进关注点分离和改进代码重用的结构类型，并且更容易在代码开发时出现的模式上进行构建。接口的语义是 Go 灵活、轻量级的主要原因之一。</p><p>有关更多详细信息，请参阅关于<a href="https://golang.google.cn/doc/faq#inheritance">类型继承的问题</a>。</p><h3 id="如何保证我的类型满足接口？"><a href="#如何保证我的类型满足接口？" class="headerlink" title="如何保证我的类型满足接口？"></a>如何保证我的类型满足接口？</h3><p>您可以要求编译器通过尝试使用 T 的零值或指向 T 的指针进行赋值来检查类型 T 是否实现了接口 I，视情况而定：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> T <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> <span class="token boolean">_</span> I <span class="token operator">=</span> T<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>       <span class="token comment">// Verify that T implements I.</span><span class="token keyword">var</span> <span class="token boolean">_</span> I <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>T<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// Verify that *T implements I.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果 <code>T</code>（或 <code>*T</code>）没有实现 <code>I</code>，错误将在编译时被发现。</p><p>如果您希望接口的用户明确声明他们实现了它，您可以将具有描述性名称的方法添加到接口的方法集中。例如：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Fooer <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>    <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">ImplementsFooer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>然后类型必须实现 <code>ImplementsFooer</code> 方法才能成为 <code>Fooer</code>，清楚地记录事实并在 <a href="https://golang.google.cn/cmd/go/#hdr-Show_documentation_for_package_or_symbol">go doc</a> 的输出中宣布它。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Bar <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token punctuation">(</span>b Bar<span class="token punctuation">)</span> <span class="token function">ImplementsFooer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token punctuation">(</span>b Bar<span class="token punctuation">)</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>大多数代码没有使用这些约束，因为它们限制了接口思想的实用性。但有时，它们对于解决相似接口之间的歧义是必要的。</p><h3 id="为什么类型-T-不满足-Equal-接口？"><a href="#为什么类型-T-不满足-Equal-接口？" class="headerlink" title="为什么类型 T 不满足 Equal 接口？"></a>为什么类型 T 不满足 Equal 接口？</h3><p>考虑这个简单的接口来表示一个可以将自己与另一个值进行比较的对象：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Equaler <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>    <span class="token function">Equal</span><span class="token punctuation">(</span>Equaler<span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这种类型，<code>T</code>:</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> T <span class="token builtin">int</span><span class="token keyword">func</span> <span class="token punctuation">(</span>t T<span class="token punctuation">)</span> <span class="token function">Equal</span><span class="token punctuation">(</span>u T<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> t <span class="token operator">==</span> u <span class="token punctuation">&#125;</span> <span class="token comment">// does not satisfy Equaler</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>与某些多态类型系统中的类似情况不同，<code>T</code> 没有实现 <code>Equaler</code>。 <code>T.Equal</code> 的参数类型是 <code>T</code>，而不是字面上要求的 <code>Equaler</code> 类型。</p><p>在 Go 中，类型系统不提倡 <code>Equal</code> 的参数；这是程序员的责任，如 <code>T2</code> 类型所示，它确实实现了 <code>Equaler</code>：</p><p>一个相关的例子是相反的：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Opener <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>   <span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Reader<span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token punctuation">(</span>t T3<span class="token punctuation">)</span> <span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>os<span class="token punctuation">.</span>File<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 Go 中，<code>T3</code> 不满足 <code>Opener</code>，尽管它可能在另一种语言中。</p><p>虽然在这种情况下，Go 的类型系统确实为程序员做的更少，但缺少子类型使得关于接口满足的规则很容易陈述：函数的名称和签名是否与接口完全相同？ Go 的规则也很容易高效地实现。我们认为这些好处抵消了自动类型提升的不足。如果有一天 Go 采用某种形式的多态类型，我们期望会有一种方法来表达这些示例的想法，并且还可以对它们进行静态检查。</p><h3 id="我可以将-T-转换为-interface-吗？"><a href="#我可以将-T-转换为-interface-吗？" class="headerlink" title="我可以将 []T 转换为 []interface{} 吗？"></a>我可以将 []T 转换为 []interface{} 吗？</h3><p>不是直接的。语言规范不允许这样做，因为这两种类型在内存中没有相同的表示。有必要将元素单独复制到目标切片。此示例将 int 切片转换为 interface{} 切片：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">t <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">&#125;</span>s <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> i<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> t <span class="token punctuation">&#123;</span>    s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> v<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="如果-T1-和-T2-具有相同的基础类型，我可以将-T1-转换为-T2-吗？"><a href="#如果-T1-和-T2-具有相同的基础类型，我可以将-T1-转换为-T2-吗？" class="headerlink" title="如果 T1 和 T2 具有相同的基础类型，我可以将 [] T1 转换为 [] T2 吗？"></a>如果 T1 和 T2 具有相同的基础类型，我可以将 [] T1 转换为 [] T2 吗？</h3><p>此代码示例的最后一行无法编译。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> T1 <span class="token builtin">int</span><span class="token keyword">type</span> T2 <span class="token builtin">int</span><span class="token keyword">var</span> t1 T1<span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token function">T2</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span> <span class="token comment">// OK</span><span class="token keyword">var</span> st1 <span class="token punctuation">[</span><span class="token punctuation">]</span>T1<span class="token keyword">var</span> sx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>T2<span class="token punctuation">)</span><span class="token punctuation">(</span>st1<span class="token punctuation">)</span> <span class="token comment">// NOT OK</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在 Go 中，类型与方法密切相关，因为每个命名类型都有一个（可能为空的）方法集。一般规则是您可以更改要转换的类型的名称（因此可能更改其方法集），但不能更改复合类型元素的名称（和方法集）。 Go 要求你明确类型转换。</p><h3 id="为什么我的-nil-错误值不等于-nil？"><a href="#为什么我的-nil-错误值不等于-nil？" class="headerlink" title="为什么我的 nil 错误值不等于 nil？"></a>为什么我的 nil 错误值不等于 nil？</h3><p>在幕后，接口被实现为两个元素，一个类型 <code>T</code> 和一个值 <code>V</code>。<code>V</code> 是一个具体的值，例如 int、结构或指针，而不是接口本身，并且具有类型 <code>T</code>。例如，如果我们存储接口中的 <code>int</code> 值 3，结果接口值示意性地具有 (<code>T=int</code>, <code>V=3</code>)。值 <code>V</code> 也称为接口的动态值，因为给定的接口变量在程序执行期间可能保存不同的值 <code>V</code>（和相应的类型 <code>T</code>）。</p><p>只有当 <code>V</code> 和 <code>T</code> 都未设置时，接口值才为 <code>nil</code>，（<code>T=nil</code>，<code>V</code> 未设置），特别是，<code>nil</code> 接口将始终保持 <code>nil</code> 类型。如果我们将 <code>*int</code> 类型的 <code>nil</code> 指针存储在接口值中，则内部类型将是 <code>*int</code> 而与指针的值无关：(<code>T=*int</code>, <code>V=nil</code>)。因此，即使内部的指针值 <code>V</code> 为 <code>nil</code>，这样的接口值也将非 <code>nil</code>。</p><p>这种情况可能会令人困惑，并且当 <code>nil</code> 值存储在接口值中时会出现，例如 <code>error</code> 返回：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">returnsError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> p <span class="token operator">*</span>MyError <span class="token operator">=</span> <span class="token boolean">nil</span>    <span class="token keyword">if</span> <span class="token function">bad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        p <span class="token operator">=</span> ErrBad    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> p <span class="token comment">// Will always return a non-nil error.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果一切顺利，该函数返回一个 <code>nil</code> <code>p</code>，因此返回值是一个错误接口值持有 (<code>T=*MyError</code>, <code>V=nil</code>)。这意味着如果调用者将返回的错误与 <code>nil</code> 进行比较，即使没有发生任何不好的事情，它也总是看起来好像有错误。要向调用者返回正确的 <code>nil</code> 错误，函数必须返回显式的 <code>nil</code>：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">returnsError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token function">bad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> ErrBad    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对于返回错误的函数，最好在其签名中始终使用错误类型（正如我们上面所做的那样），而不是像 <code>*MyError</code> 这样的具体类型，以帮助确保正确创建错误。例如，<code>os.Open</code> 返回一个错误，即使不是 <code>nil</code>，它也总是具体类型 <code>*os.PathError</code>。</p><p>每当使用接口时，都会出现与此处描述的类似情况。请记住，如果接口中存储了任何具体值，则接口不会为 nil。有关更多信息，请参阅<a href="https://golang.google.cn/doc/articles/laws_of_reflection.html">反射定律</a>。</p><h3 id="为什么没有未标记的联合，就像在-C-中一样？"><a href="#为什么没有未标记的联合，就像在-C-中一样？" class="headerlink" title="为什么没有未标记的联合，就像在 C 中一样？"></a>为什么没有未标记的联合，就像在 C 中一样？</h3><p>未标记的联合会违反 Go 的内存安全保证。</p><h3 id="为什么-Go-没有变体类型？"><a href="#为什么-Go-没有变体类型？" class="headerlink" title="为什么 Go 没有变体类型？"></a>为什么 Go 没有变体类型？</h3><p>变体类型，也称为代数类型，提供了一种方法来指定一个值可能采用一组其他类型中的一个，但仅限于这些类型。系统编程中的一个常见示例将指定错误是网络错误、安全错误或应用程序错误，并允许调用者通过检查错误的类型来区分问题的根源。另一个例子是语法树，其中每个节点可以是不同的类型：声明、语句、赋值等等。</p><p>我们考虑在 Go 中添加变体类型，但在讨论后决定将它们排除在外，因为它们以令人困惑的方式与接口重叠。如果变体类型的元素本身就是接口会发生什么？</p><p>此外，该语言已经涵盖了一些变体类型地址。错误示例很容易表达，使用接口值来保存错误并使用类型开关来区分情况。语法树示例也是可行的，尽管没有那么优雅。</p><h3 id="为什么-Go-没有协变结果类型？"><a href="#为什么-Go-没有协变结果类型？" class="headerlink" title="为什么 Go 没有协变结果类型？"></a>为什么 Go 没有协变结果类型？</h3><p>协变结果类型意味着像</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> Copyable <span class="token keyword">interface</span> <span class="token punctuation">&#123;</span>    <span class="token function">Copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>该方法会满足</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>v Value<span class="token punctuation">)</span> <span class="token function">Copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Value<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>因为 <code>Value</code> 实现了空接口。在 Go 中方法类型必须完全匹配，所以 <code>Value</code> 没有实现 <code>Copyable</code>。 Go 将类型做什么的概念——它的方法——从类型的实现中分离出来。如果两个方法返回不同的类型，它们就不是在做同样的事情。想要协变结果类型的程序员经常尝试通过接口来表达类型层次结构。在 Go 中，在接口和实现之间有一个清晰的分离更为自然。</p><h2 id="Values"><a href="#Values" class="headerlink" title="Values"></a>Values</h2><h3 id="为什么-Go-不提供隐式数字转换？"><a href="#为什么-Go-不提供隐式数字转换？" class="headerlink" title="为什么 Go 不提供隐式数字转换？"></a>为什么 Go 不提供隐式数字转换？</h3><p>C 中数字类型之间自动转换的便利性被它引起的混乱所抵消。什么时候表达式是无符号的？价值有多大？它溢出了吗？结果是否可移植，独立于执行它的机器？它也使编译器复杂化； “通常的算术转换”不容易实现，并且跨架构不一致。出于可移植性的原因，我们决定以代码中的一些显式转换为代价使事情变得清晰明了。不过，Go 中常量的定义——没有符号和大小注释的任意精度值——大大改善了问题。</p><p>一个相关的细节是，与 C 不同，<code>int</code> 和 <code>int64</code> 是不同的类型，即使 <code>int</code> 是 64 位类型。 <code>int</code> 类型是通用的；如果您关心整数包含多少位，Go 鼓励您明确表示。</p><h3 id="常量在-Go-中是如何工作的？"><a href="#常量在-Go-中是如何工作的？" class="headerlink" title="常量在 Go 中是如何工作的？"></a>常量在 Go 中是如何工作的？</h3><p>尽管 Go 对不同数值类型的变量之间的转换有严格的要求，但语言中的常量要灵活得多。诸如 <code>23</code>、<code>3.14159</code> 和 <code>math.Pi</code> 等字面常量占据了一种理想的数字空间，具有任意精度，没有上溢或下溢。例如，<code>math.Pi</code> 的值在源代码中被指定为 63 位，并且涉及该值的常量表达式保持的精度超出了 <code>float64</code> 所能容纳的范围。只有将常量或常量表达式分配给变量（程序中的内存位置）时，它才会成为具有通常浮点属性和精度的“计算机”数字。</p><p>此外，由于它们只是数字，而不是类型值，因此 Go 中的常量可以比变量更自由地使用，从而缓解了围绕严格转换规则的一些尴尬。可以写出诸如</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">sqrt2 <span class="token operator">:=</span> math<span class="token punctuation">.</span><span class="token function">Sqrt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>无需编译器抱怨，因为理想的数字 <code>2</code> 可以安全准确地转换为 <code>float64</code> 以调用 <code>math.Sqrt</code>。</p><p>一篇名为 <a href="https://blog.golang.org/constants">Constants</a> 的博客文章更详细地探讨了这个主题。</p><h3 id="为什么要内置-map？"><a href="#为什么要内置-map？" class="headerlink" title="为什么要内置 map？"></a>为什么要内置 map？</h3><p>与字符串相同的原因是：它们是如此强大和重要的数据结构，它提供了一个具有语法支持的出色实现，使编程更加愉快。我们相信 Go 的 map 实现足够强大，可以满足绝大多数用途。如果特定应用程序可以从自定义实现中受益，则可以编写一个，但在语法上不会那么方便；这似乎是一个合理的权衡。</p><h3 id="为什么-map-不允许切片作为键？"><a href="#为什么-map-不允许切片作为键？" class="headerlink" title="为什么 map 不允许切片作为键？"></a>为什么 map 不允许切片作为键？</h3><p>map 查找需要一个相等运算符，切片不实现。它们没有实现相等，因为在此类类型上没有很好地定义相等；有多个考虑因素，涉及浅层与深层比较、指针与值比较、如何处理递归类型等等。我们可能会重新审视这个问题——实现切片相等不会使任何现有程序无效——但如果不清楚切片相等应该意味着什么，现在将其忽略会更简单。</p><p>在 Go 1 中，与以前的版本不同，为结构和数组定义了相等性，因此这些类型可以用作映射键。但是，切片仍然没有相等的定义。</p><h3 id="为什么映射、切片和通道是引用，而数组是值？"><a href="#为什么映射、切片和通道是引用，而数组是值？" class="headerlink" title="为什么映射、切片和通道是引用，而数组是值？"></a>为什么映射、切片和通道是引用，而数组是值？</h3><p>关于这个话题有很多历史。早期，map 和通道在语法上是指针，不可能声明或使用非指针实例。此外，我们还为数组应该如何工作而苦苦挣扎。最终我们决定指针和值的严格分离使语言更难使用。更改这些类型以充当对关联的共享数据结构的引用解决了这些问题。这种变化给语言增加了一些令人遗憾的复杂性，但对可用性产生了很大影响：Go 在引入时成为一种更高效、更舒适的语言。</p><h2 id="编写代码"><a href="#编写代码" class="headerlink" title="编写代码"></a>编写代码</h2><h3 id="库文档是如何记录的？"><a href="#库文档是如何记录的？" class="headerlink" title="库文档是如何记录的？"></a>库文档是如何记录的？</h3><p>有一个用 Go 编写的程序 godoc，它从源代码中提取包文档并将其作为一个网页提供，其中包含指向声明、文件等的链接。一个实例正在 <a href="https://golang.google.cn/pkg/">golang.org/pkg/</a> 上运行。事实上，godoc 在 <a href="https://golang.google.cn/">golang.org/</a> 上实现了完整的站点。</p><p><code>godoc</code> 实例可以配置为在它显示的程序中提供丰富的、交互式的符号静态分析；详细信息在<a href="https://golang.google.cn/lib/godoc/analysis/help.html">此处</a>列出。</p><p>为了从命令行访问文档，<a href="https://golang.google.cn/pkg/cmd/go/">go</a> 工具有一个 <a href="https://golang.google.cn/pkg/cmd/go/#hdr-Show_documentation_for_package_or_symbol">doc</a> 子命令，它为相同的信息提供了一个文本界面。</p><h3 id="有-Go-编程风格指南吗？"><a href="#有-Go-编程风格指南吗？" class="headerlink" title="有 Go 编程风格指南吗？"></a>有 Go 编程风格指南吗？</h3><p>没有明确的风格指南，尽管肯定有一种可识别的“Go 风格”。</p><p>Go 已经建立了约定来指导围绕命名、布局和文件组织的决策。文档 <a href="https://golang.google.cn/doc/effective_go.html">Effective Go</a> 包含关于这些主题的一些建议。更直接地说，程序 <code>gofmt</code> 是一个漂亮的打印机，其目的是强制执行布局规则。它取代了允许解释的通常的注意事项纲要。存储库中的所有 Go 代码，以及开源世界中的绝大多数代码，都是通过 <code>gofmt</code> 运行的。</p><p>标题为 <a href="https://golang.google.cn/s/comments">Go Code Review Comments</a> 的文档是一组非常简短的文章，这些文章介绍了程序员经常错过的 Go 习惯用法的细节。对于为 Go 项目进行代码审查的人来说，它是一个方便的参考。</p><h3 id="如何向-Go-库提交补丁？"><a href="#如何向-Go-库提交补丁？" class="headerlink" title="如何向 Go 库提交补丁？"></a>如何向 Go 库提交补丁？</h3><p>库源位于存储库的 src 目录中。如果您想做出重大改变，请在开始之前在邮件列表中讨论。</p><p>有关如何继续进行的更多信息，请参阅文档对 <a href="https://golang.google.cn/doc/contribute.html">Go 项目的贡献</a>。</p><h3 id="为什么在克隆存储库时“go-get”使用-HTTPS？"><a href="#为什么在克隆存储库时“go-get”使用-HTTPS？" class="headerlink" title="为什么在克隆存储库时“go get”使用 HTTPS？"></a>为什么在克隆存储库时“go get”使用 HTTPS？</h3><p>公司通常只允许标准 TCP 端口 80 (HTTP) 和 443 (HTTPS) 上的传出流量，阻止其他端口上的传出流量，包括 TCP 端口 9418 (git) 和 TCP 端口 22 (SSH)。当使用 HTTPS 而不是 HTTP 时，<code>git</code> 默认强制执行证书验证，提供针对中间人、窃听和篡改攻击的保护。因此 <code>go get</code> 命令使用 HTTPS 以确保安全。</p><p><code>Git</code> 可以配置为通过 HTTPS 进行身份验证或使用 SSH 代替 HTTPS。要通过 HTTPS 进行身份验证，您可以在 <code>git</code> 查询的 <code>$HOME/.netrc</code> 文件中添加一行：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">machine github.com login USERNAME password APIKEY<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>对于 GitHub 帐户，密码可以是<a href="https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/">个人访问令牌</a>。</p><p><code>Git</code> 也可以配置为使用 SSH 代替 HTTPS 来匹配给定前缀的 URL。例如，要对所有 GitHub 访问使用 SSH，请将这些行添加到您的 <code>~/.gitconfig</code>：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>url <span class="token string">"ssh://git@github.com/"</span><span class="token punctuation">]</span>    insteadOf <span class="token operator">=</span> https://github.com/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="我应该如何使用“go-get”管理包版本？"><a href="#我应该如何使用“go-get”管理包版本？" class="headerlink" title="我应该如何使用“go get”管理包版本？"></a>我应该如何使用“go get”管理包版本？</h3><p>Go 工具链有一个内置系统，用于管理版本化的相关包集，称为模块。模块是在 Go 1.11 中引入的，并且自 <a href="https://golang.google.cn/doc/go1.14#introduction">1.14</a> 起已准备好用于生产。</p><p>要使用模块创建项目，请运行 <code>go mod init</code>。此命令创建一个跟踪依赖版本的 <code>go.mod</code> 文件。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go mod init example/project<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>要添加、升级或降级依赖项，请运行 <code>go get</code>：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">go get golang.org/x/text@v0.3.5<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>有关入门的更多信息，请参阅教程：<a href="https://golang.google.cn/doc/tutorial/create-module.html">创建模块</a>。</p><p>有关使用模块管理依赖项的指南，请参阅<a href="https://golang.google.cn/doc/#developing-modules">开发模块</a>。</p><p>模块中的包应遵循<a href="https://research.swtch.com/vgo-import">导入兼容性规则</a>，随着它们的发展保持向后兼容性：</p><ul><li>如果旧包和新包具有相同的导入路径  </li><li>新包必须向后兼容旧包</li></ul><p><a href="https://golang.google.cn/doc/go1compat.html">Go 1 兼容性指南</a>在这里是一个很好的参考：不要删除导出的名称，鼓励标记复合文字，等等。如果需要不同的功能，请添加新名称而不是更改旧名称。</p><p>模块通过<a href="https://semver.org/">语义版本控制</a>和语义导入版本控制对此进行编码。如果需要中断兼容性，请以新的主要版本发布模块。主版本 2 及更高版本的模块需要<a href="https://golang.google.cn/ref/mod#major-version-suffixes">主版本后缀</a>作为其路径的一部分（如 /v2）。这保留了导入兼容性规则：模块的不同主要版本中的包具有不同的路径。</p><h2 id="指针和分配"><a href="#指针和分配" class="headerlink" title="指针和分配"></a>指针和分配</h2><h3 id="函数参数什么时候传值？"><a href="#函数参数什么时候传值？" class="headerlink" title="函数参数什么时候传值？"></a>函数参数什么时候传值？</h3><p>与 C 家族中的所有语言一样，Go 中的所有内容都是按值传递的。也就是说，一个函数总是得到一个被传递的东西的副本，就好像有一个赋值语句将值分配给参数一样。例如，将 <code>int</code> 值传递给函数会生成 <code>int</code> 的副本，传递指针值会生成指针的副本，但不会复制它指向的数据。 （有关这如何影响方法接收器的讨论，请参见<a href="#%E6%88%91%E5%BA%94%E8%AF%A5%E5%9C%A8%E5%80%BC%E6%88%96%E6%8C%87%E9%92%88%E4%B8%8A%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95%E5%90%97%EF%BC%9F">后面的部分</a>。）</p><p>映射和切片值的行为类似于指针：它们是包含指向底层映射或切片数据的指针的描述符。复制地图或切片值不会复制它指向的数据。复制接口值会复制存储在接口值中的事物。如果接口值包含一个结构，则复制接口值会复制该结构。如果接口值包含一个指针，则复制接口值会复制指针，但不会复制它指向的数据。</p><p>请注意，此讨论是关于操作的语义。只要优化不改变语义，实际实现可能会应用优化以避免复制。</p><h3 id="什么时候应该使用指向接口的指针？"><a href="#什么时候应该使用指向接口的指针？" class="headerlink" title="什么时候应该使用指向接口的指针？"></a>什么时候应该使用指向接口的指针？</h3><p>几乎从不。指向接口值的指针只出现在罕见的、棘手的情况下，包括为延迟评估而伪装接口值的类型。</p><p>将指向接口值的指针传递给期望接口的函数是一个常见的错误。编译器会抱怨这个错误，但情况仍然可能令人困惑，因为有时需要一个<a href="https://golang.google.cn/doc/faq#different_method_sets">指针来满足接口</a>。洞察力是，尽管指向具体类型的指针可以满足接口，但有一个例外，指向接口的指针永远不能满足接口。</p><p>考虑变量声明，</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> w io<span class="token punctuation">.</span>Writer<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>打印函数 <code>fmt.Fprintf</code> 将满足 <code>io.Writer</code> 的值作为其第一个参数——它实现了规范的 <code>Write</code> 方法。因此我们可以写</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token string">"hello, world\n"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是，如果我们传递 <code>w</code> 的地址，程序将无法编译。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">fmt<span class="token punctuation">.</span><span class="token function">Fprintf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>w<span class="token punctuation">,</span> <span class="token string">"hello, world\n"</span><span class="token punctuation">)</span> <span class="token comment">// Compile-time error.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>一个例外是，任何值，甚至是指向接口的指针，都可以分配给空接口类型 (<code>interface&#123;&#125;</code>) 的变量。即便如此，如果值是指向接口的指针，那几乎肯定是错误的。结果可能令人困惑。</p><h3 id="我应该在值或指针上定义方法吗？"><a href="#我应该在值或指针上定义方法吗？" class="headerlink" title="我应该在值或指针上定义方法吗？"></a>我应该在值或指针上定义方法吗？</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>MyStruct<span class="token punctuation">)</span> <span class="token function">pointerMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// method on pointer</span><span class="token keyword">func</span> <span class="token punctuation">(</span>s MyStruct<span class="token punctuation">)</span>  <span class="token function">valueMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// method on value</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>对于不习惯指针的程序员来说，这两个例子之间的区别可能会让人感到困惑，但情况其实很简单。当在一个类型上定义一个方法时，接收者（在上面的例子中）表现得就像它是方法的一个参数一样。将接收者定义为值还是指针是同一个问题，那么，函数参数应该是值还是指针。有几个考虑。</p><p>首先，也是最重要的，该方法是否需要修改接收器？如果是这样，接收者必须是一个指针。 （切片和映射充当引用，因此它们的故事有点微妙，但例如要在方法中更改切片的长度，接收者仍然必须是指针。）在上面的示例中，如果 <code>pointerMethod</code> 修改了<code>s</code>，调用者将看到这些更改，但 <code>valueMethod</code> 是使用调用者参数的副本调用的（这是传递值的定义），因此调用者将看不到它所做的更改。</p><p>顺便说一句，在 Java 中，方法接收器始终是指针，尽管它们的指针性质有些伪装（并且有人提议在语言中添加值接收器）。 Go 中的值接收器是不寻常的。</p><p>其次是效率的考虑。如果接收器很大，例如一个大结构，使用指针接收器会便宜得多。</p><p>其次是一致性。如果该类型的某些方法必须具有指针接收器，那么其余的也应该具有，因此无论该类型如何使用，方法集都是一致的。有关详细信息，请参阅<a href="https://golang.google.cn/doc/faq#different_method_sets">方法集</a>部分。</p><p>对于基本类型、切片和小型结构等类型，值接收器非常便宜，因此除非方法的语义需要指针，否则值接收器是高效且清晰的。</p><h3 id="new-和-make-有什么区别？"><a href="#new-和-make-有什么区别？" class="headerlink" title="new 和 make 有什么区别？"></a>new 和 make 有什么区别？</h3><p>简而言之：<code>new</code> 分配内存，而 <code>make</code> 初始化 <code>slice</code>、<code>map</code> 和 <code>channel</code> 类型。</p><p>有关详细信息，请参阅 <a href="https://golang.google.cn/doc/effective_go.html#allocation_new">Effective Go 的相关部分</a>。</p><h3 id="64-位机器上的-int-大小是多少？"><a href="#64-位机器上的-int-大小是多少？" class="headerlink" title="64 位机器上的 int 大小是多少？"></a>64 位机器上的 int 大小是多少？</h3><p><code>int</code> 和 <code>uint</code> 的大小是特定于实现的，但在给定平台上彼此相同。为了可移植性，依赖于特定大小值的代码应使用显式大小的类型，如 <code>int64</code>。在 32 位机器上，编译器默认使用 32 位整数，而在 64 位机器上，整数有 64 位。 （从历史上看，这并不总是正确的。）</p><p>另一方面，浮点标量和复数类型总是有大小的（没有浮点数或复数基本类型），因为程序员在使用浮点数时应该注意精度。用于（无类型）浮点常量的默认类型是 <code>float64</code>。因此 <code>foo := 3.0</code> 声明了一个 <code>float64</code> 类型的变量 foo。对于由（无类型）常量初始化的 <code>float32</code> 变量，必须在变量声明中明确指定变量类型：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> foo <span class="token builtin">float32</span> <span class="token operator">=</span> <span class="token number">3.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或者，必须为常量赋予一个转换类型，如 <code>foo := float32(3.0)</code>。</p><h3 id="我如何知道变量是分配在堆上还是栈上？"><a href="#我如何知道变量是分配在堆上还是栈上？" class="headerlink" title="我如何知道变量是分配在堆上还是栈上？"></a>我如何知道变量是分配在堆上还是栈上？</h3><p>从正确性的角度来看，您不需要知道。只要有对它的引用，Go 中的每个变量就存在。实现选择的存储位置与语言的语义无关。</p><p>存储位置确实对编写高效程序有影响。如果可能，Go 编译器将在该函数的堆栈帧中分配该函数的本地变量。但是，如果编译器在函数返回后无法证明该变量未被引用，那么编译器必须在垃圾回收堆上分配该变量以避免悬空指针错误。此外，如果局部变量非常大，将其存储在堆上而不是堆栈上可能更有意义。</p><p>在当前的编译器中，如果一个变量的地址被占用，那么该变量就是在堆上分配的候选者。但是，基本的逃逸分析会识别某些情况，即此类变量不会超过函数的返回值并且可以驻留在堆栈中。</p><h3 id="为什么我的-Go-进程使用这么多虚拟内存？"><a href="#为什么我的-Go-进程使用这么多虚拟内存？" class="headerlink" title="为什么我的 Go 进程使用这么多虚拟内存？"></a>为什么我的 Go 进程使用这么多虚拟内存？</h3><p>Go 内存分配器保留了一个大的虚拟内存区域作为分配的竞技场。这个虚拟内存对于特定的 Go 进程是本地的；保留不会剥夺其他进程的内存。</p><p>要查找分配给 Go 进程的实际内存量，请使用 Unix <code>top</code> 命令并查阅 <code>RES</code> (Linux) 或 <code>RSIZE</code> (macOS) 列</p><h2 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h2><h3 id="哪些操作是原子的？互斥体呢？"><a href="#哪些操作是原子的？互斥体呢？" class="headerlink" title="哪些操作是原子的？互斥体呢？"></a>哪些操作是原子的？互斥体呢？</h3><p>Go 中操作的原子性描述可以在 <a href="https://golang.google.cn/ref/mem">Go 内存模型</a>文档中找到。</p><p>低级同步和原子原语在 <a href="https://golang.google.cn/pkg/sync">sync</a> 和 <a href="https://golang.google.cn/pkg/sync/atomic">sync/atomic</a> 中可用。这些包适用于简单的任务，例如增加引用计数或保证小规模互斥。</p><p>对于更高级别的操作，例如并发服务器之间的协调，更高级别的技术可以带来更好的程序，Go 通过其 goroutine 和通道支持这种方法。例如，您可以构建您的程序，以便一次只有一个 goroutine 负责特定的数据。原始的 <a href="https://www.youtube.com/watch?v=PAAkCSZUG1c">Go 谚语</a>总结了这种方法，</p><p>不要通过共享内存进行通信。相反，通过通信共享内存。</p><p>有关此概念的详细讨论，请参阅“<a href="https://golang.google.cn/doc/codewalk/sharemem/">通过通信代码共享内存</a>”及其<a href="https://blog.golang.org/2010/07/share-memory-by-communicating.html">相关文章</a>。</p><p>大型并发程序可能会从这两个工具包中借用。</p><h3 id="为什么我的程序没有更多-CPU-运行得更快？"><a href="#为什么我的程序没有更多-CPU-运行得更快？" class="headerlink" title="为什么我的程序没有更多 CPU 运行得更快？"></a>为什么我的程序没有更多 CPU 运行得更快？</h3><p>一个程序是否在更多 CPU 上运行得更快取决于它要解决的问题。 Go 语言提供并发原语，例如 goroutine 和通道，但并发仅在底层问题本质上是并行时才启用并行性。本质上是顺序的问题不能通过添加更多的 CPU 来加速，而那些可以分解成可以并行执行的部分的问题可以加速，有时甚至是显着的。</p><p>有时添加更多 CPU 会减慢程序速度。实际上，花费更多时间进行同步或通信而不是进行有用计算的程序在使用多个操作系统线程时可能会遇到性能下降。这是因为在线程之间传递数据涉及切换上下文，这会产生巨大的成本，而且随着 CPU 的增加，成本会增加。例如，Go 规范中的<a href="https://golang.google.cn/ref/spec#An_example_package">素筛示例</a>虽然启动了许多 goroutine，但并没有显着的并行性；增加线程（CPU）的数量更有可能减慢速度而不是加快速度。</p><p>有关此主题的更多详细信息，请参阅题为“<a href="https://blog.golang.org/2013/01/concurrency-is-not-parallelism.html">并发不是并行</a>”的演讲。</p><h3 id="如何控制-CPU-的数量？"><a href="#如何控制-CPU-的数量？" class="headerlink" title="如何控制 CPU 的数量？"></a>如何控制 CPU 的数量？</h3><p>可同时执行 goroutine 的 CPU 数量由 <code>GOMAXPROCS</code> shell 环境变量控制，其默认值是可用的 CPU 内核数。因此，具有并行执行潜力的程序应该默认在多 CPU 机器上实现它。要更改要使用的并行 CPU 数量，请设置环境变量或使用运行时包的类似名称<a href="https://golang.google.cn/pkg/runtime/#GOMAXPROCS">函数</a>来配置运行时支持以利用不同数量的线程。将其设置为 1 消除了真正并行的可能性，迫使独立的 goroutine 轮流执行。</p><p>运行时可以分配比 <code>GOMAXPROCS</code> 的值更多的线程来服务多个未完成的 I/O 请求。 <code>GOMAXPROCS</code> 只影响一次实际可以执行多少个 goroutine；在系统调用中可能会阻塞任意更多。</p><p>Go 的 goroutine 调度器并没有它需要的那么好，尽管随着时间的推移它已经改进了。未来，它可能会更好地优化其对 OS 线程的使用。目前，如果存在性能问题，基于每个应用程序设置 <code>GOMAXPROCS</code> 可能会有所帮助。</p><h3 id="为什么没有goroutine-ID？"><a href="#为什么没有goroutine-ID？" class="headerlink" title="为什么没有goroutine ID？"></a>为什么没有goroutine ID？</h3><p>Goroutines 没有名字；他们只是匿名的工人。它们不向程序员公开唯一标识符、名称或数据结构。有些人对此感到惊讶，期望 go 语句返回一些可用于稍后访问和控制 goroutine 的项。</p><p>goroutines 是匿名的根本原因是在编写并发代码时可以使用完整的 Go 语言。相比之下，在命名线程和 goroutine 时开发的使用模式会限制使用它们的库可以做什么。</p><p>这是困难的例证。一旦命名了一个 goroutine 并围绕它构建了一个模型，它就变得特别了，并且人们很想将所有计算与该 goroutine 相关联，而忽略了使用多个可能共享的 goroutine 进行处理的可能性。如果 <code>net/http</code> 包将 per-request 状态与 goroutine 相关联，则客户端在处理请求时将无法使用更多 goroutine。</p><p>此外，诸如图形系统库之类的库的经验表明，这些库要求所有处理都发生在“主线程”上，这表明当以并发语言部署时，这种方法是多么尴尬和限制。特殊线程或 goroutine 的存在迫使程序员扭曲程序以避免因无意中在错误线程上操作而导致的崩溃和其他问题</p><p>对于特定 goroutine 真正特殊的情况，该语言提供了诸如通道之类的功能，可以以灵活的方式与之交互。</p><h2 id="函数和方法"><a href="#函数和方法" class="headerlink" title="函数和方法"></a>函数和方法</h2><h3 id="为什么-T-和-T-有不同的方法集？"><a href="#为什么-T-和-T-有不同的方法集？" class="headerlink" title="为什么 T 和 *T 有不同的方法集？"></a>为什么 T 和 *T 有不同的方法集？</h3><p>正如 <a href="https://golang.google.cn/ref/spec#Types">Go 规范</a>所说，一个类型 <code>T</code> 的方法集由所有接收者类型为 <code>T</code> 的方法组成，而对应指针类型 <code>*T</code> 的方法集由所有接收者为 <code>*T</code> 或 <code>T</code> 的方法组成。这意味着 <code>*T</code> 的方法集包括 <code>T</code> 的，但不包括相反的。</p><p>之所以出现这种区别，是因为如果接口值包含指针 <code>*T</code>，则方法调用可以通过取消引用指针来获取值，但如果接口值包含值 <code>T</code>，则方法调用没有安全的方法来获取指针。 （这样做将允许方法修改接口内的值的内容，这是语言规范所不允许的。）</p><p>即使在编译器可以将值的地址传递给方法的情况下，如果方法修改了值，这些更改也会在调用者中丢失。例如，如果 <code>bytes.Buffer</code> 的 <code>Write</code> 方法使用值接收器而不是指针，则此代码：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> buf bytes<span class="token punctuation">.</span>Bufferio<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> os<span class="token punctuation">.</span>Stdin<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>会将标准输入复制到 <code>buf</code> 的副本中，而不是 <code>buf</code> 本身。这几乎不是所期望的行为。</p><h3 id="作为-goroutine-运行的闭包会发生什么？"><a href="#作为-goroutine-运行的闭包会发生什么？" class="headerlink" title="作为 goroutine 运行的闭包会发生什么？"></a>作为 goroutine 运行的闭包会发生什么？</h3><p>并发使用闭包时可能会出现一些混淆。考虑以下程序：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    done <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">bool</span><span class="token punctuation">)</span>    values <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> values <span class="token punctuation">&#123;</span>        <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>            done <span class="token operator">&lt;-</span> <span class="token boolean">true</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// wait for all goroutines to complete before exiting</span>    <span class="token keyword">for</span> <span class="token boolean">_</span> <span class="token operator">=</span> <span class="token keyword">range</span> values <span class="token punctuation">&#123;</span>        <span class="token operator">&lt;-</span>done    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>人们可能会错误地期望看到 <code>a</code>、<code>b</code>、<code>c</code> 作为输出。相反，您可能会看到 <code>c</code>、<code>c</code>、<code>c</code>。这是因为循环的每次迭代都使用变量 <code>v</code> 的相同实例，因此每个闭包共享该单个变量。当闭包运行时，它会在执行 <code>fmt.Println</code> 时打印 <code>v</code> 的值，但 <code>v</code> 可能在 goroutine 启动后已被修改。为了帮助在这些问题和其他问题发生之前发现它们，运行 <code>go vet</code>。</p><p>要在启动时将 <code>v</code> 的当前值绑定到每个闭包，必须修改内部循环以在每次迭代时创建一个新变量。一种方法是将变量作为参数传递给闭包：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> values <span class="token punctuation">&#123;</span>    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>u <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span>        done <span class="token operator">&lt;-</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在此示例中， <code>v</code> 的值作为参数传递给匿名函数。然后该值可以在函数内部作为变量 <code>u</code> 访问。</p><p>更简单的是创建一个新变量，使用一种可能看起来很奇怪但在 Go 中可以正常工作的声明风格：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> values <span class="token punctuation">&#123;</span>    v <span class="token operator">:=</span> v <span class="token comment">// create a new 'v'.</span>    <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>        done <span class="token operator">&lt;-</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>语言的这种行为，没有为每次迭代定义一个新变量，回想起来可能是一个错误。它可能会在以后的版本中得到解决，但为了兼容性，在 Go 版本 1 中不能更改。</p><h2 id="控制流"><a href="#控制流" class="headerlink" title="控制流"></a>控制流</h2><h3 id="为什么-Go-没有-运算符？"><a href="#为什么-Go-没有-运算符？" class="headerlink" title="为什么 Go 没有 ?: 运算符？"></a>为什么 Go 没有 <code>?:</code> 运算符？</h3><p>Go 中没有三元测试操作。您可以使用以下方法来实现相同的结果：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">if</span> expr <span class="token punctuation">&#123;</span>    n <span class="token operator">=</span> trueVal<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    n <span class="token operator">=</span> falseVal<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Go 中没有 <code>?:</code> 的原因是该语言的设计者已经看到该操作过于频繁地用于创建难以理解的复杂表达式。 <code>if-else</code> 形式虽然更长，但无疑更清晰。一种语言只需要一个条件控制流结构。</p><h2 id="类型参数"><a href="#类型参数" class="headerlink" title="类型参数"></a>类型参数</h2><h3 id="为什么-Go-有类型参数？"><a href="#为什么-Go-有类型参数？" class="headerlink" title="为什么 Go 有类型参数？"></a>为什么 Go 有类型参数？</h3><p>类型参数允许所谓的泛型编程，其中函数和数据结构是根据稍后指定的类型定义的，当使用这些函数和数据结构时。例如，它们可以编写一个函数，该函数返回任何有序类型的两个值中的最小值，而不必为每种可能的类型编写单独的版本。有关示例的更深入解释，请参阅博客文章<a href="https://golang.google.cn/blog/why-generics">Why Generics</a>?。</p><h3 id="Go-中的泛型是如何实现的？"><a href="#Go-中的泛型是如何实现的？" class="headerlink" title="Go 中的泛型是如何实现的？"></a>Go 中的泛型是如何实现的？</h3><p>编译器可以选择是单独编译每个实例化，还是将合理相似的实例化编译为单个实现。单一实现方法类似于具有接口参数的函数。不同的编译器会针对不同的情况做出不同的选择。标准的 Go 1.18 编译器通常为每个具有相同形状的类型参数发出一个实例化，其中形状由类型的属性决定，例如它包含的指针的大小和位置。未来的版本将尝试在编译时间、运行时效率和代码大小之间进行权衡。</p><h3 id="Go-中的泛型与其他语言中的泛型相比如何？"><a href="#Go-中的泛型与其他语言中的泛型相比如何？" class="headerlink" title="Go 中的泛型与其他语言中的泛型相比如何？"></a>Go 中的泛型与其他语言中的泛型相比如何？</h3><p>所有语言的基本功能都是相似的：可以使用稍后指定的类型来编写类型和函数。也就是说，存在一些差异。</p><ul><li><p>Java<br>  在 Java 中，编译器在编译时检查泛型类型，但在运行时删除类型。这称为<a href="https://en.wikipedia.org/wiki/Generics_in_Java#Problems_with_type_erasure">类型擦除</a>。例如，在编译时称为 <code>List&lt;Integer&gt;</code> 的 Java 类型将在运行时变为非泛型类型 <code>List</code>。这意味着，例如，当使用 Java 形式的类型反射时，不可能区分 <code>List&lt;Integer&gt;</code> 类型的值和 <code>List&lt;Float&gt;</code> 类型的值。在 Go 中，泛型类型的反射信息包括完整的编译时类型信息。</p><p>  Java 使用类型通配符，例如 <code>List&lt;? extends Number&gt;</code> 或 <code>List&lt;? super Number&gt;</code> 来实现泛型协变和逆变。 Go 没有这些概念，这使得 Go 中的泛型类型更加简单。</p></li><li><p>C++<br>  传统上，C++ 模板不对类型参数实施任何约束，尽管 C++20 通过概念支持可选约束。在 Go 中，约束对于所有类型参数都是强制性的。 C++20 概念表示为必须使用类型参数编译的小代码片段。 Go 约束是定义所有允许的类型参数集的接口类型。</p><p>  C++ 支持模板元编程；去没有。实际上，所有 C++ 编译器都会在实例化每个模板时对其进行编译；如上所述，Go 可以并且确实对不同的实例化使用不同的方法。</p></li><li><p>Rust<br>  Rust 版本的约束称为 trait bound。在 Rust 中，必须显式定义 trait bound 和类型之间的关联，无论是在定义 trait bound 的 crate 中，还是在定义类型的 crate 中。在 Go 中，类型参数隐式满足约束，就像 Go 类型隐式实现接口类型一样。 Rust 标准库为比较或加法等操作定义了标准特征； Go 标准库没有，因为这些可以通过接口类型在用户代码中表示。</p></li><li><p>Python<br>  Python 不是一种静态类型语言，因此可以合理地说所有 Python 函数在默认情况下始终是泛型的：它们始终可以使用任何类型的值调用，并且在运行时检测到任何类型错误。</p></li></ul><h3 id="为什么-Go-在类型参数列表中使用方括号？"><a href="#为什么-Go-在类型参数列表中使用方括号？" class="headerlink" title="为什么 Go 在类型参数列表中使用方括号？"></a>为什么 Go 在类型参数列表中使用方括号？</h3><p>Java 和 C++ 对类型参数列表使用尖括号，如 Java <code>List&lt;Integer&gt;</code> 和 C++ <code>std::vector&lt;int&gt;</code>。但是，该选项不适用于 Go，因为它会导致语法问题：在函数中解析代码时，例如 <code>v := F&lt;T&gt;</code>，在看到 &lt; 时，我们是否看到实例化是模棱两可的或使用 &lt; 运算符的表达式。如果没有类型信息，这很难解决。</p><p>例如，考虑如下语句</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">a<span class="token punctuation">,</span> b <span class="token operator">=</span> w <span class="token operator">&lt;</span> x<span class="token punctuation">,</span> y <span class="token operator">></span> <span class="token punctuation">(</span>z<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果没有类型信息，就无法确定赋值的右侧是一对表达式（<code>w &lt; x</code> 和 <code>y &gt; z</code>），还是返回两个结果值的泛型函数实例化和调用 <code>((w&lt;x, y&gt;)(z))</code>。</p><p>Go 的一个关键设计决定是在没有类型信息的情况下进行解析，这在使用尖括号作为泛型时似乎是不可能的。</p><p>Go 在使用方括号方面并不是唯一的或独创的；还有其他语言（例如 Scala）也使用方括号来表示通用代码。</p><h3 id="为什么-Go-不支持带类型参数的方法？"><a href="#为什么-Go-不支持带类型参数的方法？" class="headerlink" title="为什么 Go 不支持带类型参数的方法？"></a>为什么 Go 不支持带类型参数的方法？</h3><p>Go 允许泛型类型具有方法，但是除了接收者之外，这些方法的参数不能使用参数化类型。类型的方法决定了该类型实现的接口，但尚不清楚这将如何处理泛型类型方法的参数化参数。它需要在运行时实例化函数或为每个可能的类型参数实例化每个泛型函数。这两种方法似乎都不可行。有关更多详细信息（包括示例），请参阅提案。不要使用带有类型参数的方法，而是使用带有类型参数的顶级函数，或者将类型参数添加到接收器类型。</p><h3 id="为什么我不能对参数化类型的接收者使用更具体的类型？"><a href="#为什么我不能对参数化类型的接收者使用更具体的类型？" class="headerlink" title="为什么我不能对参数化类型的接收者使用更具体的类型？"></a>为什么我不能对参数化类型的接收者使用更具体的类型？</h3><p>泛型类型的方法声明是用包含类型参数名称的接收器编写的。有些人认为可以使用特定类型，从而生成仅适用于某些类型参数的方法：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> S<span class="token punctuation">[</span>T any<span class="token punctuation">]</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span> f T <span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token punctuation">(</span>s S<span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span>t <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> s<span class="token punctuation">.</span>f <span class="token operator">+</span> t<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这会失败并出现编译器错误，例如 <code>operator + not defined on s.f</code>（类型字符串的变量受任何约束），即使 <code>+</code> 运算符当然适用于预先声明的类型字符串。</p><p>这是因为在Add方法的声明中使用 <code>string</code> 只是简单的为类型参数引入了一个名字，名字就是<code>string</code>。这是一个有效的，如果奇怪的，要做的事情。字段 <code>s.f</code> 的类型是 <code>string</code>，不是通常的预声明类型 <code>string</code>，而是 <code>S</code> 的类型参数，在这个方法中被命名为 <code>string</code>。由于类型参数的约束是 any，所以不允许使用 <code>+</code> 运算符。</p><h3 id="为什么编译器不能推断我程序中的类型参数？"><a href="#为什么编译器不能推断我程序中的类型参数？" class="headerlink" title="为什么编译器不能推断我程序中的类型参数？"></a>为什么编译器不能推断我程序中的类型参数？</h3><p>在很多情况下，程序员可以很容易地看到泛型类型或函数的类型参数必须是什么，但该语言不允许编译器推断它。类型推断是有意限制的，以确保不会对推断出的类型产生任何混淆。其他语言的经验表明，在阅读和调试程序时，意外的类型推断会导致相当大的混乱。始终可以指定要在调用中使用的显式类型参数。未来可能会支持新的推理形式，只要规则保持简单明了。</p><h2 id="包和测试"><a href="#包和测试" class="headerlink" title="包和测试"></a>包和测试</h2><h3 id="如何创建多文件包？"><a href="#如何创建多文件包？" class="headerlink" title="如何创建多文件包？"></a>如何创建多文件包？</h3><p>将包的所有源文件单独放在一个目录中。源文件可以随意引用不同文件中的项目；不需要前向声明或头文件。</p><p>除了被拆分成多个文件之外，该包将像单个文件包一样编译和测试。</p><h3 id="如何编写单元测试？"><a href="#如何编写单元测试？" class="headerlink" title="如何编写单元测试？"></a>如何编写单元测试？</h3><p>在与您的包源相同的目录中创建一个以 <code>_test.go</code> 结尾的新文件。在该文件中，<code>import &quot;testing&quot;</code>并编写表单的函数</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">TestFoo</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token operator">...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>在该目录中运行 <code>go test</code>。该脚本找到测试函数，构建测试二进制文件并运行它。</p><p>有关详细信息，请参阅<a href="https://golang.google.cn/doc/code.html">如何编写 Go 代码</a>文档、测试包和 <code>go test</code> 子命令。</p><h3 id="我最喜欢的测试辅助函数在哪里？"><a href="#我最喜欢的测试辅助函数在哪里？" class="headerlink" title="我最喜欢的测试辅助函数在哪里？"></a>我最喜欢的测试辅助函数在哪里？</h3><p>Go 的标准测试包使编写单元测试变得容易，但它缺乏其他语言测试框架提供的功能，例如断言函数。本文档的<a href="#%E4%B8%BA%E4%BB%80%E4%B9%88-go-%E6%B2%A1%E6%9C%89%E6%96%AD%E8%A8%80">前面部分</a>解释了为什么 Go 没有断言，并且相同的论点适用于在测试中使用断言。正确的错误处理意味着在一个测试失败后让其他测试运行，这样调试失败的人就可以全面了解问题所在。报告 <code>isPrime</code> 对 2、3、5 和 7（或 2、4、8 和 16）给出错误答案的测试比报告 <code>isPrime</code> 对 2 给出错误答案因此没有更有用的测试进行了更多测试。触发测试失败的程序员可能不熟悉失败的代码。现在，当测试中断时，花费时间编写一个好的错误消息会得到回报。</p><p>与此相关的一点是，测试框架倾向于发展成自己的迷你语言，具有条件、控制和打印机制，但 Go 已经具备所有这些功能；为什么要重新创建它们？我们宁愿用 Go 编写测试；学习的语言少了一种，而且这种方法使测试简单易懂。</p><p>如果编写好的错误所需的额外代码量似乎是重复性和压倒性的，那么如果表驱动的测试可能会更好，迭代数据结构中定义的输入和输出列表（Go 对数据结构文字有很好的支持）。编写好的测试和好的错误消息的工作将分摊到许多测试用例中。标准 Go 库充满了说明性示例，例如 <a href="https://golang.google.cn/src/fmt/fmt_test.go"><code>fmt</code> 包的格式测试</a>。</p><h3 id="为什么标准库中没有-X？"><a href="#为什么标准库中没有-X？" class="headerlink" title="为什么标准库中没有 X？"></a>为什么标准库中没有 X？</h3><p>标准库的目的是支持运行时，连接到操作系统，并提供许多 Go 程序所需的关键功能，例如格式化 I/O 和网络。它还包含对 Web 编程很重要的元素，包括加密和对 HTTP、JSON 和 XML 等标准的支持。</p><p>没有明确的标准来定义包含的内容，因为长期以来，这是唯一的 Go 库。但是，有一些标准可以定义今天添加的内容。</p><p>标准库的新增内容很少见，并且包含的​​门槛很高。包含在标准库中的代码需要承担大量的持续维护成本（通常由原作者以外的人承担），受 <a href="https://golang.google.cn/doc/go1compat.html">Go 1 兼容性承诺</a>（阻止对 API 中的任何缺陷的修复）的约束，并且受制于<a href="https://golang.google.cn/s/releasesched">Go 发布时间表</a>，防止错误修复快速提供给用户。</p><p>大多数新代码应该存在于标准库之外，并且可以通过 <a href="https://golang.google.cn/cmd/go/"><code>go</code> 工具</a>的 <code>go get</code> 命令访问。这样的代码可以有自己的维护者、发布周期和兼容性保证。用户可以在 <a href="https://godoc.org/">godoc.org</a> 上找到包并阅读他们的文档。</p><p>尽管标准库中有一些并不真正属于的部分，例如 <code>log/syslog</code>，但由于 Go 1 兼容性承诺，我们继续维护库中的所有内容。但是我们鼓励大多数新代码存在于其他地方。</p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="使用什么编译器技术来构建编译器？"><a href="#使用什么编译器技术来构建编译器？" class="headerlink" title="使用什么编译器技术来构建编译器？"></a>使用什么编译器技术来构建编译器？</h3><p>Go 有几个生产编译器，还有一些正在为各种平台开发的其他编译器。</p><p>默认编译器 <code>gc</code> 包含在 Go 发行版中，作为对 <code>go</code> 命令的支持的一部分。 Gc 最初是用 C 编写的，因为引导很困难——你需要一个 Go 编译器来设置一个 Go 环境。但是事情已经发展了，自从 Go 1.5 发布以来，编译器一直是一个 Go 程序。编译器使用自动翻译工具从 C 转换为 Go，如本<a href="https://golang.google.cn/s/go13compiler">设计文档</a>和<a href="https://golang.google.cn/talks/2015/gogo.slide#1">谈话</a>中所述。因此编译器现在是“自托管”的，这意味着我们需要面对引导问题。解决方案是已经有一个工作的 Go 安装，就像一个正常工作的 C 安装一样。<a href="https://golang.google.cn/s/go15bootstrap">此处</a>和<a href="https://golang.google.cn/doc/install/source">此处</a>描述了如何从源代码构建新 Go 环境的故事。</p><p><code>Gc</code> 是用 Go 编写的，带有递归下降解析器，并使用自定义加载器（也是用 Go 编写但基于 Plan 9 加载器）来生成 ELF/Mach-O/PE 二进制文件。</p><p>在项目开始时，我们考虑使用 LLVM 进行 gc，但认为它太大且速度太慢，无法满足我们的性能目标。回想起来更重要的是，从 LLVM 开始会使引入一些 ABI 和相关更改（例如堆栈管理）变得更加困难，这是 Go 需要但不是标准 C 设置的一部分。然而，一个新的 <a href="https://go.googlesource.com/gollvm/">LLVM 实现</a>现在开始融合在一起。</p><p><code>Gccgo</code> 编译器是一个用 C++ 编写的前端，带有一个与标准 GCC 后端耦合的递归下降解析器。</p><p>Go 被证明是一种很好的语言，可以用来实现 Go 编译器，尽管这不是它的最初目标。从一开始就不是自托管的，这使得 Go 的设计能够专注于其最初的用例，即联网服务器。如果我们决定 Go 应该尽​​早自行编译，我们最终可能会得到一种更针对编译器构建的语言，这是一个有价值的目标，但不是我们最初的目标。</p><p>尽管 gc 不使用它们（还没有？），但 go 包中提供了本机词法分析器和解析器，并且还有一个本机<a href="https://golang.google.cn/pkg/go/types">类型检查器</a>。</p><h3 id="运行时支持是如何实现的？"><a href="#运行时支持是如何实现的？" class="headerlink" title="运行时支持是如何实现的？"></a>运行时支持是如何实现的？</h3><p>同样由于引导问题，运行时代码最初主要是用 C 编写的（带有一点汇编程序），但后来被翻译成 Go（除了一些汇编程序位）。 <code>Gccgo</code> 的运行时支持使用 <code>glibc</code>。 <code>gccgo</code> 编译器使用称为分段堆栈的技术实现 goroutine，最近对黄金链接器的修改支持。 <code>Gollvm</code> 同样建立在相应的 LLVM 基础设施之上。</p><h3 id="为什么我的小程序是这么大的二进制文件？"><a href="#为什么我的小程序是这么大的二进制文件？" class="headerlink" title="为什么我的小程序是这么大的二进制文件？"></a>为什么我的小程序是这么大的二进制文件？</h3><p><code>gc</code> 工具链中的链接器默认创建静态链接的二进制文件。因此，所有 Go 二进制文件都包含 Go 运行时，以及支持动态类型检查、反射甚至恐慌时间堆栈跟踪所需的运行时类型信息。</p><p>在 Linux 上使用 gcc 静态编译和链接的简单 C“hello, world”程序大约 750 kB，包括 <code>printf</code> 的实现。使用 <code>fmt.Printf</code> 的等效 Go 程序重达几兆字节，但其中包括更强大的运行时支持以及类型和调试信息。</p><p>使用 gc 编译的 Go 程序可以与 <code>-ldflags=-w</code> 标志链接以禁用 DWARF 生成，从二进制文件中删除调试信息，但不会丢失其他功能。这可以大大减少二进制大小。</p><h3 id="我可以停止这些关于我未使用的变量-导入的投诉吗？"><a href="#我可以停止这些关于我未使用的变量-导入的投诉吗？" class="headerlink" title="我可以停止这些关于我未使用的变量/导入的投诉吗？"></a>我可以停止这些关于我未使用的变量/导入的投诉吗？</h3><p>未使用的变量的存在可能表明存在错误，而未使用的导入只会减慢编译速度，随着时间的推移，随着程序积累代码和程序员，这种影响会变得很大。由于这些原因，Go 拒绝使用未使用的变量或导入来编译程序，以短期的便利性换取长期的构建速度和程序的清晰度。</p><p>尽管如此，在开发代码时，临时创建这些情况是很常见的，并且在程序编译之前必须将它们编辑出来可能会很烦人。</p><p>有些人要求提供编译器选项来关闭这些检查或至少将它们减少为警告。但是，没有添加这样的选项，因为编译器选项不应该影响语言的语义，并且因为 Go 编译器不报告警告，只报告阻止编译的错误。</p><p>没有警告有两个原因。首先，如果值得抱怨，那就值得在代码中修复。 （如果它不值得修复，那就不值得一提。）其次，让编译器生成警告鼓励实现警告可能使编译嘈杂的弱案例，掩盖应该修复的真正错误。</p><p>不过，解决这种情况很容易。在开发过程中，使用空白标识符让未使用的东西保持不变。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">import</span> <span class="token string">"unused"</span><span class="token comment">// This declaration marks the import as used by referencing an</span><span class="token comment">// item from the package.</span><span class="token keyword">var</span> <span class="token boolean">_</span> <span class="token operator">=</span> unused<span class="token punctuation">.</span>Item  <span class="token comment">// TODO: Delete before committing!</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    debugData <span class="token operator">:=</span> debug<span class="token punctuation">.</span><span class="token function">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token boolean">_</span> <span class="token operator">=</span> debugData <span class="token comment">// Used only during debugging.</span>    <span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在，大多数 Go 程序员使用 <a href="https://godoc.org/golang.org/x/tools/cmd/goimports">goimports</a> 工具，它会自动重写 Go 源文件以具有正确的导入，从而在实践中消除未使用的导入问题。这个程序很容易连接到大多数编辑器，以便在编写 Go 源文件时自动运行。</p><h3 id="为什么我的病毒扫描软件认为我的-Go-发行版或编译的二进制文件被感染了？"><a href="#为什么我的病毒扫描软件认为我的-Go-发行版或编译的二进制文件被感染了？" class="headerlink" title="为什么我的病毒扫描软件认为我的 Go 发行版或编译的二进制文件被感染了？"></a>为什么我的病毒扫描软件认为我的 Go 发行版或编译的二进制文件被感染了？</h3><p>这是一种常见的情况，尤其是在 Windows 机器上，并且几乎总是误报。商业病毒扫描程序经常被 Go 二进制文件的结构所迷惑，它们不像从其他语言编译的那样经常看到这种结构。</p><p>如果您刚刚安装了 Go 发行版并且系统报告它已被感染，那肯定是一个错误。要真正彻底，您可以通过将校验和与<a href="https://golang.google.cn/dl/">下载页面</a>上的校验和进行比较来验证下载。</p><p>在任何情况下，如果您认为报告有误，请向您的病毒扫描程序供应商报告错误。也许病毒扫描程序可以及时学会理解 Go 程序。</p><h2 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h2><h3 id="为什么-Go-在基准-X-上表现不佳？"><a href="#为什么-Go-在基准-X-上表现不佳？" class="headerlink" title="为什么 Go 在基准 X 上表现不佳？"></a>为什么 Go 在基准 X 上表现不佳？</h3><p>Go 的设计目标之一是在可比较的程序中接近 C 的性能，但在某些基准测试中它的表现相当差，包括 <a href="https://go.googlesource.com/exp/+/master/shootout/">golang.org/x/exp/shootout</a> 中的几个。最慢的取决于在 Go 中没有可比性能版本的库。例如，<a href="https://go.googlesource.com/exp/+/master/shootout/pidigits.go">pidigits.go</a> 依赖于多精度数学包，而 C 版本与 Go 不同，使用 <a href="https://gmplib.org/">GMP</a>（用优化的汇编程序编写）。依赖于正则表达式的基准（例如 <a href="https://go.googlesource.com/exp/+/master/shootout/regex-dna.go">regex-dna.go</a>）本质上是将 Go 的原生 <a href="https://golang.google.cn/pkg/regexp">regexp 包</a>与成熟的、高度优化的正则表达式库（如 PCRE）进行比较。</p><p>基准游戏是通过广泛的调整赢得的，大多数基准的围棋版本需要注意。如果你测量可比较的 C 和 Go 程序（<a href="https://go.googlesource.com/exp/+/master/shootout/reverse-complement.go">reverse-complement.go</a> 就是一个例子），你会发现这两种语言在原始性能上比这个套件所显示的要接近得多。</p><p>尽管如此，仍有改进的余地。编译器很好，但可能会更好，许多库需要主要的性能工作，而垃圾收集器还不够快。 （即使是这样，注意不要产生不必要的垃圾也会产生巨大的影响。）</p><p>无论如何，围棋通常很有竞争力。随着语言和工具的发展，许多程序的性能有了显着提高。请参阅有关<a href="https://blog.golang.org/2011/06/profiling-go-programs.html">分析 Go 程序</a>的博客文章以获取信息示例。</p><h2 id="从-C-开始的变化"><a href="#从-C-开始的变化" class="headerlink" title="从 C 开始的变化"></a>从 C 开始的变化</h2><h3 id="为什么语法与-C-如此不同？"><a href="#为什么语法与-C-如此不同？" class="headerlink" title="为什么语法与 C 如此不同？"></a>为什么语法与 C 如此不同？</h3><p>除了声明语法之外，差异并不大，并且源于两个愿望。首先，语法应该感觉轻松，没有太多强制性关键字、重复或奥秘。其次，该语言被设计成易于分析并且可以在没有符号表的情况下进行解析。这使得构建调试器、依赖分析器、自动文档提取器、IDE 插件等工具变得更加容易。 C 及其后代在这方面是出了名的困难。</p><h3 id="为什么声明是向后的？"><a href="#为什么声明是向后的？" class="headerlink" title="为什么声明是向后的？"></a>为什么声明是向后的？</h3><p>如果你习惯了 C，它们只会倒退。在 C 中，概念是变量被声明为表示其类型的表达式，这是一个好主意，但类型和表达式语法不能很好地混合，并且结果可能令人困惑；考虑函数指针。 Go 主要将表达式和类型语法分开并且简化了事情（使用前缀 <code>*</code> 作为指针是证明规则的例外）。在 C 中，声明</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token builtin">int</span><span class="token operator">*</span> a<span class="token punctuation">,</span> b<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将 a 声明为指针但不是 b；在 Go 中</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> a<span class="token punctuation">,</span> b <span class="token operator">*</span><span class="token builtin">int</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>声明两者都是指针。这更清晰，更规律。此外， <code>:=</code> 短声明形式认为完整的变量声明应该呈现与 <code>:=</code> 相同的顺序</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> a <span class="token builtin">uint64</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token comment">// 下面具有相同的效果</span>a <span class="token operator">:=</span> <span class="token function">uint64</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>解析也被简化了，因为它有一个独特的类型语法，而不仅仅是表达式语法；诸如 func 和 chan 之类的关键字使事情变得清晰。</p><p>有关更多详细信息，请参阅有关 <a href="https://golang.google.cn/doc/articles/gos_declaration_syntax.html">Go 的声明语法</a>的文章。</p><h3 id="为什么没有指针运算？"><a href="#为什么没有指针运算？" class="headerlink" title="为什么没有指针运算？"></a>为什么没有指针运算？</h3><p>安全。如果没有指针算法，就有可能创建一种永远不会得出错误成功的非法地址的语言。编译器和硬件技术已经发展到使用数组索引的循环可以与使用指针算法的循环一样高效的程度。此外，缺少指针算法可以简化垃圾收集器的实现。</p><h3 id="为什么是-和-–-语句而不是表达式？为什么是后缀，而不是前缀？"><a href="#为什么是-和-–-语句而不是表达式？为什么是后缀，而不是前缀？" class="headerlink" title="为什么是 ++ 和 – 语句而不是表达式？为什么是后缀，而不是前缀？"></a>为什么是 ++ 和 – 语句而不是表达式？为什么是后缀，而不是前缀？</h3><p>如果没有指针算术，前置和后置增量运算符的便利值就会下降。通过将它们从表达式层次结构中完全删除，表达式语法得到了简化，并且围绕 <code>++</code> 和 <code>--</code>（考虑 <code>f(i++)</code> 和 <code>p[i] = q[++i]</code>）的求值顺序的混乱问题也被消除了。简化意义重大。至于后缀与前缀，两者都可以正常工作，但后缀版本更传统；对前缀的坚持源于 STL，这是一个语言库，其名称讽刺地包含后缀增量。</p><h3 id="为什么有大括号但没有分号？为什么我不能把左大括号放在下一行？"><a href="#为什么有大括号但没有分号？为什么我不能把左大括号放在下一行？" class="headerlink" title="为什么有大括号但没有分号？为什么我不能把左大括号放在下一行？"></a>为什么有大括号但没有分号？为什么我不能把左大括号放在下一行？</h3><p>Go 使用大括号进行语句分组，这是使用过 C 家族中任何语言的程序员所熟悉的语法。然而，分号是用于解析器的，而不是用于人的，我们希望尽可能地消除它们。为了实现这个目标，Go 借鉴了 BCPL 的一个技巧：分隔语句的分号在形式语法中，但在可能是语句结尾的任何行的末尾由词法分析器自动注入，无需前瞻。这在实践中非常有效，但它的效果是强制使用大括号样式。例如，函数的左大括号不能单独出现在一行上。</p><p>一些人认为词法分析器应该进行前瞻以允许大括号存在于下一行。我们不同意。由于 Go 代码旨在由 <code>gofmt</code> 自动格式化，因此必须选择某种样式。这种风格可能与您在 C 或 Java 中使用的不同，但 Go 是一种不同的语言，并且 <code>gofmt</code> 的风格与其他任何语言一样好。更重要的是——更重要的是——所有 Go 程序的单一、程序化强制格式的优点远远超过了特定风格的任何可察觉的缺点。还要注意 Go 的风格意味着 Go 的交互式实现可以一次使用一行标准语法，而无需特殊规则。</p><h3 id="为什么要进行垃圾收集？开销会不会太大？"><a href="#为什么要进行垃圾收集？开销会不会太大？" class="headerlink" title="为什么要进行垃圾收集？开销会不会太大？"></a>为什么要进行垃圾收集？开销会不会太大？</h3><p>系统程序中簿记的最大来源之一是管理已分配对象的生命周期。在诸如 C 之类的手动完成的语言中，它会消耗大量的程序员时间，并且通常是有害错误的原因。即使在提供辅助机制的 C++ 或 Rust 等语言中，这些机制也会对软件的设计产生重大影响，通常会增加其自身的编程开销。我们认为消除此类程序员开销至关重要，过去几年垃圾收集技术的进步使我们相信它可以足够便宜地实现，并且延迟足够低，这可能是网络系统的一种可行方法。</p><p>并发编程的大部分困难都源于对象生命周期问题：随着对象在线程之间传递，保证它们被安全释放变得很麻烦。自动垃圾收集使并发代码更容易编写。当然，在并发环境中实现垃圾收集本身就是一个挑战，但是一次而不是在每个程序中满足它对每个人都有帮助。</p><p>最后，除了并发之外，垃圾收集使接口更简单，因为它们不需要指定如何跨接口管理内存。</p><p>这并不是说最近在诸如 Rust 之类的语言中为资源管理问题带来新思想的工作是错误的；我们鼓励这项工作，并很高兴看到它如何发展。但是 Go 采用更传统的方法，通过垃圾收集和单独的垃圾收集来处理对象生命周期。</p><p>当前的实现是一个标记和清除收集器。如果机器是多处理器，则收集器与主程序并行运行在单独的 CPU 内核上。近年来收集器的主要工作已将暂停时间通常减少到亚毫秒范围，即使对于大型堆也是如此，几乎消除了网络服务器中垃圾收集的主要反对意见之一。工作继续改进算法，进一步减少开销和延迟，并探索新的方法。 Go 团队的 Rick Hudson 在 2018 年 ISMM 主题演讲中描述了迄今为止的进展，并提出了一些未来的方法。</p><p>关于性能的话题，请记住，Go 为程序员提供了对内存布局和分配的相当大的控制权，这比垃圾收集语言中的典型控制要多得多。一个细心的程序员可以通过很好地使用语言来显着减少垃圾收集的开销；请参阅有关分析 Go 程序的文章以获取工作示例，包括 Go 分析工具的演示。</p>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> translate </tag>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu 18.04 离线部署 Nvidia-Docker 环境</title>
      <link href="environment/docker/setup-nvidia-docker-8272923955cb/"/>
      <url>environment/docker/setup-nvidia-docker-8272923955cb/</url>
      
        <content type="html"><![CDATA[<p>Docker 容器化的方式使服务部署维护更加容易，但是 Docker 本身并不能直接调用 GPU cuda 来做一些事情，因此 Nvidia 官方给出了补救方案：<a href="https://github.com/NVIDIA/nvidia-docker">Nvidia-Docker</a>。NVIDIA Container Toolkit 允许用户构建和运行 GPU 加速的 Docker 容器。该工具包包括一个容器运行时库和实用程序，用于自动配置容器以利用 NVIDIA GPU。</p><p>在线环境安装部署，<a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html">官方文档安装指引</a>讲的很明白了，按步骤走就行。这里主要讲一下离线部署方式。</p><h2 id="环境需求"><a href="#环境需求" class="headerlink" title="环境需求"></a>环境需求</h2><p>运行 NVIDIA Container Toolkit 的先决条件列表如下所述：</p><ul><li>内核版本 &gt; 3.10 的 GNU/Linux x86_64</li><li>Docker &gt;= 19.03（推荐，但某些发行版可能包含旧版本的 Docker。支持的最低版本为 1.12）</li><li>架构 &gt;= Kepler（或计算能力 3.0）的 NVIDIA GPU</li><li>NVIDIA Linux 驱动程序 &gt;= 418.81.07（请注意，不支持较旧的驱动程序版本或分支。）</li></ul><p>Nvidia 驱动程序 <code>.run</code> <a href="https://www.nvidia.com/Download/index.aspx?lang=en-us">下载地址</a></p><h2 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h2><p>本文基于 Ubuntu 18.04 LTS x86_64 系统，其他系统下载方式大致相同。</p><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><p>访问 <a href="https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/">https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/</a> Ubuntu 18.04 系统 Docker 资源下载页面，其他平台和系统参照官方<a href="https://docs.docker.com/engine/install/">安装文档</a>操作，或者直接在资源下载页面回退到<a href="https://download.docker.com/">根目录</a>按自己的平台查找，下载 <code>containerd.io</code>、<code>docker-ce-cli</code>、<code>docker-ce</code> 这三个所需版本的 <code>deb</code> 包，下载命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/containerd.io_1.5.10-1_amd64.deb<span class="token comment"># 或者</span><span class="token function">curl</span> -OL https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/containerd.io_1.5.10-1_amd64.deb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="NVIDIA-Container-Toolkit"><a href="#NVIDIA-Container-Toolkit" class="headerlink" title="NVIDIA Container Toolkit"></a>NVIDIA Container Toolkit</h3><p>Nvidia-Docker 组件的安装包都对应项目的 Github 存储库的 gh-pages 分支中，自行选择需要的平台和版本：</p><ul><li>nvidia-docker2: <a href="https://github.com/NVIDIA/nvidia-docker/tree/gh-pages/">https://github.com/NVIDIA/nvidia-docker/tree/gh-pages/</a></li><li>nvidia-container-toolkit: <a href="https://github.com/NVIDIA/nvidia-container-runtime/tree/gh-pages/">https://github.com/NVIDIA/nvidia-container-runtime/tree/gh-pages/</a></li><li>libnvidia-container: <a href="https://github.com/NVIDIA/libnvidia-container/tree/gh-pages/">https://github.com/NVIDIA/libnvidia-container/tree/gh-pages/</a></li></ul><blockquote><p>注：Github 下载不能直接使用 <code>wget</code>, 需要替换 <code>github.com</code> 域名为 <code>raw.githubusercontent.com</code> 后可用</p></blockquote><p>下面摘录了官方文档的架构和依赖描述，不想了解可以跳到<a href="#%E5%AE%89%E8%A3%85%E7%A6%BB%E7%BA%BF%E5%8C%85">安装</a>部分</p><h4 id="架构概述"><a href="#架构概述" class="headerlink" title="架构概述"></a>架构概述</h4><p>NVIDIA Container Toolkit 的架构旨在支持生态系统中的任何容器运行时。对于 Docker，NVIDIA Container Toolkit 由以下组件组成（在层次结构中从上到下）：</p><ul><li><code>nvidia-docker2</code></li><li><code>nvidia-container-runtime</code></li><li><code>nvidia-container-toolkit</code></li><li><code>libnvidia-container</code></li></ul><p>下图表示通过各个组件的流程：</p><p><img src="https://docs.nvidia.com/datacenter/cloud-native/_images/nvidia-docker-arch.png" alt="nvidia-docker-arch.png"></p><p>NVIDIA Container Toolkit 的包装也反映了这些依赖关系。如果您从 Docker 的顶级 <code>nvidia-docker2</code> 包开始，则可以看到包依赖项如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">├─ nvidia-docker2│    ├─ docker-ce <span class="token punctuation">(</span><span class="token operator">></span><span class="token operator">=</span> <span class="token number">18.06</span>.0~ce~3-0~ubuntu<span class="token punctuation">)</span>│    ├─ docker-ee <span class="token punctuation">(</span><span class="token operator">></span><span class="token operator">=</span> <span class="token number">18.06</span>.0~ce~3-0~ubuntu<span class="token punctuation">)</span>│    ├─ docker.io <span class="token punctuation">(</span><span class="token operator">></span><span class="token operator">=</span> <span class="token number">18.06</span>.0<span class="token punctuation">)</span>│    └─ nvidia-container-runtime <span class="token punctuation">(</span><span class="token operator">></span><span class="token operator">=</span> <span class="token number">3.3</span>.0<span class="token punctuation">)</span>├─ nvidia-container-runtime│    └─ nvidia-container-toolkit <span class="token punctuation">(</span><span class="token operator">&lt;&lt;</span> <span class="token number">2.0</span>.0<span class="token punctuation">)</span>├─ nvidia-container-toolkit│    └─ libnvidia-container-tools <span class="token punctuation">(</span><span class="token operator">&lt;&lt;</span> <span class="token number">2.0</span>.0<span class="token punctuation">)</span>├─ libnvidia-container-tools│    └─ libnvidia-container1 <span class="token punctuation">(</span><span class="token operator">></span><span class="token operator">=</span> <span class="token number">1.2</span>.0~rc.3<span class="token punctuation">)</span>└─ libnvidia-container1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="应该使用那个包？"><a href="#应该使用那个包？" class="headerlink" title="应该使用那个包？"></a>应该使用那个包？</h4><p>鉴于这种组件层次结构，很容易看出，如果您只安装 <code>nvidia-container-toolkit</code>，那么您将不会安装 <code>nvidia-container-runtime</code> 作为其中的一部分，因此 <code>--runtime=nvidia</code> 将不可用。对于 Docker 19.03+，这很好，因为 Docker 在您传递 <code>--gpus</code> 选项时直接调用 <code>nvidia-container-toolkit</code>，而不是依赖 <code>nvidia-container-runtime</code> 作为代理。</p><p>但是，如果您想在 Docker 19.03+ 中使用 Kubernetes，您实际上需要继续使用 <code>nvidia-docker2</code>，因为 Kubernetes 还不支持通过 <code>--gpus</code> 标志将 GPU 信息向下传递给 docker。它仍然依赖 <code>nvidia-container-runtime</code> 通过一组环境变量将 GPU 信息传递到运行时堆栈。</p><p>无论使用 <code>nvidia-docker2</code> 还是 <code>nvidia-container-toolkit</code>，都使用相同的容器运行时堆栈。使用 <code>nvidia-docker2</code> 将安装一个瘦运行时，该运行时可以通过环境变量将 GPU 信息代理到 <code>nvidia-container-toolkit</code>，而不是依靠 <code>--gpus</code> 标志让 Docker 直接执行此操作。</p><p>为简单起见（和向后兼容），建议继续使用 <code>nvidia-docker2</code> 作为顶级安装包。</p><h2 id="安装离线包"><a href="#安装离线包" class="headerlink" title="安装离线包"></a>安装离线包</h2><h3 id="检查依赖"><a href="#检查依赖" class="headerlink" title="检查依赖"></a>检查依赖</h3><p>安装之前使用 <code>dpkg -I</code> 检查离线包的依赖库是否下载完成，安装顺序也需要按依赖关系进行安装</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dpkg -I ./pkg/docker/docker-ce_20.10.9_3-0_ubuntu-bionic_amd64.deb <span class="token operator">|</span> <span class="token function">grep</span> DependsDepends: containerd.io <span class="token punctuation">(</span><span class="token operator">></span><span class="token operator">=</span> <span class="token number">1.4</span>.1<span class="token punctuation">)</span>, docker-ce-cli, iptables, libseccomp2 <span class="token punctuation">(</span><span class="token operator">></span><span class="token operator">=</span> <span class="token number">2.3</span>.0<span class="token punctuation">)</span>, libc6 <span class="token punctuation">(</span><span class="token operator">></span><span class="token operator">=</span> <span class="token number">2.8</span><span class="token punctuation">)</span>, libdevmapper1.02.1 <span class="token punctuation">(</span><span class="token operator">></span><span class="token operator">=</span> <span class="token number">2</span>:1.02.97<span class="token punctuation">)</span>, libsystemd0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>可以看到，要安装 <code>docker-ce 20.10.9</code> 版本需要关键依赖 <code>containerd.io</code> 和 <code>docker-ce-cli</code>，其他的均为系统库，且 <code>contain.io</code> 版本必须在 <code>1.4.1</code> 之后才行</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>使用 <code>dpkg -i</code> 按依赖顺序安装所有离线包，先安装 Docker 环境，再安装 Nvidia-Docker 环境</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Install docker server ...</span><span class="token function">sudo</span> dpkg -i ./containerd.io_x.y.z-1_amd64.deb<span class="token function">sudo</span> dpkg -i ./docker-ce-cli_x.y.z_3-0_ubuntu-bionic_amd64.deb<span class="token function">sudo</span> dpkg -i ./docker-ce_x.y.z_3-0_ubuntu-bionic_amd64.deb<span class="token comment"># Install nvidia-container ...</span><span class="token function">sudo</span> dpkg -i ./libnvidia-container1_x.y.z-1_amd64.deb<span class="token function">sudo</span> dpkg -i ./libnvidia-container-tools_x.y.z-1_amd64.deb<span class="token function">sudo</span> dpkg -i ./nvidia-container-toolkit_x.y.z-1_amd64.deb<span class="token function">sudo</span> dpkg -i ./nvidia-container-runtime_x.y.z-1_all.deb<span class="token function">sudo</span> dpkg -i ./nvidia-docker2_x.y.z-1_all.deb<span class="token comment"># restart docker daemon</span><span class="token function">sudo</span> systemctl restart docker<span class="token comment"># test running</span><span class="token function">sudo</span> docker run --rm --gpus all nvidia/cuda:11.0-base nvidia-smi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="注册-runtime"><a href="#注册-runtime" class="headerlink" title="注册 runtime"></a>注册 runtime</h4><blockquote><p>如果已经安装 <code>nvidia-docker2</code> 包，请忽略下面内容</p></blockquote><p>安装 <code>nvidia-docker2</code> 包时会配置默认的 runtime 如下:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /etc/docker/daemon.json<span class="token punctuation">&#123;</span>    <span class="token string">"default-runtime"</span><span class="token builtin class-name">:</span> <span class="token string">"nvidia"</span>,    <span class="token string">"runtimes"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>        <span class="token string">"nvidia"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span>            <span class="token string">"path"</span><span class="token builtin class-name">:</span> <span class="token string">"/usr/bin/nvidia-container-runtime"</span>,            <span class="token string">"runtimeArgs"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果没有安装 <code>nvidia-docker2</code> 包，需要手动注册 nvidia 运行，请使用以下最适合您的环境的方法。您可能需要将新参数与现有配置合并。提供三个选项：</p><ol><li><p>修改 systemd 文件</p> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/systemd/system/docker.service.d<span class="token function">sudo</span> <span class="token function">tee</span> /etc/systemd/system/docker.service.d/override.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF[Service]ExecStart=ExecStart=/usr/bin/dockerd --host=fd:// --add-runtime=nvidia=/usr/bin/nvidia-container-runtimeEOF</span><span class="token function">sudo</span> systemctl daemon-reload <span class="token punctuation">\</span><span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>配置 daemon.json</p> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;</span><span class="token string">EOF&#123;    "runtimes": &#123;        "nvidia": &#123;            "path": "/usr/bin/nvidia-container-runtime",            "runtimeArgs": []        &#125;    &#125;&#125;EOF</span><span class="token function">sudo</span> <span class="token function">pkill</span> -SIGHUP dockerd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p> 您可以选择通过将以下内容添加到 <code>/etc/docker/daemon.json</code> 来重新配置默认运行时：</p> <pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"default-runtime"</span><span class="token operator">:</span> <span class="token string">"nvidia"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>命令行</p><p> 使用 dockerd 添加 nvidia 运行时：</p> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> dockerd --add-runtime<span class="token operator">=</span>nvidia<span class="token operator">=</span>/usr/bin/nvidia-container-runtime <span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h3 id="环境变量（OCI-规范）"><a href="#环境变量（OCI-规范）" class="headerlink" title="环境变量（OCI 规范）"></a>环境变量（OCI 规范）</h3><p>用户可以使用环境变量控制 NVIDIA 容器运行时的行为——尤其是枚举 GPU 和驱动程序的功能。每个环境变量都映射到来自 <a href="https://github.com/NVIDIA/libnvidia-container"><code>libnvidia-container</code></a> 的 <code>nvidia-container-cli</code> 的命令行参数。这些变量已经在 NVIDIA 提供的基本 <a href="https://ngc.nvidia.com/catalog/containers/nvidia:cuda">CUDA 镜像</a>中设置。</p><h4 id="GPU-枚举"><a href="#GPU-枚举" class="headerlink" title="GPU 枚举"></a>GPU 枚举</h4><p>从 Docker <code>19.03</code> 开始​​，可以使用 <code>--gpus</code> 选项或环境变量 <code>NVIDIA_VISIBLE_DEVICES</code> 将 GPU 指定给 Docker CLI。此变量控制容器内可以访问哪些 GPU。</p><p><code>NVIDIA_VISIBLE_DEVICES</code> 变量的值可能为：</p><table><thead><tr><th>可能的值</th><th>描述</th></tr></thead><tbody><tr><td><code>0,1,2,</code> 或  <code>GPU-fef8089b</code></td><td>GPU UUID 或索引的逗号分隔列表</td></tr><tr><td><code>all</code></td><td>所有 GPU 都可以访问，这是基本 CUDA 容器映像中的默认值</td></tr><tr><td><code>none</code></td><td>将无法访问任何 GPU，但将启用驱动程序功能</td></tr><tr><td><code>void</code> 或 不设置</td><td><code>nvidia-container-runtime</code> 将具有与 <code>runc</code> 相同的行为（即既不公开 GPU 也不公开功能）</td></tr></tbody></table><blockquote><p>使用 <code>NVIDIA_VISIBLE_DEVICES</code> 变量时，您可能需要将 <code>--runtime</code> 设置为 <code>nvidia</code>，除非已设置为默认值。</p></blockquote><p>举一些栗子</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 启动启用 GPU 的 CUDA 容器</span>docker run --rm --gpus all nvidia/cuda nvidia-smidocker run --rm --runtime<span class="token operator">=</span>nvidia <span class="token punctuation">\</span>    -e <span class="token assign-left variable">NVIDIA_VISIBLE_DEVICES</span><span class="token operator">=</span>all nvidia/cuda nvidia-smi<span class="token comment"># 启动 GPU 的容器使用特定 GPU</span>docker run --gpus <span class="token string">'"device=1,2"'</span> <span class="token punctuation">\</span>    nvidia/cuda nvidia-smi --query-gpu<span class="token operator">=</span>uuid --format<span class="token operator">=</span>csvdocker run --gpus <span class="token assign-left variable">device</span><span class="token operator">=</span>GPU-18a3e86f-4c0e-cd9f-59c3-55488c4b0c24 <span class="token punctuation">\</span>     nvidia/cuda nvidia-smi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="驱动功能"><a href="#驱动功能" class="headerlink" title="驱动功能"></a>驱动功能</h4><p><code>NVIDIA_DRIVER_CAPABILITIES</code> 控制哪些驱动程序库/二进制文件将安装在容器内。</p><p><code>NVIDIA_DRIVER_CAPABILITIES</code> 变量的值可能为：</p><table><thead><tr><th>可能的值</th><th>描述</th></tr></thead><tbody><tr><td><code>compute,video</code> 或 <code>graphics,utility</code></td><td>容器需要的驱动程序功能的逗号分隔列表</td></tr><tr><td><code>all</code></td><td>启用所有可用的驱动程序功能</td></tr><tr><td>空 或 不设置</td><td>使用默认驱动程序功能：实用程序、计算</td></tr></tbody></table><p>支持的驱动程序功能如下表所示：</p><table><thead><tr><th>驱动功能</th><th>描述</th></tr></thead><tbody><tr><td><code>compute</code></td><td>CUDA 和 OpenCL 应用程序需要</td></tr><tr><td><code>compat32</code></td><td>运行 32 位应用程序所必需的</td></tr><tr><td><code>graphics</code></td><td>运行 OpenGL 和 Vulkan 应用程序</td></tr><tr><td><code>utility</code></td><td>使用 <code>nvidia-smi</code> 和 NVML 所需的</td></tr><tr><td><code>video</code></td><td>需要使用视频编解码器 SDK</td></tr><tr><td><code>display</code></td><td>利用 X11 显示所需的</td></tr></tbody></table><p>例如，指定 <code>compute</code> 和 <code>utility</code> 功能，允许使用 CUDA 和 NVML</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker run --rm --runtime<span class="token operator">=</span>nvidia <span class="token punctuation">\</span>    -e <span class="token assign-left variable">NVIDIA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token number">2,3</span> <span class="token punctuation">\</span>    -e <span class="token assign-left variable">NVIDIA_DRIVER_CAPABILITIES</span><span class="token operator">=</span>compute,utility <span class="token punctuation">\</span>    nvidia/cuda nvidia-smidocker run --rm --gpus <span class="token string">'all,"capabilities=compute,utility"'</span> <span class="token punctuation">\</span>    nvidia/cuda:11.0-base nvidia-smi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h4><p>NVIDIA 运行时还提供了对容器支持的配置定义约束的能力。</p><p><code>NVIDIA_REQUIRE_*</code>，该变量是一个逻辑表达式，用于定义容器上的软件版本或 GPU 架构的约束。</p><p>下面提供了支持的约束：</p><table><thead><tr><th>约束</th><th>描述</th></tr></thead><tbody><tr><td><code>cuda</code></td><td>对 CUDA 驱动程序版本的约束</td></tr><tr><td><code>driver</code></td><td>对驱动程序版本的限制</td></tr><tr><td><code>arch</code></td><td>对所选 GPU 的计算架构的约束</td></tr><tr><td><code>brand</code></td><td>对所选 GPU 品牌的限制（例如 GeForce、Tesla、GRID）</td></tr></tbody></table><p>多个约束可以在单个环境变量中表示：空格分隔的约束是 逻辑或关系，逗号分隔的约束是 逻辑与关系， <code>NVIDIA_REQUIRE_*</code> 形式的多个环境变量是 逻辑与 在一起的。</p><p>例如，可以为容器映像指定以下约束，以约束支持的 CUDA 和驱动程序版本：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">NVIDIA_REQUIRE_CUDA <span class="token string">"cuda>=11.0 driver>=450"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="Dockerfiles-配置"><a href="#Dockerfiles-配置" class="headerlink" title="Dockerfiles 配置"></a>Dockerfiles 配置</h4><p>可以通过环境变量在镜像中设置功能和 GPU 枚举。如果在 Dockerfile 中设置了环境变量，则不需要在 <code>docker run</code> 命令行中设置它们。</p><p>例如，如果您正在创建自己的自定义 CUDA 容器，可以设置环境变量的默认值如下：</p><pre class="line-numbers language-Dockerfile" data-language="Dockerfile"><code class="language-Dockerfile">ENV NVIDIA_VISIBLE_DEVICES allENV NVIDIA_DRIVER_CAPABILITIES compute,utility<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这些环境变量已经在 NVIDIA 提供的 CUDA 镜像中设置。</p>]]></content>
      
      
      <categories>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nvidia-docker </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Postgres 心得</title>
      <link href="database/postgres/postgres-7bf49e6e12c8/"/>
      <url>database/postgres/postgres-7bf49e6e12c8/</url>
      
        <content type="html"><![CDATA[<h2 id="使用-Docker-部署"><a href="#使用-Docker-部署" class="headerlink" title="使用 Docker 部署"></a>使用 Docker 部署</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker run --name postgres <span class="token punctuation">\</span>    -e <span class="token assign-left variable">POSTGRES_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span> <span class="token punctuation">\</span>    -e <span class="token assign-left variable">PGDATA</span><span class="token operator">=</span>/var/lib/postgresql/data/pgdata <span class="token punctuation">\</span>    -v /opt/data/postgres:/var/lib/postgresql/data <span class="token punctuation">\</span>    -p <span class="token number">5432</span>:5432 -d <span class="token punctuation">\</span>    postgres:14.1-alpine3.15<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>部署后默认创建 <code>postgres</code> 数据库，用户名为 <code>postgres</code>，密码为 <code>123456</code></p><p>若需要启动容器时创建新的数据库，则需要在 <code>/docker-entrypoint-initdb.d</code> 文件夹下创建初始化 sql 脚本</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> seeker<span class="token punctuation">;</span>  <span class="token comment">-- 创建新用户</span><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> db1<span class="token punctuation">;</span> <span class="token comment">-- 创建新数据库</span><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> <span class="token keyword">DATABASE</span> db1 <span class="token keyword">TO</span> seeker<span class="token punctuation">;</span> <span class="token comment">-- 赋予用户 seeker 访问 db1 的所有权限</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="psql-命令行访问"><a href="#psql-命令行访问" class="headerlink" title="psql 命令行访问"></a>psql 命令行访问</h2><p>容器启动后，可以 <code>exec</code> 进入容器，使用自带的 <code>psql</code> 客户端命令行访问服务</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">psql <span class="token punctuation">[</span>option<span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span>dbname <span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">]</span>$ docker <span class="token builtin class-name">exec</span> -it posgres psql db1 seekerpsql <span class="token punctuation">(</span><span class="token number">14.1</span><span class="token punctuation">)</span>Type <span class="token string">"help"</span> <span class="token keyword">for</span> help.<span class="token assign-left variable">db1</span><span class="token operator">=</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>psql 选项：</p><ul><li><code>-c, --command=COMMAND</code>：执行一条 SQL 或命令并退出</li><li><code>-d, --dbname=DBNAME</code>：指定要连接的数据库名，(默认: <code>&quot;root&quot;</code>)</li><li><code>-h, --host=HOSTNAME</code>：数据库服务地址， (默认: <code>&quot;local socket&quot;</code>)</li><li><code>-p, --port=PORT</code>: 数据库服务端口，(默认 <code>&quot;5432&quot;</code>)</li><li><code>-U, --username=USERNAME</code>：用户名，(默认 <code>&quot;root&quot;</code>)</li><li><code>-w, --no-password</code>: 不提示密码登录，会默认使用 Docekr 环境变量的密码</li><li><code>-W, --password</code>: 强制提示输入密码，</li></ul><p>更多命令行应用可以查看 <a href="http://www.postgres.cn/docs/13/app-psql.html">psql</a>，下面列出常用的几个命令</p><h3 id="查看所有数据库"><a href="#查看所有数据库" class="headerlink" title="查看所有数据库"></a>查看所有数据库</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">postgres<span class="token operator">=</span><span class="token comment"># \l  -- 列出所有数据库信息</span>                                 List <span class="token keyword">of</span> <span class="token keyword">databases</span>   Name    <span class="token operator">|</span>  Owner   <span class="token operator">|</span> Encoding <span class="token operator">|</span>  <span class="token keyword">Collate</span>   <span class="token operator">|</span>   Ctype    <span class="token operator">|</span>   Access <span class="token keyword">privileges</span>   <span class="token comment">-----------+----------+----------+------------+------------+-----------------------</span> postgres  <span class="token operator">|</span> postgres <span class="token operator">|</span> UTF8     <span class="token operator">|</span> en_US<span class="token punctuation">.</span>utf8 <span class="token operator">|</span> en_US<span class="token punctuation">.</span>utf8 <span class="token operator">|</span>  template0 <span class="token operator">|</span> postgres <span class="token operator">|</span> UTF8     <span class="token operator">|</span> en_US<span class="token punctuation">.</span>utf8 <span class="token operator">|</span> en_US<span class="token punctuation">.</span>utf8 <span class="token operator">|</span> <span class="token operator">=</span>c<span class="token operator">/</span>postgres          <span class="token operator">+</span>           <span class="token operator">|</span>          <span class="token operator">|</span>          <span class="token operator">|</span>            <span class="token operator">|</span>            <span class="token operator">|</span> postgres<span class="token operator">=</span>CTc<span class="token operator">/</span>postgres<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>postgres<span class="token operator">=</span><span class="token comment"># SELECT datname FROM pg_database; -- 使用 sql 查询 数据库名</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="切换数据库"><a href="#切换数据库" class="headerlink" title="切换数据库"></a>切换数据库</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">postgres<span class="token operator">=</span><span class="token comment"># \c db1 --  \connect 相当于重新开启一个新的连接，如果登录时设置了 -W 选项，则会提示输入密码</span>You are now connected <span class="token keyword">to</span> <span class="token keyword">database</span> <span class="token string">"db1"</span> <span class="token keyword">as</span> <span class="token keyword">user</span> <span class="token string">"postgres"</span><span class="token punctuation">.</span>db1<span class="token operator">=</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="查看所有表"><a href="#查看所有表" class="headerlink" title="查看所有表"></a>查看所有表</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">postgres<span class="token operator">=</span><span class="token comment"># \dt -- 列出所有表信息， 后面可以跟 正则表达式</span>         List <span class="token keyword">of</span> relations <span class="token keyword">Schema</span> <span class="token operator">|</span>     Name     <span class="token operator">|</span> <span class="token keyword">Type</span>  <span class="token operator">|</span>  Owner   <span class="token comment">--------+--------------+-------+----------</span> <span class="token keyword">public</span> <span class="token operator">|</span> tablename    <span class="token operator">|</span> <span class="token keyword">table</span> <span class="token operator">|</span> postgres <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>postgres<span class="token operator">=</span><span class="token comment"># select tablename from pg_tables where schemaname = 'public'; -- 使用 sql 查询 数据表名</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="查看表结构"><a href="#查看表结构" class="headerlink" title="查看表结构"></a>查看表结构</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">postgres<span class="token operator">=</span><span class="token comment"># \d channels  -- 查看表结构和索引信息</span>                            <span class="token keyword">Table</span> <span class="token string">"public.channels"</span> <span class="token keyword">Column</span> <span class="token operator">|</span>  <span class="token keyword">Type</span>  <span class="token operator">|</span> Collation <span class="token operator">|</span> Nullable <span class="token operator">|</span>               <span class="token keyword">Default</span>                <span class="token comment">--------+--------+-----------+----------+--------------------------------------</span> id     <span class="token operator">|</span> <span class="token keyword">bigint</span> <span class="token operator">|</span>           <span class="token operator">|</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token operator">|</span> nextval<span class="token punctuation">(</span><span class="token string">'channels_id_seq'</span>::regclass<span class="token punctuation">)</span> name   <span class="token operator">|</span> <span class="token keyword">text</span>   <span class="token operator">|</span>           <span class="token operator">|</span>          <span class="token operator">|</span> Indexes:    <span class="token string">"channels_pkey"</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> <span class="token keyword">btree</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="遇到的一些问题"><a href="#遇到的一些问题" class="headerlink" title="遇到的一些问题"></a>遇到的一些问题</h2><h3 id="迁移数据表，自增id失效"><a href="#迁移数据表，自增id失效" class="headerlink" title="迁移数据表，自增id失效"></a>迁移数据表，自增id失效</h3><p>当从一个数据库中拷贝一张表到另一个数据库，数据虽然过去了，但是自增 id 是从 1 开始的，这时候需要将自增 id 改为当前表的最后一个 id, Postgres 也提供了 <code>setval</code> 函数可以修改</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> setval<span class="token punctuation">(</span><span class="token string">'table_id_seq'</span>::regclass<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token keyword">table</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="表不存在"><a href="#表不存在" class="headerlink" title="表不存在"></a>表不存在</h3><p>服务启动前没有预先建表，当查询时，数据表不存在，Postgres 会报错 <code>ERROR: relation &quot;table&quot; does not exist (SQLSTATE 42P01)</code>，为了避免因为这个错误影响结果，可以预先在系统表里查找该表是否存在</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span>relname<span class="token punctuation">)</span> <span class="token keyword">from</span> pg_class <span class="token keyword">where</span> relname <span class="token operator">=</span> <span class="token string">'tablename'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Postgres </tag>
            
            <tag> SQL </tag>
            
            <tag> psql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UPX 压缩 go build 可执行文件</title>
      <link href="language/go/build-9f4ddd47a382/"/>
      <url>language/go/build-9f4ddd47a382/</url>
      
        <content type="html"><![CDATA[<p>Go 是静态编译语言，<code>go build</code>正常编译时会将依赖以及调试信息等都打包进去，不需要运行环境支持，但是这样一来，可执行文件体积就比较大，怎么解决呢，通过查询资料，有两种方法可以进一步减小可执行文件的体积。</p><h2 id="设置编译参数"><a href="#设置编译参数" class="headerlink" title="设置编译参数"></a>设置编译参数</h2><p><code>go build</code> 命令提供有可选编译参数，其中 <code>-ldflags</code> 选项将 <code>go tool link</code> 的参数传递给 <code>go build</code>，其中有下面两个参数，可以减少编译后的体积</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ go tool <span class="token function">link</span> --helpusage: <span class="token function">link</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> main.o  <span class="token punctuation">..</span>.  -s    disable symbol table      <span class="token comment"># 去掉符号表信息</span>  -w    disable DWARF generation  <span class="token comment"># 去掉 DWARF 调试信息，不能进行 gdb 调试 </span>  <span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>实际测试下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 不添加编译参数</span>$ go build<span class="token comment"># 查看大小</span>$ ll sql2md-rwxrwxr-x <span class="token number">1</span> mazhuang mazhuang <span class="token number">9</span>.8M Sep  <span class="token number">2</span> <span class="token number">15</span>:00 sql2md<span class="token comment"># 添加编译参数 -w</span>$ go build -ldflags<span class="token operator">=</span><span class="token string">"-w"</span>$ ll sql2md             -rwxrwxr-x <span class="token number">1</span> mazhuang mazhuang <span class="token number">8</span>.1M Sep  <span class="token number">2</span> <span class="token number">15</span>:08 sql2md<span class="token comment"># 添加编译参数 -s</span>$ go build -ldflags<span class="token operator">=</span><span class="token string">"-s"</span>$ ll sql2md-rwxrwxr-x <span class="token number">1</span> mazhuang mazhuang <span class="token number">7</span>.3M Sep  <span class="token number">2</span> <span class="token number">15</span>:08 sql2md<span class="token comment"># 添加编译参数 -w -s</span>$ go build -ldflags<span class="token operator">=</span><span class="token string">"-w -s"</span> $ ll sql2md-rwxrwxr-x <span class="token number">1</span> mazhuang mazhuang <span class="token number">7</span>.3M Sep  <span class="token number">2</span> <span class="token number">15</span>:02 sql2md<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到体积有了缩减，但是并不是很明显，其中 <code>-s</code> 和 <code>-w -s</code> 选项编译后的体积的是一样的，且体积最小</p><h2 id="使用-UPX-压缩"><a href="#使用-UPX-压缩" class="headerlink" title="使用 UPX 压缩"></a>使用 UPX 压缩</h2><p><a href="https://github.com/upx/upx">UPX(The Ultimate Packer for eXecutables)</a> 是开源的可执行文件压缩软件，UPX 通常会将程序和 DLL 的文件大小减少约 50%-70%，从而 减少磁盘空间、网络加载时间、下载时间和其他分销和存储成本。</p><p>UPX 压缩的程序和库是完全独立的并完全像以前一样运行，大多数情况下没有运行时或内存损失支持的格式。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># For CentOS/Fedora/RHEL</span>$ <span class="token function">sudo</span> yum <span class="token function">install</span> upx<span class="token comment"># For Ubuntu</span>$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> upx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="压缩测试"><a href="#压缩测试" class="headerlink" title="压缩测试"></a>压缩测试</h3><p>不使用编译参数，编译后压缩</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ go build <span class="token operator">&amp;&amp;</span> upx sql2md                        Ultimate Packer <span class="token keyword">for</span> eXecutables                          Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">1996</span> - <span class="token number">2017</span>UPX <span class="token number">3.94</span>        Markus Oberhumer, Laszlo Molnar <span class="token operator">&amp;</span> John Reiser   May 12th <span class="token number">2017</span>        File size         Ratio      Format      Name   --------------------   ------   -----------   -----------  <span class="token number">10190160</span> -$   <span class="token number">5405412</span>   <span class="token number">53.05</span>%   linux/amd64   sql2md                        Packed <span class="token number">1</span> file.$ ll sql2md-rwxrwxr-x <span class="token number">1</span> mazhuang mazhuang <span class="token number">5</span>.2M Sep  <span class="token number">2</span> <span class="token number">17</span>:08 sql2md<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>重新编译携带编译参数</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ go build -ldflags<span class="token operator">=</span><span class="token string">"-s"</span> <span class="token operator">&amp;&amp;</span> upx sql2md                       Ultimate Packer <span class="token keyword">for</span> eXecutables                          Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">1996</span> - <span class="token number">2017</span>UPX <span class="token number">3.94</span>        Markus Oberhumer, Laszlo Molnar <span class="token operator">&amp;</span> John Reiser   May 12th <span class="token number">2017</span>        File size         Ratio      Format      Name   --------------------   ------   -----------   -----------   <span class="token number">7620264</span> -<span class="token operator">></span>   <span class="token number">2833612</span>   <span class="token number">37.19</span>%   linux/amd64   sql2md                        Packed <span class="token number">1</span> file.$ ll sql2md-rwxrwxr-x <span class="token number">1</span> mazhuang mazhuang <span class="token number">2</span>.8M Sep  <span class="token number">2</span> <span class="token number">17</span>:19 sql2md<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>带参数编译后再压缩，体积从 9.8 缩小到 2.8, 减少了约 71.4%，有了很明显的改善</p>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
            <tag> build </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 gihub-action 发布 go release</title>
      <link href="tools/github/go-action-917caa029424/"/>
      <url>tools/github/go-action-917caa029424/</url>
      
        <content type="html"><![CDATA[<p>当需要自动编译并发布 release 程序时，可以使用 github action 的工作流来实现</p><h2 id="创建工作流脚本"><a href="#创建工作流脚本" class="headerlink" title="创建工作流脚本"></a>创建工作流脚本</h2><p>新建yml脚本 <code>.github/workflows/release.yml</code>,</p><pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"># 工作流名称name: Go Release# 触发条件on:  push:    # 创建 tag 时    tags:    - v*    # 推送到 master 分支时    branchs:    - masterjobs:  release:    # 运行环境    runs-on: ubuntu-latest    steps:    # 切换到对应 tag 源码    - name: Checkout      uses: actions&#x2F;checkout@v2      with:        fetch-depth: 0    # 安装 Go    - name: Set up Go      uses: actions&#x2F;setup-go@v2      with:        go-version: 1.17    # 使用 goreleaser 编译 release    - name: Create release on GitHub      uses: goreleaser&#x2F;goreleaser-action@v2      with:        # GoReleaser 版本        version: latest        # 传递给 GoReleaser 的参数        args: release --rm-dist      env:        # 提供访问仓库token        GITHUB_TOKEN: $&#123;&#123;secrets.GITHUB_TOKEN&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里使用 <a href="https://goreleaser.com/">goreleaser</a> 提供的多平台二进制文件构建 github action，可以更方便的编译多平台版本, 详细信息请阅读 <a href="https://github.com/goreleaser/goreleaser-action#usage">GoReleaser Action Usage</a></p><h3 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h3><p>使用该 action 还需要提供配置文件 <code>.goreleaser.yaml</code>，放置在仓库根目录下，若不提供配置文件，则会根据<a href="https://github.com/goreleaser/goreleaser/blob/master/.goreleaser.yml">默认的配置文件</a>，编译所有平台的版本，以及 docker 等编译流程，有可能会出错。因此，根据自己需要，参考默认配置文件，选择适合自己的配置，确保工作流正常执行</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Golang </tag>
            
            <tag> github </tag>
            
            <tag> workflow </tag>
            
            <tag> ci </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rtsp 协议</title>
      <link href="stream/protocol/rtsp-c0ef3fecf501/"/>
      <url>stream/protocol/rtsp-c0ef3fecf501/</url>
      
        <content type="html"><![CDATA[<p>实时流协议 (RTSP) 是一种应用程序级协议，用于控制具有实时属性的数据的传送。 RTSP 提供了一个可扩展的框架，以实现实时数据（如音频和视频）的受控、按需交付。 数据源可以包括实时数据馈送和存储的剪辑。 该协议旨在控制多个数据传输会话，提供一种选择传输通道（例如 UDP、多播 UDP 和 TCP）的方法，并提供一种选择基于 RTP (<a href="https://datatracker.ietf.org/doc/html/rfc1889">RFC 1889</a>) 的传输机制的方法。</p><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1 介绍"></a>1 介绍</h2><h3 id="1-1-目的"><a href="#1-1-目的" class="headerlink" title="1.1 目的"></a>1.1 目的</h3><p>实时流协议 (RTSP) 建立和控制 单个或多个时间同步的连续流 音频和视频等媒体。它通常不提供 连续流本身，虽然连续的交错 带有控制流的媒体流是可能的（参见<a href="#1012-%E5%B5%8C%E5%85%A5%E4%BA%A4%E9%94%99%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE">第 10.12 节</a>）。 换句话说，RTSP 充当“网络远程控制” 多媒体服务器。</p><p>要控制的流集由演示描述(presentation description)定义。 本备忘录未定义演示描述的格式。</p><p>没有 RTSP 连接的概念； 相反，服务器维护一个由标识符标记的会话。 RTSP 会话与传输级连接（如 TCP 连接）无关。 在 RTSP 会话期间，RTSP 客户端可能会打开和关闭许多与服务器的可靠传输连接以发出 RTSP 请求。或者，它可以使用无连接传输协议，例如 UDP。</p><p>RTSP 控制的流可以使用 RTP [1]，但是 RTSP 不依赖于用于承载的传输机制 连续媒体。该协议在语法上有意相似 并运行到 HTTP/1.1 [2] 以便扩展机制到 HTTP 在大多数情况下也可以添加到 RTSP。但是，RTSP 的不同之处在于 HTTP 的几个重要方面：</p><ul><li>RTSP 引入了许多新方法并具有不同的协议标识符。</li><li>一个 RTSP 服务器需要在几乎所有情况下默认维护状态 与 HTTP 的无状态性质相反。</li><li>RTSP 服务器和客户端都可以发出请求。</li><li>数据通过不同的协议在带外(out-of-band)传输（有一特例除外）。</li><li>RTSP 被定义为使用 ISO 10646 (UTF-8) 而不是 ISO 8859-1， 与当前的 HTML 国际化努力一致 [3]。</li><li>Request-URI 始终包含绝对 URI。因为 向后兼容历史错误，HTTP/1.1 [2] 请求中只携带绝对路径，并放置主机 名称在单独的头部字段中。</li></ul><p>这使得“虚拟主机”的实现更容易，其中一台主机与一台主机 IP 地址托管多个文档树。</p><p>该协议支持以下操作：</p><ul><li>从媒体服务器检索媒体：<br>客户端可以通过 HTTP 或其他一些方法请求演示描述。 如果演示正在被多播，则演示描述包含要用于连续媒体的多播地址和端口。 如果仅通过单播将演示发送给客户端，则出于安全原因，客户端会提供目的地。</li><li>邀请媒体服务器参加会议：<br>可以“邀请”媒体服务器加入现有会议，或者在演示中播放媒体，或者在演示中记录媒体的全部或子集。 这种模式对于分布式教学应用很有用。 会议中的几方可能会轮流“按下遥控器按钮”。</li><li>向现有演示添加媒体：<br>特别是对于现场演示，如果服务器可以告诉客户端额外的媒体正在成为可用的。</li></ul><p>RTSP 请求可以由代理、隧道和缓存处理，如 HTTP/1.1 [2]。</p><h3 id="1-2-要求"><a href="#1-2-要求" class="headerlink" title="1.2 要求"></a>1.2 要求</h3><p>本文档中的关键词“MUST”、“MUST NOT”、“REQUIRED”、“SHALL”、“SHALL NOT”、“SHOULD”、“SHOULD NOT”、“RECOMMENDED”、“MAY”和“OPTIONAL” 将按照 <a href="https://datatracker.ietf.org/doc/html/rfc2119">RFC 2119</a> [4] 中的描述进行解释。</p><h3 id="1-3-术语"><a href="#1-3-术语" class="headerlink" title="1.3 术语"></a>1.3 术语</h3><ul><li>聚合控制（Aggregate control）：<br>服务器使用单个时间线控制多个流。对于音频/视频源，这意味着客户端可以发出单个播放或暂停消息来控制音频和视频源。</li><li>会议（Conference）：<br>多方多媒体演示，其中“多”意味着大于或等于一。</li><li>客户端（Client）：<br>客户端从媒体服务器请求连续的媒体数据。</li><li>连接（Connection）：<br>在两个以通讯为目的的程序之间建立传输层虚拟电路。</li><li>容器文件（Container file）：<br>可能包含多个媒体流的文件，这些媒体流在一起播放时通常包含一个演示。 RTSP 服务器可以提供对这些文件的聚合控制，尽管容器文件的概念没有嵌入到协议中。</li><li>连续媒体（Continuous media）：<br>source和sink之间存在时序关系的数据； 也就是说，接收端必须重现源端存在的时序关系。 连续媒体最常见的例子是音频和动态视频。 连续媒体可以是实时的（交互式），其中源和接收器之间存在“紧密”的时间关系，也可以是流媒体（回放），这种关系不太严格。</li><li>实体（Entity）：<br>作为请求或响应的有效负载传输的信息。一个实体由实体头字段形式的元信息和实体主体形式的内容组成，如第 8 节所述。</li><li>媒体初始化（Media initialization）：<br>数据类型/编解码器特定的初始化。 这包括诸如时钟速率、颜色表等。客户端播放媒体流所需的任何传输无关信息发生在流设置的媒体初始化阶段。</li><li>媒体参数（Media parameter）：<br>特定于媒体类型的参数，可以在流播放之前或期间更改。</li><li>媒体服务器（Media server）：<br>为一个或多个媒体流提供播放或录制服务的服务器。 演示中的不同媒体流可能源自不同的媒体服务器。 媒体服务器可以与调用演示的 Web 服务器驻留在相同或不同的主机上。</li><li>媒体服务器间接（Media server indirection）：<br>将媒体客户端重定向到不同的媒体服务器。</li><li>媒体流（Media stream）：<br>单个媒体实例，例如音频流或视频流以及单个白板或共享应用程序组。 使用 RTP 时，流由 RTP 会话中的源创建的所有 RTP 和 RTCP 数据包组成。 这等效于 DSM-CC 流（[5]）的定义。</li><li>消息（Message）：<br>RTSP 通信的基本单元，由符合第 15 节中定义的语法并通过连接或无连接协议传输的八位字节的结构化序列组成。</li><li>参与者（Participant）：<br>会议成员。 参与者可以是机器，例如媒体记录或回放服务器。</li><li>演示（Presentation）：<br>一组一个或多个流作为完整的媒体馈送呈现给客户端，使用如下定义的演示描述。 在 RTSP 上下文中的大多数情况下，这意味着对这些流的聚合控制，但并非必须如此。</li><li>演示描述（Presentation description）：<br>演示描述包含有关演示中一个或多个媒体流的信息，例如编码集、网络地址和有关内容的信息。 其他 IETF 协议如 SDP (<a href="https://datatracker.ietf.org/doc/html/rfc2327">RFC 2327</a> [6]) 使用术语“会话”来表示现场演示。 呈现描述可以采用多种不同的格式，包括但不限于会话描述格式SDP。</li><li>响应（Response）：<br>RTSP 响应。 如果是 HTTP 响应，则明确指出。</li><li>请求（Request）：<br>RTSP 请求。 如果是 HTTP 请求，则明确指出。</li><li>RTSP 会话(RTSP session)：<br>完整的 RTSP“事务”，例如观看电影。 会话通常包括客户端为连续媒体流设置传输机制 (<code>SETUP</code>)，使用 <code>PLAY</code> 或 <code>RECORD</code> 启动流，并使用 <code>TEARDOWN</code> 关闭流。</li><li>传输初始化（Transport initialization）：<br>客户端和服务器之间传输信息（例如，端口号、传输协议）的协商。</li></ul><h3 id="1-4-协议属性"><a href="#1-4-协议属性" class="headerlink" title="1.4 协议属性"></a>1.4 协议属性</h3><p>RTSP 具有以下属性：</p><ul><li><strong>可扩展</strong>：<br>可以轻松地将新方法和参数添加到 RTSP。</li><li><strong>易于解析</strong>：<br>RTSP 可以被标准 HTTP 或 MIME 解析器解析。</li><li><strong>安全</strong>：<br>RTSP 重复使用网络安全机制。 所有 HTTP 身份验证机制，例如基本（<a href="https://datatracker.ietf.org/doc/html/rfc2068">RFC 2068</a> [2，第 11.1 节]）和摘要身份验证（<a href="https://datatracker.ietf.org/doc/html/rfc2069">RFC 2069</a> [8]）都可以直接应用。 还可以重用传输或网络层安全机制。</li><li><strong>传输无关</strong>：<br>RTSP 可以使用不可靠的数据报协议 (UDP) (<a href="https://datatracker.ietf.org/doc/html/rfc768">RFC 768</a> [9])、可靠的数据报协议 (RDP（<a href="https://datatracker.ietf.org/doc/html/rfc1151">RFC 1151</a>）未广泛使用的 [10]) 或可靠的流协议，例如 TCP (<a href="https://datatracker.ietf.org/doc/html/rfc793">RFC 793</a> [11]），因为它实现了应用程序级的可靠性。</li><li><strong>支持多服务器</strong>：<br>演示中的每个媒体流都可以驻留在不同的服务器上。 客户端自动与不同的媒体服务器建立多个并发控制会话。 媒体同步在传输层执行。</li><li><strong>记录设备的控制</strong>：<br>该协议可以控制记录和播放设备，以及可以在两种模式之间交替的设备（“VCR”）。</li><li><strong>流控与会议发起分离</strong>：<br>流控与邀请媒体服务器加入会议分离。 唯一的要求是会议发起协议提供或可用于创建唯一的会议标识符。 特别地，SIP[12]或H.323[13]可用于邀请服务器参加会议。</li><li><strong>适用于专业应用</strong>：<br>RTSP 通过 SMPTE 时间戳支持帧级精度，允许远程数字编辑。</li><li><strong>演示描述中立</strong>：<br>协议不强加特定的演示描述或元文件格式，并且可以传达要使用的格式类型。 但是，演示描述必须至少包含一个 RTSP URI。</li><li><strong>代理和防火墙友好</strong>：<br>应用程序和传输层 (SOCKS [14]) 防火墙应该可以轻松处理该协议。 防火墙可能需要了解 <code>SETUP</code> 方法才能为 UDP 媒体流打开一个“洞”。</li><li><strong>HTTP 友好</strong>：<br>在合理的情况下，RTSP 重用 HTTP 概念，以便可以重用现有的基础设施。 该基础设施包括用于将标签与内容相关联的 PICS（互联网内容选择平台 [15,16]）。 然而，RTSP 不仅仅向 HTTP 添加方法，因为在大多数情况下控制连续媒体需要服务器状态。</li><li><strong>适当的服务器控制</strong>：<br>如果客户端可以启动流，则它必须能够停止流。 服务器不应以客户端无法停止流的方式开始向客户端流式传输。</li><li><strong>传输协商</strong>：<br>客户端可以在实际需要处理连续媒体流之前协商传输方法。</li><li><strong>能力协商</strong>：<br>如果基本功能被禁用，客户端必须有一些干净的机制来确定哪些方法不会被实现。 这允许客户端呈现适当的用户界面。 例如，如果不允许搜索，则用户界面必须能够禁止移动滑动位置指示器。</li></ul><p>RTSP 的早期要求是多客户端功能。 但是，确定更好的方法是确保协议可以轻松扩展到多客户端场景。 流标识符可以被多个控制流使用，因此“传递远程”是可能的。 该协议不会解决几个客户端如何协商访问的问题； 这留给“社交协议”或其他一些楼层控制机制。</p><h3 id="1-5-扩展-RTSP"><a href="#1-5-扩展-RTSP" class="headerlink" title="1.5 扩展 RTSP"></a>1.5 扩展 RTSP</h3><p>由于并非所有媒体服务器都具有相同的功能，因此媒体服务器必然会支持不同的请求集。 例如：</p><ul><li>服务器可能只能播放，因此不需要支持 <code>RECORD</code> 请求。</li><li>如果服务器仅支持实时事件，则它可能无法搜索（绝对定位）。</li><li>某些服务器可能不支持设置流参数，因此不支持 <code>GET_PARAMETER</code> 和 <code>SET_PARAMETER</code>。</li></ul><p>服务器应该实现<a href="#12-%E5%A4%B4%E9%83%A8%E5%AD%97%E6%AE%B5%E5%AE%9A%E4%B9%89">第 12 节</a>中描述的所有头域。</p><p>由演示描述的创建者决定不要询问服务器的不可能。 这种情况与 HTTP/1.1 [2] 中的情况类似，其中 [H19.6] 中描述的方法不太可能在所有服务器上都得到支持。</p><p>RTSP 可以通过三种方式进行扩展，此处按支持的更改量级列出：</p><ul><li>现有方法可以用新参数扩展，只要这些参数可以被接收者安全地忽略。（这相当于向 HTML 标签添加新参数。）如果客户端在不支持方法扩展时需要否定确认，则可以在 <code>Require</code>: 字段中添加与扩展对应的标签（参见第 12.32 节）。</li><li>可以添加新方法。如果消息的接收者不理解该请求，它会以错误代码 <code>501</code>（未实现）进行响应，并且发送者不应再次尝试使用此方法。客户端也可以使用 <code>OPTIONS</code> 方法来查询服务器支持的方法。服务器应该使用公共响应头列出它支持的方法。</li><li>可以定义新的协议版本，允许几乎所有方面（除了协议版本号的位置）改变。</li></ul><h3 id="1-6-操作模式"><a href="#1-6-操作模式" class="headerlink" title="1.6 操作模式"></a>1.6 操作模式</h3><p>每个演示和媒体流都可以由一个 RTSP URL 标识。 整个演示和演示组成的媒体的属性由演示描述文件定义，其格式超出了本规范的范围。 呈现描述文件可以由客户端通过HTTP或电子邮件等其他方式获取，不一定存储在媒体服务器上。</p><p>出于本规范的目的，假定一个演示描述描述一个或多个演示，每个演示维护一个共同的时间轴。为了说明的简单并且不失一般性，假设演示描述恰好包含一个这样的演示。一个演示可能包含多个媒体流。</p><p>演示描述文件包含对构成演示的媒体流的描述，包括它们的编码、语言和其他参数，这些参数使客户端能够选择最合适的媒体组合。在此演示描述中，每个可由 RTSP 单独控制的媒体流由一个 RTSP URL 标识，该 URL 指向处理该特定媒体流的媒体服务器并命名存储在该服务器上的流。多个媒体流可以位于不同的服务器上；例如，音频和视频流可以跨服务器拆分以进行负载共享。该描述还列举了服务器能够使用的传输方法。</p><p>除了媒体参数之外，还需要确定网络目标地址和端口。 可以区分几种操作模式：</p><ul><li>单播：<br>媒体通过客户端选择的端口号传输到 RTSP 请求的源。 或者，媒体在与 RTSP 相同的可靠流上传输。</li><li>多播，服务器选择地址：<br>媒体服务器选择多播地址和端口。 这是实况或近媒体点播传输的典型情况。</li><li>多播，客户端选择地址：<br>如果服务器要参加现有的多播会议，则多播地址、端口和加密密钥由会议描述给出，通过本规范范围之外的方式建立。</li></ul><h3 id="1-7-RTSP-状态"><a href="#1-7-RTSP-状态" class="headerlink" title="1.7 RTSP 状态"></a>1.7 RTSP 状态</h3><p>RTSP 控制可以通过独立协议发送的流，与控制通道无关。 例如，当数据通过 UDP 流动时，RTSP 控制可能发生在 TCP 连接上。 因此，即使媒体服务器没有收到 RTSP 请求，数据传递也会继续。 此外，在其生命周期内，单个媒体流可能由在不同 TCP 连接上顺序发出的 RTSP 请求控制。 因此，服务器需要维护“会话状态”才能将 RTSP 请求与流相关联。 状态转换在 A 节中描述。</p><p>RTSP 中的许多方法对状态没有贡献。 但是，以下在定义服务器上流资源的分配和使用方面起着核心作用：<code>SETUP</code>, <code>PLAY</code>, <code>RECORD</code>, <code>PAUSE</code>, 和 <code>TEARDOWN</code>。</p><ul><li><code>SETUP</code>：<br>使服务器为流分配资源并启动 RTSP 会话。</li><li><code>PLAY</code> 和 <code>RECORD</code>：<br>在通过 SETUP 分配的流上开始数据传输。</li><li><code>PAUSE</code>：<br>在不释放服务器资源的情况下暂时停止流。</li><li><code>TEARDOWN</code>：<br>释放与流相关的资源。 RTSP 会话不再存在于服务器上。有助于状态的 RTSP 方法使用会话头字段（第 12.37 节）来标识其状态正在被操纵的 RTSP 会话。 服务器生成会话标识符以响应 SETUP 请求（<a href="#104-setup">第 10.4 节</a>）。</li></ul><h3 id="1-8-与其他协议的关系"><a href="#1-8-与其他协议的关系" class="headerlink" title="1.8 与其他协议的关系"></a>1.8 与其他协议的关系</h3><p>RTSP 在功能上与 HTTP 有一些重叠。 它还可能与 HTTP 交互，因为与流媒体内容的初始联系通常是通过网页进行的。 当前协议规范旨在允许 Web 服务器和实现 RTSP 的媒体服务器之间的不同切换点。 例如，可以使用 HTTP 或 RTSP 检索表示描述，这减少了基于 Web 浏览器的场景中的往返次数，同时还允许完全不依赖 HTTP 的独立 RTSP 服务器和客户端。</p><p>但是，RTSP 与 HTTP 的根本不同之处在于，数据传递是在不同的协议中带外进行的。 HTTP 是一种非对称协议，客户端发出请求，服务器响应。 <strong>在 RTSP 中，媒体客户端和媒体服务器都可以发出请求。 RTSP 请求也不是无状态的； 他们可以设置参数并在请求被确认后很长时间继续控制媒体流。</strong></p><blockquote><p>重用 HTTP 功能至少在两个方面具有优势，即安全性和代理。 要求非常相似，因此能够在缓存、代理和身份验证上采用 HTTP 工作是很有价值的。</p></blockquote><p>虽然大多数实时媒体将使用 RTP 作为传输协议，但 RTSP 并不依赖于 RTP。</p><p>RTSP 假定存在可以表达包含多个媒体流的演示的静态和时间属性的演示描述格式。</p><h2 id="2-符号约定"><a href="#2-符号约定" class="headerlink" title="2 符号约定"></a>2 符号约定</h2><p>由于许多定义和语法与 HTTP/1.1 相同，因此本规范仅指向定义它们的部分，而不是复制它。 为简洁起见，[HX.Y] 指的是当前 HTTP/1.1 规范（<a href="https://datatracker.ietf.org/doc/html/rfc2068">RFC 2068</a> [2]）的 X.Y 部分。</p><p>本文档中指定的所有机制均以散文和类似于 [H2.1] 中使用的增强型巴科斯-诺尔形式 (BNF) 进行描述。 它在 <a href="https://datatracker.ietf.org/doc/html/rfc2234">RFC 2234</a> [17] 中有详细描述，不同之处在于该 RTSP 规范维护逗号分隔列表的“1#”符号。</p><p>在本备忘录中，我们使用缩进和较小类型的段落来提供背景和动机。 这是为了让没有参与规范制定的读者理解为什么事情是他们在 RTSP 中的方式。</p><h2 id="3-协议参数"><a href="#3-协议参数" class="headerlink" title="3 协议参数"></a>3 协议参数</h2><h3 id="3-1-RTSP-版本"><a href="#3-1-RTSP-版本" class="headerlink" title="3.1 RTSP 版本"></a>3.1 RTSP 版本</h3><p><a href="https://datatracker.ietf.org/doc/html/rfc2068#section-3.1">[H3.1]</a> 适用，HTTP 被 RTSP 取代。</p><h3 id="3-2-RTSP-RUL"><a href="#3-2-RTSP-RUL" class="headerlink" title="3.2 RTSP RUL"></a>3.2 RTSP RUL</h3><p>“rtsp”和“rtspu”方案用于通过RTSP协议引用网络资源。 本节定义了 RTSP URL 的特定于方案的语法和语义。</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">rtsp_URL  &#x3D;   ( &quot;rtsp:&quot; | &quot;rtspu:&quot; )              &quot;&#x2F;&#x2F;&quot; host [ &quot;:&quot; port ] [ abs_path ]host      &#x3D;   &lt;IP 地址的合法 Internet 主机域名（点分十进制形式），如 RFC 1123 \cite&#123;rfc1123&#125; 的第 2.1 节所定义 &gt;port      &#x3D;   *DIGIT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>abs_path 在[H3.2.1] 中定义。</p><blockquote><p>请注意，此时片段和查询标识符没有明确定义的含义，解释权留给 RTSP 服务器。</p></blockquote><p>rtsp 方案要求使用可靠的协议（Internet 的 TCP 协议）发出命令，而 rtspu 方案使用不可靠的协议（Internet 的 UDP 协议）。</p><p>如果端口为空或未给出，则默认端口为 554。 语义是识别的资源可以由服务器上的 RTSP 控制，监听 TCP（方案“rtsp”）连接或主机端口上的 UDP（方案“rtspu”）数据包，资源的 Request-URI 是 rtsp_URL。</p><p>应尽可能避免在 URL 中使用 IP 地址（参见 <a href="https://datatracker.ietf.org/doc/html/rfc1924">RFC 1924</a> [19]）。</p><p>演示或流由文本媒体标识符标识，使用 URL 的字符集和转义约定 [H3.2]（<a href="https://datatracker.ietf.org/doc/html/rfc1738">RFC 1738</a> [20]）。 URL 可以指一个流或一个流的集合，即一个演示。 因此，第 10 节中描述的请求可以应用于整个演示或演示中的单个流。 请注意，某些请求方法只能应用于流，不能应用于演示，反之亦然。</p><p>例如，RTSP URL：<code>rtsp://media.example.com:554/twister/audiotrack</code>，标识了演示“twister”中的音频流，可以通过 TCP 连接向主机 <code>media.example.com</code> 的端口 <code>554</code> 发出的 RTSP 请求进行控制。</p><p>此外，RTSP URL：<code>rtsp://media.example.com:554/twister</code> 标识了可能由音频和视频流组成的演示“twister”。</p><p>这并不意味着在 URL 中引用流的标准方法。 演示描述定义了演示中的层次关系以及各个流的 URL。 演示描述可以将流命名为“a.mov”，并将整个演示命名为“b.mov”。</p><p>RTSP URL 的路径组件对客户端是不透明的，并且不暗示服务器的任何特定文件系统结构。</p><blockquote><p>这种解耦还允许通过简单地替换 URL 中的方案来将表示描述与非 RTSP 媒体控制协议一起使用。</p></blockquote><h3 id="3-3-会议标识符"><a href="#3-3-会议标识符" class="headerlink" title="3.3 会议标识符"></a>3.3 会议标识符</h3><p>会议标识符对 RTSP 是不透明的，并使用标准 URI 编码方法进行编码（即，LWS 使用 % 进行转义）。 它们可以包含任何八位字节值。 会议标识符必须是全局唯一的。 对于 H.323，将使用会议 ID 值。</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">conference-id &#x3D;   1*xchar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>会议标识符用于允许 RTSP 会话从媒体服务器正在参与的多媒体会议中获取参数。这些会议是由本规范范围之外的协议创建的，例如 H.323 [13] 或 SIP [12]。 例如，RTSP 客户端不是明确提供传输信息，而是要求媒体服务器使用会议描述中的值。</p><h3 id="3-4-会话标识符"><a href="#3-4-会话标识符" class="headerlink" title="3.4 会话标识符"></a>3.4 会话标识符</h3><p>会话标识符是任意长度的不透明字符串。 线性空白必须是 URL 转义的。 会话标识符必须随机选择，并且必须至少有 8 个八位字节长，以便更难猜测。 （见第 16 节。）</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">session-id   &#x3D;   1*( ALPHA | DIGIT | safe )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-5-SMPTE-相对时间戳"><a href="#3-5-SMPTE-相对时间戳" class="headerlink" title="3.5 SMPTE 相对时间戳"></a>3.5 SMPTE 相对时间戳</h3><p>SMPTE 相对时间戳表示相对于剪辑开始的时间。 相对时间戳表示为 SMPTE 时间码，以确保帧级访问精度。 时间码的格式为 <code>hours:minutes:seconds:frames.subframes</code>，原点位于剪辑的开头。 默认的 smpte 格式为“SMPTE 30 drop”格式，帧率为 29.97 帧/秒。 通过使用“smpte time”的替代使用，可以支持其他 SMPTE 代码（例如“SMPTE 25”）。 对于时间值中的“帧”字段，可以假定值为 0 到 29。每秒 30 和 29.97 帧之间的差异是通过丢弃每分钟的前两个帧索引（值 00 和 01）来处理的，每十分钟除外 . 如果帧值为零，则可以省略。 子帧以帧的百分之一进行测量。</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">smpte-range  &#x3D;   smpte-type &quot;&#x3D;&quot; smpte-time &quot;-&quot; [ smpte-time ]smpte-type   &#x3D;   &quot;smpte&quot; | &quot;smpte-30-drop&quot; | &quot;smpte-25&quot;                                ; other timecodes may be addedsmpte-time   &#x3D;   1*2DIGIT &quot;:&quot; 1*2DIGIT &quot;:&quot; 1*2DIGIT [ &quot;:&quot; 1*2DIGIT ]                    [ &quot;.&quot; 1*2DIGIT ]Examples:    smpte&#x3D;10:12:33:20-    smpte&#x3D;10:07:33-    smpte&#x3D;10:07:00-10:07:33:05.01    smpte-25&#x3D;10:07:00-10:07:33:05.01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-6-正常播放时间-NPT"><a href="#3-6-正常播放时间-NPT" class="headerlink" title="3.6 正常播放时间(NPT)"></a>3.6 正常播放时间(NPT)</h3><p>正常播放时间 (NPT) 表示流相对于演示开始的绝对位置。时间戳由小数组成。小数点左边的部分可以用秒或小时、分钟和秒来表示。小数点右边的部分测量秒的分数。</p><p>演示的开始对应于 0.0 秒。负值没有定义。特殊常量 now 被定义为实时事件的当前时刻。它只能用于现场活动。</p><p>NPT 在 DSM-CC 中被定义为：“直观地说，NPT 是观众与节目相关联的时钟。它通常以数字方式显示在 VCR 上。NPT 在正常播放模式（比例 = 1）下正常推进，以更快的速度推进 “在快速向前扫描（高正比例）时的速率，在反向扫描（高负比例）时递减，并在暂停模式下固定。NPT（逻辑上）等效于 SMPTE 时间码。” [5]</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">npt-range    &#x3D;   ( npt-time &quot;-&quot; [ npt-time ] ) | ( &quot;-&quot; npt-time )npt-time     &#x3D;   &quot;now&quot; | npt-sec | npt-hhmmssnpt-sec      &#x3D;   1*DIGIT [ &quot;.&quot; *DIGIT ]npt-hhmmss   &#x3D;   npt-hh &quot;:&quot; npt-mm &quot;:&quot; npt-ss [ &quot;.&quot; *DIGIT ]npt-hh       &#x3D;   1*DIGIT     ; any positive numbernpt-mm       &#x3D;   1*2DIGIT    ; 0-59npt-ss       &#x3D;   1*2DIGIT    ; 0-59Examples:    npt&#x3D;123.45-125    npt&#x3D;12:05:35.3-    npt&#x3D;now-<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>语法符合 ISO 8601。 npt-sec 表示法针对自动生成进行了优化，ntp-hhmmss 表示法针对人类读者的使用进行了优化。 “now”常量允许客户端请求接收实时提要，而不是存储或延迟的版本。 这是必需的，因为绝对时间和零时间都不适合这种情况。</p></blockquote><h3 id="3-7-绝对时间"><a href="#3-7-绝对时间" class="headerlink" title="3.7 绝对时间"></a>3.7 绝对时间</h3><p>绝对时间表示为 ISO 8601 时间戳，使用 UTC (GMT)。 可以指示几分之一秒。</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">utc-range    &#x3D;   &quot;clock&quot; &quot;&#x3D;&quot; utc-time &quot;-&quot; [ utc-time ]utc-time     &#x3D;   utc-date &quot;T&quot; utc-time &quot;Z&quot;utc-date     &#x3D;   8DIGIT                    ; &lt; YYYYMMDD &gt;utc-time     &#x3D;   6DIGIT [ &quot;.&quot; fraction ]   ; &lt; HHMMSS.fraction &gt;Example for November 8, 1996 at 14h37 and 20 and a quarter seconds UTC:19961108T143720.25Z<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-8-选项标签"><a href="#3-8-选项标签" class="headerlink" title="3.8 选项标签"></a>3.8 选项标签</h3><p>选项标签是用于在 RTSP 中指定新选项的唯一标识符。 这些标签用于 Require（第 12.32 节）和 Proxy-Require（第 12.27 节）标头字段。</p><p>语法:</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">option-tag   &#x3D;   1*xchar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>新 RTSP 选项的创建者应该使用反向域名作为该选项的前缀（例如，“com.foo.mynewfeature”是可以在“foo.com”上找到其发明者的特征的恰当名称），或者注册 互联网号码分配机构 (IANA) 的新选项。</p><h4 id="3-8-1-向-IANA-注册新的选项标签"><a href="#3-8-1-向-IANA-注册新的选项标签" class="headerlink" title="3.8.1 向 IANA 注册新的选项标签"></a>3.8.1 向 IANA 注册新的选项标签</h4><p>注册新的 RTSP 选项时，应提供以下信息：</p><ul><li>选项的名称和描述。 名称可以是任意长度，但长度不应超过 20 个字符。 名称不得包含任何空格、控制字符或句点。</li><li>表明谁对选项具有变更控制权（例如，IETF、ISO、ITU-T、其他国际标准化机构、财团或特定公司或公司集团）；</li><li>对进一步描述的引用（如果有），例如（按优先顺序）RFC、发表的论文、专利申请、技术报告、记录的源代码或计算机手册；</li><li>对于专有选项，联系信息（邮政和电子邮件地址）；</li></ul><h2 id="4-RTSP-消息"><a href="#4-RTSP-消息" class="headerlink" title="4 RTSP 消息"></a>4 RTSP 消息</h2><p>RTSP 是一种基于文本的协议，使用 UTF-8 编码（<a href="https://datatracker.ietf.org/doc/html/rfc2279">RFC 2279</a> [21]）中的 ISO 10646 字符集。线路由 CRLF 终止，但接收方也应准备好将 CR 和 LF 自己解释为线路终止符。</p><blockquote><p>基于文本的协议使以自描述方式添加可选参数变得更加容易。由于参数数量和命令频率低，处理效率不是问题。如果仔细完成基于文本的协议，还可以轻松地以 Tcl、Visual Basic 和 Perl 等脚本语言实现研究原型。</p><p>10646 字符集避免了棘手的字符集切换，但只要使用 US-ASCII，应用程序就看不到它。这也是用于 RTCP 的编码。 ISO 8859-1 直接转换为 Unicode，高位八位字节为零。设置了最高有效位的 ISO 8859-1 字符表示为 1100001x 10xxxxxx。 （参见 <a href="https://datatracker.ietf.org/doc/html/rfc2279">RFC 2279</a> [21]）</p></blockquote><p>RTSP 消息可以通过任何 8 位简洁的低层传输协议承载。</p><p>请求包含方法、方法所操作的对象以及进一步描述方法的参数。除非另有说明，否则方法是幂等的。方法还被设计为在媒体服务器上需要很少或不需要状态维护。</p><h3 id="4-1-消息类型"><a href="#4-1-消息类型" class="headerlink" title="4.1 消息类型"></a>4.1 消息类型</h3><p>详见<a href="https://datatracker.ietf.org/doc/html/rfc2068#section-4.1">[H4.1]</a></p><p>RTSP 消息包括从客户端到服务器的请求和响应 从服务器到客户端。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">RTSP-message   &#x3D; Request | Response     ; RTSP&#x2F;1.0 messages<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>请求（第 5 节）和响应（第 6 节）消息使用 <a href="https://datatracker.ietf.org/doc/html/rfc822">RFC 822</a> [9] 的通用消息格式来传输实体（消息的有效负载）。 两种类型的消息都包含一个起始行、一个或多个头域（也称为“头”）、一个空行（即在 CRLF 之前没有任何内容的行）指示头域的结尾，以及一个可选的 message-body。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">generic-message &#x3D; start-line                  *message-header                  CRLF                  [ message-body ]start-line      &#x3D; Request-Line | Status-Line<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>为了健壮性，服务器应该忽略收到请求行的任何空行。换句话说，如果服务器正在读取消息开头的协议流并首先接收到 CRLF，则它应该忽略 CRLF。</p><h3 id="4-2-消息头"><a href="#4-2-消息头" class="headerlink" title="4.2 消息头"></a>4.2 消息头</h3><p>详见<a href="https://datatracker.ietf.org/doc/html/rfc2068#section-4.2">[H4.2]</a></p><p>RTSP 标头字段，包括通用标头（第 4.5 节）、请求标头（第 5.3 节）、响应标头（第 6.2 节）和实体标头（第 7.1 节）字段，遵循与节中给出的相同的通用格式 <a href="https://datatracker.ietf.org/doc/html/rfc822#section-3.1">RFC 822 [9] 的 3.1 节</a>。 每个头字段由一个名称后跟一个冒号（“:”）和字段值组成。 字段名称不区分大小写。 字段值前面可以有任意数量的 LWS，但首选单个 SP。 通过在每个额外的行之前至少添加一个 SP 或 HT，可以将头部字段扩展到多行。 应用程序在生成 RTSP 构造时应该遵循“通用形式”，因为可能存在一些无法接受通用形式之外的任何内容的实现。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">message-header &#x3D; field-name &quot;:&quot; [ field-value ] CRLFfield-name     &#x3D; tokenfield-value    &#x3D; *( field-content | LWS )field-content  &#x3D; &lt;the OCTETs making up the field-value                 and consisting of either *TEXT or combinations                 of token, tspecials, and quoted-string &gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接收具有不同字段名称的头字段的顺序并不重要。 然而，“好的做法”是先发送通用头域，然后是请求头域或响应头域，最后是实体头域。</p><p>当且仅当该头字段的整个字段值定义为逗号分隔列表 [即#(values)] 时，消息中可能会出现多个具有相同字段名称的消息头字段。 通过将每个后续字段值附加到第一个字段值，每个字段值用逗号分隔，必须可以将多个头部字段组合成一个“字段名称：字段值”对，而不改变消息的语义。 因此，接收具有相同字段名的头字段的顺序对组合字段值的解释很重要，因此当转发消息时，代理不得更改这些字段值的顺序。</p><h3 id="4-3-消息体"><a href="#4-3-消息体" class="headerlink" title="4.3 消息体"></a>4.3 消息体</h3><p>详见<a href="https://datatracker.ietf.org/doc/html/rfc2068#section-4.3">[H4.3]</a></p><p>RTSP 消息的消息正文（如果有）用于携带与请求或响应相关联的实体正文。仅当应用了传输编码时，消息正文才与实体正文不同，如传输编码头字段所示（第 14.40 节）。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">message-body &#x3D; entity-body             | &lt;entity-body encoded as per Transfer-Encoding&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Transfer-Encoding 必须用于指示应用程序应用的任何传输编码，以确保消息的安全和正确传输。 Transfer-Encoding 是消息的属性，而不是实体的属性，因此可以由任何应用程序沿请求/响应链添加或删除。</p><p>消息中何时允许消息正文的规则因请求和响应而异。</p><p>通过在请求的消息头中包含 Content-Length 或 Transfer-Encoding 头字段来表示请求中消息正文的存在。只有当请求方法（第 5.1.1 节）允许实体主体时，消息主体才可以包含在请求中。</p><p>对于响应消息，消息中是否包含消息体取决于请求方法和响应状态代码（第 6.1.1 节）。对 HEAD 请求方法的所有响应不得包含消息正文，即使实体头字段的存在可能使人们相信它们确实如此。所有 1xx（信息性）、204（无内容）和 304（未修改）响应不得包含消息正文。所有其他响应都包含消息正文，尽管它的长度可能为零。</p><h3 id="4-4-消息长度"><a href="#4-4-消息长度" class="headerlink" title="4.4 消息长度"></a>4.4 消息长度</h3><p>当消息包含消息正文时，该正文的长度由以下之一确定（按优先顺序）：</p><ol><li>任何不包括消息体的响应消息（例如 1xx、204 和 304 响应）总是以头字段后的第一个空行结束，而不管消息中存在的实体头字段。 （注意：空行仅包含 CRLF。）</li><li>如果存在 Content-Length 头字段（第 12.14 节），则其值（以字节为单位）表示消息体的长度。 如果该头域不存在，则假定值为零。</li><li>由服务器关闭连接。（关闭连接不能用于指示请求正文的结束，因为这将使服务器无法发回响应。）</li></ol><blockquote><p>请注意，RTSP（目前）不支持 HTTP/1.1 “分块”传输编码（参见 [H3.6]）并且需要存在 Content-Length 头字段。</p><blockquote><p>鉴于返回的表示描述的长度适中，服务器应该始终能够确定它的长度，即使它是动态生成的，这使得分块传输编码变得不必要。 即使 Content-Length 必须存在，如果有任何实体主体，即使没有明确给出长度，规则也能确保合理的行为。</p></blockquote></blockquote><h2 id="5-通用头部字段"><a href="#5-通用头部字段" class="headerlink" title="5 通用头部字段"></a>5 通用头部字段</h2><p>参见 <a href="https://datatracker.ietf.org/doc/html/rfc2068#section-4.5">[H4.5]</a>，除了 Pragma、Transfer-Encoding 和 Upgrade 标头没有定义：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">general-header     &#x3D;     Cache-Control     ; Section 12.8                     |     Connection        ; Section 12.10                     |     Date              ; Section 12.18                     |     Via               ; Section 12.43  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-请求"><a href="#6-请求" class="headerlink" title="6 请求"></a>6 请求</h2><p>从客户端到服务器（反之亦然）的请求消息在该消息的第一行中包括要应用于资源的方法、资源的标识符和使用的协议版本。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">Request     &#x3D;       Request-Line          ; Section 6.1            *(      general-header        ; Section 5            |       request-header        ; Section 6.2            |       entity-header )       ; Section 8.1                    CRLF                    [ message-body ]      ; Section 4.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-1-请求行"><a href="#6-1-请求行" class="headerlink" title="6.1 请求行"></a>6.1 请求行</h3><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">Request-Line &#x3D; Method SP Request-URI SP RTSP-Version CRLF Method         &#x3D;         &quot;DESCRIBE&quot;              ; Section 10.2                |         &quot;ANNOUNCE&quot;              ; Section 10.3                |         &quot;GET_PARAMETER&quot;         ; Section 10.8                |         &quot;OPTIONS&quot;               ; Section 10.1                |         &quot;PAUSE&quot;                 ; Section 10.6                |         &quot;PLAY&quot;                  ; Section 10.5                |         &quot;RECORD&quot;                ; Section 10.11                |         &quot;REDIRECT&quot;              ; Section 10.10                |         &quot;SETUP&quot;                 ; Section 10.4                |         &quot;SET_PARAMETER&quot;         ; Section 10.9                |         &quot;TEARDOWN&quot;              ; Section 10.7                |         extension-methodextension-method &#x3D; tokenRequest-URI &#x3D; &quot;*&quot; | absolute_URIRTSP-Version &#x3D; &quot;RTSP&quot; &quot;&#x2F;&quot; 1*DIGIT &quot;.&quot; 1*DIGIT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-2-请求头域"><a href="#6-2-请求头域" class="headerlink" title="6.2 请求头域"></a>6.2 请求头域</h3><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">request-header  &#x3D;          Accept                   ; Section 12.1                |          Accept-Encoding          ; Section 12.2                |          Accept-Language          ; Section 12.3                |          Authorization            ; Section 12.5                |          From                     ; Section 12.20                |          If-Modified-Since        ; Section 12.23                |          Range                    ; Section 12.29                |          Referer                  ; Section 12.30                |          User-Agent               ; Section 12.41<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>请注意，与 HTTP/1.1 [2] 相比，RTSP 请求始终包含绝对 URL（即，包括方案、主机和端口）而不仅仅是绝对路径。</p><blockquote><p>HTTP/1.1 要求服务器理解绝对 URL，但客户端应该使用 Host 请求标头。 这纯粹是为了向后兼容 HTTP/1.0 服务器，这一考虑不适用于 RTSP。</p></blockquote></blockquote><p>Request-URI 中的星号“*”表示该请求并不适用于特定资源，而是适用于服务器本身，并且仅在使用的方法不一定适用于资源时才允许。 一个例子是：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">OPTIONS * RTSP&#x2F;1.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="7-响应"><a href="#7-响应" class="headerlink" title="7 响应"></a>7 响应</h2><p>[H6] 适用，但 HTTP-Version 被 RTSP-Version 取代。 此外，RTSP 定义了额外的状态代码，并没有定义一些 HTTP 代码。 表 1 中定义了有效的响应代码和它们可以使用的方法。</p><p>接收并解释请求消息后，接收方以 RTSP 响应消息进行响应。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">Response    &#x3D;     Status-Line         ; Section 7.1            *(    general-header      ; Section 5            |     response-header     ; Section 7.1.2            |     entity-header )     ; Section 8.1                  CRLF                  [ message-body ]    ; Section 4.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-1-状态行"><a href="#7-1-状态行" class="headerlink" title="7.1 状态行"></a>7.1 状态行</h3><p>响应消息的第一行是状态行，由协议版本后跟数字状态代码和与状态代码关联的文本短语组成，每个元素由 SP 字符分隔。 除了最后的 CRLF 序列外，不允许使用 CR 或 LF。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">Status-Line &#x3D;   RTSP-Version SP Status-Code SP Reason-Phrase CRLF<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="7-1-1-状态码和原因短语"><a href="#7-1-1-状态码和原因短语" class="headerlink" title="7.1.1 状态码和原因短语"></a>7.1.1 状态码和原因短语</h4><p>Status-Code 元素是尝试理解和满足请求的 3 位整数结果代码。 这些代码在第 11 节中有完整定义。原因短语旨在提供状态代码的简短文本描述。 状态代码供自动机使用，原因短语供人类用户使用。 客户端不需要检查或显示原因短语。</p><p>状态代码的第一位数字定义了响应的类别。最后两位数字没有任何分类作用。第一个数字有 5 个值：</p><ul><li>1xx：信息性 - 收到请求，继续处理</li><li>2xx：成功 - 成功接收、理解和接受动作</li><li>3xx：重定向 - 必须采取进一步行动才能完成请求</li><li>4xx：客户端错误 - 请求包含错误的语法或无法完成</li><li>5xx：服务器错误 - 服务器未能满足明显有效的请求</li></ul><p>为 RTSP/1.0 定义的数字状态代码的各个值以及一组相应的原因短语示例如下所示。此处列出的原因短语仅供推荐 - 它们可能会被本地等效项替换而不影响协议。请注意，RTSP 采用了大多数 HTTP/1.1 [2] 状态代码，并添加了从 x50 开始的 RTSP 特定状态代码，以避免与新定义的 HTTP 状态代码发生冲突。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">Status-Code &#x3D;     &quot;100&quot;      ; Continue            |     &quot;200&quot;      ; OK            |     &quot;201&quot;      ; Created            |     &quot;250&quot;      ; Low on Storage Space            |     &quot;300&quot;      ; Multiple Choices            |     &quot;301&quot;      ; Moved Permanently            |     &quot;302&quot;      ; Moved Temporarily            |     &quot;303&quot;      ; See Other            |     &quot;304&quot;      ; Not Modified            |     &quot;305&quot;      ; Use Proxy            |     &quot;400&quot;      ; Bad Request            |     &quot;401&quot;      ; Unauthorized            |     &quot;402&quot;      ; Payment Required            |     &quot;403&quot;      ; Forbidden            |     &quot;404&quot;      ; Not Found            |     &quot;405&quot;      ; Method Not Allowed            |     &quot;406&quot;      ; Not Acceptable            |     &quot;407&quot;      ; Proxy Authentication Required            |     &quot;408&quot;      ; Request Time-out            |     &quot;410&quot;      ; Gone            |     &quot;411&quot;      ; Length Required            |     &quot;412&quot;      ; Precondition Failed            |     &quot;413&quot;      ; Request Entity Too Large            |     &quot;414&quot;      ; Request-URI Too Large            |     &quot;415&quot;      ; Unsupported Media Type            |     &quot;451&quot;      ; Parameter Not Understood            |     &quot;452&quot;      ; Conference Not Found            |     &quot;453&quot;      ; Not Enough Bandwidth            |     &quot;454&quot;      ; Session Not Found            |     &quot;455&quot;      ; Method Not Valid in This State            |     &quot;456&quot;      ; Header Field Not Valid for Resource            |     &quot;457&quot;      ; Invalid Range            |     &quot;458&quot;      ; Parameter Is Read-Only            |     &quot;459&quot;      ; Aggregate operation not allowed            |     &quot;460&quot;      ; Only aggregate operation allowed            |     &quot;461&quot;      ; Unsupported transport            |     &quot;462&quot;      ; Destination unreachable            |     &quot;500&quot;      ; Internal Server Error            |     &quot;501&quot;      ; Not Implemented            |     &quot;502&quot;      ; Bad Gateway            |     &quot;503&quot;      ; Service Unavailable            |     &quot;504&quot;      ; Gateway Time-out            |     &quot;505&quot;      ; RTSP Version not supported            |     &quot;551&quot;      ; Option not supported            |     extension-codeextension-code  &#x3D;     3DIGITReason-Phrase   &#x3D;     *&lt;TEXT, excluding CR, LF&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>RTSP 状态代码是可扩展的。RTSP 应用程序不需要理解所有注册状态代码的含义，尽管这种理解显然是可取的。 但是，应用程序必须理解任何状态代码的类别，如第一个数字所示，并将任何无法识别的响应视为等同于该类的 x00 状态代码，除非不能缓存无法识别的响应。例如，如果客户端收到无法识别的 431 状态代码，它可以安全地假设其请求有问题，并将响应视为收到 400 状态代码。 在这种情况下，用户代理应该将响应返回的实体呈现给用户，因为该实体可能包含解释异常状态的人类可读信息。</p><table><thead><tr><th>Code</th><th>reason</th><th>RTSP method</th></tr></thead><tbody><tr><td>100</td><td>Continue</td><td>all</td></tr><tr><td></td><td></td><td></td></tr><tr><td>200</td><td>OK</td><td>all</td></tr><tr><td>201</td><td>Created</td><td>RECORD</td></tr><tr><td>250</td><td>Low on Storage Space</td><td>RECORD</td></tr><tr><td></td><td></td><td></td></tr><tr><td>300</td><td>Multiple Choices</td><td>all</td></tr><tr><td>301</td><td>Moved Permanently</td><td>all</td></tr><tr><td>302</td><td>Moved Temporarily</td><td>all</td></tr><tr><td>303</td><td>See Other</td><td>all</td></tr><tr><td>305</td><td>Use Proxy</td><td>all</td></tr><tr><td></td><td></td><td></td></tr><tr><td>400</td><td>Bad Request</td><td>all</td></tr><tr><td>401</td><td>Unauthorized</td><td>all</td></tr><tr><td>402</td><td>Payment Required</td><td>all</td></tr><tr><td>403</td><td>Forbidden</td><td>all</td></tr><tr><td>404</td><td>Not Found</td><td>all</td></tr><tr><td>405</td><td>Method Not Allowed</td><td>all</td></tr><tr><td>406</td><td>Not Acceptable</td><td>all</td></tr><tr><td>407</td><td>Proxy Authentication Required</td><td>all</td></tr><tr><td>408</td><td>Request Timeout</td><td>all</td></tr><tr><td>410</td><td>Gone</td><td>all</td></tr><tr><td>411</td><td>Length Required</td><td>all</td></tr><tr><td>412</td><td>Precondition Failed</td><td>DESCRIBE, SETUP</td></tr><tr><td>413</td><td>Request Entity Too Large</td><td>all</td></tr><tr><td>414</td><td>Request-URI Too Long</td><td>all</td></tr><tr><td>415</td><td>Unsupported Media Type</td><td>all</td></tr><tr><td>451</td><td>Invalid parameter</td><td>SETUP</td></tr><tr><td>452</td><td>Illegal Conference Identifier</td><td>SETUP</td></tr><tr><td>453</td><td>Not Enough Bandwidth</td><td>SETUP</td></tr><tr><td>454</td><td>Session Not Found</td><td>all</td></tr><tr><td>455</td><td>Method Not Valid In This State</td><td>all</td></tr><tr><td>456</td><td>Header Field Not Valid</td><td>all</td></tr><tr><td>457</td><td>Invalid Range</td><td>PLAY</td></tr><tr><td>458</td><td>Parameter Is Read-Only</td><td>SET_PARAMETER</td></tr><tr><td>459</td><td>Aggregate Operation Not Allowed</td><td>all</td></tr><tr><td>460</td><td>Only Aggregate Operation Allowed</td><td>all</td></tr><tr><td>461</td><td>Unsupported Transport</td><td>all</td></tr><tr><td>462</td><td>Destination Unreachable</td><td>all</td></tr><tr><td></td><td></td><td></td></tr><tr><td>500</td><td>Internal Server Error</td><td>all</td></tr><tr><td>501</td><td>Not Implemented</td><td>all</td></tr><tr><td>502</td><td>Bad Gateway</td><td>all</td></tr><tr><td>503</td><td>Service Unavailable</td><td>all</td></tr><tr><td>504</td><td>Gateway Timeout</td><td>all</td></tr><tr><td>505</td><td>RTSP Version Not Supported</td><td>all</td></tr><tr><td>551</td><td>Option not support</td><td>all</td></tr></tbody></table><p>表1：状态代码及其在 RTSP 方法中的使用</p><h4 id="7-1-2-响应头域"><a href="#7-1-2-响应头域" class="headerlink" title="7.1.2 响应头域"></a>7.1.2 响应头域</h4><p>响应头字段允许请求接收者传递关于响应的附加信息，这些信息不能放在状态行中。 这些头域提供了关于服务器的信息以及关于对由 Request-URI 标识的资源的进一步访问的信息。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">response-header &#x3D;     Location             ; Section 12.25                |     Proxy-Authenticate   ; Section 12.26                |     Public               ; Section 12.28                |     Retry-After          ; Section 12.31                |     Server               ; Section 12.36                |     Vary                 ; Section 12.42                |     WWW-Authenticate     ; Section 12.44<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>只有结合协议版本的更改才能可靠地扩展响应头字段名称。 然而，新的或实验性的头域可以被赋予响应头域的语义，如果通信中的所有各方都将它们识别为响应头域。 无法识别的头字段被视为实体头字段。</p><h2 id="8-实体"><a href="#8-实体" class="headerlink" title="8 实体"></a>8 实体</h2><p>如果请求方法或响应状态代码不受其他限制，则请求和响应消息可以传输实体。 实体由实体头字段和实体主体组成，尽管某些响应将仅包含实体头。</p><p>在本节中，发送者和接收者都指的是客户端或服务器，具体取决于谁发送和谁接收实体。</p><h3 id="8-1-实体头域"><a href="#8-1-实体头域" class="headerlink" title="8.1 实体头域"></a>8.1 实体头域</h3><p>实体头字段定义了关于实体主体的可选元信息，或者，如果不存在主体，则定义有关请求标识的资源的元信息。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">entity-header       &#x3D;    Allow               ; Section 12.4                    |    Content-Base        ; Section 12.11                    |    Content-Encoding    ; Section 12.12                    |    Content-Language    ; Section 12.13                    |    Content-Length      ; Section 12.14                    |    Content-Location    ; Section 12.15                    |    Content-Type        ; Section 12.16                    |    Expires             ; Section 12.19                    |    Last-Modified       ; Section 12.24                    |    extension-headerextension-header    &#x3D;    message-header<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>扩展头机制允许在不改变协议的情况下定义额外的实体头字段，但不能假设这些字段是接收者可识别的。 无法识别的头域应该被接收者忽略并由代理转发。</p><h3 id="8-2-实体主体"><a href="#8-2-实体主体" class="headerlink" title="8.2 实体主体"></a>8.2 实体主体</h3><p>详见<a href="https://datatracker.ietf.org/doc/html/rfc2068#section-7.2">[H7.2]</a></p><p>与 RTSP 请求或响应一起发送的实体主体（如果有）采用实体头字段定义的格式和编码。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">entity-body    &#x3D; *OCTET <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如第 4.3 节所述，实体正文仅在消息正文存在时才出现在消息中。 实体主体是通过对可能已被应用以确保消息的安全和正确传输的任何传输编码进行解码而从消息主体中获得的。</p><h2 id="9-连接"><a href="#9-连接" class="headerlink" title="9 连接"></a>9 连接</h2><p>RTSP 请求可以通过几种不同的方式传输：</p><ul><li>用于多个请求-响应事务的持久传输连接；</li><li>每个请求/响应事务一个连接；</li><li>无连接模式。</li></ul><p>传输连接的类型由 RTSP URI（<a href="#32-rtsp-rul">第 3.2 节</a>）定义。 对于“rtsp”方案，假设一个持久连接，而“rtspu”方案要求在不建立连接的情况下发送RTSP请求。</p><p>与 HTTP 不同，RTSP 允许媒体服务器向媒体客户端发送请求。但是，这仅支持持久连接，因为媒体服务器没有可靠的方式到达客户端。此外，这是从媒体服务器到客户端的请求可能穿过防火墙的唯一方式。</p><h3 id="9-1-流水线"><a href="#9-1-流水线" class="headerlink" title="9.1 流水线"></a>9.1 流水线</h3><p>支持持久连接或无连接模式的客户端可以“管道”其请求（即发送多个请求而不等待每个响应）。 服务器必须按照接收请求的相同顺序发送对这些请求的响应。</p><h3 id="9-2-可靠性和确认"><a href="#9-2-可靠性和确认" class="headerlink" title="9.2 可靠性和确认"></a>9.2 可靠性和确认</h3><p>除非请求被发送到多播组，否则接收者会确认请求。 如果没有确认，发送方可能会在一个往返时间 (RTT) 超时后重新发送相同的消息。 往返时间的估计与 TCP (<a href="https://datatracker.ietf.org/doc/html/rfc1123">RFC 1123</a>) [18] 中一样，初始往返值为 500 毫秒。 一个实现可以缓存最后一个 RTT 测量作为未来连接的初始值。</p><p>如果使用可靠的传输协议来承载 RTSP，则不得重传请求； RTSP 应用程序必须依赖底层传输来提供可靠性。</p><blockquote><p>如果底层可靠传输（例如 TCP）和 RTSP 应用程序都重传请求，则每个数据包丢失可能导致两次重传。 接收器通常不能利用应用层重传，因为传输栈不会在第一次尝试到达接收器之前传递应用层重传。 如果丢包是由于拥塞造成的，不同层的多次重传会加剧拥塞。</p><p>如果在小型 RTT LAN 上使用 RTSP，则用于优化初始 TCP 往返估计的标准程序，例如 T/TCP (<a href="https://datatracker.ietf.org/doc/html/rfc1644">RFC 1644</a>) [22] 中使用的程序，可能会有所帮助。</p></blockquote><p>时间戳标头（第 12.38 节）用于避免重传歧义问题 [23, p. 301] 并消除了对卡恩算法的需要。</p><p>每个请求在 CSeq 标头中携带一个序列号（第 12.17 节），对于每个传输的不同请求，该序列号递增 1。如果由于缺乏确认而重复请求，则该请求必须携带原始序列号（即，序列号不递增）。</p><p>实现 RTSP 的系统必须支持通过 TCP 承载 RTSP，并且可以支持 UDP。 RTSP 服务器的默认端口对于 UDP 和 TCP 都是 554。</p><p>发往同一个控制端点的多个 RTSP 数据包可能会被打包到单个低层 PDU 中或被封装到 TCP 流中。 RTSP 数据可以与 RTP 和 RTCP 数据包交错。</p><p>与 HTTP 不同，RTSP 消息必须包含一个 Content-Length 标头，只要该消息包含有效负载。否则，RTSP 包以紧跟在最后一个消息头之后的空行终止。</p><h2 id="10-方法定义"><a href="#10-方法定义" class="headerlink" title="10 方法定义"></a>10 方法定义</h2><p>方法标记指示要在请求 URI 标识的资源上执行的方法。 该方法区分大小写。 未来可能会定义新的方法。 方法名称不能以 $ 字符（十进制 24）开头，并且必须是标记。 方法总结在表 2 中。</p><table><thead><tr><th>method</th><th>direction</th><th>object</th><th>requirement</th></tr></thead><tbody><tr><td>DESCRIBE</td><td>C-&gt;S</td><td>P,S</td><td>recommended</td></tr><tr><td>ANNOUNCE</td><td>C-&gt;S, S-&gt;C</td><td>P,S</td><td>optional</td></tr><tr><td>GET_PARAMETER</td><td>C-&gt;S, S-&gt;C</td><td>P,S</td><td>optional</td></tr><tr><td>OPTIONS</td><td>C-&gt;S, S-&gt;C</td><td>P,S</td><td>required (S-&gt;C: optional)</td></tr><tr><td>PAUSE</td><td>C-&gt;S</td><td>P,S</td><td>recommended</td></tr><tr><td>PLAY</td><td>C-&gt;S</td><td>P,S</td><td>required</td></tr><tr><td>RECORD</td><td>C-&gt;S</td><td>P,S</td><td>optional</td></tr><tr><td>REDIRECT</td><td>S-&gt;C</td><td>P,S</td><td>optional</td></tr><tr><td>SETUP</td><td>C-&gt;S</td><td>S</td><td>required</td></tr><tr><td>SET_PARAMETER</td><td>C-&gt;S, S-&gt;C</td><td>P,S</td><td>optional</td></tr><tr><td>TEARDOWN</td><td>C-&gt;S</td><td>P,S</td><td>required</td></tr></tbody></table><p>表 2：RTSP 方法概述、它们的方向以及它们操作的对象（P: presentation, S: stream）</p><blockquote><p>注意：建议使用 PAUSE，但不是必需的，因为可以构建不支持此方法的全功能服务器，例如，用于实时提要。 如果一个服务器不支持一个特定的方法，它必须返回“501 Not Implemented”并且客户端不应该为这个服务器再次尝试这个方法。</p></blockquote><h3 id="10-1-OPTIONS"><a href="#10-1-OPTIONS" class="headerlink" title="10.1 OPTIONS"></a>10.1 OPTIONS</h3><p>该行为等同于 [H9.2] 中描述的行为。一个 <code>OPTIONS</code> 请求可以在任何时候发出，例如，如果客户端将要尝试一个非标准请求。 它不会影响服务器状态。例如：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S:   OPTIONS * RTSP&#x2F;1.0        CSeq: 1        Require: implicit-play        Proxy-Require: gzipped-messagesS-&gt;C:   RTSP&#x2F;1.0 200 OK        CSeq: 1        Public: DESCRIBE, SETUP, TEARDOWN, PLAY, PAUSE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>请注意，这些必然是虚构的功能（人们希望我们不会故意忽略一个真正有用的功能，以便我们在本节中有一个强有力的例子）。</p></blockquote><h3 id="10-2-DESCRIBE"><a href="#10-2-DESCRIBE" class="headerlink" title="10.2 DESCRIBE"></a>10.2 DESCRIBE</h3><p><code>DESCRIBE</code> 方法从服务器检索由请求 URL 标识的演示或媒体对象的描述。 它可以使用 Accept 头来指定客户端理解的描述格式。服务器以所请求资源的描述作为响应。<code>DESCRIBE</code> 回复-响应对构成了 RTSP 的媒体初始化阶段。例如：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S:   DESCRIBE rtsp:&#x2F;&#x2F;server.example.com&#x2F;fizzle&#x2F;foo RTSP&#x2F;1.0        CSeq: 312        Accept: application&#x2F;sdp, application&#x2F;rtsl, application&#x2F;mhegS-&gt;C:   RTSP&#x2F;1.0 200 OK        CSeq: 312        Date: 23 Jan 1997 15:35:06 GMT        Content-Type: application&#x2F;sdp        Content-Length: 376        v&#x3D;0        o&#x3D;mhandley 2890844526 2890842807 IN IP4 126.16.64.4        s&#x3D;SDP Seminar        i&#x3D;A Seminar on the session description protocol        u&#x3D;http:&#x2F;&#x2F;www.cs.ucl.ac.uk&#x2F;staff&#x2F;M.Handley&#x2F;sdp.03.ps        e&#x3D;mjh@isi.edu (Mark Handley)        c&#x3D;IN IP4 224.2.17.12&#x2F;127        t&#x3D;2873397496 2873404696        a&#x3D;recvonly        m&#x3D;audio 3456 RTP&#x2F;AVP 0        m&#x3D;video 2232 RTP&#x2F;AVP 31        m&#x3D;whiteboard 32416 UDP WB        a&#x3D;orient:portrait<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>DESCRIBE</code> 响应必须包含它描述的资源的所有媒体初始化信息。如果媒体客户端从 <code>DESCRIBE</code> 以外的来源获得演示描述，并且该描述包含一组完整的媒体初始化参数，则客户端应该使用这些参数，而不是通过 RTSP 请求相同媒体的描述。此外，服务器不应该使用 <code>DESCRIBE</code> 响应作为媒体间接的手段。</p><blockquote><p>需要建立明确的基本规则，以便客户端能够清楚地知道何时通过 <code>DESCRIBE</code> 请求媒体初始化信息，何时不请求。通过强制 <code>DESCRIBE</code> 响应包含它描述的一组流的所有媒体初始化，并阻止将 <code>DESCRIBE</code> 用于媒体间接，我们避免了可能由其他方法导致的循环问题。<br>媒体初始化是任何基于 RTSP 的系统的要求，但 RTSP 规范并未规定必须通过 <code>DESCRIBE</code> 方法完成此操作。 RTSP 客户端可以通过三种方式接收初始化信息：</p><ul><li>通过 RTSP 的 <code>DESCRIBE</code> 方法；</li><li>通过一些其他协议（HTTP、电子邮件附件等）；</li><li>通过命令行或标准输入（因此作为使用 SDP 文件或其他媒体初始化格式启动的浏览器帮助应用程序工作）。</li></ul><p>为了实际互操作性，强烈建议最小服务器支持 <code>DESCRIBE</code> 方法，并强烈建议最小客户端支持充当“帮助应用程序”的能力，从标准输入、命令行和/或其他适合客户端操作环境的方式。</p></blockquote><h3 id="10-3-ANNOUNCE"><a href="#10-3-ANNOUNCE" class="headerlink" title="10.3 ANNOUNCE"></a>10.3 ANNOUNCE</h3><p><code>ANNOUNCE</code> 方法有两个目的：</p><ul><li>当从客户端发送到服务器时，<code>ANNOUNCE</code> 将请求 URL 标识的演示或媒体对象的描述发布到服务器。</li><li>当从服务器发送到客户端时，<code>ANNOUNCE</code> 实时更新会话描述。</li></ul><p>如果将新媒体流添加到演示中（例如，在现场演示期间），则应再次发送整个演示描述，而不仅仅是附加组件，以便可以删除组件。例如：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S:   ANNOUNCE rtsp:&#x2F;&#x2F;server.example.com&#x2F;fizzle&#x2F;foo RTSP&#x2F;1.0        CSeq: 312        Date: 23 Jan 1997 15:35:06 GMT        Session: 47112344        Content-Type: application&#x2F;sdp        Content-Length: 332        v&#x3D;0        o&#x3D;mhandley 2890844526 2890845468 IN IP4 126.16.64.4        s&#x3D;SDP Seminar        i&#x3D;A Seminar on the session description protocol        u&#x3D;http:&#x2F;&#x2F;www.cs.ucl.ac.uk&#x2F;staff&#x2F;M.Handley&#x2F;sdp.03.ps        e&#x3D;mjh@isi.edu (Mark Handley)        c&#x3D;IN IP4 224.2.17.12&#x2F;127        t&#x3D;2873397496 2873404696        a&#x3D;recvonly        m&#x3D;audio 3456 RTP&#x2F;AVP 0        m&#x3D;video 2232 RTP&#x2F;AVP 31S-&gt;C:   RTSP&#x2F;1.0 200 OK        CSeq: 312<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="10-4-SETUP"><a href="#10-4-SETUP" class="headerlink" title="10.4 SETUP"></a>10.4 SETUP</h3><p>对 URI 的 <code>SETUP</code> 请求指定用于流媒体的传输机制。客户端可以对已经播放的流发出 <code>SETUP</code> 请求以更改传输参数，服务器可以允许。如果它不允许这样做，它必须以错误“455 Method Not Valid In This State”响应。为了任何中间防火墙的利益，客户端必须指明传输参数，即使它对这些参数没有影响，例如，服务器在哪里通告固定的多播地址。</p><blockquote><p>由于 <code>SETUP</code> 包括所有传输初始化信息，防火墙和其他中间网络设备（需要此信息）可以免于解析 <code>DESCRIBE</code> 响应的更艰巨的任务，该响应已保留用于媒体初始化。</p></blockquote><p><code>Transport</code> 头指定客户端可接受的传输参数，用于数据传输；响应将包含服务器选择的传输参数。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S:   SETUP rtsp:&#x2F;&#x2F;example.com&#x2F;foo&#x2F;bar&#x2F;baz.rm RTSP&#x2F;1.0        CSeq: 302        Transport: RTP&#x2F;AVP;unicast;client_port&#x3D;4588-4589S-&gt;C:   RTSP&#x2F;1.0 200 OK        CSeq: 302        Date: 23 Jan 1997 15:35:06 GMT        Session: 47112344        Transport: RTP&#x2F;AVP;unicast;          client_port&#x3D;4588-4589;server_port&#x3D;6256-6257<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>服务器生成会话标识符以响应 <code>SETUP</code> 请求。 如果对服务器的 <code>SETUP</code> 请求包含会话标识符，则服务器必须将此设置请求捆绑到现有会话中或返回错误“459 Aggregate Operation Not Allowed”（参见第 11.3.10 节）。</p><h3 id="10-5-PLAY"><a href="#10-5-PLAY" class="headerlink" title="10.5 PLAY"></a>10.5 PLAY</h3><p><code>PLAY</code> 方法告诉服务器通过 <code>SETUP</code> 中指定的机制开始发送数据。<strong>在任何未完成的 <code>SETUP</code> 请求被确认为成功之前，客户端不得发出 <code>PLAY</code> 请求。</strong></p><p><code>PLAY</code> 请求将正常播放时间定位到指定范围的开始，并传送流数据直到到达范围结束。<code>PLAY</code> 请求可能会被流水线化（排队）；服务器必须将 <code>PLAY</code> 请求按顺序执行。也就是说，<strong>在前一个 <code>PLAY</code> 请求仍处于活动状态时到达的 <code>PLAY</code> 请求会被延迟，直到第一个请求完成。</strong></p><blockquote><p>这允许精确编辑。</p></blockquote><p>例如，无论下面示例中的两个 <code>PLAY</code> 请求到达的间隔有多近，服务器将首先播放 10 到 15 秒，然后紧随其后的是 20 到 25 秒，最后是 30 秒到结束。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S:   PLAY rtsp:&#x2F;&#x2F;audio.example.com&#x2F;audio RTSP&#x2F;1.0        CSeq: 835        Session: 12345678        Range: npt&#x3D;10-15C-&gt;S:   PLAY rtsp:&#x2F;&#x2F;audio.example.com&#x2F;audio RTSP&#x2F;1.0        CSeq: 836        Session: 12345678        Range: npt&#x3D;20-25C-&gt;S:   PLAY rtsp:&#x2F;&#x2F;audio.example.com&#x2F;audio RTSP&#x2F;1.0        CSeq: 837        Session: 12345678        Range: npt&#x3D;30-<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>有关更多示例，请参阅 <code>PAUSE</code> 请求的说明。</p><p>没有 <code>Range</code> 标头的 <code>PLAY</code> 请求是合法的。 除非流已暂停，否则它会从头开始播放流。 如果流已通过 <code>PAUSE</code> 暂停，则流传输将在暂停点恢复。 如果一个流正在播放，这样的 <code>PLAY</code> 请求不会引起进一步的动作，客户端可以使用它来测试服务器的活跃度。</p><p><code>Range</code> 头也可能包含一个时间参数。此参数指定应开始播放的 UTC 时间。如果在指定时间后收到消息，则立即开始播放。时间参数可用于辅助从不同源获得的流的同步。</p><p>对于点播流，服务器回复将播放的实际范围。如果媒体源需要将请求的范围与有效的帧边界对齐，则这可能与请求的范围不同。如果请求中未指定范围，则在回复中返回当前位置。回复中的范围单位与请求中的范围单位相同。</p><p>播放完所需的范围后，演示会自动暂停，就像发出了暂停请求一样。</p><p>以下示例从 SMPTE 时间码 0:10:20 开始播放整个演示，直到剪辑结束。播放时间为1997年1月23日15时36分。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S: PLAY rtsp:&#x2F;&#x2F;audio.example.com&#x2F;twister.en RTSP&#x2F;1.0      CSeq: 833      Session: 12345678      Range: smpte&#x3D;0:10:20-;time&#x3D;19970123T153600ZS-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 833      Date: 23 Jan 1997 15:35:06 GMT      Range: smpte&#x3D;0:10:22-;time&#x3D;19970123T153600Z<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>为了回放现场演示的录音，可能需要使用时钟单位：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S: PLAY rtsp:&#x2F;&#x2F;audio.example.com&#x2F;meeting.en RTSP&#x2F;1.0      CSeq: 835      Session: 12345678      Range: clock&#x3D;19961108T142300Z-19961108T143520ZS-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 835      Date: 23 Jan 1997 15:35:06 GMT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>仅支持播放的媒体服务器必须支持 npt 格式，并且可以支持时钟和 smpte 格式。</p><h3 id="10-6-PAUSE"><a href="#10-6-PAUSE" class="headerlink" title="10.6 PAUSE"></a>10.6 PAUSE</h3><p><code>PAUSE</code> 请求会导致流传输暂时中断（停止）。如果请求 URL 命名了一个流，则只会暂停该流的播放和记录。例如，对于音频，这相当于静音。如果请求 URL 为一个演示或一组流命名，则该演示或组中所有当前活动流的传递将停止。恢复播放或录制后，必须保持曲目同步。任何服务器资源都被保留，尽管服务器可以在暂停了 <code>SETUP</code> 消息中会话头的超时参数指定的持续时间后关闭会话并释放资源。例如：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S: PAUSE rtsp:&#x2F;&#x2F;example.com&#x2F;fizzle&#x2F;foo RTSP&#x2F;1.0      CSeq: 834      Session: 12345678S-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 834      Date: 23 Jan 1997 15:35:06 GMT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>PAUSE</code> 请求可能包含一个 Range 标头，指定何时停止流或演示。我们将这一点称为“暂停点”。标头必须只包含一个值而不是时间范围。流的正常播放时间设置为暂停点。暂停请求在服务器第一次遇到任何当前挂起的 <code>PLAY</code> 请求中指定的时间点时生效。如果 Range 标头指定了任何当前挂起的 <code>PLAY</code> 请求之外的时间，则返回错误“457 Invalid Range”。如果媒体单元（例如音频或视频帧）恰好在暂停点开始呈现，则不会播放或录制。如果缺少 Range 标头，则在收到消息时立即中断流传递，并将暂停点设置为当前正常播放时间。</p><p><code>PAUSE</code> 请求会丢弃所有排队的 <code>PLAY</code> 请求。然而，必须保持媒体流中的暂停点。没有 Range 标头的后续 <code>PLAY</code> 请求从暂停点恢复。</p><p>例如，如果服务器有 10 到 15 和 20 到 29 范围的播放请求待处理，然后收到 NPT 21 的暂停请求，它将开始播放第二个范围并在 NPT 21 处停止。如果暂停请求是针对 NPT 12 的并且服务器正在 NPT 13 处播放第一个播放请求，服务器立即停止。如果暂停请求是针对 NPT 16，则服务器在完成第一个播放请求后停止并丢弃第二个播放请求。</p><p>再举一个例子，如果服务器收到了播放范围 10 到 15 然后是 13 到 20（即重叠范围）的请求，则 NPT=14 的 <code>PAUSE</code> 请求将在服务器播放第一个范围时生效，第二个 <code>PLAY</code> 请求实际上被忽略，假设 <code>PAUSE</code> 请求在服务器开始播放第二个重叠范围之前到达。 无论 <code>PAUSE</code> 请求何时到达，它都会将 NPT 设置为 14。</p><p>如果服务器已经在 Range 标头中指定的时间之外发送了数据，则 <code>PLAY</code> 仍会在该时间点恢复，因为假定客户端在该时间点之后丢弃了数据。 这确保了无间隙的连续暂停/播放循环。</p><h3 id="10-7-TEARDOWN"><a href="#10-7-TEARDOWN" class="headerlink" title="10.7 TEARDOWN"></a>10.7 TEARDOWN</h3><p><code>TEARDOWN</code> 请求停止给定 URI 的流传递，释放与之关联的资源。 如果 URI 是此演示的演示 URI，则与该会话关联的任何 RTSP 会话标识符都不再有效。 除非所有传输参数都由会话描述定义，否则必须在会话再次播放之前发出 <code>SETUP</code> 请求。例如：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S: TEARDOWN rtsp:&#x2F;&#x2F;example.com&#x2F;fizzle&#x2F;foo RTSP&#x2F;1.0      CSeq: 892      Session: 12345678S-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 892<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="10-8-GET-PARAMETER"><a href="#10-8-GET-PARAMETER" class="headerlink" title="10.8 GET_PARAMETER"></a>10.8 GET_PARAMETER</h3><p><code>GET_PARAMETER</code> 请求检索 URI 中指定的演示或流的参数值。 回复和响应的内容留给实现。 没有实体主体的 <code>GET_PARAMETER</code> 可用于测试客户端或服务器的活跃度（“ping”）。例如：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">S-&gt;C: GET_PARAMETER rtsp:&#x2F;&#x2F;example.com&#x2F;fizzle&#x2F;foo RTSP&#x2F;1.0      CSeq: 431      Content-Type: text&#x2F;parameters      Session: 12345678      Content-Length: 15      packets_received      jitterC-&gt;S: RTSP&#x2F;1.0 200 OK      CSeq: 431      Content-Length: 46      Content-Type: text&#x2F;parameters      packets_received: 10      jitter: 0.3838<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>“text/parameters”部分只是参数的示例类型。 这种方法是故意松散定义的，目的是在进一步实验后定义回复内容和响应内容。</p><h3 id="10-9-SET-PARAMETER"><a href="#10-9-SET-PARAMETER" class="headerlink" title="10.9 SET_PARAMETER"></a>10.9 SET_PARAMETER</h3><p>此方法请求为由 URI 指定的演示或流设置参数值。</p><p>一个请求应该只包含一个参数，以允许客户端确定特定请求失败的原因。如果请求包含多个参数，则服务器必须仅在所有参数都可以成功设置的情况下对请求进行操作。服务器必须允许将参数重复设置为相同的值，但它可以禁止更改参数值。</p><blockquote><p>注意：媒体流的传输参数必须只能用 SETUP 命令设置。限制将传输参数设置为 SETUP 是为了防火墙的利益。</p></blockquote><p>参数以细粒度的方式拆分，以便可以有更有意义的错误指示。但是，如果需要原子设置，则允许设置多个参数可能是有意义的。想象一下设备控制，客户端不希望摄像机平移，除非它也可以同时倾斜到正确的角度。例如：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S: SET_PARAMETER rtsp:&#x2F;&#x2F;example.com&#x2F;fizzle&#x2F;foo RTSP&#x2F;1.0      CSeq: 421      Content-length: 20      Content-type: text&#x2F;parameters      barparam: barstuffS-&gt;C: RTSP&#x2F;1.0 451 Invalid Parameter      CSeq: 421      Content-length: 10      Content-type: text&#x2F;parameters      barparam<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>“text/parameters”部分只是参数的示例类型。 这种方法是故意松散定义的，目的是在进一步实验后定义回复内容和响应内容。</p><h3 id="10-10-REDIRECT"><a href="#10-10-REDIRECT" class="headerlink" title="10.10 REDIRECT"></a>10.10 REDIRECT</h3><p>重定向请求通知客户端它必须连接到另一个服务器位置。 **它包含必需的标头 <code>Location</code>**，它指示客户端应该发出对该 URL 的请求。 它可能包含参数 Range，该参数指示重定向何时生效。 如果客户端想继续为这个 URI 发送或接收媒体，客户端必须在指定的主机上为当前会话发出一个 <code>TEARDOWN</code> 请求和一个新会话的 <code>SETUP</code> 请求。</p><p>此示例请求在给定的播放时间将此 URI 的流量重定向到新服务器：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">S-&gt;C: REDIRECT rtsp:&#x2F;&#x2F;example.com&#x2F;fizzle&#x2F;foo RTSP&#x2F;1.0      CSeq: 732      Location: rtsp:&#x2F;&#x2F;bigserver.com:8001      Range: clock&#x3D;19960213T143205Z-<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="10-11-RECORD"><a href="#10-11-RECORD" class="headerlink" title="10.11 RECORD"></a>10.11 RECORD</h3><p>该方法根据呈现描述开始记录一系列媒体数据。 时间戳反映开始和结束时间 (UTC)。 如果未指定时间范围，请使用演示说明中提供的开始或结束时间。 如果会话已经开始，请立即开始录制。</p><p>服务器决定是否将记录的数据存储在 request-URI 或另一个 URI 下。 如果服务器不使用请求 URI，则响应应该是 <code>201</code>（已创建）并包含一个描述请求状态和引用新资源的实体，以及一个位置头。</p><p>支持录制现场演示的媒体服务器必须支持时钟范围格式； smpte 格式没有意义。</p><p>在该示例中，媒体服务器先前被邀请参加所指示的会议。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S: RECORD rtsp:&#x2F;&#x2F;example.com&#x2F;meeting&#x2F;audio.en RTSP&#x2F;1.0      CSeq: 954      Session: 12345678      Conference: 128.16.64.19&#x2F;32492374<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="10-12-嵌入（交错）二进制数据"><a href="#10-12-嵌入（交错）二进制数据" class="headerlink" title="10.12 嵌入（交错）二进制数据"></a>10.12 嵌入（交错）二进制数据</h3><p>某些防火墙设计和其他情况可能会强制服务器交错 RTSP 方法和流数据。除非必要，否则通常应避免这种交织，因为它使客户端和服务器操作复杂化并增加了额外的开销。仅当 RTSP 通过 TCP 传输时，才应使用交错二进制数据。</p><p>RTP 数据包等流数据由 ASCII 美元符号（24 位十六进制）封装，后跟一字节通道标识符，后跟封装的二进制数据的长度，以网络字节顺序为二进制、两字节整数。流数据紧随其后，没有 CRLF，但包括上层协议头。每个 $ 块正好包含一个上层协议数据单元，例如一个 RTP 数据包。</p><p>信道标识符在传输报头中用交错参数定义（第 12.39 节）。</p><p>当传输选择是 RTP 时，RTCP 消息也由服务器通过 TCP 连接交错。默认情况下，RTCP 数据包在高于 RTP 通道的第一个可用通道上发送。客户端可以在另一个通道上显式地请求 RTCP 数据包。这是通过在传输头的交错参数中指定两个通道来完成的（第 12.39 节）。</p><blockquote><p>当两个或多个流以这种方式交错时，需要 RTCP 进行同步。 此外，这提供了一种方便的方法，可以在网络配置需要时通过 TCP 控制连接隧道传输 RTP/RTCP 数据包，并在可能的情况下将它们传输到 UDP。</p></blockquote><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S: SETUP rtsp:&#x2F;&#x2F;foo.com&#x2F;bar.file RTSP&#x2F;1.0      CSeq: 2      Transport: RTP&#x2F;AVP&#x2F;TCP;interleaved&#x3D;0-1S-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 2      Date: 05 Jun 1997 18:57:18 GMT      Transport: RTP&#x2F;AVP&#x2F;TCP;interleaved&#x3D;0-1      Session: 12345678C-&gt;S: PLAY rtsp:&#x2F;&#x2F;foo.com&#x2F;bar.file RTSP&#x2F;1.0      CSeq: 3      Session: 12345678S-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 3      Session: 12345678      Date: 05 Jun 1997 18:59:15 GMT      RTP-Info: url&#x3D;rtsp:&#x2F;&#x2F;foo.com&#x2F;bar.file;        seq&#x3D;232433;rtptime&#x3D;972948234S-&gt;C: $\000&#123;2 byte length&#125;&#123;&quot;length&quot; bytes data, w&#x2F;RTP header&#125;S-&gt;C: $\000&#123;2 byte length&#125;&#123;&quot;length&quot; bytes data, w&#x2F;RTP header&#125;S-&gt;C: $\001&#123;2 byte length&#125;&#123;&quot;length&quot; bytes  RTCP packet&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="11-状态代码定义"><a href="#11-状态代码定义" class="headerlink" title="11 状态代码定义"></a>11 状态代码定义</h2><p>在适用的情况下，会重复使用 HTTP 状态 <a href="https://datatracker.ietf.org/doc/html/rfc2068#section-10">[H10]</a> 代码。 具有相同含义的状态码在此不再赘述。 有关哪些请求可能返回哪些状态代码的列表，请参见表 1。</p><h3 id="11-1-Success-2xx"><a href="#11-1-Success-2xx" class="headerlink" title="11.1 Success 2xx"></a>11.1 Success 2xx</h3><h4 id="11-1-1-250-Low-on-Storage-Space"><a href="#11-1-1-250-Low-on-Storage-Space" class="headerlink" title="11.1.1 250 Low on Storage Space"></a>11.1.1 250 Low on Storage Space</h4><p>服务器在收到由于存储空间不足而可能无法完全完成的 RECORD 请求后返回此警告。 如果可能，服务器应该使用 Range 标头来指示它仍然可以记录的时间段。 由于服务器上的其他进程可能同时消耗存储空间，因此客户端应仅将其作为估计值。</p><h3 id="11-2-Redirection-3xx"><a href="#11-2-Redirection-3xx" class="headerlink" title="11.2 Redirection 3xx"></a>11.2 Redirection 3xx</h3><p>详见<a href="https://datatracker.ietf.org/doc/html/rfc2068#section-10.3">[H10.3]</a>。</p><p>在 RTSP 中，重定向可用于负载平衡或将流请求重定向到拓扑更靠近客户端的服务器。 确定拓扑接近度的机制超出了本规范的范围。</p><h3 id="11-3-Client-Error-4xx"><a href="#11-3-Client-Error-4xx" class="headerlink" title="11.3 Client Error 4xx"></a>11.3 Client Error 4xx</h3><ul><li><p><code>405 Method Not Allowed</code></p><p>请求 URI 所标识的资源不允许使用请求中指定的方法。 响应必须包含一个 Allow 头，其中包含所请求资源的有效方法列表。 如果请求尝试使用在 <code>SETUP</code> 期间未指明的方法，也将使用此状态代码，例如，如果即使传输头中的模式参数仅指定了 <code>PLAY</code>，也会发出 <code>RECORD</code> 请求。</p></li><li><p><code>451 Parameter Not Understood</code></p><p>请求的接收者不支持请求中包含的一个或多个参数。</p></li><li><p><code>452 Conference Not Found</code></p><p>媒体服务器不知道会议头域指示的会议。</p></li><li><p><code>453 Not Enough Bandwidth</code></p><p>由于带宽不足，请求被拒绝。 例如，这可能是资源预留失败的结果。</p></li><li><p><code>454 Session Not Found</code></p><p>会话标头中的 RTSP 会话标识符丢失、无效或已超时。</p></li><li><p><code>455 Method Not Valid in This State</code></p><p>客户端或服务器无法在当前状态下处理此请求。 响应应该包含一个 Allow 标头以使错误恢复更容易。</p></li><li><p><code>456 Header Field Not Valid for Resource</code></p><p>服务器无法处理所需的请求标头。 例如，如果 <code>PLAY</code> 包含 Range 头字段，但流不允许查找。</p></li><li><p><code>457 Invalid Range</code></p><p>给定的范围值超出范围，例如，超出了演示的结尾。</p></li><li><p>458 Parameter Is Read-Only</p><p><code>SET_PARAMETER</code> 设置的参数可以读取但不能修改。</p></li><li><p>459 Aggregate Operation Not Allowed</p><p>所请求的方法可能不适用于相关 URL，因为它是一个聚合（表示）URL。该方法可以应用于流 URL。</p></li><li><p>460 Only Aggregate Operation Allowed</p><p>所请求的方法可能不适用于相关 URL，因为它不是聚合（表示）URL。该方法可以应用于演示 URL。</p></li><li><p>461 Unsupported Transport</p><p>传输字段不包含受支持的传输规范。</p></li><li><p>462 Destination Unreachable</p><p>由于无法到达客户端地址，无法建立数据传输通道。此错误很可能是客户端尝试在传输字段中放置无效目标参数的结果。</p></li><li><p>551 Option not supported</p><p>不支持在 Require 或 Proxy-Require 字段中给出的选项。应返回 Unsupported 标头，说明不支持的选项。</p></li></ul><h2 id="12-头部字段定义"><a href="#12-头部字段定义" class="headerlink" title="12 头部字段定义"></a>12 头部字段定义</h2><p>HTTP/1.1 [2] 或其他未在此处列出的非标准标头字段目前没有明确定义的含义，接收方应忽略。表 3 总结了 RTSP 使用的报头字段。</p><p>在 “type” 列中：</p><ul><li>“g” 指定在请求和响应中都能找到的通用请求头，</li><li>“R” 指定请求头，</li><li>“r” 指定响应头，</li><li>“e” 指定实体头字段。</li></ul><p>在 “support” 列中标记为 “req.” 的字段必须由接收者为特定方法实现，而标记为 “opt.” 的字段是可选的。</p><blockquote><p>请注意，并非所有标记为 “req.” 的字段都会在这种类型的每个请求中发送。 “req.”意味着只有客户端（对于响应头）和服务器（对于请求头）必须实现这些字段。</p></blockquote><p>最后一列列出了此头部字段有意义的方法；名称“entity”是指返回消息正文的所有方法。在本规范中，<code>DESCRIBE</code> 和 <code>GET_PARAMETER</code> 属于此类。</p><table><thead><tr><th>Header</th><th>type</th><th>support</th><th>methods</th></tr></thead><tbody><tr><td>Accept</td><td>R</td><td>opt.</td><td>entity</td></tr><tr><td>Accept-Encoding</td><td>R</td><td>opt.</td><td>entity</td></tr><tr><td>Accept-Language</td><td>R</td><td>opt.</td><td>all</td></tr><tr><td>Allow</td><td>r</td><td>opt.</td><td>all</td></tr><tr><td>Authorization</td><td>R</td><td>opt.</td><td>all</td></tr><tr><td>Bandwidth</td><td>R</td><td>opt.</td><td>all</td></tr><tr><td>Blocksize</td><td>R</td><td>opt.</td><td>all but OPTIONS, TEARDOWN</td></tr><tr><td>Cache-Control</td><td>g</td><td>opt.</td><td>SETUP</td></tr><tr><td>Conference</td><td>R</td><td>opt.</td><td>SETUP</td></tr><tr><td>Connection</td><td>g</td><td>req.</td><td>all</td></tr><tr><td>Content-Base</td><td>e</td><td>opt.</td><td>entity</td></tr><tr><td>Content-Encoding</td><td>e</td><td>req.</td><td>SET_PARAMETER</td></tr><tr><td>Content-Encoding</td><td>e</td><td>req.</td><td>DESCRIBE, ANNOUNCE</td></tr><tr><td>Content-Language</td><td>e</td><td>req.</td><td>DESCRIBE, ANNOUNCE</td></tr><tr><td>Content-Length</td><td>e</td><td>req.</td><td>SET_PARAMETER, ANNOUNCE</td></tr><tr><td>Content-Length</td><td>e</td><td>req.</td><td>entity</td></tr><tr><td>Content-Location</td><td>e</td><td>opt.</td><td>entity</td></tr><tr><td>Content-Type</td><td>e</td><td>req.</td><td>SET_PARAMETER, ANNOUNCE</td></tr><tr><td>Content-Type</td><td>r</td><td>req.</td><td>entity</td></tr><tr><td>CSeq</td><td>g</td><td>req.</td><td>all</td></tr><tr><td>Date</td><td>g</td><td>opt.</td><td>all</td></tr><tr><td>Expires</td><td>e</td><td>opt.</td><td>DESCRIBE, ANNOUNCE</td></tr><tr><td>From</td><td>R</td><td>opt.</td><td>all</td></tr><tr><td>If-Modified-Since</td><td>R</td><td>opt.</td><td>DESCRIBE, SETUP</td></tr><tr><td>Last-Modified</td><td>e</td><td>opt.</td><td>entity</td></tr><tr><td>Proxy-Authenticate</td><td></td><td></td><td></td></tr><tr><td>Proxy-Require</td><td>R</td><td>req.</td><td>all</td></tr><tr><td>Public</td><td>r</td><td>opt.</td><td>all</td></tr><tr><td>Range</td><td>R</td><td>opt.</td><td>PLAY, PAUSE, RECORD</td></tr><tr><td>Range</td><td>r</td><td>opt.</td><td>PLAY, PAUSE, RECORD</td></tr><tr><td>Referer</td><td>R</td><td>opt.</td><td>all</td></tr><tr><td>Require</td><td>R</td><td>req.</td><td>all</td></tr><tr><td>Retry-After</td><td>r</td><td>opt.</td><td>all</td></tr><tr><td>RTP-Info</td><td>r</td><td>req.</td><td>PLAY</td></tr><tr><td>Scale</td><td>Rr</td><td>opt.</td><td>PLAY, RECORD</td></tr><tr><td>Session</td><td>Rr</td><td>req.</td><td>all but SETUP, OPTIONS</td></tr><tr><td>Server</td><td>r</td><td>opt.</td><td>all</td></tr><tr><td>Speed</td><td>Rr</td><td>opt.</td><td>PLAY</td></tr><tr><td>Transport</td><td>Rr</td><td>req.</td><td>SETUP</td></tr><tr><td>Unsupported</td><td>r</td><td>req.</td><td>all</td></tr><tr><td>User-Agent</td><td>R</td><td>opt.</td><td>all</td></tr><tr><td>Via</td><td>g</td><td>opt.</td><td>all</td></tr><tr><td>WWW-Authenticate</td><td>r</td><td>opt.</td><td>all</td></tr></tbody></table><p>   表3： RTSP 头域概述</p><p>请求头详见<a href="https://datatracker.ietf.org/doc/html/rfc2326#section-12">RFC 2326</a></p><h2 id="13-缓存"><a href="#13-缓存" class="headerlink" title="13 缓存"></a>13 缓存</h2><p>在 HTTP 中，响应-请求对被缓存。 RTSP 在这方面有很大的不同。响应不可缓存，但 <code>DESCRIBE</code> 返回的或包含在 <code>ANNOUNCE</code> 中的演示描述除外。 （因为除了 <code>DESCRIBE</code> 和 <code>GET_PARAMETER</code> 之外的任何响应都不会返回任何数据，缓存对于这些请求来说并不是真正的问题。）但是，对于连续媒体数据来说是可取的，通常相对于 RTSP 在带外传送，要缓存，以及会话描述。</p><p>在接收到 <code>SETUP</code> 或 <code>PLAY</code> 请求时，代理确定它是否具有连续媒体内容及其描述的最新副本。它可以通过分别发出 <code>SETUP</code> 或 <code>DESCRIBE</code> 请求并将 Last-Modified 标头与缓存副本的标头进行比较来确定副本是否是最新的。如果副本不是最新的，它会根据需要修改 SETUP 传输参数并将请求转发到源服务器。随后的控制命令如 <code>PLAY</code> 或 <code>PAUSE</code> 然后未经修改地传递代理。代理将连续媒体数据传送给客户端，同时可能制作本地副本供以后重用。缓存允许的确切行为由第 12.8 节中描述的缓存响应指令给出。如果缓存当前正在向请求者提供流，则它必须回答任何 DESCRIBE 请求，因为流描述的低级细节可能在源服务器上已更改。</p><blockquote><p>请注意，RTSP 缓存与 HTTP 缓存不同，属于“直通”类型。缓存不是从源服务器检索整个资源，而是简单地复制流数据，因为它在流向客户端的途中经过。因此，它不会引入额外的延迟。</p></blockquote><p>对于客户端来说，RTSP 代理缓存就像一个普通的媒体服务器，对于媒体源服务器来说就像一个客户端。正如 HTTP 缓存必须为它缓存的对象存储内容类型、内容语言等，媒体缓存必须存储表示描述。通常，缓存会从表示描述中消除所有传输引用（即多播信息），因为这些与从缓存到客户端的数据传递无关。有关编码的信息保持不变。如果缓存能够翻译缓存的媒体数据，它将创建一个新的演示描述，其中包含它可以提供的所有编码可能性。</p><h2 id="14-示例"><a href="#14-示例" class="headerlink" title="14 示例"></a>14 示例</h2><p>以下示例涉及非标准的流描述格式，例如 RTSL。 以下示例不能用作这些格式的参考。</p><h3 id="14-1-媒体点播（单播）"><a href="#14-1-媒体点播（单播）" class="headerlink" title="14.1 媒体点播（单播）"></a>14.1 媒体点播（单播）</h3><p>客户端 C 从媒体服务器 A (audio.example.com) 和 V (video.example.com) 请求电影。 媒体描述存储在网络服务器 W 上。 媒体描述包含对演示及其所有流的描述，包括可用的编解码器、动态 RTP 有效负载类型、协议栈以及语言或版权限制等内容信息。 它还可以给出关于电影时间线的指示。</p><p>在这个例子中，客户端只对电影的最后部分感兴趣。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;W: GET &#x2F;twister.sdp HTTP&#x2F;1.1      Host: www.example.com      Accept: application&#x2F;sdpW-&gt;C: HTTP&#x2F;1.0 200 OK      Content-Type: application&#x2F;sdp      v&#x3D;0      o&#x3D;- 2890844526 2890842807 IN IP4 192.16.24.202      s&#x3D;RTSP Session      m&#x3D;audio 0 RTP&#x2F;AVP 0      a&#x3D;control:rtsp:&#x2F;&#x2F;audio.example.com&#x2F;twister&#x2F;audio.en      m&#x3D;video 0 RTP&#x2F;AVP 31      a&#x3D;control:rtsp:&#x2F;&#x2F;video.example.com&#x2F;twister&#x2F;videoC-&gt;A: SETUP rtsp:&#x2F;&#x2F;audio.example.com&#x2F;twister&#x2F;audio.en RTSP&#x2F;1.0      CSeq: 1      Transport: RTP&#x2F;AVP&#x2F;UDP;unicast;client_port&#x3D;3056-3057A-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 1      Session: 12345678      Transport: RTP&#x2F;AVP&#x2F;UDP;unicast;client_port&#x3D;3056-3057;                 server_port&#x3D;5000-5001C-&gt;V: SETUP rtsp:&#x2F;&#x2F;video.example.com&#x2F;twister&#x2F;video RTSP&#x2F;1.0      CSeq: 1      Transport: RTP&#x2F;AVP&#x2F;UDP;unicast;client_port&#x3D;3058-3059V-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 1      Session: 23456789      Transport: RTP&#x2F;AVP&#x2F;UDP;unicast;client_port&#x3D;3058-3059;                 server_port&#x3D;5002-5003C-&gt;V: PLAY rtsp:&#x2F;&#x2F;video.example.com&#x2F;twister&#x2F;video RTSP&#x2F;1.0      CSeq: 2      Session: 23456789      Range: smpte&#x3D;0:10:00-V-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 2      Session: 23456789      Range: smpte&#x3D;0:10:00-0:20:00      RTP-Info: url&#x3D;rtsp:&#x2F;&#x2F;video.example.com&#x2F;twister&#x2F;video;        seq&#x3D;12312232;rtptime&#x3D;78712811C-&gt;A: PLAY rtsp:&#x2F;&#x2F;audio.example.com&#x2F;twister&#x2F;audio.en RTSP&#x2F;1.0      CSeq: 2      Session: 12345678      Range: smpte&#x3D;0:10:00-A-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 2      Session: 12345678      Range: smpte&#x3D;0:10:00-0:20:00      RTP-Info: url&#x3D;rtsp:&#x2F;&#x2F;audio.example.com&#x2F;twister&#x2F;audio.en;        seq&#x3D;876655;rtptime&#x3D;1032181C-&gt;A: TEARDOWN rtsp:&#x2F;&#x2F;audio.example.com&#x2F;twister&#x2F;audio.en RTSP&#x2F;1.0      CSeq: 3      Session: 12345678A-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 3C-&gt;V: TEARDOWN rtsp:&#x2F;&#x2F;video.example.com&#x2F;twister&#x2F;video RTSP&#x2F;1.0      CSeq: 3      Session: 23456789V-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>即使音频和视频轨道在两个不同的服务器上，并且可能在稍微不同的时间开始并且可能相互漂移，客户端也可以使用标准 RTP 方法同步两者，特别是 RTCP 发送方中包含的时间尺度 报告。</p><h3 id="14-2-容器文件的流式传输"><a href="#14-2-容器文件的流式传输" class="headerlink" title="14.2 容器文件的流式传输"></a>14.2 容器文件的流式传输</h3><p>出于本示例的目的，容器文件是一个存储实体，其中存在属于同一最终用户呈现的多个连续媒体类型。实际上，容器文件表示一个 RTSP 演示，其每个组件都是 RTSP 流。容器文件是一种广泛使用的存储此类演示的方式。当组件作为独立的流传输时，希望在服务器端为这些流维护一个公共上下文。</p><blockquote><p>这使服务器能够轻松保持单个存储手柄打开。它还允许在服务器对流进行任何优先级排序的情况下平等地处理所有流。</p></blockquote><p>演示作者也可能希望防止客户端对流进行选择性检索，以保留组合媒体演示的艺术效果。类似地，在这种紧密绑定的表示中，希望能够通过使用聚合 URL 的单个控制消息来控制所有流。</p><p>以下是使用单个 RTSP 会话控制多个流的示例。它还说明了聚合 URL 的使用。客户端 C 向媒体服务器 M 请求演示。 影片存储在容器文件中。 客户端已获得容器文件的 RTSP URL。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;M: DESCRIBE rtsp:&#x2F;&#x2F;foo&#x2F;twister RTSP&#x2F;1.0      CSeq: 1M-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 1      Content-Type: application&#x2F;sdp      Content-Length: 164      v&#x3D;0      o&#x3D;- 2890844256 2890842807 IN IP4 172.16.2.93      s&#x3D;RTSP Session      i&#x3D;An Example of RTSP Session Usage      a&#x3D;control:rtsp:&#x2F;&#x2F;foo&#x2F;twister      t&#x3D;0 0      m&#x3D;audio 0 RTP&#x2F;AVP 0      a&#x3D;control:rtsp:&#x2F;&#x2F;foo&#x2F;twister&#x2F;audio      m&#x3D;video 0 RTP&#x2F;AVP 26      a&#x3D;control:rtsp:&#x2F;&#x2F;foo&#x2F;twister&#x2F;videoC-&gt;M: SETUP rtsp:&#x2F;&#x2F;foo&#x2F;twister&#x2F;audio RTSP&#x2F;1.0      CSeq: 2      Transport: RTP&#x2F;AVP;unicast;client_port&#x3D;8000-8001M-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 2      Transport: RTP&#x2F;AVP;unicast;client_port&#x3D;8000-8001;                 server_port&#x3D;9000-9001      Session: 12345678C-&gt;M: SETUP rtsp:&#x2F;&#x2F;foo&#x2F;twister&#x2F;video RTSP&#x2F;1.0      CSeq: 3      Transport: RTP&#x2F;AVP;unicast;client_port&#x3D;8002-8003      Session: 12345678M-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 3      Transport: RTP&#x2F;AVP;unicast;client_port&#x3D;8002-8003;                 server_port&#x3D;9004-9005      Session: 12345678C-&gt;M: PLAY rtsp:&#x2F;&#x2F;foo&#x2F;twister RTSP&#x2F;1.0      CSeq: 4      Range: npt&#x3D;0-      Session: 12345678M-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 4      Session: 12345678      RTP-Info: url&#x3D;rtsp:&#x2F;&#x2F;foo&#x2F;twister&#x2F;video;        seq&#x3D;9810092;rtptime&#x3D;3450012C-&gt;M: PAUSE rtsp:&#x2F;&#x2F;foo&#x2F;twister&#x2F;video RTSP&#x2F;1.0      CSeq: 5      Session: 12345678M-&gt;C: RTSP&#x2F;1.0 460 Only aggregate operation allowed      CSeq: 5C-&gt;M: PAUSE rtsp:&#x2F;&#x2F;foo&#x2F;twister RTSP&#x2F;1.0      CSeq: 6      Session: 12345678M-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 6      Session: 12345678C-&gt;M: SETUP rtsp:&#x2F;&#x2F;foo&#x2F;twister RTSP&#x2F;1.0      CSeq: 7      Transport: RTP&#x2F;AVP;unicast;client_port&#x3D;10000M-&gt;C: RTSP&#x2F;1.0 459 Aggregate operation not allowed      CSeq: 7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在第一个失败实例中，客户端尝试暂停演示的一个流（在本例中为视频）。 对于该演示，服务器不允许这样做。 在第二种情况下，聚合 URL 可能不用于 <code>SETUP</code>，并且每个流需要一个控制消息来设置传输参数。</p><blockquote><p>这使传输标头的语法保持简单，并允许防火墙轻松解析传输信息。</p></blockquote><h3 id="14-3-单流容器文件"><a href="#14-3-单流容器文件" class="headerlink" title="14.3 单流容器文件"></a>14.3 单流容器文件</h3><p>一些 RTSP 服务器可能会将所有文件视为“容器文件”，而其他服务器可能不支持这样的概念。 因此，客户端应该使用会话描述中为请求 URL 设置的规则，而不是假设始终使用一致的 URL。 下面是一个多流服务器如何期望提供单流文件的示例：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">      Accept: application&#x2F;x-rtsp-mh, application&#x2F;sdp      CSeq: 1S-&gt;C  RTSP&#x2F;1.0 200 OK      CSeq: 1      Content-base: rtsp:&#x2F;&#x2F;foo.com&#x2F;test.wav&#x2F;      Content-type: application&#x2F;sdp      Content-length: 48      v&#x3D;0      o&#x3D;- 872653257 872653257 IN IP4 172.16.2.187      s&#x3D;mu-law wave file      i&#x3D;audio test      t&#x3D;0 0      m&#x3D;audio 0 RTP&#x2F;AVP 0      a&#x3D;control:streamid&#x3D;0C-&gt;S  SETUP rtsp:&#x2F;&#x2F;foo.com&#x2F;test.wav&#x2F;streamid&#x3D;0 RTSP&#x2F;1.0      Transport: RTP&#x2F;AVP&#x2F;UDP;unicast;                 client_port&#x3D;6970-6971;mode&#x3D;play      CSeq: 2S-&gt;C  RTSP&#x2F;1.0 200 OK      Transport: RTP&#x2F;AVP&#x2F;UDP;unicast;client_port&#x3D;6970-6971;                 server_port&#x3D;6970-6971;mode&#x3D;play      CSeq: 2      Session: 2034820394C-&gt;S  PLAY rtsp:&#x2F;&#x2F;foo.com&#x2F;test.wav RTSP&#x2F;1.0      CSeq: 3      Session: 2034820394S-&gt;C  RTSP&#x2F;1.0 200 OK      CSeq: 3      Session: 2034820394      RTP-Info: url&#x3D;rtsp:&#x2F;&#x2F;foo.com&#x2F;test.wav&#x2F;streamid&#x3D;0;        seq&#x3D;981888;rtptime&#x3D;3781123<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意 <code>SETUP</code> 命令中的不同 URL，然后切换回 <code>PLAY</code> 命令中的聚合 URL。 当有多个流具有聚合控制时，这完全有意义，但在流数为 1 的特殊情况下不太直观。</p><p>在这种特殊情况下，建议服务器原谅发送以下内容的实现：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S  PLAY rtsp:&#x2F;&#x2F;foo.com&#x2F;test.wav&#x2F;streamid&#x3D;0 RTSP&#x2F;1.0      CSeq: 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在最坏的情况下，服务器应该发回：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">S-&gt;C  RTSP&#x2F;1.0 460 Only aggregate operation allowed      CSeq: 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>人们还希望服务器实现也能接受以下内容：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;S  SETUP rtsp:&#x2F;&#x2F;foo.com&#x2F;test.wav RTSP&#x2F;1.0      Transport: rtp&#x2F;avp&#x2F;udp;client_port&#x3D;6970-6971;mode&#x3D;play      CSeq: 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>由于此文件中只有一个流，因此这意味着什么并不含糊。</p><h3 id="14-4-使用多播的现场媒体演示"><a href="#14-4-使用多播的现场媒体演示" class="headerlink" title="14.4 使用多播的现场媒体演示"></a>14.4 使用多播的现场媒体演示</h3><p>媒体服务器 M 选择多播地址和端口。 这里，我们假设网络服务器只包含一个指向完整描述的指针，而媒体服务器 M 维护完整描述。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;W: GET &#x2F;concert.sdp HTTP&#x2F;1.1      Host: www.example.comW-&gt;C: HTTP&#x2F;1.1 200 OK      Content-Type: application&#x2F;x-rtsl      &lt;session&gt;        &lt;track src&#x3D;&quot;rtsp:&#x2F;&#x2F;live.example.com&#x2F;concert&#x2F;audio&quot;&gt;      &lt;&#x2F;session&gt;C-&gt;M: DESCRIBE rtsp:&#x2F;&#x2F;live.example.com&#x2F;concert&#x2F;audio RTSP&#x2F;1.0      CSeq: 1M-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 1      Content-Type: application&#x2F;sdp      Content-Length: 44      v&#x3D;0      o&#x3D;- 2890844526 2890842807 IN IP4 192.16.24.202      s&#x3D;RTSP Session      m&#x3D;audio 3456 RTP&#x2F;AVP 0      a&#x3D;control:rtsp:&#x2F;&#x2F;live.example.com&#x2F;concert&#x2F;audio      c&#x3D;IN IP4 224.2.0.1&#x2F;16C-&gt;M: SETUP rtsp:&#x2F;&#x2F;live.example.com&#x2F;concert&#x2F;audio RTSP&#x2F;1.0      CSeq: 2      Transport: RTP&#x2F;AVP;multicastM-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 2      Transport: RTP&#x2F;AVP;multicast;destination&#x3D;224.2.0.1;                 port&#x3D;3456-3457;ttl&#x3D;16      Session: 0456804596C-&gt;M: PLAY rtsp:&#x2F;&#x2F;live.example.com&#x2F;concert&#x2F;audio RTSP&#x2F;1.0      CSeq: 3      Session: 0456804596M-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 3      Session: 0456804596<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="14-5-在现有会话中播放媒体"><a href="#14-5-在现有会话中播放媒体" class="headerlink" title="14.5 在现有会话中播放媒体"></a>14.5 在现有会话中播放媒体</h3><p>会议参与者 C 希望媒体服务器 M 将演示磁带回放到现有会议中。 C 向媒体服务器表明网络地址和加密密钥已由会议提供，因此不应由服务器选择。 该示例省略了简单的 ACK 响应。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;M: DESCRIBE rtsp:&#x2F;&#x2F;server.example.com&#x2F;demo&#x2F;548&#x2F;sound RTSP&#x2F;1.0      CSeq: 1      Accept: application&#x2F;sdpM-&gt;C: RTSP&#x2F;1.0 200 1 OK      Content-type: application&#x2F;sdp      Content-Length: 44      v&#x3D;0      o&#x3D;- 2890844526 2890842807 IN IP4 192.16.24.202      s&#x3D;RTSP Session      i&#x3D;See above      t&#x3D;0 0      m&#x3D;audio 0 RTP&#x2F;AVP 0C-&gt;M: SETUP rtsp:&#x2F;&#x2F;server.example.com&#x2F;demo&#x2F;548&#x2F;sound RTSP&#x2F;1.0      CSeq: 2      Transport: RTP&#x2F;AVP;multicast;destination&#x3D;225.219.201.15;                 port&#x3D;7000-7001;ttl&#x3D;127      Conference: 199702170042.SAA08642@obiwan.arl.wustl.edu%20StarrM-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 2      Transport: RTP&#x2F;AVP;multicast;destination&#x3D;225.219.201.15;                 port&#x3D;7000-7001;ttl&#x3D;127      Session: 91389234234      Conference: 199702170042.SAA08642@obiwan.arl.wustl.edu%20StarrC-&gt;M: PLAY rtsp:&#x2F;&#x2F;server.example.com&#x2F;demo&#x2F;548&#x2F;sound RTSP&#x2F;1.0      CSeq: 3      Session: 91389234234M-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="14-6-录像"><a href="#14-6-录像" class="headerlink" title="14.6 录像"></a>14.6 录像</h3><p>会议参与者客户端C要求媒体服务器M记录会议的音频和视频部分。 客户端使用 <code>ANNOUNCE</code> 方法向服务器提供有关记录会话的元信息。</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">C-&gt;M: ANNOUNCE rtsp:&#x2F;&#x2F;server.example.com&#x2F;meeting RTSP&#x2F;1.0      CSeq: 90      Content-Type: application&#x2F;sdp      Content-Length: 121      v&#x3D;0      o&#x3D;camera1 3080117314 3080118787 IN IP4 195.27.192.36      s&#x3D;IETF Meeting, Munich - 1      i&#x3D;The thirty-ninth IETF meeting will be held in Munich, Germany      u&#x3D;http:&#x2F;&#x2F;www.ietf.org&#x2F;meetings&#x2F;Munich.html      e&#x3D;IETF Channel 1 &lt;ietf39-mbone@uni-koeln.de&gt;      p&#x3D;IETF Channel 1 +49-172-2312 451      c&#x3D;IN IP4 224.0.1.11&#x2F;127      t&#x3D;3080271600 3080703600      a&#x3D;tool:sdr v2.4a6      a&#x3D;type:test      m&#x3D;audio 21010 RTP&#x2F;AVP 5      c&#x3D;IN IP4 224.0.1.11&#x2F;127      a&#x3D;ptime:40      m&#x3D;video 61010 RTP&#x2F;AVP 31      c&#x3D;IN IP4 224.0.1.12&#x2F;127M-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 90C-&gt;M: SETUP rtsp:&#x2F;&#x2F;server.example.com&#x2F;meeting&#x2F;audiotrack RTSP&#x2F;1.0      CSeq: 91      Transport: RTP&#x2F;AVP;multicast;destination&#x3D;224.0.1.11;                 port&#x3D;21010-21011;mode&#x3D;record;ttl&#x3D;127M-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 91      Session: 50887676      Transport: RTP&#x2F;AVP;multicast;destination&#x3D;224.0.1.11;                 port&#x3D;21010-21011;mode&#x3D;record;ttl&#x3D;127C-&gt;M: SETUP rtsp:&#x2F;&#x2F;server.example.com&#x2F;meeting&#x2F;videotrack RTSP&#x2F;1.0      CSeq: 92      Session: 50887676      Transport: RTP&#x2F;AVP;multicast;destination&#x3D;224.0.1.12;                 port&#x3D;61010-61011;mode&#x3D;record;ttl&#x3D;127M-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 92      Transport: RTP&#x2F;AVP;multicast;destination&#x3D;224.0.1.12;                 port&#x3D;61010-61011;mode&#x3D;record;ttl&#x3D;127C-&gt;M: RECORD rtsp:&#x2F;&#x2F;server.example.com&#x2F;meeting RTSP&#x2F;1.0      CSeq: 93      Session: 50887676      Range: clock&#x3D;19961110T1925-19961110T2015M-&gt;C: RTSP&#x2F;1.0 200 OK      CSeq: 93<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="15-语法"><a href="#15-语法" class="headerlink" title="15 语法"></a>15 语法</h2><p>详见<a href="https://datatracker.ietf.org/doc/html/rfc2326#section-15">RFC 2326</a></p><h2 id="16-安全注意事项"><a href="#16-安全注意事项" class="headerlink" title="16 安全注意事项"></a>16 安全注意事项</h2><p>详见<a href="https://datatracker.ietf.org/doc/html/rfc2326#section-16">RFC 2326</a></p><h2 id="附录-A：RTSP-协议状态机"><a href="#附录-A：RTSP-协议状态机" class="headerlink" title="附录 A：RTSP 协议状态机"></a>附录 A：RTSP 协议状态机</h2><p>RTSP 客户端和服务器状态机描述了从 RTSP 会话初始化到 RTSP 会话终止的协议行为。</p><p>状态是基于每个对象定义的。 对象由流 URL 和 RTSP 会话标识符唯一标识。 任何使用聚合 URL 表示由多个流组成的 RTSP 演示的请求/回复都将对所有流的各个状态产生影响。 例如，如果演示 /movie 包含两个流，/movie/audio 和 /movie/video，则以下命令：</p><pre class="line-numbers language-rtsp" data-language="rtsp"><code class="language-rtsp">PLAY rtsp:&#x2F;&#x2F;foo.com&#x2F;movie RTSP&#x2F;1.0CSeq: 559Session: 12345678<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>将对 /movie/audio 和 /movie/video 的状态产生影响。</p><blockquote><p>这个例子并不意味着用标准的方式来表示 URL 中的流或与文件系统的关系。 见第 3.2 节。</p></blockquote><p>请求 OPTIONS、ANNOUNCE、DESCRIBE、GET_PARAMETER、SET_PARAMETER 对客户端或服务器状态没有任何影响，因此未在状态表中列出。</p><h3 id="A-1-客户端状态机"><a href="#A-1-客户端状态机" class="headerlink" title="A.1 客户端状态机"></a>A.1 客户端状态机</h3><p>客户端可以假设以下状态：</p><ul><li><code>Init</code>:<br><code>SETUP</code> 已发送，等待回复。</li><li><code>Ready</code>:<br>在播放状态下收到 <code>SETUP</code> 回复或 <code>PAUSE</code> 回复。</li><li><code>Playing</code>:<br>收到 <code>PLAY</code> 回复</li><li><code>Recording</code>:<br>收到 <code>RECORD</code> 回复</li></ul><p>通常，客户端在收到对请求的回复时更改状态。 请注意，某些请求在未来的时间或位置（例如 <code>PAUSE</code>）有效，并且状态也会相应更改。 如果对象不需要明确的 <code>SETUP</code>（例如，它可以通过多播组获得），则状态从 <code>Ready</code> 开始。 在这种情况下，只有两种状态，<code>Ready</code> 和 <code>Playing</code>。 当达到请求范围的末尾时，客户端还会将状态从“<code>Playing</code>/<code>Recording</code>”更改为“<code>Ready</code>”。</p><p>“下一个状态”列指示在收到成功响应 (2xx) 后假定的状态。 如果请求产生 3xx 的状态码，则状态变为 <code>Init</code>，而 4xx 的状态码不会产生状态变化。 未为每个状态列出的消息不得由处于该状态的客户端发出，但不影响状态的消息除外，如上所列。 从服务器接收 <code>REDIRECT</code> 相当于从服务器接收 3xx 重定向状态。</p><table><thead><tr><th>state</th><th>message sent</th><th>next state after response</th></tr></thead><tbody><tr><td>Init</td><td>SETUP</td><td>Ready</td></tr><tr><td></td><td>TEARDOWN</td><td>Init</td></tr><tr><td>Ready</td><td>PLAY</td><td>Playing</td></tr><tr><td></td><td>RECORD</td><td>Recording</td></tr><tr><td></td><td>TEARDOWN</td><td>Init</td></tr><tr><td></td><td>SETUP</td><td>Ready</td></tr><tr><td>Playing</td><td>PAUSE</td><td>Ready</td></tr><tr><td></td><td>TEARDOWN</td><td>Init</td></tr><tr><td></td><td>PLAY</td><td>Playing</td></tr><tr><td></td><td>SETUP</td><td>Playing (changed transport)</td></tr><tr><td>Recording</td><td>PAUSE</td><td>Ready</td></tr><tr><td></td><td>TEARDOWN</td><td>Init</td></tr><tr><td></td><td>RECORD</td><td>Recording</td></tr><tr><td></td><td>SETUP</td><td>Recording (changed transport)</td></tr></tbody></table><h3 id="A-2-服务器状态机"><a href="#A-2-服务器状态机" class="headerlink" title="A.2 服务器状态机"></a>A.2 服务器状态机</h3><p>服务器可以呈现以下状态：</p><ul><li><code>Init</code>:<br>初始状态，尚未收到有效的 <code>SETUP</code>。</li><li><code>Ready</code>:<br>上次 <code>SETUP</code> 接收成功，发送回复或播放后，上次接收 <code>PAUSE</code> 成功，回复发送。</li><li><code>Playing</code>:<br>最后 <code>PLAY</code> 接收成功，回复已发送。 正在发送数据。</li><li><code>Recording</code>:<br>服务器正在记录媒体数据。</li></ul><p>通常，服务器会在收到请求时更改状态。 如果服务器处于播放或录制状态并且处于单播模式，如果它在定义的时间间隔内没有从客户端收到“健康”信息，例如 RTCP 报告或 RTSP 命令，它可以恢复到 <code>Init</code> 并拆除 RTSP 会话 ，默认为一分钟。 服务器可以在 Session 响应头中声明另一个超时值（第 12.37 节）。 如果服务器处于就绪状态，并且在超过一分钟的时间间隔内没有收到 RTSP 请求，则它可以恢复到 <code>Init</code>。 请注意，某些请求（例如 <code>PAUSE</code>）可能会在未来的时间或位置生效，并且服务器状态会在适当的时间发生变化。 在客户端请求的范围结束时，服务器从播放或录制状态恢复到就绪状态。</p><p><code>REDIRECT</code> 消息在发送时立即生效，除非它具有指定重定向何时生效的 Range 标头。 在这种情况下，服务器状态也会在适当的时候发生变化。</p><p>如果对象不需要明确的 <code>SETUP</code>，则状态从 <code>Ready</code> 开始，只有两种状态，<code>Ready</code> 和 <code>Playing</code>。</p><p>“下一个状态”列指示发送成功响应 (2xx) 后假定的状态。 如果请求导致状态代码为 3xx，则状态变为 Init。 状态代码 4xx 不会导致任何更改。</p><table><thead><tr><th>state</th><th>message received</th><th>next state</th></tr></thead><tbody><tr><td>Init</td><td>SETUP</td><td>Ready</td></tr><tr><td></td><td>TEARDOWN</td><td>Init</td></tr><tr><td>Ready</td><td>PLAY</td><td>Playing</td></tr><tr><td></td><td>SETUP</td><td>Ready</td></tr><tr><td></td><td>TEARDOWN</td><td>Init</td></tr><tr><td></td><td>RECORD</td><td>Recording</td></tr><tr><td>Playing</td><td>PLAY</td><td>Playing</td></tr><tr><td></td><td>PAUSE</td><td>Ready</td></tr><tr><td></td><td>TEARDOWN</td><td>Init</td></tr><tr><td></td><td>SETUP</td><td>Playing</td></tr><tr><td>Recording</td><td>RECORD</td><td>Recording</td></tr><tr><td></td><td>PAUSE</td><td>Ready</td></tr><tr><td></td><td>TEARDOWN</td><td>Init</td></tr><tr><td></td><td>SETUP</td><td>Recording</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 音视频 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> translate </tag>
            
            <tag> rtsp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ffmpeg 命令行</title>
      <link href="stream/ffmpeg/ffmpeg-cmd-da0b4531b2bd/"/>
      <url>stream/ffmpeg/ffmpeg-cmd-da0b4531b2bd/</url>
      
        <content type="html"><![CDATA[<p>FFmpeg 是领先的多媒体框架，能够解码、编码、转码、复用、解复用、流、过滤和播放人类和机器创建的几乎任何东西。它支持最前沿的最晦涩的古代格式。无论它们是由某个标准委员会、社区还是公司设计的。它还具有高度的可移植性：FFmpeg 在各种构建环境、机器架构和配置下编译、运行并通过我们的测试基础设施 FATE，跨越 Linux、Mac OS X、Microsoft Windows、BSD、Solaris 等。</p><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg <span class="token punctuation">[</span>global_options<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token punctuation">[</span>input_file_options<span class="token punctuation">]</span> -i input_url<span class="token punctuation">&#125;</span> <span class="token punctuation">..</span>. <span class="token punctuation">&#123;</span><span class="token punctuation">[</span>output_file_options<span class="token punctuation">]</span> output_url<span class="token punctuation">&#125;</span> <span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>ffmpeg</code> 是一个非常快速的视频和音频转换器，它也可以从实时音频/视频源中抓取。它还可以在任意采样率之间进行转换，并使用高质量的多相滤波器动态调整视频大小。</p><p><code>ffmpeg</code> 从 <code>-i</code> 选项指定的任意数量的输入“文件”（可以是常规文件、管道、网络流、抓取设备等）中读取，并写入任意数量的输出“文件”，其中由纯输出 url 指定。在命令行上发现的任何不能被解释为选项的东西都被认为是一个输出 url。</p><p>原则上，每个输入或输出 url 可以包含任意数量的不同类型（视频/音频/字幕/附件/数据）的流。允许的流数量和/或类型可能受容器格式的限制。选择哪些流从哪些输入进入哪些输出可以自动完成或使用 <code>-map</code> 选项（请参阅流选择章节）。</p><p>要在选项中引用输入文件，您必须使用它们的索引（从 0 开始）。例如。第一个输入文件是 0，第二个是 1，等等。类似地，文件中的流由它们的索引引用。例如。 2:3 指的是第三个输入文件中的第四个流。另请参阅<a href="#%E6%B5%81%E8%AF%B4%E6%98%8E%E7%AC%A6">流说明符</a>一章。</p><p>作为一般规则，选项应用于下一个指定的文件。因此，顺序很重要，您可以在命令行上多次使用相同的选项。然后将每次出现应用于下一个输入或输出文件。此规则的例外是全局选项（例如详细级别），应首先指定。</p><p>不要混合输入和输出文件——首先指定所有输入文件，然后指定所有输出文件。也不要混合属于不同文件的选项。所有选项仅适用于下一个输入或输出文件，并在文件之间重置。</p><ul><li><p>将输出文件的视频比特率设置为 64 kbit/s：</p>  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i input.avi -b:v 64k -bufsize 64k output.avi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>强制输出文件的帧速率为 24 fps:</p>  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i input.avi -r <span class="token number">24</span> output.avi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>将输入文件的帧速率（仅对原始格式有效）强制为 1 fps，将输出文件的帧速率强制为 24 fps:</p>  <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -r <span class="token number">1</span> -i input.m2v -r <span class="token number">24</span> output.avi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p>原始输入文件可能需要格式选项。</p><h2 id="详细描述"><a href="#详细描述" class="headerlink" title="详细描述"></a>详细描述</h2><p>ffmpeg中每个输出的转码过程可以用下图来描述：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text"> _______              ______________|       |            |              || input |  demuxer   | encoded data |   decoder| file  | ---------&gt; | packets      | -----+|_______|            |______________|      |                                           v                                       _________                                      |         |                                      | decoded |                                      | frames  |                                      |_________| ________             ______________       ||        |           |              |      || output | &lt;-------- | encoded data | &lt;----+| file   |   muxer   | packets      |   encoder|________|           |______________|<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>ffmpeg</code> 调用 <code>libavformat</code> 库（包含 demuxers）来读取输入文件并从中获取包含编码数据的数据包。当有多个输入文件时，<code>ffmpeg</code>尝试通过跟踪任何活动输入流上的最低时间戳来保持它们同步。</p><p>然后将编码的数据包传递给解码器（除非为流选择了 streamcopy，请参阅进一步的说明）。解码器产生未压缩的帧（原始视频/PCM 音频/…），可以通过过滤进一步处理（见下一节）。过滤后，帧被传递到编码器，编码器对它们进行编码并输出编码数据包。最后，这些被传递给 muxer, muxer 将编码的数据包写入输出文件。</p><h3 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h3><p>在编码之前，<code>ffmpeg</code> 可以使用 <code>libavfilter</code> 库中的过滤器处理原始音频和视频帧。几个链式过滤器形成一个过滤器图。 <code>ffmpeg</code> 区分两种类型的过滤器图：简单的和复杂的。</p><h4 id="简单的过滤器图"><a href="#简单的过滤器图" class="headerlink" title="简单的过滤器图"></a>简单的过滤器图</h4><p>简单的过滤器图是那些只有一个输入和输出，两者都是相同类型的。在上图中，它们可以通过在解码和编码之间简单地插入一个附加步骤来表示：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text"> _________                        ______________|         |                      |              || decoded |                      | encoded data || frames  |\                   _ | packets      ||_________| \                  &#x2F;||______________|             \   __________   &#x2F;  simple     _\||          | &#x2F;  encoder  filtergraph   | filtered |&#x2F;                | frames   |                |__________|<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用 per-stream <code>-filter</code> 选项（分别为视频和音频使用 <code>-vf</code> 和 <code>-af</code> 别名）配置简单过滤器图。一个简单的视频过滤器图看起来像这样：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text"> _______        _____________        _______        ________|       |      |             |      |       |      |        || input | ---&gt; | deinterlace | ---&gt; | scale | ---&gt; | output ||_______|      |_____________|      |_______|      |________|<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>请注意，某些过滤器会更改框架属性，但不会更改框架内容。例如。上例中的 <code>fps</code> 过滤器会更改帧数，但不会触及帧内容。另一个例子是 <code>setpts</code> 过滤器，它只设置时间戳，否则不变地传递帧。</p></blockquote><h4 id="复杂的过滤器图"><a href="#复杂的过滤器图" class="headerlink" title="复杂的过滤器图"></a>复杂的过滤器图</h4><p>复杂的过滤器图不能简单地描述为应用于一个流的线性处理链。例如，当图形具有多个输入和/或输出时，或者当输出流类型与输入不同时，就会出现这种情况。它们可以用下图表示：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text"> _________|         || input 0 |\                    __________|_________| \                  |          |             \   _________    &#x2F;| output 0 |              \ |         |  &#x2F; |__________| _________     \| complex | &#x2F;|         |     |         |&#x2F;| input 1 |----&gt;| filter  |\|_________|     |         | \   __________               &#x2F;| graph   |  \ |          |              &#x2F; |         |   \| output 1 | _________   &#x2F;  |_________|    |__________||         | &#x2F;| input 2 |&#x2F;|_________|<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>使用 <code>-filter_complex</code> 选项配置复杂过滤器图。请注意，此选项是全局的，因为复杂的 filtergraph 就其性质而言，不能明确地与单个流或文件相关联。</p><p><code>-lavfi</code> 选项等效于 <code>-filter_complex</code>。</p><p>复杂过滤器图的一个简单示例是 <code>overlay</code> 过滤器，它具有两个视频输入和一个视频输出，其中包含一个叠加在另一个之上的视频。它的音频对应物是 <code>amix</code> 过滤器。</p><h3 id="流复制"><a href="#流复制" class="headerlink" title="流复制"></a>流复制</h3><p>流复制是通过将 <code>copy</code> 参数提供给 <code>-codec</code> 选项来选择的模式。它使 <code>ffmpeg</code> 省略了指定流的解码和编码步骤，因此它只进行解复用和复用。它对于更改容器格式或修改容器级元数据很有用。在这种情况下，上图将简化为：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text"> _______              ______________            ________|       |            |              |          |        || input |  demuxer   | encoded data |  muxer   | output || file  | ---------&gt; | packets      | -------&gt; | file   ||_______|            |______________|          |________|<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于没有解码或编码，因此速度非常快且没有质量损失。但是，由于许多因素，它在某些情况下可能不起作用。应用过滤器显然也是不可能的，因为过滤器适用于未压缩的数据。</p><h2 id="流选择"><a href="#流选择" class="headerlink" title="流选择"></a>流选择</h2><p><code>ffmpeg</code> 提供 <code>-map</code> 选项用于手动控制每个输出文件中的流选择。用户可以跳过 <code>-map</code> 并让 <code>ffmpeg</code> 执行自动流选择，如下所述。 <code>-vn</code>/<code>-an</code>/<code>-sn</code>/<code>-dn</code> 选项可用于分别跳过包含视频、音频、字幕和数据流，无论是手动映射还是自动选择，除了那些作为复杂过滤器图输出的流。</p><h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>下面的小节描述了流选择中涉及的各种规则。接下来的示例展示了这些规则在实践中的应用。</p><p>尽管已尽一切努力准确反映程序的行为，但 FFmpeg 仍在不断开发中，自撰写本文以来，代码可能已更改。</p><h4 id="自动流选择"><a href="#自动流选择" class="headerlink" title="自动流选择"></a>自动流选择</h4><p>在特定输出文件没有任何映射选项的情况下，ffmpeg 会检查输出格式以检查其中可以包含哪种类型的流，即。视频、音频和/或字幕。对于每种可接受的流类型，ffmpeg 将从所有输入中选择一个可用的流。</p><p>它将根据以下标准选择该流：</p><ul><li>对于视频，它是具有最高分辨率的流，</li><li>对于音频，它是拥有最多频道的流，</li><li>对于字幕，它是找到的第一个字幕流，但有一个警告。输出格式的默认字幕编码器可以是基于文本的，也可以是基于图像的，并且只会选择相同类型的字幕流。</li></ul><p>在几个相同类型的流速率相等的情况下，选择索引最低的流。</p><p>数据或附件流不会自动选择，只能使用 <code>-map</code> 包含。</p><h4 id="手动流选择"><a href="#手动流选择" class="headerlink" title="手动流选择"></a>手动流选择</h4><p>使用 <code>-map</code> 时，该输出文件中仅包含用户映射的流，下面描述的 filtergraph 输出的一种可能例外。</p><h4 id="复杂的过滤器图-1"><a href="#复杂的过滤器图-1" class="headerlink" title="复杂的过滤器图"></a>复杂的过滤器图</h4><p>如果有任何带有未标记焊盘的复杂 filtergraph 输出流，它们将被添加到第一个输出文件中。如果输出格式不支持流类型，这将导致致命错误。在没有 map 选项的情况下，包含这些流会导致跳过它们类型的自动流选择。如果存在映射选项，除了映射流之外，还包括这些过滤器图流。</p><p>带有标记焊盘的复杂 filtergraph 输出流必须映射一次且恰好一次。</p><h4 id="流处理"><a href="#流处理" class="headerlink" title="流处理"></a>流处理</h4><p>流处理独立于流选择，下面描述的字幕除外。流处理是通过 <code>-codec</code> 选项设置的，用于特定输出文件中的流。特别是，编解码器选项由 ffmpeg 在流选择过程之后应用，因此不会影响后者。如果没有为流类型指定 <code>-codec</code> 选项，ffmpeg 将选择输出文件复用器注册的默认编码器。</p><p>字幕存在例外情况。如果为输出文件指定了字幕编码器，则将包括找到的任何类型、文本或图像的第一个字幕流。 ffmpeg 不验证指定的编码器是否可以转换选定的流，或者转换后的流在输出格式中是否可接受。这也普遍适用：当用户手动设置编码器时，流选择过程无法检查编码流是否可以混合到输出文件中。如果不能，ffmpeg 将中止并且所有输出文件都将无法处理。</p><h3 id="流选择示例"><a href="#流选择示例" class="headerlink" title="流选择示例"></a>流选择示例</h3><p>以下示例说明了 ffmpeg 的流选择方法的行为、怪癖和限制。</p><p>这里假设有以下三个输入文件。</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">input file &#39;A.avi&#39;      stream 0: video 640x360      stream 1: audio 2 channelsinput file &#39;B.mp4&#39;      stream 0: video 1920x1080      stream 1: audio 2 channels      stream 2: subtitles (text)      stream 3: audio 5.1 channels      stream 4: subtitles (text)input file &#39;C.mkv&#39;      stream 0: video 1280x720      stream 1: audio 2 channels      stream 2: subtitles (image)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>示例：自动流选择</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i A.avi -i B.mp4 out1.mkv out2.wav -map <span class="token number">1</span>:a -c:a copy out3.mov<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>指定了三个输出文件，对于前两个，没有设置 <code>-map</code> 选项，因此 ffmpeg 会自动为这两个文件选择流。</p><p>out1.mkv 是 Matroska 容器文件，接受视频、音频和字幕流，因此 ffmpeg 会尝试从每种类型中选择一个。<br>对于视频，它将从所有输入视频流中分辨率最高的 B.mp4 中选择 <code>stream 0</code>。<br>对于音频，它将从 B.mp4 中选择 <code>stream 3</code>，因为它具有最多的通道数。<br>对于字幕，它会从 B.mp4 中选择 <code>stream 2</code>，这是 A.avi 和 B.mp4 中的第一个字幕流。</p><p>out2.wav 仅接受音频流，因此仅选择来自 B.mp4 的 <code>stream 3</code>。</p><p>对于 out3.mov，由于设置了 <code>-map</code> 选项，因此不会发生自动流选择。 <code>-map 1:a</code> 选项将从第二个输入 B.mp4 中选择所有音频流。此输出文件中不会包含其他流。</p><p>对于前两个输出，所有包含的流都将被转码。选择的编码器将是每个输出格式注册的默认编码器，可能与所选输入流的编解码器不匹配。</p><p>对于第三个输出，音频流的编解码器选项已设置为 <code>copy</code>，因此不会发生或可能发生解码-过滤-编码操作。所选流的数据包应从输入文件传送并在输出文件中混合。</p><ul><li>示例：自动字幕选择</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i C.mkv out1.mkv -c:s dvdsub -an out2.mkv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>虽然 out1.mkv 是接受字幕流的 Matroska 容器文件，但只能选择视频和音频流。 C.mkv 的字幕流是基于图像的，而 Matroska muxer 的默认字幕编码器是基于文本的，因此预计字幕的转码操作会失败，因此未选择该流。然而，在 out2.mkv 中，在命令中指定了字幕编码器，因此除了视频流之外，还选择了字幕流。 <code>-an</code> 的存在会禁用 out2.mkv 的音频流选择。</p><ul><li>示例：未标记的 filtergraph 输出</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i A.avi -i C.mkv -i B.mp4 -filter_complex <span class="token string">"overlay"</span> out1.mp4 out2.srt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此处使用 <code>-filter_complex</code> 选项设置过滤器图，并由单个视频过滤器组成。<code>overlay</code> 过滤器正好需要两个视频输入，但没有指定，因此使用前两个可用的视频流，即 A.avi 和 C.mkv。过滤器的输出垫没有标签，因此被发送到第一个输出文件 out1.mp4。因此，会跳过视频流的自动选择，这会选择 B.mp4 中的流。大多数频道的音频流即。 B.mp4 中的 <code>stream 3</code> 是自动选择的。但是没有选择字幕流，因为 MP4 格式没有注册默认的字幕编码器，并且用户没有指定字幕编码器。</p><p>第二个输出文件 out2.srt 只接受基于文本的字幕流。因此，即使第一个可用的字幕流属于 C.mkv，它也是基于图像的，因此被跳过。所选流，即 B.mp4 中的 <code>stream 2</code>，是第一个基于文本的字幕流。</p><ul><li>示例：带标签的 filtergraph 输出</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i A.avi -i B.mp4 -i C.mkv -filter_complex <span class="token string">"[1:v]hue=s=0[outv];overlay;aresample"</span> <span class="token punctuation">\</span>       -map <span class="token string">'[outv]'</span> -an        out1.mp4 <span class="token punctuation">\</span>                                out2.mkv <span class="token punctuation">\</span>       -map <span class="token string">'[outv]'</span> -map <span class="token number">1</span>:a:0 out3.mkv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>上述命令将失败，因为标记为 <code>[outv]</code> 的输出 pad 已被映射两次。不得处理任何输出文件。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i A.avi -i B.mp4 -i C.mkv -filter_complex <span class="token string">"[1:v]hue=s=0[outv];overlay;aresample"</span> <span class="token punctuation">\</span>       -an        out1.mp4 <span class="token punctuation">\</span>                  out2.mkv <span class="token punctuation">\</span>       -map <span class="token number">1</span>:a:0 out3.mkv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>上面的这个命令也会失败，因为色调过滤器输出有一个标签，<code>[outv]</code>，并且没有被映射到任何地方。</p><p>该命令应修改如下，</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i A.avi -i B.mp4 -i C.mkv -filter_complex <span class="token string">"[1:v]hue=s=0,split=2[outv1][outv2];overlay;aresample"</span> <span class="token punctuation">\</span>        -map <span class="token string">'[outv1]'</span> -an        out1.mp4 <span class="token punctuation">\</span>                                  out2.mkv <span class="token punctuation">\</span>        -map <span class="token string">'[outv2]'</span> -map <span class="token number">1</span>:a:0 out3.mkv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>来自 B.mp4 的视频流被发送到色调过滤器，其输出使用拆分过滤器克隆一次，并且两个输出都被标记。然后每个副本都映射到第一个和第三个输出文件。</p><p>需要两个视频输入的覆盖过滤器使用前两个未使用的视频流。这些是来自 A.avi 和 C.mkv 的流。覆盖输出没有标记，因此无论是否存在 <code>-map</code> 选项，它都会发送到第一个输出文件 out1.mp4。</p><p>aresample 过滤器发送第一个未使用的音频流，即 A.avi 的音频流。由于此过滤器输出也未标记，因此它也映射到第一个输出文件。 <code>-an</code> 的存在只会抑制音频流的自动或手动流选择，而不是从过滤器图发送的输出。这两个映射流都应在 out1.mp4 中的映射流之前排序。</p><p>映射到 out2.mkv 的视频、音频和字幕流完全由自动流选择决定。</p><p>out3.mkv 包含来自色调过滤器的克隆视频输出和来自 B.mp4 的第一个音频流。</p><h2 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h2><p>如果没有另外指定，所有数字选项都接受表示数字的字符串作为输入，其后可以跟 SI 单位前缀之一，例如：’K’、’M’ 或 ‘G’。</p><p>如果将“i”附加到 SI 单位前缀，则完整前缀将被解释为二进制倍数的单位前缀，其基于 1024 的幂而不是 1000 的幂。将“B”附加到 SI 单位前缀将乘以value 为 8。这允许使用，例如：’KB’、’MiB’、’G’ 和 ‘B’ 作为数字后缀。</p><p>不带参数的选项是布尔选项，并将相应的值设置为 true。可以通过在选项名称前加上“no”来将它们设置为 false。例如，使用 <code>-nofoo</code> 会将名称为“foo”的布尔选项设置为false。</p><h3 id="流说明符"><a href="#流说明符" class="headerlink" title="流说明符"></a>流说明符</h3><p>某些选项适用于每个流，例如比特率或编解码器。流说明符用于精确指定给定选项属于哪个流。</p><p>流说明符是一个字符串，通常附加到选项名称并用冒号分隔。例如。 <code>-codec:a:1 ac3</code> 包含 <code>a:1</code> 流说明符，它匹配第二个音频流。因此，它会为第二个音频流选择 ac3 编解码器。</p><p>流说明符可以匹配多个流，因此该选项适用于所有流。例如。 <code>-b:a 128k</code> 中的流说明符匹配所有音频流。</p><p>空流说明符匹配所有流。例如， <code>-codec copy</code> 或 <code>-codec: copy</code> 将复制所有流而无需重新编码。</p><p>流说明符的可能形式是：</p><ul><li><code>stream_index</code><br>将流与此索引匹配。例如。 <code>-threads:1 4</code> 会将第二个流的线程数设置为 4。如果将 <em>stream_index</em> 用作附加流说明符（见下文），则它会从匹配的流中选择流编号 <em>stream_index</em>。流编号基于 libavformat 检测到的流的顺序，除非还指定了程序 ID。在这种情况下，它基于程序中流的顺序。</li><li><code>stream_type[:additional_stream_specifier]</code><br>stream_type 是以下之一：’v’ 或 ‘V’ 表示视频，’a’ 表示音频，’s’ 表示字幕，’d’ 表示数据，’t’ 表示附件。 ‘v’ 匹配所有视频流，’V’ 只匹配没有附加图片、视频缩略图或封面艺术的视频流。如果使用了 <em>additional_stream_specifier</em>，则它匹配具有此类型并匹配 <em>additional_stream_specifier</em> 的流。否则，它匹配指定类型的所有流。</li><li><code>p:program_id[:additional_stream_specifier]</code><br>匹配程序中带有 id <em>program_id</em> 的流。如果使用了 <em>additional_stream_specifier</em>，则它匹配既是程序的一部分又匹配 <em>additional_stream_specifier</em> 的流。</li><li><code>#stream_id or i:stream_id</code><br>通过流 ID 匹配流（例如 MPEG-TS 容器中的 PID）。</li><li><code>m:key[:value]</code><br>匹配具有指定值的元数据标签键的流。如果未给出值，则匹配包含具有任何值的给定标记的流。</li><li><code>u</code><br>将流与可用配置相匹配，必须定义编解码器，并且必须提供视频维度或音频采样率等基本信息。</li></ul><blockquote><p>请注意，在 <code>ffmpeg</code> 中，元数据匹配仅适用于输入文件。</p></blockquote><h3 id="通用选项"><a href="#通用选项" class="headerlink" title="通用选项"></a>通用选项</h3><p>这些选项在 <code>ff*</code> 工具之间共享。</p><ul><li><p><code>-L</code><br>显示许可证。</p></li><li><p><code>-h, -?, -help, --help [arg]</code><br>显示帮助。可以指定一个可选参数来打印有关特定项目的帮助。如果未指定参数，则仅显示基本（非高级）工具选项。</p><p><em>arg</em> 的可能值是：</p><ul><li><code>long</code><br>除基本工具选项外，还打印高级工具选项。</li><li><code>full</code><br>打印完整的选项列表，包括编码器、解码器、解复用器、复用器、过滤器等的共享和私有选项。</li><li><code>decoder=decoder_name</code><br>打印有关名为 <em>decoder_name</em> 的解码器的详细信息。使用 -decoders 选项获取所有解码器的列表。</li><li><code>encoder=encoder_name</code><br>打印有关名为 <em>encoder_name</em> 的编码器的详细信息。使用 -encoders 选项获取所有编码器的列表。</li><li><code>demuxer=demuxer_name</code><br>打印有关名为 <em>demuxer_name</em> 的解复用器的详细信息。使用 -formats 选项获取所有 demuxers 和 muxers 的列表。</li><li><code>muxer=muxer_name</code><br>打印有关名为 <em>muxer_name</em> 的复用器的详细信息。使用 -formats 选项获取所有 demuxers 和 muxers 的列表。</li><li><code>filter=filter_name</code><br>打印有关名为 <em>filter_name</em> 的过滤器的详细信息。使用 -filters 选项获取所有过滤器的列表。</li><li><code>bsf=bitstream_filter_name</code><br>打印有关名为 <em>bitstream_filter_name</em> 的比特流过滤器的详细信息。使用 -bsfs 选项获取所有比特流过滤器的列表。</li><li><code>protocol=protocol_name</code><br>打印有关名为 <em>protocol_name</em> 的协议的详细信息。使用 -protocols 选项获取所有协议的列表。</li></ul></li><li><p><code>-version</code><br>显示版本。</p></li><li><p><code>-buildconf</code><br>显示构建配置，每行一个选项。</p></li><li><p><code>-formats</code><br>显示可用格式（包括设备）。</p></li><li><p><code>-demuxers</code><br>显示可用的解复用器。</p></li><li><p><code>-muxers</code><br>显示可用的复用器。</p></li><li><p><code>-devices</code><br>显示可用设备。</p></li><li><p><code>-codecs</code><br>显示 libavcodec 已知的所有编解码器。</p><blockquote><p>请注意，术语“编解码器”在本文档中用作更准确地称为媒体比特流格式的快捷方式。</p></blockquote></li><li><p><code>-decoders</code><br>显示可用的解码器。</p></li><li><p><code>-encoders</code><br>显示可用的编码器。</p></li><li><p><code>-bsfs</code><br>显示可用的比特流过滤器。</p></li><li><p><code>-protocols</code><br>显示可用的协议。</p></li><li><p><code>-filters</code><br>显示可用的 libavfilter 过滤器。</p></li><li><p><code>-sample_fmts</code><br>显示可用的样本格式。</p></li><li><p><code>-layouts</code><br>显示频道名称和标准频道布局。</p></li><li><p><code>-colors</code><br>显示识别的颜色名称。</p></li><li><p><code>-sources device[,opt1=val1[,opt2=val2]...]</code><br>显示输入设备的自动检测源。某些设备可能提供无法自动检测的系统相关源名称。不能假定返回的列表总是完整的。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -sources pulse,server<span class="token operator">=</span><span class="token number">192.168</span>.0.4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>-sinks device[,opt1=val1[,opt2=val2]...]</code><br>显示输出设备的自动检测接收器。某些设备可能提供无法自动检测的系统相关接收器名称。不能假定返回的列表总是完整的。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -sinks pulse,server<span class="token operator">=</span><span class="token number">192.168</span>.0.4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>-loglevel [flags+]loglevel | -v [flags+]loglevel</code><br>设置库使用的日志记录级别和标志。</p><ul><li><p>可选的 <em>flags</em> 前缀可以由以下值组成：</p><p><code>repeat</code><br>表示不应该将重复的日志输出压缩到第一行，并且将省略“最后一条消息重复 n 次”这一行。<br><code>level</code><br>指示日志输出应为每个消息行添加 <code>[level]</code> 前缀。这可以用作原木着色的替代方法，例如将日志转储到文件时。</p><p>也可以通过添加 ‘+’/‘-‘ 前缀来单独使用标志来设置/重置单个标志，而不会影响其他 <em>flags</em> 或更改 <em>loglevel</em>。当同时设置 <em>flags</em> 和 <em>loglevel</em> 时，最后一个 <em>flags</em> 值和 <em>loglevel</em> 之前应该有一个’+’分隔符。</p></li><li><p><em>loglevel</em> 是包含以下值之一的字符串或数字：  </p><p><code>quiet, -8</code><br>什么都不显示；安静。<br><code>panic, 0</code><br>只显示可能导致进程崩溃的致命错误，例如断言失败。这目前不用于任何事情。<br><code>fatal, 8</code><br>只显示致命错误。这些是过程绝对无法继续的错误。<br><code>error, 16</code><br>显示所有错误，包括可以从中恢复的错误。<br><code>warning, 24</code><br>显示所有警告和错误。将显示与可能不正确或意外事件相关的任何消息。<br><code>info, 32</code><br>在处理过程中显示信息性消息。这是警告和错误的补充。这是默认值。<br><code>verbose, 40</code><br>与 <code>info</code> 相同，但更详细。<br><code>debug, 48</code><br>显示所有内容，包括调试信息。<br><code>trace, 56</code></p><p>例如启用重复日志输出，添加 <code>level</code> 前缀，并将 <em>loglevel</em> 设置为 <code>verbose</code>：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -loglevel repeat+level+verbose -i input output<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>启用重复日志输出而不影响 <code>level</code> 前缀标志或 <em>loglevel</em> 的当前状态的另一个示例：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg <span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> -loglevel +repeat<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>默认情况下，程序会记录到 stderr。如果终端支持着色，则使用颜色来标记错误和警告。可以通过设置环境变量 <code>AV_LOG_FORCE_NOCOLOR</code> 禁用日志着色，也可以强制设置环境变量 <code>AV_LOG_FORCE_COLOR</code>。</p></li></ul></li><li><p><code>-report</code><br>将完整的命令行和日志输出转储到当前目录中名为 <code>program-YYYYMMDD-HHMMSS.log</code> 的文件中。此文件可用于错误报告。它还意味着 <code>-loglevel debug</code>。</p><p>将环境变量 <code>FFREPORT</code> 设置为任何值具有相同的效果。如果值为‘:’分隔的 key=value 序列，这些选项将影响报告；如果选项值包含特殊字符或选项分隔符 ‘:’，则必须对其进行转义（请参阅 ffmpeg-utils 手册中的<a href="">“引用和转义”</a>部分）。</p><p>识别以下选项：</p><p><code>file</code><br>设置用于报告的文件名； <code>%p</code> 扩展为程序名称，<code>%t</code> 扩展为时间戳，<code>%%</code> 扩展为纯 <code>%</code><br><code>level</code><br>使用数值设置日志详细级别（请参阅 <code>-loglevel</code>）。</p><p>例如，要使用日志级别 <code>32</code>（日志级别 <code>info</code> 的别名）将报告输出到名为 ffreport.log 的文件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">FFREPORT</span><span class="token operator">=</span>file<span class="token operator">=</span>ffreport.log:level<span class="token operator">=</span><span class="token number">32</span> ffmpeg -i input output<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>解析环境变量的错误不是致命的，不会出现在报告中。</p></li><li><p><code>-hide_banner</code><br>禁止打印横幅。<br>所有 FFmpeg 工具通常都会显示版权声明、构建选项和库版本。此选项可用于禁止打印此信息。</p></li><li><p><code>-cpuflags flags (global)</code><br>允许设置和清除 CPU 标志。此选项用于测试。除非您知道自己在做什么，否则不要使用它。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -cpuflags -sse+mmx <span class="token punctuation">..</span>.ffmpeg -cpuflags mmx <span class="token punctuation">..</span>.ffmpeg -cpuflags <span class="token number">0</span> <span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>此选项的可选 flags 如下：</p><table><thead><tr><th>Processors</th><th>flags</th></tr></thead><tbody><tr><td>x86</td><td><code>mmx</code>, <code>mmxext</code>, <code>sse</code>, <code>sse2</code>, <code>sse2slow</code>, <code>sse3</code>, <code>sse3slow</code>, <code>ssse3</code>, <code>atom</code>, <code>sse.1</code>, <code>sse.2</code>, <code>avx</code>, <code>avx2</code>, <code>xop</code>, <code>fma3</code>, <code>fma4</code>, <code>3dnow</code>, <code>3dnowext</code>, <code>bmi1</code>, <code>bmi2</code>, <code>cmov</code></td></tr><tr><td>ARM</td><td><code>armv5te</code>,<code>armv6</code>,<code>armv6t2</code>,<code>vfp</code>,<code>vfpv3</code>,<code>neon</code>,<code>setend</code></td></tr><tr><td>AArch64</td><td><code>armv8</code>,<code>vfp</code>,<code>neon</code></td></tr><tr><td>PowerPC</td><td><code>altivec</code></td></tr><tr><td>Specific Processors</td><td><code>pentium2</code>,<code>pentium3</code>,<code>pentium4</code>,<code>k6</code>,<code>k62</code>,<code>athlon</code>,<code>athlonxp</code>,<code>k8</code></td></tr></tbody></table></li><li><p><code>-cpucount count (global)</code><br>覆盖 CPU 计数检测。此选项用于测试。除非您知道自己在做什么，否则不要使用它。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -cpucount <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>-max_alloc bytes</code><br>通过 ffmpeg 的 malloc 函数系列设置在堆上分配块的最大大小限制。使用此选项时要格外小心。如果您不了解这样做的全部后果，请不要使用。默认值为 INT_MAX。</p></li></ul><h3 id="AV选项"><a href="#AV选项" class="headerlink" title="AV选项"></a>AV选项</h3><p>这些选项由 libavformat、libavdevice 和 libavcodec 库直接提供。要查看可用 AVOptions 的列表，请使用 <code>-help</code> 选项。它们分为两类：</p><ul><li><code>generic</code><br>可以为任何容器、编解码器或设备设置这些选项。通用选项列在容器/设备的 AVFormatContext 选项下和编解码器的 AVCodecContext 选项下。</li><li><code>private</code><br>这些选项特定于给定的容器、设备或编解码器。私有选项列在其相应的容器/设备/编解码器下。</li></ul><p>例如，要将 ID3v2.3 标头而不是默认 ID3v2.4 写入 MP3 文件，请使用 MP3 复用器的 id3v2_version 私有选项：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i input.flac -id3v2_version <span class="token number">3</span> out.mp3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>所有编解码器 AVOptions 都是每个流，因此应该附加一个流说明符：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i multichannel.mxf -map <span class="token number">0</span>:v:0 -map <span class="token number">0</span>:a:0 -map <span class="token number">0</span>:a:0 -c:a:0 ac3 -b:a:0 640k -ac:a:1 <span class="token number">2</span> -c:a:1 aac -b:2 128k out.mp4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在上面的示例中，多声道音频流被映射两次以进行输出。第一个实例使用编解码器 ac3 和比特率 640k 进行编码。第二个实例被缩混为 2 个通道并使用编解码器 aac 进行编码。使用输出流的绝对索引为其指定了 128k 的比特率。</p><blockquote><p>注意：-nooption 语法不能用于布尔型 AVOptions，请使用 -option 0/-option 1。<br>注意：通过在选项名称前面加上 v/a/s 来指定每个流 AVOptions 的旧的未记录方式现在已过时，将很快被删除。</p></blockquote><h3 id="主要选项"><a href="#主要选项" class="headerlink" title="主要选项"></a>主要选项</h3><ul><li><p><code>-f fmt (input/output)</code><br>强制输入或输出文件格式。通常会自动检测输入文件的格式，并根据输出文件的文件扩展名猜测格式，因此在大多数情况下不需要此选项。</p></li><li><p><code>-i url (input)</code><br>输入文件地址</p></li><li><p><code>-y (global)</code><br>无需询问即可覆盖输出文件。</p></li><li><p><code>-n (global)</code><br>不要覆盖输出文件，如果指定的输出文件已经存在，则立即退出。</p></li><li><p><code>-stream_loop number (input)</code><br>设置输入流应循环的次数。循环 0 表示不循环，循环 -1 表示无限循环。</p></li><li><p><code>-recast_media (global)</code><br>允许强制使用与解复用器检测到或指定的媒体类型不同的媒体类型的解码器。用于解码混合为数据流的媒体数据。</p></li><li><p><code>-c[:stream_specifier] codec (input/output,per-stream)</code><br><code>-codec[:stream_specifier] codec (input/output,per-stream)</code><br>为一个或多个流选择编码器（在输出文件之前使用时）或解码器（在输入文件之前使用时）。<code>codec</code> 是解码器/编码器或特殊值 <code>copy</code>（仅输出）的名称，以指示不重新编码流。<br>例如:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i INPUT -map <span class="token number">0</span> -c:v libx264 -c:a copy OUTPUT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>使用 libx264 编码所有视频流并复制所有音频流。</p><p>对于每个流，应用最后一个匹配的 <code>c</code> 选项，所以</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i INPUT -map <span class="token number">0</span> -c copy -c:v:1 libx264 -c:a:137 libvorbis OUTPUT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将复制除第二个视频（将使用 libx264 编码）和第 138 个音频（将使用 libvorbis 编码）之外的所有流。</p></li><li><p><code>-t duration (input/output)</code><br>当用作输入选项时（在 -i 之前），限制从输入文件读取数据的持续时间。</p><p>当用作输出选项时（在输出 url 之前），在其持续时间达到持续时间后停止写入输出。</p><p><em>duration</em> 必须是持续时间规范，请参阅 <a href="https://ffmpeg.org/ffmpeg-utils.html#time-duration-syntax">(ffmpeg-utils) ffmpeg-utils(1) 手册中的持续时间部分</a>。</p><p>-to 和 -t 是互斥的，-t 有优先权。</p></li><li><p><code>-to position (input/output)</code><br>停止在位置写入输出或读取输入。<code>position</code> 必须是持续时间规范，请参阅 <a href="https://ffmpeg.org/ffmpeg-utils.html#time-duration-syntax">(ffmpeg-utils) ffmpeg-utils(1) 手册中的持续时间部分</a>。</p><p>-to 和 -t 是互斥的，-t 有优先权。</p></li><li><p><code>-fs limit_size (output)</code><br>设置文件大小限制，以字节为单位。超出限制后不会再写入更多的字节块。输出文件的大小略大于请求的文件大小。</p></li><li><p><code>-ss position (input/output)</code><br>当用作输入选项（在 <code>-i</code> 之前）时，在此输入文件中寻找 <em>position</em>。请注意，在大多数格式中，不可能精确查找，因此 <code>ffmpeg</code> 将查找 <em>position</em> 之前最近的查找点。当转码和 <code>-accurate_seek</code> 启用（默认）时，搜索点和 <em>position</em> 之间的这个额外段将被解码并丢弃。在进行流复制或使用 <code>-noaccurate_seek</code> 时，它将被保留。</p><p>当用作输出选项时（在输出 url 之前），解码但丢弃输入，直到时间戳到达 <em>position</em> 。</p></li><li><p><code>-sseof position (input)</code><br>类似于 <code>-ss</code> 选项，但相对于“文件结尾”。即负值在文件中较早，0 位于 EOF。</p></li><li><p><code>-itsoffset offset (input)</code><br>设置输入时间偏移。</p><p>偏移量被添加到输入文件的时间戳中。指定正偏移量意味着相应的流被延迟了 <em>offset</em> 中指定的持续时间。</p></li><li><p><code>-itsscale scale (input,per-stream)</code><br>重新调整输入时间戳。 <em>scale</em> 应该是一个浮点数。</p></li><li><p><code>-timestamp date (output)</code><br>在容器中设置录制时间戳。</p><p><em>date</em> 必须是日期规范，请参阅 <a href="https://ffmpeg.org/ffmpeg-utils.html#date-syntax">(ffmpeg-utils) ffmpeg-utils(1) 手册中的日期部分</a>。</p></li><li><p><code>-metadata[:metadata_specifier] key=value (output,per-metadata)</code><br>设置元数据键/值对。</p><p>可以给出可选的 <em>metadata_specifier</em> 来设置流、章节或节目的元数据。有关详细信息，请参阅 <code>-map_metadata</code> 文档。</p><p>此选项会覆盖使用 <code>-map_metadata</code> 设置的元数据。也可以使用空值删除元数据。</p><p>例如，在输出文件中设置标题：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i in.avi -metadata <span class="token assign-left variable">title</span><span class="token operator">=</span><span class="token string">"my title"</span> out.flv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>设置第一个音频流的语言：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i INPUT -metadata:s:a:0 <span class="token assign-left variable">language</span><span class="token operator">=</span>eng OUTPUT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>-disposition[:stream_specifier] value (output,per-stream)</code><br>设置流的处置。</p><p>此选项会覆盖从输入流复制的处置。也可以通过将其设置为 0 来删除处置。</p><p>下面的处置是被允许的：</p><p><code>default</code>, <code>dub</code>, <code>original</code>, <code>comment</code>, <code>lyrics</code>, <code>karaoke</code>, <code>forced</code>, <code>hearing_impaired</code>, <code>visual_impaired</code>, <code>clean_effects</code>, <code>attached_pic</code>, <code>captions</code>, <code>descriptions</code>, <code>dependent</code>, <code>metadata</code></p><p>例如，要使第二个音频流成为默认流：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i in.mkv -c copy -disposition:a:1 default out.mkv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>要使第二个字幕流成为默认流并从第一个字幕流中删除默认配置：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i in.mkv -c copy -disposition:s:0 <span class="token number">0</span> -disposition:s:1 default out.mkv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>要添加嵌入式封面/缩略图：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i in.mp4 -i IMAGE -map <span class="token number">0</span> -map <span class="token number">1</span> -c copy -c:v:1 png -disposition:v:1 attached_pic out.mp4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>并非所有复用器都支持嵌入式缩略图，支持的多路复用器仅支持几种格式，例如 JPEG 或 PNG。</p></li><li><p><code>-program [title=title:][program_num=program_num:]st=stream[:st=stream...] (output)</code><br>创建具有指定标题 program_num 的程序并将指定的流添加到其中。</p></li><li><p><code>-target type (output)</code><br>指定目标文件类型（<code>vcd</code>、<code>svcd</code>、<code>dvd</code>、<code>dv</code>、<code>dv50</code>）。 type 可以以 <code>pal-</code>、<code>ntsc-</code> 或 <code>film-</code> 为前缀以使用相应的标准。然后自动设置所有格式选项（比特率、编解码器、缓冲区大小）。您只需键入：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i myfile.avi -target vcd /tmp/vcd.mpg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>不过，您可以指定其他选项，只要您知道它们与标准不冲突，例如：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i myfile.avi -target vcd -bf <span class="token number">2</span> /tmp/vcd.mpg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>-dn (input/output)</code><br>作为输入选项，阻止文件的所有数据流被过滤或自动选择或映射用于任何输出。请参阅 <code>-discard</code> 选项以单独禁用流。</p><p>作为输出选项，禁用数据记录，即任何数据流的自动选择或映射。如需完全手动控制，请参阅 <code>-map</code> 选项。</p></li><li><p><code>-dframes number (output)</code><br>设置要输出的数据帧数。这是 <code>-frames:d</code> 的过时别名，您应该改用它。</p></li><li><p><code>-frames[:stream_specifier] framecount (output,per-stream)</code><br>在帧计数帧后停止写入流。</p></li><li><p><code>-q[:stream_specifier] q (output,per-stream)</code><br><code>-qscale[:stream_specifier] q (output,per-stream)</code><br>使用固定质量标度 (VBR)。 q/qscale 的含义取决于编解码器。如果在没有 stream_specifier 的情况下使用 qscale，则它仅适用于视频流，这是为了保持与先前行为的兼容性，并且因为为音频和视频的 2 个不同编解码器指定相同的编解码器特定值通常不是没有 stream_specifier 时的预期目的用来。</p></li><li><p><code>-filter[:stream_specifier] filtergraph (output,per-stream)</code><br>创建由 filtergraph 指定的 filtergraph 并使用它来过滤流。</p><p><em>filtergraph</em> 是对应用于流的 filtergraph 的描述，并且必须具有相同类型的流的单个输入和单个输出。在过滤器图中，输入与标签 <code>in</code> 相关联，输出与标签 <code>out</code> 相关联。有关 filtergraph 语法的更多信息，请参阅 ffmpeg-filters 手册。</p><p>如果要创建具有多个输入和/或输出的过滤器图，请参阅 <a href="https://ffmpeg.org/ffmpeg.html#filter_005fcomplex_005foption"><code>-filter_complex</code></a> 选项。</p></li><li><p><code>-filter_script[:stream_specifier] filename (output,per-stream)</code><br>此选项与 -filter 类似，唯一的区别是它的参数是要从中读取 filtergraph 描述的文件的名称。</p></li><li><p><code>-reinit_filter[:stream_specifier] integer (input,per-stream)</code><br>此布尔选项确定当输入帧参数在中途更改时，此流所馈送的过滤器图是否重新初始化。默认情况下启用此选项，因为大多数视频和所有音频过滤器都无法处理输入帧属性中的偏差。重新初始化后，现有的过滤器状态将丢失，例如某些过滤器中可用的帧数 <code>n</code> 参考。重新初始化时缓冲的任何帧都将丢失。对于视频，更改触发重新初始化的属性是帧分辨率或像素格式；用于音频、样本格式、采样率、通道数或通道布局。</p></li><li><p><code>-filter_threads nb_threads (global)</code><br>定义用于处理过滤器管道的线程数。每个管道将生成一个线程池，其中包含许多可用于并行处理的线程。默认值为可用 CPU 的数量。</p></li><li><p><code>-pre[:stream_specifier] preset_name (output,per-stream)</code><br>指定匹配流的预设。</p></li><li><p><code>-stats (global)</code><br>打印编码进度/统计信息。默认情况下它是打开的，要明确禁用它，您需要指定 <code>-nostats</code>。</p></li><li><p><code>-stats_period time (global)</code><br>设置更新编码进度/统计信息的时间段。默认值为 0.5 秒。</p></li><li><p><code>-progress url (global)</code><br>将程序友好的进度信息发送到 url。</p><p>进度信息会定期写入并在编码过程结束时写入。它由“key=value”行组成。键仅由字母数字字符组成。进度信息序列的最后一个键始终是“进度”。</p><p>使用 <code>-stats_period</code> 设置更新周期。</p></li><li><p><code>-stdin</code><br>在标准输入上启用交互。默认情况下打开，除非使用标准输入作为输入。要显式禁用交互，您需要指定 <code>-nostdin</code>。</p><p>禁用标准输入上的交互很有用，例如，如果 ffmpeg 在后台进程组中。使用 <code>ffmpeg ... &lt; /dev/null</code> 可以实现大致相同的结果，但它需要一个 shell。</p></li><li><p><code>-debug_ts (global)</code><br>打印时间戳信息。默认情况下它是关闭的。此选项主要用于测试和调试目的，输出格式可能会从一个版本更改为另一个版本，因此不应由可移植脚本使用。</p></li><li><p><code>-attach filename (output)</code><br>将附件添加到输出文件。这得到了一些格式的支持，比如 Matroska，例如用于渲染字幕的字体。附件作为特定类型的流实现，因此此选项将向文件添加新流。然后可以以通常的方式在此流上使用每个流选项。使用此选项创建的附件流将在所有其他流（即使用 <code>-map</code> 或自动映射创建的流）之后创建。</p><blockquote><p>请注意，对于 Matroska，您还必须设置 mimetype 元数据标签：</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 假设附件流将是输出文件中的第三个。</span>ffmpeg -i INPUT -attach DejaVuSans.ttf -metadata:s:2 <span class="token assign-left variable">mimetype</span><span class="token operator">=</span>application/x-truetype-font out.mkv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>-dump_attachment[:stream_specifier] filename (input,per-stream)</code><br>将匹配的附件流提取到名为 <code>filename</code> 的文件中。如果文件名为空，则将使用文件名元数据标签的值。</p><p>例如。将第一个附件提取到名为“out.ttf”的文件中：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -dump_attachment:t:0 out.ttf -i INPUT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>提取由 <code>filename</code> 标签确定的文件的所有附件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -dump_attachment:t <span class="token string">""</span> -i INPUT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>技术说明 - 附件作为编解码器额外数据实现，因此此选项实际上可用于从任何流中提取额外数据，而不仅仅是附件。</p></blockquote></li></ul><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><h3 id="视频和音频抓取"><a href="#视频和音频抓取" class="headerlink" title="视频和音频抓取"></a>视频和音频抓取</h3><p>如果指定输入格式和设备，则 ffmpeg 可以直接抓取视频和音频。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -f oss -i /dev/dsp -f video4linux2 -i /dev/video0 /tmp/out.mpg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或者使用 ALSA 音频源（单声道输入，卡 ID 1）而不是 OSS：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -f alsa -ac <span class="token number">1</span> -i hw:1 -f video4linux2 -i /dev/video0 /tmp/out.mpg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>请注意，在使用任何电视查看器（例如 Gerd Knorr 的 xawtv）启动 ffmpeg 之前，您必须激活正确的视频源和频道。您还必须使用标准混音器正确设置录音电平。</p></blockquote><h3 id="视频和音频文件格式转换"><a href="#视频和音频文件格式转换" class="headerlink" title="视频和音频文件格式转换"></a>视频和音频文件格式转换</h3><p>任何支持的文件格式和协议都可以作为 ffmpeg 的输入：</p><ul><li><p>您可以使用 YUV 文件作为输入:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i /tmp/test%d.Y /tmp/out.mpg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>它将使用以下文件：</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">&#x2F;tmp&#x2F;test0.Y, &#x2F;tmp&#x2F;test0.U, &#x2F;tmp&#x2F;test0.V,&#x2F;tmp&#x2F;test1.Y, &#x2F;tmp&#x2F;test1.U, &#x2F;tmp&#x2F;test1.V, etc...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Y 文件使用两倍于 U 和 V 文件的分辨率。它们是原始文件，没有标题。它们可以由所有体面的视频解码器生成。如果 ffmpeg 无法猜测，您必须使用 -s 选项指定图像的大小。</p></li><li><p>您可以从原始 YUV420P 文件输入:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i /tmp/test.yuv /tmp/out.avi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>test.yuv 是一个包含原始 YUV 平面数据的文件。每帧由 Y 平面和 U 平面和 V 平面组成，垂直和水平分辨率的一半。</p></li><li><p>您可以输出到原始 YUV420P 文件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i mydivx.avi hugefile.yuv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>可以设置多个输入文件和输出文件:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 将音频文件 a.wav 和原始 YUV 视频文件 a.yuv 转换为 MPEG 文件 a.mpg。</span>ffmpeg -i /tmp/a.wav -s 640x480 -i /tmp/a.yuv /tmp/a.mpg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>您还可以同时进行音频和视频转换:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 以 22050 Hz 采样率将 a.wav 转换为 MPEG 音频。</span>ffmpeg -i /tmp/a.wav -ar <span class="token number">22050</span> /tmp/a.mp2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>您可以同时编码为多种格式并定义从输入流到输出流的映射:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 将 a.wav 转换为 64 kbits 的 a.mp2 和 128 kbits 的 b.mp2。</span>ffmpeg -i /tmp/a.wav -map <span class="token number">0</span>:a -b:a 64k /tmp/a.mp2 -map <span class="token number">0</span>:a -b:a 128k /tmp/b.mp2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p> ‘-map file:index’ 按照输出流定义的顺序指定每个输出流使用哪个输入流。</p></li><li><p>您可以对解密的 VOB 进行转码：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i snatch_1.vob -f avi -c:v mpeg4 -b:v 800k -g <span class="token number">300</span> -bf <span class="token number">2</span> -c:a libmp3lame -b:a 128k snatch.avi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这是一个典型的 DVD 翻录示例；输入是一个 VOB 文件，输出一个带有 MPEG-4 视频和 MP3 音频的 AVI 文件。请注意，在此命令中，我们使用 B 帧，因此 MPEG-4 流与 DivX5 兼容，GOP 大小为 300，这意味着对于 29.97fps 输入视频，每 10 秒有一个内帧。此外，音频流是 MP3 编码的，因此您需要通过传递 <code>--enable-libmp3lame</code> 进行配置来启用 LAME 支持。该映射对于 DVD 转码以获得所需的音频语言特别有用。</p><blockquote><p>注意：要查看支持的输入格式，请使用 ffmpeg -demuxers。</p></blockquote></li><li><p>您可以从视频中提取图像，或从多个图像创建视频：</p><ul><li>从视频中提取图像：</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i foo.avi -r <span class="token number">1</span> -s WxH -f image2 foo-%03d.jpeg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这将每秒从视频中提取一个视频帧，并将它们输出到名为 foo-001.jpeg、foo-002.jpeg 等的文件中。图像将被重新缩放以适应新的 WxH 值。</p><p>如果您只想提取有限数量的帧，可以将上述命令与 <code>-frames:v</code> 或 <code>-t</code> 选项结合使用，或者与 <code>-ss</code> 结合使用，以从某个时间点开始提取。</p><ul><li>从多个图像创建视频：</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -f image2 -framerate <span class="token number">12</span> -i foo-%03d.jpeg -s WxH foo.avi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>语法 <code>foo-%03d.jpeg</code> 指定使用由三个数字填充零组成的十进制数来表示序列号。它与 C printf 函数支持的语法相同，但只有接受普通整数的格式才是合适的。</p><p>导入图像序列时，-i 还支持通过选择特定于 image2 的 <code>-pattern_type glob</code> 选项在内部扩展类似 shell 的通配符模式（通配符）。</p><p>例如，从匹配 glob 模式 foo-*.jpeg 的文件名创建视频：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -f image2 -pattern_type glob -framerate <span class="token number">12</span> -i <span class="token string">'foo-*.jpeg'</span> -s WxH foo.avi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>您可以在输出中放置许多相同类型的流:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i test1.avi -i test2.avi -map <span class="token number">1</span>:1 -map <span class="token number">1</span>:0 -map <span class="token number">0</span>:1 -map <span class="token number">0</span>:0 -c copy -y test12.nut<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>生成的输出文件 test12.nut 将以相反的顺序包含来自输​​入文件的前四个流。</p></li><li><p>强制 CBR 视频输出：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i myfile.avi -b 4000k -minrate 4000k -maxrate 4000k -bufsize 1835k out.m2v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>四个选项 lmin、lmax、mblmin 和 mblmax 使用 ‘lambda’ 单位，但您可以使用 QP2LAMBDA 常数轻松地从 ‘q’ 单位转换：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ffmpeg -i src.ext -lmax <span class="token number">21</span>*QP2LAMBDA dst.ext<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> 音视频 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ffmpeg </tag>
            
            <tag> video </tag>
            
            <tag> audio </tag>
            
            <tag> translate </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql 的 upsert 操作</title>
      <link href="database/mysql/upsert-f2f8bfbaba7a/"/>
      <url>database/mysql/upsert-f2f8bfbaba7a/</url>
      
        <content type="html"><![CDATA[<p>当我们在使用 Mysql 时，经常会有 <code>upsert</code> 这样的需求：插入一行唯一数据时，若该行数据已存在，则更新该行内容，不存在则插入新的一行。但是 Mysql 没有 MongoDB 中 <code>upsert</code> 这样的函数可以直接实现，一般来说会先用 <code>Count(*)</code> 查找是否存在该行，然后根据结果执行不通的操作，这样操作就有些繁琐了。<br>我想着 Mysql 应该会有对这样的操作进行优化的方法，抱着这一猜想，我查看了官方文档，确实发现有两个函数可以实现这样的功能，下面我们一起来看下:v:。</p><h2 id="使用-REPLACE"><a href="#使用-REPLACE" class="headerlink" title="使用 REPLACE"></a>使用 REPLACE</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p>替换语句语法：</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">REPLACE</span> <span class="token keyword">INTO</span> tab_name <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>val<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>该语句在一般情况下和 <code>INSERT</code> 语句的功能类似，插入一行新数据，当遇到主键或唯一索引冲突时，会删除旧行插入新行，实现替换的目的</p><p>我们以会员表为例来说明</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>member<span class="token punctuation">`</span> <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>sex<span class="token punctuation">`</span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="更新数据包含主键"><a href="#更新数据包含主键" class="headerlink" title="更新数据包含主键"></a>更新数据包含主键</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 插入一条数据</span>mysql<span class="token operator">></span> <span class="token keyword">REPLACE</span> <span class="token keyword">INTO</span> member <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"alice"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span class="token comment">-- 修改第一条数据的 sex 字段</span>mysql<span class="token operator">></span> mysql<span class="token operator">></span> <span class="token keyword">REPLACE</span> <span class="token keyword">INTO</span> member <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"alice"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span class="token comment">-- 数据库仅有一条数据，替换成功了</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> member<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+-------+------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name  <span class="token operator">|</span> sex  <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------+------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> alice <span class="token operator">|</span>    <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------+------+</span><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当更新的数据包含主键时，更新同一条数据会发生冲突，从而发生替换。而且，根据返回的影响行数(raws)，我们也可以知道发生了什么操作，当 <code>raws=1</code> 时，执行了插入操作，当 <code>raws&gt;1</code> 时，执行了替换的操作，为什么是大于1呢，<code>REPLACE</code> 的 <code>raws</code> 包含删除行数和插入行数，当存在多个唯一索引时，替换会删除多行旧数据，插入一行，因此有时会大于1。</p><h3 id="更新数据不包含主键"><a href="#更新数据不包含主键" class="headerlink" title="更新数据不包含主键"></a>更新数据不包含主键</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">REPLACE</span> <span class="token keyword">INTO</span> member <span class="token punctuation">(</span>name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">"brain"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">REPLACE</span> <span class="token keyword">INTO</span> member <span class="token punctuation">(</span>name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">"brain"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> member<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+-------+------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name  <span class="token operator">|</span> sex  <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------+------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> alice <span class="token operator">|</span>    <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> brain <span class="token operator">|</span>    <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> brain <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------+------+</span><span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当更新数据不包含主键，也没有索引时，仅会发生插入动作。下面我们来看表中存在唯一索引的情况。</p><h3 id="更新包含唯一索引"><a href="#更新包含唯一索引" class="headerlink" title="更新包含唯一索引"></a>更新包含唯一索引</h3><p>将第三条记录删除，并且给 <code>name</code> 添加索引</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>test<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>member<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>test<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>member<span class="token punctuation">`</span> <span class="token keyword">ADD</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span><span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>现在更新 <code>ciri</code> 的信息</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">REPLACE</span> <span class="token keyword">INTO</span> member <span class="token punctuation">(</span>name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">"ciri"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">REPLACE</span> <span class="token keyword">INTO</span> member <span class="token punctuation">(</span>name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">"ciri"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> member<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+-------+------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name  <span class="token operator">|</span> sex  <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------+------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> alice <span class="token operator">|</span>    <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> brain <span class="token operator">|</span>    <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> ciri  <span class="token operator">|</span>    <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------+------+</span><span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>根据影响行数，我们发现第一次更新时插入了新行，第二次更新发生了替换，但是相应的 <code>id</code> 也自增了，从 <code>4</code> 变成 <code>5</code>，因为我们没有指定 <code>id</code>，替换操作删除了旧行，插入了新行。因此，:exclamation:我们<strong>使用 <code>REPLACE</code> 语句时，必须保证表中有主键或是唯一索引，若 <code>id</code> 为自增时，更新数据必须包含 <code>id</code></strong>, 否则查询数据将会返回错误结果。</p><p>更多信息请阅读<a href="https://dev.mysql.com/doc/refman/5.7/en/replace.html">官方文档</a>，下面我们来看第二种方法</p><h2 id="使用-ON-DUPLICATE-KEY-UPDATE"><a href="#使用-ON-DUPLICATE-KEY-UPDATE" class="headerlink" title="使用 ON DUPLICATE KEY UPDATE"></a>使用 ON DUPLICATE KEY UPDATE</h2><p>以上面的会员表结构为例，该语句会先执行 <code>INSERT</code> 操作，若 <code>INSERT</code> 成功，则后面的 <code>UPDATE</code> 语句会被忽略，若插入时发生主键或唯一索引冲突，则执行 <code>UPDATE</code> 操作</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> member <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'alice'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">ON</span> <span class="token keyword">DUPLICATE</span> <span class="token keyword">KEY</span> <span class="token keyword">UPDATE</span> sex<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">-- same as: </span><span class="token keyword">UPDATE</span> member <span class="token keyword">SET</span> sex<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>使用 <code>ON DUPLICATE KEY UPDATE</code>时，影响行数会有如下几种情况：</p><ul><li><code>raws=0</code>：没有更新数据，</li><li><code>raws=1</code>：将 <code>VALUES</code> 数据插入了新行</li><li><code>raws=2</code>：更新了当前行的数据为 <code>UPDATE</code> 后面的内容</li></ul><p>若要更新多个字段，则用 <code>,</code> 拼接多个列赋值语句</p><p>该语句和 <code>REPLACE</code> 的条件一样，执行操作的表必须有主键或者唯一索引，且 <code>VALUES</code> 中要包含对应列</p><p>该语句比 <code>REPLACE</code> 好的一点是不会删除旧行，仅仅会进行更新和插入操作，因此可以避免误删除造成的数据不完整</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> member <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'ciri'</span> <span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>       <span class="token operator">-</span><span class="token operator">></span>   <span class="token keyword">ON</span> <span class="token keyword">DUPLICATE</span> <span class="token keyword">KEY</span> <span class="token keyword">UPDATE</span> sex<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'chris'</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> member<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+-------+------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name  <span class="token operator">|</span> sex  <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------+------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> alice <span class="token operator">|</span>    <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> brain <span class="token operator">|</span>    <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> chris <span class="token operator">|</span>    <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+-------+------+</span><span class="token number">3</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>想了解更多信息请阅读<a href="https://dev.mysql.com/doc/refman/5.7/en/insert-on-duplicate.html">官方文档</a></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>当我们需要 <code>upsert</code> 操作时，且当前表中有主键或唯一索引，我们就可以使用 <code>REPLACE</code> 和 <code>ON DUPLICATE KEY UPDATE</code> 语句来进行更新或插入不确定是否存在的记录，但是建议使用 <code>ON DUPLICATE KEY UPDATE</code> 语句，可以避免误删除导致的悲剧，特别注意：<strong>自增列必须包含在语句中</strong>。</p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> replace </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在 MySQL 中管理层级结构</title>
      <link href="database/mysql/catalog-in-mysql-ca9ab232a3bd/"/>
      <url>database/mysql/catalog-in-mysql-ca9ab232a3bd/</url>
      
        <content type="html"><![CDATA[<p>层级目录是很常见的展示分类数据的方式，但是在关系型数据库(例如 MySQL )中存储并不能很好的处理这种层级很多父子关系。</p><ul><li>当层数固定且较少（2-3层）时，可以使用一对多关系表来表示数据之间的关系；  </li><li>当层数较多，或者不固定，可随意增减时，关系表就不适用了，我们不可能在需要创建下级的时候新建一张表，这样数据库管理就很麻烦了。</li></ul><p>一个常见的书籍分类如下图所示：</p><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iMzU5cHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo2NTdweDtoZWlnaHQ6MzU5cHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNjU3IDM1OSIgd2lkdGg9IjY1N3B4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcz48ZmlsdGVyIGhlaWdodD0iMzAwJSIgaWQ9ImZyYW45azJ4dXU1dCIgd2lkdGg9IjMwMCUiIHg9Ii0xIiB5PSItMSI+PGZlR2F1c3NpYW5CbHVyIHJlc3VsdD0iYmx1ck91dCIgc3RkRGV2aWF0aW9uPSIyLjAiLz48ZmVDb2xvck1hdHJpeCBpbj0iYmx1ck91dCIgcmVzdWx0PSJibHVyT3V0MiIgdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIC40IDAiLz48ZmVPZmZzZXQgZHg9IjQuMCIgZHk9IjQuMCIgaW49ImJsdXJPdXQyIiByZXN1bHQ9ImJsdXJPdXQzIi8+PGZlQmxlbmQgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iYmx1ck91dDMiIG1vZGU9Im5vcm1hbCIvPjwvZmlsdGVyPjwvZGVmcz48Zz48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZnJhbjlrMnh1dTV0KSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjY0IiB4PSIxMCIgeT0iMTYwLjc0MjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NCIgeD0iMjAiIHk9IjE4My43MzczIj5ib29rczwvdGV4dD48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZnJhbjlrMnh1dTV0KSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE1NSIgeD0iMTI0IiB5PSIxNjAuNzQyMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzMSIgeD0iMTM0IiB5PSIxODMuNzM3MyI+Y29tcHV0ZXIgU2NpZW5jZTwvdGV4dD48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZnJhbjlrMnh1dTV0KSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE0NyIgeD0iMzI5IiB5PSI3Ni4yOTY5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI3IiB4PSIzMzkiIHk9Ijk5LjI5MiI+b3BlcmF0aW5nIHN5c3RlbTwvdGV4dD48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZnJhbjlrMnh1dTV0KSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjUwIiB4PSI1MjYiIHk9IjIwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzAiIHg9IjUzNiIgeT0iNDIuOTk1MSI+VW5peDwvdGV4dD48cGF0aCBkPSJNNDc2LDk0LjQ0NTMgTDQ4Niw5NC40NDUzIEM1MDEsOTQuNDQ1MyA1MDEsMzguMTQ4NCA1MTYsMzguMTQ4NCBMNTI2LDM4LjE0ODQgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZnJhbjlrMnh1dTV0KSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjU3IiB4PSI1MjYiIHk9Ijc2LjI5NjkiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzNyIgeD0iNTM2IiB5PSI5OS4yOTIiPkxpbnV4PC90ZXh0PjxwYXRoIGQ9Ik00NzYsOTQuNDQ1MyBMNDg2LDk0LjQ0NTMgQzUwMSw5NC40NDUzIDUwMSw5NC40NDUzIDUxNiw5NC40NDUzIEw1MjYsOTQuNDQ1MyAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmcmFuOWsyeHV1NXQpIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iODMiIHg9IjUyNiIgeT0iMTMyLjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2MyIgeD0iNTM2IiB5PSIxNTUuNTg4OSI+V2luZG93czwvdGV4dD48cGF0aCBkPSJNNDc2LDk0LjQ0NTMgTDQ4Niw5NC40NDUzIEM1MDEsOTQuNDQ1MyA1MDEsMTUwLjc0MjIgNTE2LDE1MC43NDIyIEw1MjYsMTUwLjc0MjIgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNMjc5LDE3OC44OTA2IEwyODksMTc4Ljg5MDYgQzMwNCwxNzguODkwNiAzMDQsOTQuNDQ1MyAzMTksOTQuNDQ1MyBMMzI5LDk0LjQ0NTMgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZnJhbjlrMnh1dTV0KSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjE4NiIgeD0iMzI5IiB5PSIyNDUuMTg3NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2NiIgeD0iMzM5IiB5PSIyNjguMTgyNiI+cHJvZ3JhbW1pbmcgbGFuZ3VhZ2U8L3RleHQ+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgZmlsdGVyPSJ1cmwoI2ZyYW45azJ4dXU1dCkiIGhlaWdodD0iMzYuMjk2OSIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI3MyIgeD0iNTY1IiB5PSIxODguODkwNiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjUzIiB4PSI1NzUiIHk9IjIxMS44ODU3Ij5DJmFtcDtDKys8L3RleHQ+PHBhdGggZD0iTTUxNSwyNjMuMzM1OSBMNTI1LDI2My4zMzU5IEM1NDAsMjYzLjMzNTkgNTQwLDIwNy4wMzkxIDU1NSwyMDcuMDM5MSBMNTY1LDIwNy4wMzkxICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgZmlsdGVyPSJ1cmwoI2ZyYW45azJ4dXU1dCkiIGhlaWdodD0iMzYuMjk2OSIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI0MCIgeD0iNTY1IiB5PSIyNDUuMTg3NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIwIiB4PSI1NzUiIHk9IjI2OC4xODI2Ij5HbzwvdGV4dD48cGF0aCBkPSJNNTE1LDI2My4zMzU5IEw1MjUsMjYzLjMzNTkgQzU0MCwyNjMuMzM1OSA1NDAsMjYzLjMzNTkgNTU1LDI2My4zMzU5IEw1NjUsMjYzLjMzNTkgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZnJhbjlrMnh1dTV0KSIgaGVpZ2h0PSIzNi4yOTY5IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjcxIiB4PSI1NjUiIHk9IjMwMS40ODQ0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTEiIHg9IjU3NSIgeT0iMzI0LjQ3OTUiPlB5dGhvbjwvdGV4dD48cGF0aCBkPSJNNTE1LDI2My4zMzU5IEw1MjUsMjYzLjMzNTkgQzU0MCwyNjMuMzM1OSA1NDAsMzE5LjYzMjggNTU1LDMxOS42MzI4IEw1NjUsMzE5LjYzMjggIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNMjc5LDE3OC44OTA2IEwyODksMTc4Ljg5MDYgQzMwNCwxNzguODkwNiAzMDQsMjYzLjMzNTkgMzE5LDI2My4zMzU5IEwzMjksMjYzLjMzNTkgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNNzQsMTc4Ljg5MDYgTDg0LDE3OC44OTA2IEM5OSwxNzguODkwNiA5OSwxNzguODkwNiAxMTQsMTc4Ljg5MDYgTDEyNCwxNzguODkwNiAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmcmFuOWsyeHV1NXQpIiBoZWlnaHQ9IjM2LjI5NjkiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMTAxIiB4PSIxMjQiIHk9IjIxNy4wMzkxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODEiIHg9IjEzNCIgeT0iMjQwLjAzNDIiPnBzeWNob2xvZ3k8L3RleHQ+PHBhdGggZD0iTTc0LDE3OC44OTA2IEw4NCwxNzguODkwNiBDOTksMTc4Ljg5MDYgOTksMjM1LjE4NzUgMTE0LDIzNS4xODc1IEwxMjQsMjM1LjE4NzUgIiBmaWxsPSJub25lIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48IS0tTUQ1PVs0OWRmZjdkNzI1OGQ2NDRiYzQ0MGY1NzhkNDExOTMxNF0KQHN0YXJ0bWluZG1hcA0KKiBib29rcw0KKiogY29tcHV0ZXIgU2NpZW5jZSANCioqKiBvcGVyYXRpbmcgc3lzdGVtDQoqKioqIFVuaXgNCioqKiogTGludXgNCioqKiogV2luZG93cw0KKioqIHByb2dyYW1taW5nIGxhbmd1YWdlDQoqKioqIEMmQysrDQoqKioqIEdvDQoqKioqIFB5dGhvbg0KKiogcHN5Y2hvbG9neQ0KQGVuZG1pbmRtYXANCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMS4xMGJldGEyKFVua25vd24gY29tcGlsZSB0aW1lKQooR1BMIHNvdXJjZSBkaXN0cmlidXRpb24pCkphdmEgUnVudGltZTogSmF2YShUTSkgU0UgUnVudGltZSBFbnZpcm9ubWVudApKVk06IEphdmEgSG90U3BvdChUTSkgNjQtQml0IFNlcnZlciBWTQpEZWZhdWx0IEVuY29kaW5nOiBVVEYtOApMYW5ndWFnZTogZW4KQ291bnRyeTogVVMKLS0+PC9nPjwvc3ZnPg=='><p>以上面书籍分类为例，我们基于 <code>MySQL-5.7</code> 分别介绍两种不同的层级数据存储模型：</p><h2 id="邻接列表模型"><a href="#邻接列表模型" class="headerlink" title="邻接列表模型"></a>邻接列表模型</h2><p>邻接表模型是较为传统方式，以 id 和 parent_id 形成自关联关系，将数据存储在一张表中，省去了多张关系表的麻烦，变得简洁明了。</p><h3 id="初始化数据"><a href="#初始化数据" class="headerlink" title="初始化数据"></a>初始化数据</h3><p>先创建一张 <code>catalog</code> 表</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>catalog<span class="token punctuation">`</span> <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>parent_id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>按上面图形的关系插入数据，以 <code>id</code> 和 <code>parent_id</code> 表示父子关系，最顶层父节点 <code>id</code> 为 0，这种父子关系可以很直观的理解。</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>catalog<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'books'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>catalog<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'computer Science'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>catalog<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'operating system'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>catalog<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'Unix'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>catalog<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'Linux'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>catalog<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'Windows'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>catalog<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'programming language'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>catalog<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'C&amp;C++'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>catalog<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'Go'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>catalog<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'Python'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>mysql<span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>catalog<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'psychology'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查询结果如下：</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> catalog<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+----------------------+-----------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name                 <span class="token operator">|</span> parent_id <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+----------------------+-----------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> books                <span class="token operator">|</span>         <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> computer Science     <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> operating system     <span class="token operator">|</span>         <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> Unix                 <span class="token operator">|</span>         <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> Linux                <span class="token operator">|</span>         <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> Windows              <span class="token operator">|</span>         <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> programming <span class="token keyword">language</span> <span class="token operator">|</span>         <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> C<span class="token operator">&amp;</span>C<span class="token operator">+</span><span class="token operator">+</span>                <span class="token operator">|</span>         <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> Go                   <span class="token operator">|</span>         <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">10</span> <span class="token operator">|</span> Python               <span class="token operator">|</span>         <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> psychology           <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+----------------------+-----------+</span><span class="token number">11</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>虽然看起来很直观，而且当我们插入新数据时，可以很容易的根据父节点 id 插入对应的数据，但是删除某一结点的时候，需要先删除该节点的所有子孙节点，才能删除该节点，否则子节点会成为孤儿节点存在，消失在树中。而且查询整个树时，由于不知道具体层数，则需要递归查询所有子节点，以确保所有节点被找到，时间复杂度极高，数据量不大的情况下我们可以使用 MySQL 函数进行查询子节点工作，简单方便。</p><p>递归的方法可以参考：<a href="https://blog.csdn.net/acmain_chm/article/details/4142971">MySQL中进行树状所有子节点的查询</a>这篇文章的内容，这里不多做解释。</p><h3 id="查询子节点函数"><a href="#查询子节点函数" class="headerlink" title="查询子节点函数"></a>查询子节点函数</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DEFINER</span><span class="token operator">=</span><span class="token punctuation">`</span>root<span class="token punctuation">`</span><span class="token variable">@`%`</span> <span class="token keyword">FUNCTION</span> <span class="token punctuation">`</span>getChildList<span class="token punctuation">`</span><span class="token punctuation">(</span>rootId <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">CHARSET</span> utf8mb4    <span class="token keyword">DETERMINISTIC</span><span class="token keyword">BEGIN</span>    <span class="token keyword">DECLARE</span> sTemp <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>    <span class="token keyword">DECLARE</span> sTempChd <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">SET</span> sTemp <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>     <span class="token keyword">SET</span> sTempChd <span class="token operator">=</span>CAST<span class="token punctuation">(</span>rootId <span class="token keyword">AS</span> <span class="token keyword">CHAR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">WHILE</span> sTempChd <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DO</span>         <span class="token comment">-- 拼接 ',' 为了和  GROUP_CONCAT 函数保持一致</span>        <span class="token keyword">SET</span> sTemp <span class="token operator">=</span> CONCAT<span class="token punctuation">(</span>sTemp<span class="token punctuation">,</span>sTempChd<span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">SELECT</span> GROUP_CONCAT<span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">INTO</span> sTempChd <span class="token keyword">FROM</span> <span class="token punctuation">`</span>catalog<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> FIND_IN_SET<span class="token punctuation">(</span><span class="token punctuation">`</span>parent_id<span class="token punctuation">`</span><span class="token punctuation">,</span> sTempChd<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span>     <span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>     <span class="token keyword">SET</span> sTemp <span class="token operator">=</span> CONCAT<span class="token punctuation">(</span>sTemp<span class="token punctuation">,</span><span class="token string">'-1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">RETURN</span> sTemp<span class="token punctuation">;</span><span class="token keyword">END</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>该函数中，使用 <code>GROUP_CONCAT</code> 函数能够组合父节点 id 相同的子 id，并默认以 <code>,</code> 分隔，但其返回结果的长度受参数 <code>group_concat_max_len</code> 控制，默认值为1024，若需要修改，则修改 <code>MySQL</code> 配置文件的参数即可，或者执行下面的 sql 语句修改：</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> group_concat_max_len <span class="token operator">=</span> <span class="token number">10240</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="查询子树"><a href="#查询子树" class="headerlink" title="查询子树"></a>查询子树</h3><p>MySQL 的函数能和 <code>WHERE</code> 关键词一起在 sql 语句中使用:</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查询整个树的节点id;</span>mysql<span class="token operator">></span> <span class="token keyword">select</span> getChildList<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----------------------------+</span><span class="token operator">|</span> getChildList<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>            <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------------------------+</span><span class="token operator">|</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------------------------+</span><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span class="token comment">-- 查询子树信息；</span>mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> catalog <span class="token keyword">where</span> FIND_IN_SET<span class="token punctuation">(</span>id<span class="token punctuation">,</span> getChildList<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+------------------+-----------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name             <span class="token operator">|</span> parent_id <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------------------+-----------+</span><span class="token operator">|</span>  <span class="token number">3</span> <span class="token operator">|</span> operating system <span class="token operator">|</span>         <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">4</span> <span class="token operator">|</span> Unix             <span class="token operator">|</span>         <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">5</span> <span class="token operator">|</span> Linux            <span class="token operator">|</span>         <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">6</span> <span class="token operator">|</span> Windows          <span class="token operator">|</span>         <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+------------------+-----------+</span><span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="删除子树"><a href="#删除子树" class="headerlink" title="删除子树"></a>删除子树</h3><p>使用查询子节点函数也可以删除整个子树，而且不会产生孤儿节点。</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">delete</span> <span class="token keyword">from</span> catalog <span class="token keyword">where</span> FIND_IN_SET<span class="token punctuation">(</span>id<span class="token punctuation">,</span> getChildList<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">4</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> catalog<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----+----------------------+-----------+</span><span class="token operator">|</span> id <span class="token operator">|</span> name                 <span class="token operator">|</span> parent_id <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+----------------------+-----------+</span><span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span> books                <span class="token operator">|</span>         <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span> computer Science     <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">7</span> <span class="token operator">|</span> programming <span class="token keyword">language</span> <span class="token operator">|</span>         <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">8</span> <span class="token operator">|</span> C<span class="token operator">&amp;</span>C<span class="token operator">+</span><span class="token operator">+</span>                <span class="token operator">|</span>         <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">|</span>  <span class="token number">9</span> <span class="token operator">|</span> Go                   <span class="token operator">|</span>         <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">10</span> <span class="token operator">|</span> Python               <span class="token operator">|</span>         <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token number">11</span> <span class="token operator">|</span> psychology           <span class="token operator">|</span>         <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----+----------------------+-----------+</span><span class="token number">7</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="嵌套集合模型"><a href="#嵌套集合模型" class="headerlink" title="嵌套集合模型"></a>嵌套集合模型</h2><p>嵌套集模型是多个嵌套在一起的集合来表示数据之间的层级关系，每个数据都有自己的 <code>left</code> 和 <code>right</code>值，以此来表示集合的边界</p><p><img src="https://cdn.jsdelivr.net/gh/seek4self/imgbed@main/img/blog/db/nested_category.jpg" alt="嵌套集合模型示意图"></p><h3 id="初始化集合数据"><a href="#初始化集合数据" class="headerlink" title="初始化集合数据"></a>初始化集合数据</h3><p>新建一张带左右值的表，第一条数据，也就是根节点的左右值为 1 和 2，每次插入子节点时都需要更新该子节点右边的左右值</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>nested_category<span class="token punctuation">`</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>nested_category<span class="token punctuation">`</span>  <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>lft<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>rgt<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8mb4_general_ci ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>插入预定义的数据：</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>nested_category<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'books'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>nested_category<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'computer Science'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>nested_category<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'operating system'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>nested_category<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'Unix'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>nested_category<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'Linux'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>nested_category<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'Windows'</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>nested_category<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'programming language'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>nested_category<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'C&amp;C++'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>nested_category<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'Go'</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>nested_category<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'Python'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>nested_category<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'psychology'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这些左右值数据水平展开来看就如下图编号所示，从左到右，依次增大，这种左右值的访问顺序与二叉树的先序遍历类似</p><p><img src="https://cdn.jsdelivr.net/gh/seek4self/imgbed@main/img/blog/db/nested_category_number.jpg" alt="嵌套集合模型编号图"></p><h3 id="查询完整树列表"><a href="#查询完整树列表" class="headerlink" title="查询完整树列表"></a>查询完整树列表</h3><p>在嵌套集模型中，查询相对来说就方便很多，只需要依据根节点 <code>lft</code> 和 <code>rgt</code> 就可以判断子树的范围，子节点的 <code>lft</code> 或 <code>rgt</code> 值一定在父节点 <code>lft</code> 和 <code>rgt</code> 值之间</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- 查询完整树</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> node<span class="token punctuation">.</span>name<span class="token punctuation">,</span> node<span class="token punctuation">.</span>lft<span class="token punctuation">,</span> node<span class="token punctuation">.</span>rgt    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">FROM</span> nested_category <span class="token keyword">AS</span> node<span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span>      nested_category <span class="token keyword">AS</span> parent    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">WHERE</span> node<span class="token punctuation">.</span>lft <span class="token operator">BETWEEN</span> parent<span class="token punctuation">.</span>lft <span class="token operator">AND</span> parent<span class="token punctuation">.</span>rgt <span class="token operator">AND</span> parent<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> node<span class="token punctuation">.</span>lft<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----------------------+------+------+</span><span class="token operator">|</span> name                 <span class="token operator">|</span> lft  <span class="token operator">|</span> rgt  <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------------------+------+------+</span><span class="token operator">|</span> books                <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">22</span> <span class="token operator">|</span><span class="token operator">|</span> computer Science     <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>   <span class="token number">19</span> <span class="token operator">|</span><span class="token operator">|</span> operating system     <span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span><span class="token operator">|</span> Unix                 <span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span><span class="token operator">|</span> Linux                <span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">|</span> Windows              <span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span>    <span class="token number">9</span> <span class="token operator">|</span><span class="token operator">|</span> programming <span class="token keyword">language</span> <span class="token operator">|</span>   <span class="token number">11</span> <span class="token operator">|</span>   <span class="token number">18</span> <span class="token operator">|</span><span class="token operator">|</span> C<span class="token operator">&amp;</span>C<span class="token operator">+</span><span class="token operator">+</span>                <span class="token operator">|</span>   <span class="token number">12</span> <span class="token operator">|</span>   <span class="token number">13</span> <span class="token operator">|</span><span class="token operator">|</span> Go                   <span class="token operator">|</span>   <span class="token number">14</span> <span class="token operator">|</span>   <span class="token number">15</span> <span class="token operator">|</span><span class="token operator">|</span> Python               <span class="token operator">|</span>   <span class="token number">16</span> <span class="token operator">|</span>   <span class="token number">17</span> <span class="token operator">|</span><span class="token operator">|</span> psychology           <span class="token operator">|</span>   <span class="token number">20</span> <span class="token operator">|</span>   <span class="token number">21</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------------------+------+------+</span><span class="token number">11</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span class="token comment">-- 查询 operating system 子树列表</span>mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> node<span class="token punctuation">.</span>name    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">FROM</span> nested_category <span class="token keyword">AS</span> node<span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span>      nested_category <span class="token keyword">AS</span> parent    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">WHERE</span> node<span class="token punctuation">.</span>lft <span class="token operator">BETWEEN</span> parent<span class="token punctuation">.</span>lft <span class="token operator">AND</span> parent<span class="token punctuation">.</span>rgt <span class="token operator">AND</span> parent<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">3</span>    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> node<span class="token punctuation">.</span>lft<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------------------+</span><span class="token operator">|</span> name             <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------------+</span><span class="token operator">|</span> operating system <span class="token operator">|</span><span class="token operator">|</span> Unix             <span class="token operator">|</span><span class="token operator">|</span> Linux            <span class="token operator">|</span><span class="token operator">|</span> Windows          <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------------+</span><span class="token number">4</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样一来就不用关心层级有多少层，也不用递归遍历子节点，查询就方便很多，也能提高响应效率。</p><h3 id="插入新节点"><a href="#插入新节点" class="headerlink" title="插入新节点"></a>插入新节点</h3><p>通过创建存储过程实现插入新节点的流程，然而存储过程的实现并不是原子操作，中间发生失败，不会回退，这里只是用作演示，实际应用最好在存储过程里添加事务，或是直接在业务代码中采用事务的方式进行操作</p><p>创建添加新节点的存储过程，该过程添加的新节点默认插入指定父节点的所有子节点的末尾位置：</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DEFINER</span><span class="token operator">=</span><span class="token punctuation">`</span>root<span class="token punctuation">`</span><span class="token variable">@`%`</span> <span class="token keyword">PROCEDURE</span> <span class="token punctuation">`</span>addNode<span class="token punctuation">`</span><span class="token punctuation">(</span> <span class="token operator">IN</span> <span class="token punctuation">`</span>father<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token operator">IN</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">BEGIN</span>    <span class="token comment">-- 获取父节点 right 值</span>    <span class="token keyword">SELECT</span> <span class="token variable">@frgt</span> :<span class="token operator">=</span> rgt <span class="token keyword">FROM</span> nested_category <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token variable">@father</span><span class="token punctuation">;</span>    <span class="token comment">-- 更新父节点 right 值右边的左右边界都 +2</span>    <span class="token keyword">UPDATE</span> nested_category <span class="token keyword">SET</span> rgt <span class="token operator">=</span> rgt <span class="token operator">+</span> <span class="token number">2</span> <span class="token keyword">WHERE</span> rgt <span class="token operator">></span> <span class="token variable">@frgt</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">UPDATE</span> nested_category <span class="token keyword">SET</span> lft <span class="token operator">=</span> lft <span class="token operator">+</span> <span class="token number">2</span> <span class="token keyword">WHERE</span> lft <span class="token operator">></span> <span class="token variable">@frgt</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">-- 插入新数据</span>    <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> nested_category<span class="token punctuation">(</span>name<span class="token punctuation">,</span> lft<span class="token punctuation">,</span> rgt<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token variable">@name</span><span class="token punctuation">,</span> <span class="token variable">@frgt</span><span class="token punctuation">,</span> <span class="token variable">@frgt</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">END</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>插入数据验证：</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">set</span> <span class="token variable">@father</span> :<span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">set</span> <span class="token variable">@name</span> :<span class="token operator">=</span> <span class="token string">'Cognitive psychology'</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>mysql<span class="token operator">></span> <span class="token keyword">call</span> addNode<span class="token punctuation">(</span><span class="token variable">@father</span><span class="token punctuation">,</span> <span class="token variable">@name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">--------------+</span><span class="token operator">|</span> <span class="token variable">@frgt</span> :<span class="token operator">=</span> rgt <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------+</span><span class="token operator">|</span>           <span class="token number">23</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">--------------+</span><span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查询树列表，使用 <code>count</code>函数计算深度信息如下，新节点确实位于 <code>psychology</code> 节点下方，深度为 2</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> node<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> depth    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">FROM</span> nested_category <span class="token keyword">AS</span> node<span class="token punctuation">,</span>    <span class="token operator">-</span><span class="token operator">></span>      nested_category <span class="token keyword">AS</span> parent    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">WHERE</span> node<span class="token punctuation">.</span>lft <span class="token operator">BETWEEN</span> parent<span class="token punctuation">.</span>lft <span class="token operator">AND</span> parent<span class="token punctuation">.</span>rgt     <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> node<span class="token punctuation">.</span>name    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> node<span class="token punctuation">.</span>lft<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">----------------------+-------+</span><span class="token operator">|</span> name                 <span class="token operator">|</span> depth <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------------------+-------+</span><span class="token operator">|</span> books                <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span><span class="token operator">|</span> computer Science     <span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> operating system     <span class="token operator">|</span>     <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">|</span> Unix                 <span class="token operator">|</span>     <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">|</span> Linux                <span class="token operator">|</span>     <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">|</span> Windows              <span class="token operator">|</span>     <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">|</span> programming <span class="token keyword">language</span> <span class="token operator">|</span>     <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">|</span> C<span class="token operator">&amp;</span>C<span class="token operator">+</span><span class="token operator">+</span>                <span class="token operator">|</span>     <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">|</span> Go                   <span class="token operator">|</span>     <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">|</span> Python               <span class="token operator">|</span>     <span class="token number">3</span> <span class="token operator">|</span><span class="token operator">|</span> psychology           <span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> Positive psychology  <span class="token operator">|</span>     <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">|</span> Cognitive psychology <span class="token operator">|</span>     <span class="token number">2</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">----------------------+-------+</span><span class="token number">13</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="删除子树所有节点"><a href="#删除子树所有节点" class="headerlink" title="删除子树所有节点"></a>删除子树所有节点</h3><p>删除和添加节点类似，相当于是插入的反向操作，删除节点右边剩余节点的 <code>lft</code> 和 <code>rgt</code> 值都减去子树的宽度，同样，我们用存储过程实现这一操作：</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DEFINER</span><span class="token operator">=</span><span class="token punctuation">`</span>root<span class="token punctuation">`</span><span class="token variable">@`%`</span> <span class="token keyword">PROCEDURE</span> <span class="token punctuation">`</span>deleteNode<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token operator">IN</span> <span class="token punctuation">`</span>fid<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token keyword">BEGIN</span>    <span class="token comment">-- 查询删除节点的左右值以及宽度</span>    <span class="token keyword">SELECT</span> <span class="token variable">@myLeft</span> :<span class="token operator">=</span> lft<span class="token punctuation">,</span> <span class="token variable">@myRight</span> :<span class="token operator">=</span> rgt<span class="token punctuation">,</span> <span class="token variable">@myWidth</span> :<span class="token operator">=</span> rgt <span class="token operator">-</span> lft <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">FROM</span> nested_category <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token variable">@fid</span><span class="token punctuation">;</span>    <span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> nested_category <span class="token keyword">WHERE</span> lft <span class="token operator">BETWEEN</span> <span class="token variable">@myLeft</span> <span class="token operator">AND</span> <span class="token variable">@myRight</span><span class="token punctuation">;</span>    <span class="token keyword">UPDATE</span> nested_category <span class="token keyword">SET</span> rgt <span class="token operator">=</span> rgt <span class="token operator">-</span> <span class="token variable">@myWidth</span> <span class="token keyword">WHERE</span> rgt <span class="token operator">></span> <span class="token variable">@myRight</span><span class="token punctuation">;</span>    <span class="token keyword">UPDATE</span> nested_category <span class="token keyword">SET</span> lft <span class="token operator">=</span> lft <span class="token operator">-</span> <span class="token variable">@myWidth</span> <span class="token keyword">WHERE</span> lft <span class="token operator">></span> <span class="token variable">@myRight</span><span class="token punctuation">;</span><span class="token keyword">END</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>执行存储过程，删除 <code>programming language</code> 节点，然后查询结果如下，使用 <code>CONCAT</code> 函数将深度转化为缩进，可以看出层级结构依然和之前一样：</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">mysql<span class="token operator">></span> <span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span> <span class="token keyword">REPEAT</span><span class="token punctuation">(</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> node<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token keyword">AS</span> name<span class="token punctuation">,</span> node<span class="token punctuation">.</span>lft<span class="token punctuation">,</span> node<span class="token punctuation">.</span>rgt    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">FROM</span> nested_category <span class="token keyword">AS</span> node<span class="token punctuation">,</span> nested_category <span class="token keyword">AS</span> parent    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">WHERE</span> node<span class="token punctuation">.</span>lft <span class="token operator">BETWEEN</span> parent<span class="token punctuation">.</span>lft <span class="token operator">AND</span> parent<span class="token punctuation">.</span>rgt    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> node<span class="token punctuation">.</span>name    <span class="token operator">-</span><span class="token operator">></span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> node<span class="token punctuation">.</span>lft<span class="token punctuation">;</span><span class="token operator">+</span><span class="token comment">------------------------+------+------+</span><span class="token operator">|</span> name                   <span class="token operator">|</span> lft  <span class="token operator">|</span> rgt  <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------------------+------+------+</span><span class="token operator">|</span> books                  <span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span>   <span class="token number">18</span> <span class="token operator">|</span><span class="token operator">|</span>  computer Science      <span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span>   <span class="token number">11</span> <span class="token operator">|</span><span class="token operator">|</span>   operating system     <span class="token operator">|</span>    <span class="token number">3</span> <span class="token operator">|</span>   <span class="token number">10</span> <span class="token operator">|</span><span class="token operator">|</span>    Unix                <span class="token operator">|</span>    <span class="token number">4</span> <span class="token operator">|</span>    <span class="token number">5</span> <span class="token operator">|</span><span class="token operator">|</span>    Linux               <span class="token operator">|</span>    <span class="token number">6</span> <span class="token operator">|</span>    <span class="token number">7</span> <span class="token operator">|</span><span class="token operator">|</span>    Windows             <span class="token operator">|</span>    <span class="token number">8</span> <span class="token operator">|</span>    <span class="token number">9</span> <span class="token operator">|</span><span class="token operator">|</span>  psychology            <span class="token operator">|</span>   <span class="token number">12</span> <span class="token operator">|</span>   <span class="token number">17</span> <span class="token operator">|</span><span class="token operator">|</span>   Positive psychology  <span class="token operator">|</span>   <span class="token number">13</span> <span class="token operator">|</span>   <span class="token number">14</span> <span class="token operator">|</span><span class="token operator">|</span>   Cognitive psychology <span class="token operator">|</span>   <span class="token number">15</span> <span class="token operator">|</span>   <span class="token number">16</span> <span class="token operator">|</span><span class="token operator">+</span><span class="token comment">------------------------+------+------+</span><span class="token number">9</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总之，两种方法各有利弊，邻接表方便插入，适用于新增层级比较频繁的场景，但是查询效率低下；而嵌套集模型，插入删除需要更新大部分条目，甚至全表更新，但是查询简单直接，对于层级结构相对固定的场景，使用起来相得益彰。所以该使用什么模型，应根据实际需求来定。</p><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ul><li><a href="https://blog.csdn.net/acmain_chm/article/details/4142971">MySQL中进行树状所有子节点的查询</a></li><li><a href="https://juejin.cn/post/6844903886440890381#heading-5">[译] 在 MySQL 中管理层级数据 —— 两种方法介绍</a></li><li><a href="http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/">Managing Hierarchical Data in MySQL</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VSCode 调试 c++ 配置</title>
      <link href="tools/vscode/debug-ffc6c7bc4e93/"/>
      <url>tools/vscode/debug-ffc6c7bc4e93/</url>
      
        <content type="html"><![CDATA[<p>自从微软出了 VSCode 编辑器后，就没在使用其他 IDE 了，用来编写一些动态语言(Node.js、Python)程序，不需要编译，安装的相关插件能很好的帮助调试。但是对于 c++ 这种静态编译语言，调试就成了一个大麻烦，环境配置都很难顺利的走下去，正好准备用 VSCode 看 SRS 源码，将相关的 c++ 配置及调试过程记录一下。</p><p>环境基于 WSL-Ubuntu 20.04</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ol><li>必要的 c++ 环境程序，安装过程不会的自行 Google 吧<ul><li>gcc/g++</li><li>make/cmake</li><li>gdb</li></ul></li><li>需要安装 VSCode 插件<ul><li><code>C/C++</code> (c/c++ 语法)</li><li><code>C++ Intellisense</code> (代码格式化)</li><li><code>CMake</code> (cmake 语法高亮)</li><li><code>CMake Tools</code></li></ul></li></ol><h2 id="编译调试"><a href="#编译调试" class="headerlink" title="编译调试"></a>编译调试</h2><p>CMake 编译需要写 CMakeLists.txt 文件， make 需要 Makefile 文件， 根据需要自行选择，这里以 CMake 为例</p><h3 id="添加配置"><a href="#添加配置" class="headerlink" title="添加配置"></a>添加配置</h3><h4 id="CMake"><a href="#CMake" class="headerlink" title="CMake"></a>CMake</h4><p>按快捷键 <code>Ctrl+Shift+P</code> 调出控制台， 输入 <code>cmake</code> ，选择<code>CMake:Configure</code> 或者 <code>CMake:Quick Start</code> 开始配置</p><ol><li><p>选择 gcc 编译工具版本</p><p> <img src="https://cdn.jsdelivr.net/gh/seek4self/imgbed@main/img/blog/vscode/cmake/cmake.png" alt="select gcc"></p></li><li><p>根据提示创建 <code>CMakeLists.txt</code>， 选择 <code>Create</code>， 创建新文件， 选择<code>Locate</code> 打开已有文件</p><p> <img src="https://cdn.jsdelivr.net/gh/seek4self/imgbed@main/img/blog/vscode/cmake/cmake_configure.png" alt="create CMakeLists.txt"></p></li><li><p>若 2 选择<code>Create</code>, 则按提示创建文件，输入项目名称，选择输出类型，就会生成 <code>CMakeLists.txt</code> 文件, 根据需要配置相关项，参考<a href="#cmakeliststxt-%E5%AE%9E%E4%BE%8B">CMakeLists.txt 实例</a></p><p> <img src="https://cdn.jsdelivr.net/gh/seek4self/imgbed@main/img/blog/vscode/cmake/cmake_project.png" alt="input project name"><br> <img src="https://cdn.jsdelivr.net/gh/seek4self/imgbed@main/img/blog/vscode/cmake/cmake_out.png" alt="select output"></p></li></ol><p>当状态栏出现如下图表时，则表明配置完成，可以选择 <code>Build</code> 尝试编译</p><p><img src="https://cdn.jsdelivr.net/gh/seek4self/imgbed@main/img/blog/vscode/cmake/cmake_status.png" alt="build status"></p><h4 id="CMakeLists-txt-实例"><a href="#CMakeLists-txt-实例" class="headerlink" title="CMakeLists.txt 实例"></a>CMakeLists.txt 实例</h4><p>该配置是使用<code>pkgconfig</code>编译成动态库， 如需其他格式，自行修改</p><pre class="line-numbers language-cmake" data-language="cmake"><code class="language-cmake"><span class="token keyword">cmake_minimum_required</span><span class="token punctuation">(</span><span class="token property">VERSION</span> <span class="token number">3.5</span><span class="token punctuation">)</span><span class="token comment"># 使用 pkgconfig 导入第三方库</span><span class="token keyword">project</span><span class="token punctuation">(</span>decoder LANGUAGES C<span class="token punctuation">)</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">ENV</span>&#123;PKG_CONFIG_PATH<span class="token punctuation">&#125;</span> /usr/local/ffmpeg/lib/pkgconfig<span class="token punctuation">)</span><span class="token keyword">find_package</span><span class="token punctuation">(</span>PkgConfig<span class="token punctuation">)</span><span class="token function">pkg_check_modules</span><span class="token punctuation">(</span>FFMPEG REQUIRED libavcodec libavformat libavutil<span class="token punctuation">)</span><span class="token keyword">message</span><span class="token punctuation">(</span>'sss',<span class="token punctuation">$&#123;</span>FFMPEG_INCLUDE_DIRS<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">include_directories</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span>FFMPEG_INCLUDE_DIRS<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">link_directories</span><span class="token punctuation">(</span><span class="token punctuation">$&#123;</span>FFMPEG_LIBRARY_DIRS<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment"># 显式指定编译器</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_C_COMPILER</span> <span class="token string">"gcc"</span><span class="token punctuation">)</span> <span class="token comment"># 开启调试信息</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_BUILD_TYPE</span> <span class="token string">"Debug"</span><span class="token punctuation">)</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_C_FLAGS_DEBUG</span> <span class="token string">"$ENV&#123;CFLAGS&#125; -O0 -Wall -g2 -ggdb"</span><span class="token punctuation">)</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_C_FLAGS_RELEASE</span> <span class="token string">"$ENV&#123;CFLAGS&#125; -O3 -Wall"</span><span class="token punctuation">)</span>  <span class="token comment"># 开启所有警告</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_C_FLAGS</span> <span class="token string">"-Wall"</span><span class="token punctuation">)</span><span class="token keyword">add_executable</span><span class="token punctuation">(</span>mediainfo mediainfo.c<span class="token punctuation">)</span><span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>mediainfo <span class="token punctuation">$&#123;</span>FFMPEG_LIBRARIES<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">add_executable</span><span class="token punctuation">(</span>extra_audio extra_audio.c<span class="token punctuation">)</span><span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>extra_audio <span class="token punctuation">$&#123;</span>FFMPEG_LIBRARIES<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h3><p>设置好 CMake 后，打开 <code>.cpp</code> 文件， 按快捷键 <code>Ctrl+Shift+D</code> 打开调试面板，点击 <code>运行和调试</code>, 根据系统情况选取不同的 <code>C++</code> ,如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/seek4self/imgbed@main/img/blog/vscode/cmake/debug.png" alt="select environment"></p><p>然后根据需要选择不同版本的编译器配置，会生成 <code>launch.json</code> 和 <code>tasks.json</code>, 根据调试需求更改相应的参数</p><p><img src="https://cdn.jsdelivr.net/gh/seek4self/imgbed@main/img/blog/vscode/cmake/debug_g++.png" alt="select complier config"></p><p>下面以提供调试启动配置实例, 详细配置请参考<a href="https://code.visualstudio.com/docs/cpp/config-wsl">官方文档</a></p><ul><li>task.json</li></ul><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"tasks"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>  <span class="token comment">// 默认生成的配置，用于编译单个C++可行，但是大项目就需要其他配置了，可以不用管,</span>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"cppbuild"</span><span class="token punctuation">,</span>            <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"C/C++: gcc-9 build active file"</span><span class="token punctuation">,</span>            <span class="token property">"command"</span><span class="token operator">:</span> <span class="token string">"/usr/bin/gcc-9"</span><span class="token punctuation">,</span>            <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"-g"</span><span class="token punctuation">,</span>                <span class="token string">"$&#123;workspaceFolder&#125;/main.c"</span><span class="token punctuation">,</span>                <span class="token string">"-o"</span><span class="token punctuation">,</span>                <span class="token string">"$&#123;fileDirname&#125;/$&#123;fileBasenameNoExtension&#125;"</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"options"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"cwd"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceFolder&#125;"</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token property">"problemMatcher"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"$gcc"</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"group"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"build"</span><span class="token punctuation">,</span>                <span class="token property">"isDefault"</span><span class="token operator">:</span> <span class="token boolean">true</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token property">"detail"</span><span class="token operator">:</span> <span class="token string">"Task generated by Debugger."</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token comment">// 这个任务配置对于小项目来说修改完直接编译调试还不错，</span>        <span class="token comment">// 但是大项目最好手动编译好后，直接使用 launch 调试，不建议用 task 配置 </span>        <span class="token punctuation">&#123;</span>            <span class="token comment">// label 是 task 唯一标识， 对应下面 launch 的 preLaunchTask 配置</span>            <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"cmake"</span><span class="token punctuation">,</span>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"shell"</span><span class="token punctuation">,</span>            <span class="token property">"command"</span><span class="token operator">:</span> <span class="token string">"cmake"</span><span class="token punctuation">,</span>            <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"../"</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"options"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// 工作目录</span>                <span class="token property">"cwd"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceFolder&#125;/build"</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"make"</span><span class="token punctuation">,</span>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"shell"</span><span class="token punctuation">,</span>            <span class="token property">"command"</span><span class="token operator">:</span> <span class="token string">"make"</span><span class="token punctuation">,</span>            <span class="token property">"options"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"cwd"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceFolder&#125;/build"</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"label"</span><span class="token operator">:</span> <span class="token string">"build"</span><span class="token punctuation">,</span>            <span class="token comment">// dependsOn 按顺序执行多个 task</span>            <span class="token property">"dependsOn"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"cmake"</span><span class="token punctuation">,</span>                <span class="token string">"make"</span>            <span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"2.0.0"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>launch.json</li></ul><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token comment">// 使用 IntelliSense 了解相关属性。 </span>    <span class="token comment">// 悬停以查看现有属性的描述。</span>    <span class="token comment">// 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"gdb launch"</span><span class="token punctuation">,</span>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"cppdbg"</span><span class="token punctuation">,</span>            <span class="token property">"request"</span><span class="token operator">:</span> <span class="token string">"launch"</span><span class="token punctuation">,</span>            <span class="token comment">// program 是调试启动可执行文件路径 </span>            <span class="token property">"program"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceFolder&#125;/build/decoder"</span><span class="token punctuation">,</span>            <span class="token comment">// args 将照命令行参数以空格分割，顺序依次写入数组列表，</span>            <span class="token property">"args"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"/mnt/e/film/Fate_Zero_all_OP_and_ED.mp4"</span><span class="token punctuation">,</span>                <span class="token string">"output"</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"stopAtEntry"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token property">"cwd"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceFolder&#125;"</span><span class="token punctuation">,</span>            <span class="token property">"environment"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"externalConsole"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>            <span class="token comment">// preLaunchTask 调试启动前置任务，需要配置 task.json, 进行一些编译任务</span>            <span class="token property">"preLaunchTask"</span><span class="token operator">:</span> <span class="token string">"build"</span><span class="token punctuation">,</span>            <span class="token property">"miDebuggerPath"</span><span class="token operator">:</span> <span class="token string">"/usr/bin/gdb"</span><span class="token punctuation">,</span>            <span class="token property">"MIMode"</span><span class="token operator">:</span> <span class="token string">"gdb"</span><span class="token punctuation">,</span>            <span class="token property">"setupCommands"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token punctuation">&#123;</span>                    <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"为 gdb 启用整齐打印"</span><span class="token punctuation">,</span>                    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"-enable-pretty-printing"</span><span class="token punctuation">,</span>                    <span class="token property">"ignoreFailures"</span><span class="token operator">:</span> <span class="token boolean">true</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>设置好后就可以愉快的 <code>F5</code> 了</p><h3 id="C-插件配置"><a href="#C-插件配置" class="headerlink" title="C++ 插件配置"></a>C++ 插件配置</h3><p>该配置可以解决阅读源码时导入第三方文件报红线错误，以及一些自定义 C++ 的配置</p><p>按快捷键 <code>Ctrl+Shift+P</code> 调出控制台, 输入 <code>c++</code>，选择 <code>C/C++编辑配置</code> UI界面或者 JSON 格式进行配置 <code>c_cpp_properties.json</code>，</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>         <span class="token punctuation">&#123;</span>            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Linux"</span><span class="token punctuation">,</span>            <span class="token comment">// add header file path</span>            <span class="token property">"includePath"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token string">"$&#123;workspaceFolder&#125;/**"</span><span class="token punctuation">,</span>                <span class="token string">"/usr/local/ffmpeg/include"</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token property">"defines"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token comment">// set search path</span>            <span class="token property">"browse"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                <span class="token property">"path"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                    <span class="token string">"/usr/local/ffmpeg/include"</span><span class="token punctuation">,</span>                    <span class="token string">"$&#123;workspaceFolder&#125;"</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token property">"databaseFilename"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>                <span class="token property">"limitSymbolsToIncludedHeaders"</span><span class="token operator">:</span> <span class="token boolean">false</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token property">"compilerPath"</span><span class="token operator">:</span> <span class="token string">"/usr/bin/clang"</span><span class="token punctuation">,</span>            <span class="token property">"cStandard"</span><span class="token operator">:</span> <span class="token string">"c11"</span><span class="token punctuation">,</span>            <span class="token property">"cppStandard"</span><span class="token operator">:</span> <span class="token string">"c++14"</span><span class="token punctuation">,</span>            <span class="token property">"intelliSenseMode"</span><span class="token operator">:</span> <span class="token string">"clang-x64"</span><span class="token punctuation">,</span>            <span class="token property">"compileCommands"</span><span class="token operator">:</span> <span class="token string">"$&#123;workspaceFolder&#125;/build/compile_commands.json"</span><span class="token punctuation">,</span>            <span class="token property">"configurationProvider"</span><span class="token operator">:</span> <span class="token string">"ms-vscode.cmake-tools"</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>配置属性</p><ul><li><p><code>name</code> 标识配置的友好名称。 Linux、Mac 和 Win32 是将在这些平台上自动选择的配置的特殊标识符。 VS Code 中的状态栏将显示哪个配置处于活动状态。您还可以单击状态栏中的标签来更改活动配置。</p></li><li><p><code>compilerPath</code> （可选）用于构建项目的编译器的完整路径，例如 <code>/usr/bin/gcc</code>，以启用更准确的 IntelliSense。该扩展将查询编译器以确定用于 IntelliSense 的系统包含路径和默认定义。</p></li><li><p><code>compilerArgs</code> （可选）用于修改所使用的包含或定义的编译器参数，例如 -nostdinc++、-m32 等。</p></li><li><p><code>intelliSenseMode</code> 使用的 IntelliSense 模式映射到 MSVC、gcc 或 Clang 的特定于体系结构的变体。如果未设置或设置为 <code>$&#123;default&#125;</code>，扩展将选择该平台的默认值。</p><p>平台默认值：</p><ul><li>Windows: <code>msvc-x64</code></li><li>Linux: <code>gcc-x64</code></li><li>macOS: <code>clang-x64</code></li></ul></li><li><p><code>includePath</code> 包含路径是一个文件夹，其中包含源文件中包含的头文件（例如 <code>#include &quot;myHeaderFile.h&quot;</code>）。指定 IntelliSense 引擎在搜索包含的头文件时使用的路径列表。在这些路径上搜索不是递归的。指定 <code>**</code> 表示递归搜索。例如， <code>$&#123;workspaceFolder&#125;/**</code> 将搜索所有子目录，而 <code>$&#123;workspaceFolder&#125;</code> 则不会。如果在安装了 Visual Studio 的 Windows 上，或者如果在 <code>compilerPath</code> 设置中指定了编译器，则无需在此列表中列出系统包含路径。</p></li><li><p><code>defines</code> 解析文件时要使用的 IntelliSense 引擎的预处理器定义列表。或者，使用 = 设置一个值，例如 VERSION=1。</p></li><li><p><code>cStandard</code> 用于 IntelliSense 的 C 语言标准的版本。</p></li><li><p><code>cppStandard</code> 用于 IntelliSense 的 C++ 语言标准的版本。</p></li><li><p><code>configurationProvider</code> 可以为源文件提供 IntelliSense 配置信息的 VS Code 扩展的 ID。例如，使用 VS Code 扩展 ID <code>ms-vscode.cmake-tools</code> 提供来自 CMake 工具扩展的配置信息。</p></li><li><p><code>windowsSdkVersion</code> Windows SDK 的版本包括在 Windows 上使用的路径，例如 <code>10.0.17134.0</code>。</p></li><li><p><code>macFrameworkPath</code> IntelliSense 引擎在从 Mac 框架搜索包含的标头时使用的路径列表。仅支持 macOS 的配置。</p></li><li><p><code>forcedInclude</code> （可选）在处理源文件中的任何其他字符之前应包含的文件列表。文件包含在列出的顺序中。</p></li><li><p><code>compileCommands</code> （可选）工作区的 <code>compile_commands.json</code> 文件的完整路径。将使用在此文件中发现的 <code>includePath</code> 和 <code>defines</code>，而不是为包含路径和定义设置设置的值。如果编译命令数据库不包含与您在编辑器中打开的文件相对应的翻译单元条目，则会出现一条警告消息，扩展将使用 <code>includePath</code> 和 <code>defines</code> 设置。  </p><p>有关文件格式的更多信息，请参阅 <a href="https://clang.llvm.org/docs/JSONCompilationDatabase.html">Clang 文档</a>。某些构建系统（例如 CMake）<a href="https://cmake.org/cmake/help/v3.5/variable/CMAKE_EXPORT_COMPILE_COMMANDS.html">简化了生成此文件的过程</a>。</p></li><li><p><code>browse</code> 当 <code>&quot;C_Cpp.intelliSenseEngine&quot;</code> 设置为 <code>&quot;Tag Parser&quot;</code>（也称为“模糊”IntelliSense，或“browse”引擎）时使用的属性集。这些属性也由转到定义/声明功能使用，或者当“Default”智能感知引擎无法解析源文件中的 <code>#includes</code> 时</p><ul><li><code>path</code> Tag Parser 用于搜索源文件中包含的标头的路径列表。<strong>如果省略，<code>includePath</code> 将用作 <code>path</code>。</strong>默认情况下，在这些路径上搜索是递归的。指定 <code>*</code> 表示非递归搜索。例如： <code>$&#123;workspaceFolder&#125;</code> 将搜索所有子目录，而 <code>$&#123;workspaceFolder&#125;/*</code> 不会。</li><li><code>limitSymbolsToIncludedHeaders</code> 当为 <code>true</code> 时，标签解析器将只解析 <code>$&#123;workspaceFolder&#125;</code> 中的源文件直接或间接包含的代码文件。当为 <code>false</code> 时，标签解析器将解析在 <code>browse.path</code> 列表中指定的路径中找到的所有代码文件。</li><li><code>databaseFilename</code> 生成的符号数据库的路径。此属性指示扩展将标记解析器的符号数据库保存在工作区默认存储位置以外的其他位置。如果指定了相对路径，它将相对于工作区的默认存储位置，而不是工作区文件夹本身。 <code>$&#123;workspaceFolder&#125;</code> 变量可用于指定相对于工作区文件夹的路径（例如 <code>$&#123;workspaceFolder&#125;/.vscode/browse.vc.db</code>）</li></ul></li></ul></li></ul><h3 id="多线程调试"><a href="#多线程调试" class="headerlink" title="多线程调试"></a>多线程调试</h3><p>当调试 SRS 多线程程序时， 因为有守护进程，VSCode 调试没有自动跟踪子线程，在父线程就退出了,可以在 <code>launch.json</code> 中添加强制跟踪子线程的配置，</p><ul><li>launch.json</li></ul><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.2.0"</span><span class="token punctuation">,</span>    <span class="token property">"configurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>            ...            <span class="token property">"setupCommands"</span><span class="token operator">:</span> <span class="token punctuation">[</span>                <span class="token punctuation">&#123;</span>                    <span class="token comment">// 设置跟踪子进程</span>                    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"-gdb-set follow-fork-mode child"</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="调试技巧"><a href="#调试技巧" class="headerlink" title="调试技巧"></a>调试技巧</h2><h3 id="调试控制台打印数组信息"><a href="#调试控制台打印数组信息" class="headerlink" title="调试控制台打印数组信息"></a>调试控制台打印数组信息</h3><p>调试遇见数组中存放指针时，vscode 调试器往往解析不出来数组信息，只能显示 <code>0</code> 索引的数据:</p><p><img src="https://cdn.jsdelivr.net/gh/seek4self/imgbed@main/img/blog/vscode/cmake/debug_console.png" alt="调试信息"></p><p>该段代码出自 ffmpeg 的示例程序 <a href="https://github.com/FFmpeg/FFmpeg/blob/master/doc/examples/muxing.c#L455">muxing.c</a>，有兴趣可以自行尝试。</p><p>因为 VSCode 也是基于 GDB 调试的，所以可以使用 GDB 的<code>@</code>操作符进行打印： <code>*array@len</code>，其中 <code>len</code> 是指定打印的长度，详细信息可以查看<a href="https://sourceware.org/gdb/current/onlinedocs/gdb/Arrays.html#Arrays">gdb 在线文档</a></p><p><img src="https://cdn.jsdelivr.net/gh/seek4self/imgbed@main/img/blog/vscode/cmake/debug_print_array.png" alt="调试输出"></p><p>若要从中间打印数组，只需要将 <code>*array</code> 索引改至指定的起始位置 <code>array[start]@len</code>，就会打印从 <code>start</code>~`len` 之间的数据。</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vscode </tag>
            
            <tag> c++ </tag>
            
            <tag> debug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SRS 初探之 HLS</title>
      <link href="stream/srs/srs-first-hls-f06a7b0f2c25/"/>
      <url>stream/srs/srs-first-hls-f06a7b0f2c25/</url>
      
        <content type="html"><![CDATA[<h2 id="srs-简介"><a href="#srs-简介" class="headerlink" title="srs 简介"></a>srs 简介</h2><p>SRS(Simple RTMP Server) 是国内开源的高性能流媒体集群服务器，支持 RTMP/HLS/HTTP-FLV/RTSP/DASH/WebRTC/SRT/GB28181 等多种流媒体协议，高效、稳定、易用，简单而快乐。</p><p>本文基于 srs <a href="https://github.com/ossrs/srs/tree/3.0release">3.0release</a> 版本搭建环境</p><h2 id="HLS-简介"><a href="#HLS-简介" class="headerlink" title="HLS 简介"></a>HLS 简介</h2><p><img src="https://cdn.jsdelivr.net/gh/seek4self/imgbed@main/img/blog/srs/hls.png" alt="hls Architecture from &lt;https://developer.apple.com/documentation/http_live_streaming&gt;"></p><p>HLS(Http Live Streaming) 是 Apple 公司出的流媒体协议，基于 HTTP 协议，以 m3u8 文件形式分发流，支持直播（live）和点播(vod)，一般用于传输 HEVC 或 H.264 视频和 AAC 或 AC-3 音频，流地址如下：</p><pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token header-name keyword">http:</span>//www.stream.com/live/livestream.m3u8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>HLS可以穿过任何允许HTTP数据通过的防火墙或者代理服务器。它也很容易使用内容分发网络来传输媒体流。</p><h3 id="m3u8-文件"><a href="#m3u8-文件" class="headerlink" title="m3u8 文件"></a>m3u8 文件</h3><p><code>.m3u8</code> 是播放列表目录文件，存储切片文件索引，可分为 <code>vod</code>、<code>live</code>、<code>event</code> 和 <code>master</code> 等多种类型， 前者存储多个分辨率/码率的 media 文件列表，可用于客户端播放自适应多码率视频流，后者仅存储 ts 列表</p><ul><li>live 类型示例：</li></ul><pre class="line-numbers language-m3u8" data-language="m3u8"><code class="language-m3u8">#EXTM3U                         &#x2F;&#x2F; m3u8标识标签，#EXT-X-VERSION:3                &#x2F;&#x2F; 协议版本#EXT-X-MEDIA-SEQUENCE:62        &#x2F;&#x2F; 第一个ts切片的序列号#EXT-X-TARGETDURATION:5         &#x2F;&#x2F; ts切片最大时长#EXTINF:5.000,                  &#x2F;&#x2F; ts切片信息， &lt;duration&gt;,&lt;title&gt;stream_62.ts                    &#x2F;&#x2F; uri地址，ts切片名#EXTINF:5.000,stream_63.ts#EXTINF:5.000,stream_64.ts#EXTINF:5.000,stream_65.ts#EXTINF:5.000,stream_66.ts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>vod 类型：文件末尾有终止标签 <code>#EXT-X-ENDLIST</code></li><li>event 类型: 文件开头有 类型标签 <code>EXT-X-PLAYLIST-TYPE</code>，该标签提供适用于整个播放列表文件的可变性信息。此标签可能包含值 <code>EVENT</code> 或 <code>VOD</code>。<ul><li>如果标签存在并且值为 <code>EVENT</code>，则服务器不得更改或删除已有播放列表文件的任何部分，可以追加新的 ts 信息，追加完成后以 <code>#EXT-X-ENDLIST</code> 结尾。</li><li>如果标签存在且值为 <code>VOD</code>，则播放列表文件不得做任何更改， 即当播放列表出现 <code>#EXT-X-ENDLIST</code> 时，意味着该列表已经固定不会发生任何改动。</li></ul></li><li>master 文件，提供不同带宽下不同分辨率的流地址，客户端根据测量的网络比特率切换到最合适的地址，包含 <code>BANDWIDTH</code>(必须)、<code>RESOLUTION</code>、<code>CODECS</code>(建议) 等信息</li></ul><pre class="line-numbers language-m3u8" data-language="m3u8"><code class="language-m3u8">#EXTM3U#EXT-X-STREAM-INF:BANDWIDTH&#x3D;150000,RESOLUTION&#x3D;416x234,CODECS&#x3D;&quot;avc1.42e00a,mp4a.40.2&quot;http:&#x2F;&#x2F;example.com&#x2F;low&#x2F;index.m3u8#EXT-X-STREAM-INF:BANDWIDTH&#x3D;240000,RESOLUTION&#x3D;416x234,CODECS&#x3D;&quot;avc1.42e00a,mp4a.40.2&quot;http:&#x2F;&#x2F;example.com&#x2F;lo_mid&#x2F;index.m3u8#EXT-X-STREAM-INF:BANDWIDTH&#x3D;440000,RESOLUTION&#x3D;416x234,CODECS&#x3D;&quot;avc1.42e00a,mp4a.40.2&quot;http:&#x2F;&#x2F;example.com&#x2F;hi_mid&#x2F;index.m3u8#EXT-X-STREAM-INF:BANDWIDTH&#x3D;640000,RESOLUTION&#x3D;640x360,CODECS&#x3D;&quot;avc1.42e00a,mp4a.40.2&quot;http:&#x2F;&#x2F;example.com&#x2F;high&#x2F;index.m3u8#EXT-X-STREAM-INF:BANDWIDTH&#x3D;64000,CODECS&#x3D;&quot;mp4a.40.5&quot;http:&#x2F;&#x2F;example.com&#x2F;audio&#x2F;index.m3u8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ts-切片"><a href="#ts-切片" class="headerlink" title="ts 切片"></a>ts 切片</h3><blockquote><p>To do continue</p></blockquote><h2 id="srs-分发-hls"><a href="#srs-分发-hls" class="headerlink" title="srs 分发 hls"></a>srs 分发 hls</h2><p>将 rtmp 流 推送到 srs 服务，通过 srs 将 rtmp 流切片并复用成 ts 格式文件，在没有转码的配置下只支持 h.264+aac 流格式</p><h2 id="hls-类关系"><a href="#hls-类关系" class="headerlink" title="hls 类关系"></a>hls 类关系</h2><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIxMjE3cHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo4OTdweDtoZWlnaHQ6MTIxN3B4O2JhY2tncm91bmQ6I0ZGRkZGRjsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDg5NyAxMjE3IiB3aWR0aD0iODk3cHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48IS0tTUQ1PVswZjY1MjNmODI4N2UxMDhhNDMxZDk2MWIxYjU2ZmM4N10KY2xhc3MgU3JzSGxzLS0+PGcgaWQ9ImVsZW1fU3JzSGxzIj48cmVjdCBjb2RlTGluZT0iMSIgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIxNjIuMDc4MSIgaWQ9IlNyc0hscyIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMwIiB4PSIzNDMuNSIgeT0iMTE1Ii8+PGVsbGlwc2UgY3g9IjM4My4yNSIgY3k9IjEzMSIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwYXRoIGQ9Ik0zODUuNTkzOCwxMjYuNjcxOSBDMzg0LjY1NjMsMTI2LjIzNDQgMzg0LjA2MjUsMTI2LjA5MzggMzgzLjE4NzUsMTI2LjA5MzggQzM4MC41NjI1LDEyNi4wOTM4IDM3OC41NjI1LDEyOC4xNzE5IDM3OC41NjI1LDEzMC44OTA2IEwzNzguNTYyNSwxMzIuMDE1NiBDMzc4LjU2MjUsMTM0LjU5MzggMzgwLjY3MTksMTM2LjQ4NDQgMzgzLjU2MjUsMTM2LjQ4NDQgQzM4NC43ODEzLDEzNi40ODQ0IDM4NS45Mzc1LDEzNi4xODc1IDM4Ni42ODc1LDEzNS42NDA2IEMzODcuMjY1NiwxMzUuMjM0NCAzODcuNTkzOCwxMzQuNzgxMyAzODcuNTkzOCwxMzQuMzkwNiBDMzg3LjU5MzgsMTMzLjkzNzUgMzg3LjIwMzEsMTMzLjU0NjkgMzg2LjczNDQsMTMzLjU0NjkgQzM4Ni41MTU2LDEzMy41NDY5IDM4Ni4zMTI1LDEzMy42MjUgMzg2LjEyNSwxMzMuODEyNSBDMzg1LjY3MTksMTM0LjI5NjkgMzg1LjY3MTksMTM0LjI5NjkgMzg1LjQ4NDQsMTM0LjM5MDYgQzM4NS4wNjI1LDEzNC42NTYzIDM4NC4zNzUsMTM0Ljc4MTMgMzgzLjYwOTQsMTM0Ljc4MTMgQzM4MS41NjI1LDEzNC43ODEzIDM4MC4yNjU2LDEzMy42ODc1IDM4MC4yNjU2LDEzMS45ODQ0IEwzODAuMjY1NiwxMzAuODkwNiBDMzgwLjI2NTYsMTI5LjEwOTQgMzgxLjUxNTYsMTI3Ljc5NjkgMzgzLjI1LDEyNy43OTY5IEMzODMuODI4MSwxMjcuNzk2OSAzODQuNDM3NSwxMjcuOTUzMSAzODQuOTA2MywxMjguMjAzMSBDMzg1LjM5MDYsMTI4LjQ4NDQgMzg1LjU2MjUsMTI4LjcwMzEgMzg1LjY1NjMsMTI5LjEwOTQgQzM4NS43MTg4LDEyOS41MTU2IDM4NS43NSwxMjkuNjQwNiAzODUuODkwNiwxMjkuNzY1NiBDMzg2LjAzMTMsMTI5LjkwNjMgMzg2LjI2NTYsMTMwLjAxNTYgMzg2LjQ4NDQsMTMwLjAxNTYgQzM4Ni43NSwxMzAuMDE1NiAzODcuMDE1NiwxMjkuODc1IDM4Ny4xODc1LDEyOS42NTYzIEMzODcuMjk2OSwxMjkuNSAzODcuMzI4MSwxMjkuMzEyNSAzODcuMzI4MSwxMjguODkwNiBMMzg3LjMyODEsMTI3LjQ2ODggQzM4Ny4zMjgxLDEyNy4wMzEzIDM4Ny4zMTI1LDEyNi45MDYzIDM4Ny4yMTg4LDEyNi43NSBDMzg3LjA2MjUsMTI2LjQ4NDQgMzg2Ljc4MTMsMTI2LjM0MzggMzg2LjQ4NDQsMTI2LjM0MzggQzM4Ni4xODc1LDEyNi4zNDM4IDM4NS45ODQ0LDEyNi40Mzc1IDM4NS43NjU2LDEyNi43NSBMMzg1LjU5MzgsMTI2LjY3MTkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0MyIgeD0iNDAyLjc1IiB5PSIxMzUuODQ2NyI+U3JzSGxzPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjM0NC41IiB4Mj0iNDcyLjUiIHkxPSIxNDciIHkyPSIxNDciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzNDQuNSIgeDI9IjQ3Mi41IiB5MT0iMTU1IiB5Mj0iMTU1Ii8+PGVsbGlwc2UgY3g9IjM1NC41IiBjeT0iMTY2IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjY1IiB4PSIzNjMuNSIgeT0iMTcxLjk5NTEiPmRpc3Bvc2UoKTwvdGV4dD48ZWxsaXBzZSBjeD0iMzU0LjUiIGN5PSIxODIuMjk2OSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NyIgeD0iMzYzLjUiIHk9IjE4OC4yOTIiPmN5Y2xlKCk8L3RleHQ+PGVsbGlwc2UgY3g9IjM1NC41IiBjeT0iMTk4LjU5MzgiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzEiIHg9IjM2My41IiB5PSIyMDQuNTg4OSI+aW5pdGlhbGl6ZSgpPC90ZXh0PjxlbGxpcHNlIGN4PSIzNTQuNSIgY3k9IjIxNC44OTA2IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijg3IiB4PSIzNjMuNSIgeT0iMjIwLjg4NTciPm9uX3B1Ymxpc2goKTwvdGV4dD48ZWxsaXBzZSBjeD0iMzU0LjUiIGN5PSIyMzEuMTg3NSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQiIHg9IjM2My41IiB5PSIyMzcuMTgyNiI+b25fdW5wdWJsaXNoKCk8L3RleHQ+PGVsbGlwc2UgY3g9IjM1NC41IiBjeT0iMjQ3LjQ4NDQiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzMiIHg9IjM2My41IiB5PSIyNTMuNDc5NSI+b25fYXVkaW8oKTwvdGV4dD48ZWxsaXBzZSBjeD0iMzU0LjUiIGN5PSIyNjMuNzgxMyIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NCIgeD0iMzYzLjUiIHk9IjI2OS43NzY0Ij5vbl92aWRlbygpPC90ZXh0PjwvZz48IS0tTUQ1PVs1YzJkNzE0ZDliZWJlMTU0ODg0M2U4YmQwMDMyZWRmZl0KY2xhc3MgU3JzSGxzTXV4ZXItLT48ZyBpZD0iZWxlbV9TcnNIbHNNdXhlciI+PHJlY3QgY29kZUxpbmU9IjExIiBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzMy4wNDY5IiBpZD0iU3JzSGxzTXV4ZXIiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI2OCIgeD0iMTcwLjUiIHk9IjU1MyIvPjxlbGxpcHNlIGN4PSIyNTcuMjUiIGN5PSI1NjkiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNMjU5LjU5MzgsNTY0LjY3MTkgQzI1OC42NTYzLDU2NC4yMzQ0IDI1OC4wNjI1LDU2NC4wOTM4IDI1Ny4xODc1LDU2NC4wOTM4IEMyNTQuNTYyNSw1NjQuMDkzOCAyNTIuNTYyNSw1NjYuMTcxOSAyNTIuNTYyNSw1NjguODkwNiBMMjUyLjU2MjUsNTcwLjAxNTYgQzI1Mi41NjI1LDU3Mi41OTM4IDI1NC42NzE5LDU3NC40ODQ0IDI1Ny41NjI1LDU3NC40ODQ0IEMyNTguNzgxMyw1NzQuNDg0NCAyNTkuOTM3NSw1NzQuMTg3NSAyNjAuNjg3NSw1NzMuNjQwNiBDMjYxLjI2NTYsNTczLjIzNDQgMjYxLjU5MzgsNTcyLjc4MTMgMjYxLjU5MzgsNTcyLjM5MDYgQzI2MS41OTM4LDU3MS45Mzc1IDI2MS4yMDMxLDU3MS41NDY5IDI2MC43MzQ0LDU3MS41NDY5IEMyNjAuNTE1Niw1NzEuNTQ2OSAyNjAuMzEyNSw1NzEuNjI1IDI2MC4xMjUsNTcxLjgxMjUgQzI1OS42NzE5LDU3Mi4yOTY5IDI1OS42NzE5LDU3Mi4yOTY5IDI1OS40ODQ0LDU3Mi4zOTA2IEMyNTkuMDYyNSw1NzIuNjU2MyAyNTguMzc1LDU3Mi43ODEzIDI1Ny42MDk0LDU3Mi43ODEzIEMyNTUuNTYyNSw1NzIuNzgxMyAyNTQuMjY1Niw1NzEuNjg3NSAyNTQuMjY1Niw1NjkuOTg0NCBMMjU0LjI2NTYsNTY4Ljg5MDYgQzI1NC4yNjU2LDU2Ny4xMDk0IDI1NS41MTU2LDU2NS43OTY5IDI1Ny4yNSw1NjUuNzk2OSBDMjU3LjgyODEsNTY1Ljc5NjkgMjU4LjQzNzUsNTY1Ljk1MzEgMjU4LjkwNjMsNTY2LjIwMzEgQzI1OS4zOTA2LDU2Ni40ODQ0IDI1OS41NjI1LDU2Ni43MDMxIDI1OS42NTYzLDU2Ny4xMDk0IEMyNTkuNzE4OCw1NjcuNTE1NiAyNTkuNzUsNTY3LjY0MDYgMjU5Ljg5MDYsNTY3Ljc2NTYgQzI2MC4wMzEzLDU2Ny45MDYzIDI2MC4yNjU2LDU2OC4wMTU2IDI2MC40ODQ0LDU2OC4wMTU2IEMyNjAuNzUsNTY4LjAxNTYgMjYxLjAxNTYsNTY3Ljg3NSAyNjEuMTg3NSw1NjcuNjU2MyBDMjYxLjI5NjksNTY3LjUgMjYxLjMyODEsNTY3LjMxMjUgMjYxLjMyODEsNTY2Ljg5MDYgTDI2MS4zMjgxLDU2NS40Njg4IEMyNjEuMzI4MSw1NjUuMDMxMyAyNjEuMzEyNSw1NjQuOTA2MyAyNjEuMjE4OCw1NjQuNzUgQzI2MS4wNjI1LDU2NC40ODQ0IDI2MC43ODEzLDU2NC4zNDM4IDI2MC40ODQ0LDU2NC4zNDM4IEMyNjAuMTg3NSw1NjQuMzQzOCAyNTkuOTg0NCw1NjQuNDM3NSAyNTkuNzY1Niw1NjQuNzUgTDI1OS41OTM4LDU2NC42NzE5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODYiIHg9IjI3Ny43NSIgeT0iNTczLjg0NjciPlNyc0hsc011eGVyPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjE3MS41IiB4Mj0iNDM3LjUiIHkxPSI1ODUiIHkyPSI1ODUiLz48ZWxsaXBzZSBjeD0iMTgxLjUiIGN5PSI1OTYiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAzIiB4PSIxOTAuNSIgeT0iNjAxLjk5NTEiPnNlcXVlbmNlX25vKCk8L3RleHQ+PGVsbGlwc2UgY3g9IjE4MS41IiBjeT0iNjEyLjI5NjkiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDkiIHg9IjE5MC41IiB5PSI2MTguMjkyIj50c191cmwoKTwvdGV4dD48ZWxsaXBzZSBjeD0iMTgxLjUiIGN5PSI2MjguNTkzOCIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3MCIgeD0iMTkwLjUiIHk9IjYzNC41ODg5Ij5kdXJhdGlvbigpPC90ZXh0PjxlbGxpcHNlIGN4PSIxODEuNSIgY3k9IjY0NC44OTA2IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc3IiB4PSIxOTAuNSIgeT0iNjUwLjg4NTciPmRldmlhdGlvbigpPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6MS4wLDIuMDsiIHgxPSIxNzEuNSIgeDI9IjQzNy41IiB5MT0iNjU4LjE4NzUiIHkyPSI2NTguMTg3NSIvPjxlbGxpcHNlIGN4PSIxODEuNSIgY3k9IjY2OS4xODc1IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjcxIiB4PSIxOTAuNSIgeT0iNjc1LjE4MjYiPmluaXRpYWxpemUoKTwvdGV4dD48ZWxsaXBzZSBjeD0iMTgxLjUiIGN5PSI2ODUuNDg0NCIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4NyIgeD0iMTkwLjUiIHk9IjY5MS40Nzk1Ij5vbl9wdWJsaXNoKCk8L3RleHQ+PGVsbGlwc2UgY3g9IjE4MS41IiBjeT0iNzAxLjc4MTMiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA0IiB4PSIxOTAuNSIgeT0iNzA3Ljc3NjQiPm9uX3VucHVibGlzaCgpPC90ZXh0PjxlbGxpcHNlIGN4PSIxODEuNSIgY3k9IjcxOC4wNzgxIiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExMyIgeD0iMTkwLjUiIHk9IjcyNC4wNzMyIj51cGRhdGVfY29uZmlnKCk8L3RleHQ+PGVsbGlwc2UgY3g9IjE4MS41IiBjeT0iNzM0LjM3NSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTgiIHg9IjE5MC41IiB5PSI3NDAuMzcwMSI+c2VnbWVudF9vcGVuKCk8L3RleHQ+PGVsbGlwc2UgY3g9IjE4MS41IiBjeT0iNzUwLjY3MTkiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTYwIiB4PSIxOTAuNSIgeT0iNzU2LjY2NyI+b25fc2VxdWVuY2VfaGVhZGVyKCk8L3RleHQ+PGVsbGlwc2UgY3g9IjE4MS41IiBjeT0iNzY2Ljk2ODgiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTYxIiB4PSIxOTAuNSIgeT0iNzcyLjk2MzkiPmlzX3NlZ21lbnRfb3ZlcmZsb3coKTwvdGV4dD48ZWxsaXBzZSBjeD0iMTgxLjUiIGN5PSI3ODMuMjY1NiIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTYiIHg9IjE5MC41IiB5PSI3ODkuMjYwNyI+d2FpdF9rZXlmcmFtZSgpPC90ZXh0PjxlbGxpcHNlIGN4PSIxODEuNSIgY3k9Ijc5OS41NjI1IiBmaWxsPSIjODRCRTg0IiByeD0iMyIgcnk9IjMiIHN0eWxlPSJzdHJva2U6IzAzODA0ODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI0MiIgeD0iMTkwLjUiIHk9IjgwNS41NTc2Ij5pc19zZWdtZW50X2Fic29sdXRlbHlfb3ZlcmZsb3coKTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDtzdHJva2UtZGFzaGFycmF5OjEuMCwyLjA7IiB4MT0iMTcxLjUiIHgyPSI0MzcuNSIgeTE9IjgxMi44NTk0IiB5Mj0iODEyLjg1OTQiLz48ZWxsaXBzZSBjeD0iMTgxLjUiIGN5PSI4MjMuODU5NCIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4OCIgeD0iMTkwLjUiIHk9IjgyOS44NTQ1Ij5wdXJlX2F1ZGlvKCk8L3RleHQ+PGVsbGlwc2UgY3g9IjE4MS41IiBjeT0iODQwLjE1NjMiIGZpbGw9IiM4NEJFODQiIHJ4PSIzIiByeT0iMyIgc3R5bGU9InN0cm9rZTojMDM4MDQ4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODkiIHg9IjE5MC41IiB5PSI4NDYuMTUxNCI+Zmx1c2hfYXVkaW8oKTwvdGV4dD48ZWxsaXBzZSBjeD0iMTgxLjUiIGN5PSI4NTYuNDUzMSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MCIgeD0iMTkwLjUiIHk9Ijg2Mi40NDgyIj5mbHVzaF92aWRlbygpPC90ZXh0PjxlbGxpcHNlIGN4PSIxODEuNSIgY3k9Ijg3Mi43NSIgZmlsbD0iIzg0QkU4NCIgcng9IjMiIHJ5PSIzIiBzdHlsZT0ic3Ryb2tlOiMwMzgwNDg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMTgiIHg9IjE5MC41IiB5PSI4NzguNzQ1MSI+c2VnbWVudF9jbG9zZSgpPC90ZXh0PjwvZz48IS0tTUQ1PVtkMzhjYWM3NmVkYjM0YjgwMzFjYWQ3Y2YzZjE4MTNhM10KY2xhc3MgU3JzT3JpZ2luSHViLS0+PGcgaWQ9ImVsZW1fU3JzT3JpZ2luSHViIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiBpZD0iU3JzT3JpZ2luSHViIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjUiIHg9IjM0NiIgeT0iNyIvPjxlbGxpcHNlIGN4PSIzNjEiIGN5PSIyMyIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwYXRoIGQ9Ik0zNjMuMzQzOCwxOC42NzE5IEMzNjIuNDA2MywxOC4yMzQ0IDM2MS44MTI1LDE4LjA5MzggMzYwLjkzNzUsMTguMDkzOCBDMzU4LjMxMjUsMTguMDkzOCAzNTYuMzEyNSwyMC4xNzE5IDM1Ni4zMTI1LDIyLjg5MDYgTDM1Ni4zMTI1LDI0LjAxNTYgQzM1Ni4zMTI1LDI2LjU5MzggMzU4LjQyMTksMjguNDg0NCAzNjEuMzEyNSwyOC40ODQ0IEMzNjIuNTMxMywyOC40ODQ0IDM2My42ODc1LDI4LjE4NzUgMzY0LjQzNzUsMjcuNjQwNiBDMzY1LjAxNTYsMjcuMjM0NCAzNjUuMzQzOCwyNi43ODEzIDM2NS4zNDM4LDI2LjM5MDYgQzM2NS4zNDM4LDI1LjkzNzUgMzY0Ljk1MzEsMjUuNTQ2OSAzNjQuNDg0NCwyNS41NDY5IEMzNjQuMjY1NiwyNS41NDY5IDM2NC4wNjI1LDI1LjYyNSAzNjMuODc1LDI1LjgxMjUgQzM2My40MjE5LDI2LjI5NjkgMzYzLjQyMTksMjYuMjk2OSAzNjMuMjM0NCwyNi4zOTA2IEMzNjIuODEyNSwyNi42NTYzIDM2Mi4xMjUsMjYuNzgxMyAzNjEuMzU5NCwyNi43ODEzIEMzNTkuMzEyNSwyNi43ODEzIDM1OC4wMTU2LDI1LjY4NzUgMzU4LjAxNTYsMjMuOTg0NCBMMzU4LjAxNTYsMjIuODkwNiBDMzU4LjAxNTYsMjEuMTA5NCAzNTkuMjY1NiwxOS43OTY5IDM2MSwxOS43OTY5IEMzNjEuNTc4MSwxOS43OTY5IDM2Mi4xODc1LDE5Ljk1MzEgMzYyLjY1NjMsMjAuMjAzMSBDMzYzLjE0MDYsMjAuNDg0NCAzNjMuMzEyNSwyMC43MDMxIDM2My40MDYzLDIxLjEwOTQgQzM2My40Njg4LDIxLjUxNTYgMzYzLjUsMjEuNjQwNiAzNjMuNjQwNiwyMS43NjU2IEMzNjMuNzgxMywyMS45MDYzIDM2NC4wMTU2LDIyLjAxNTYgMzY0LjIzNDQsMjIuMDE1NiBDMzY0LjUsMjIuMDE1NiAzNjQuNzY1NiwyMS44NzUgMzY0LjkzNzUsMjEuNjU2MyBDMzY1LjA0NjksMjEuNSAzNjUuMDc4MSwyMS4zMTI1IDM2NS4wNzgxLDIwLjg5MDYgTDM2NS4wNzgxLDE5LjQ2ODggQzM2NS4wNzgxLDE5LjAzMTMgMzY1LjA2MjUsMTguOTA2MyAzNjQuOTY4OCwxOC43NSBDMzY0LjgxMjUsMTguNDg0NCAzNjQuNTMxMywxOC4zNDM4IDM2NC4yMzQ0LDE4LjM0MzggQzM2My45Mzc1LDE4LjM0MzggMzYzLjczNDQsMTguNDM3NSAzNjMuNTE1NiwxOC43NSBMMzYzLjM0MzgsMTguNjcxOSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkzIiB4PSIzNzUiIHk9IjI3Ljg0NjciPlNyc09yaWdpbkh1YjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIzNDciIHgyPSI0NzAiIHkxPSIzOSIgeTI9IjM5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMzQ3IiB4Mj0iNDcwIiB5MT0iNDciIHkyPSI0NyIvPjwvZz48IS0tTUQ1PVswYzhkZGMxMjExNjJkNWQ5ZTRjODA5YWMxM2JiYjQ0MF0KY2xhc3MgU3JzRm9ybWF0LS0+PGcgaWQ9ImVsZW1fU3JzRm9ybWF0Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiBpZD0iU3JzRm9ybWF0IiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMDYiIHg9IjExNC41IiB5PSIzMzciLz48ZWxsaXBzZSBjeD0iMTI5LjUiIGN5PSIzNTMiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNMTMxLjg0MzgsMzQ4LjY3MTkgQzEzMC45MDYzLDM0OC4yMzQ0IDEzMC4zMTI1LDM0OC4wOTM4IDEyOS40Mzc1LDM0OC4wOTM4IEMxMjYuODEyNSwzNDguMDkzOCAxMjQuODEyNSwzNTAuMTcxOSAxMjQuODEyNSwzNTIuODkwNiBMMTI0LjgxMjUsMzU0LjAxNTYgQzEyNC44MTI1LDM1Ni41OTM4IDEyNi45MjE5LDM1OC40ODQ0IDEyOS44MTI1LDM1OC40ODQ0IEMxMzEuMDMxMywzNTguNDg0NCAxMzIuMTg3NSwzNTguMTg3NSAxMzIuOTM3NSwzNTcuNjQwNiBDMTMzLjUxNTYsMzU3LjIzNDQgMTMzLjg0MzgsMzU2Ljc4MTMgMTMzLjg0MzgsMzU2LjM5MDYgQzEzMy44NDM4LDM1NS45Mzc1IDEzMy40NTMxLDM1NS41NDY5IDEzMi45ODQ0LDM1NS41NDY5IEMxMzIuNzY1NiwzNTUuNTQ2OSAxMzIuNTYyNSwzNTUuNjI1IDEzMi4zNzUsMzU1LjgxMjUgQzEzMS45MjE5LDM1Ni4yOTY5IDEzMS45MjE5LDM1Ni4yOTY5IDEzMS43MzQ0LDM1Ni4zOTA2IEMxMzEuMzEyNSwzNTYuNjU2MyAxMzAuNjI1LDM1Ni43ODEzIDEyOS44NTk0LDM1Ni43ODEzIEMxMjcuODEyNSwzNTYuNzgxMyAxMjYuNTE1NiwzNTUuNjg3NSAxMjYuNTE1NiwzNTMuOTg0NCBMMTI2LjUxNTYsMzUyLjg5MDYgQzEyNi41MTU2LDM1MS4xMDk0IDEyNy43NjU2LDM0OS43OTY5IDEyOS41LDM0OS43OTY5IEMxMzAuMDc4MSwzNDkuNzk2OSAxMzAuNjg3NSwzNDkuOTUzMSAxMzEuMTU2MywzNTAuMjAzMSBDMTMxLjY0MDYsMzUwLjQ4NDQgMTMxLjgxMjUsMzUwLjcwMzEgMTMxLjkwNjMsMzUxLjEwOTQgQzEzMS45Njg4LDM1MS41MTU2IDEzMiwzNTEuNjQwNiAxMzIuMTQwNiwzNTEuNzY1NiBDMTMyLjI4MTMsMzUxLjkwNjMgMTMyLjUxNTYsMzUyLjAxNTYgMTMyLjczNDQsMzUyLjAxNTYgQzEzMywzNTIuMDE1NiAxMzMuMjY1NiwzNTEuODc1IDEzMy40Mzc1LDM1MS42NTYzIEMxMzMuNTQ2OSwzNTEuNSAxMzMuNTc4MSwzNTEuMzEyNSAxMzMuNTc4MSwzNTAuODkwNiBMMTMzLjU3ODEsMzQ5LjQ2ODggQzEzMy41NzgxLDM0OS4wMzEzIDEzMy41NjI1LDM0OC45MDYzIDEzMy40Njg4LDM0OC43NSBDMTMzLjMxMjUsMzQ4LjQ4NDQgMTMzLjAzMTMsMzQ4LjM0MzggMTMyLjczNDQsMzQ4LjM0MzggQzEzMi40Mzc1LDM0OC4zNDM4IDEzMi4yMzQ0LDM0OC40Mzc1IDEzMi4wMTU2LDM0OC43NSBMMTMxLjg0MzgsMzQ4LjY3MTkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI3NCIgeD0iMTQzLjUiIHk9IjM1Ny44NDY3Ij5TcnNGb3JtYXQ8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMTE1LjUiIHgyPSIyMTkuNSIgeTE9IjM2OSIgeTI9IjM2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjExNS41IiB4Mj0iMjE5LjUiIHkxPSIzNzciIHkyPSIzNzciLz48L2c+PCEtLU1ENT1bMmMzY2UzYzQ5ODdhODI0ZmQzM2U2MDc4NWMyMDQ2NmRdCmNsYXNzIFNyc1J0bXBKaXR0ZXItLT48ZyBpZD0iZWxlbV9TcnNSdG1wSml0dGVyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiBpZD0iU3JzUnRtcEppdHRlciIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTMyIiB4PSIyNTUuNSIgeT0iMzM3Ii8+PGVsbGlwc2UgY3g9IjI3MC41IiBjeT0iMzUzIiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBhdGggZD0iTTI3Mi44NDM4LDM0OC42NzE5IEMyNzEuOTA2MywzNDguMjM0NCAyNzEuMzEyNSwzNDguMDkzOCAyNzAuNDM3NSwzNDguMDkzOCBDMjY3LjgxMjUsMzQ4LjA5MzggMjY1LjgxMjUsMzUwLjE3MTkgMjY1LjgxMjUsMzUyLjg5MDYgTDI2NS44MTI1LDM1NC4wMTU2IEMyNjUuODEyNSwzNTYuNTkzOCAyNjcuOTIxOSwzNTguNDg0NCAyNzAuODEyNSwzNTguNDg0NCBDMjcyLjAzMTMsMzU4LjQ4NDQgMjczLjE4NzUsMzU4LjE4NzUgMjczLjkzNzUsMzU3LjY0MDYgQzI3NC41MTU2LDM1Ny4yMzQ0IDI3NC44NDM4LDM1Ni43ODEzIDI3NC44NDM4LDM1Ni4zOTA2IEMyNzQuODQzOCwzNTUuOTM3NSAyNzQuNDUzMSwzNTUuNTQ2OSAyNzMuOTg0NCwzNTUuNTQ2OSBDMjczLjc2NTYsMzU1LjU0NjkgMjczLjU2MjUsMzU1LjYyNSAyNzMuMzc1LDM1NS44MTI1IEMyNzIuOTIxOSwzNTYuMjk2OSAyNzIuOTIxOSwzNTYuMjk2OSAyNzIuNzM0NCwzNTYuMzkwNiBDMjcyLjMxMjUsMzU2LjY1NjMgMjcxLjYyNSwzNTYuNzgxMyAyNzAuODU5NCwzNTYuNzgxMyBDMjY4LjgxMjUsMzU2Ljc4MTMgMjY3LjUxNTYsMzU1LjY4NzUgMjY3LjUxNTYsMzUzLjk4NDQgTDI2Ny41MTU2LDM1Mi44OTA2IEMyNjcuNTE1NiwzNTEuMTA5NCAyNjguNzY1NiwzNDkuNzk2OSAyNzAuNSwzNDkuNzk2OSBDMjcxLjA3ODEsMzQ5Ljc5NjkgMjcxLjY4NzUsMzQ5Ljk1MzEgMjcyLjE1NjMsMzUwLjIwMzEgQzI3Mi42NDA2LDM1MC40ODQ0IDI3Mi44MTI1LDM1MC43MDMxIDI3Mi45MDYzLDM1MS4xMDk0IEMyNzIuOTY4OCwzNTEuNTE1NiAyNzMsMzUxLjY0MDYgMjczLjE0MDYsMzUxLjc2NTYgQzI3My4yODEzLDM1MS45MDYzIDI3My41MTU2LDM1Mi4wMTU2IDI3My43MzQ0LDM1Mi4wMTU2IEMyNzQsMzUyLjAxNTYgMjc0LjI2NTYsMzUxLjg3NSAyNzQuNDM3NSwzNTEuNjU2MyBDMjc0LjU0NjksMzUxLjUgMjc0LjU3ODEsMzUxLjMxMjUgMjc0LjU3ODEsMzUwLjg5MDYgTDI3NC41NzgxLDM0OS40Njg4IEMyNzQuNTc4MSwzNDkuMDMxMyAyNzQuNTYyNSwzNDguOTA2MyAyNzQuNDY4OCwzNDguNzUgQzI3NC4zMTI1LDM0OC40ODQ0IDI3NC4wMzEzLDM0OC4zNDM4IDI3My43MzQ0LDM0OC4zNDM4IEMyNzMuNDM3NSwzNDguMzQzOCAyNzMuMjM0NCwzNDguNDM3NSAyNzMuMDE1NiwzNDguNzUgTDI3Mi44NDM4LDM0OC42NzE5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAwIiB4PSIyODQuNSIgeT0iMzU3Ljg0NjciPlNyc1J0bXBKaXR0ZXI8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iMjU2LjUiIHgyPSIzODYuNSIgeTE9IjM2OSIgeTI9IjM2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI1Ni41IiB4Mj0iMzg2LjUiIHkxPSIzNzciIHkyPSIzNzciLz48L2c+PCEtLU1ENT1bNDY2MzM1YTEwZDBjMGY4ZjRkMTdjYWNiMjNlMzY3NzBdCmNsYXNzIFNyc0hsc0NvbnRyb2xsZXItLT48ZyBpZD0iZWxlbV9TcnNIbHNDb250cm9sbGVyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiBpZD0iU3JzSGxzQ29udHJvbGxlciIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ4IiB4PSI0MjIuNSIgeT0iMzM3Ii8+PGVsbGlwc2UgY3g9IjQzNy41IiBjeT0iMzUzIiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBhdGggZD0iTTQzOS44NDM4LDM0OC42NzE5IEM0MzguOTA2MywzNDguMjM0NCA0MzguMzEyNSwzNDguMDkzOCA0MzcuNDM3NSwzNDguMDkzOCBDNDM0LjgxMjUsMzQ4LjA5MzggNDMyLjgxMjUsMzUwLjE3MTkgNDMyLjgxMjUsMzUyLjg5MDYgTDQzMi44MTI1LDM1NC4wMTU2IEM0MzIuODEyNSwzNTYuNTkzOCA0MzQuOTIxOSwzNTguNDg0NCA0MzcuODEyNSwzNTguNDg0NCBDNDM5LjAzMTMsMzU4LjQ4NDQgNDQwLjE4NzUsMzU4LjE4NzUgNDQwLjkzNzUsMzU3LjY0MDYgQzQ0MS41MTU2LDM1Ny4yMzQ0IDQ0MS44NDM4LDM1Ni43ODEzIDQ0MS44NDM4LDM1Ni4zOTA2IEM0NDEuODQzOCwzNTUuOTM3NSA0NDEuNDUzMSwzNTUuNTQ2OSA0NDAuOTg0NCwzNTUuNTQ2OSBDNDQwLjc2NTYsMzU1LjU0NjkgNDQwLjU2MjUsMzU1LjYyNSA0NDAuMzc1LDM1NS44MTI1IEM0MzkuOTIxOSwzNTYuMjk2OSA0MzkuOTIxOSwzNTYuMjk2OSA0MzkuNzM0NCwzNTYuMzkwNiBDNDM5LjMxMjUsMzU2LjY1NjMgNDM4LjYyNSwzNTYuNzgxMyA0MzcuODU5NCwzNTYuNzgxMyBDNDM1LjgxMjUsMzU2Ljc4MTMgNDM0LjUxNTYsMzU1LjY4NzUgNDM0LjUxNTYsMzUzLjk4NDQgTDQzNC41MTU2LDM1Mi44OTA2IEM0MzQuNTE1NiwzNTEuMTA5NCA0MzUuNzY1NiwzNDkuNzk2OSA0MzcuNSwzNDkuNzk2OSBDNDM4LjA3ODEsMzQ5Ljc5NjkgNDM4LjY4NzUsMzQ5Ljk1MzEgNDM5LjE1NjMsMzUwLjIwMzEgQzQzOS42NDA2LDM1MC40ODQ0IDQzOS44MTI1LDM1MC43MDMxIDQzOS45MDYzLDM1MS4xMDk0IEM0MzkuOTY4OCwzNTEuNTE1NiA0NDAsMzUxLjY0MDYgNDQwLjE0MDYsMzUxLjc2NTYgQzQ0MC4yODEzLDM1MS45MDYzIDQ0MC41MTU2LDM1Mi4wMTU2IDQ0MC43MzQ0LDM1Mi4wMTU2IEM0NDEsMzUyLjAxNTYgNDQxLjI2NTYsMzUxLjg3NSA0NDEuNDM3NSwzNTEuNjU2MyBDNDQxLjU0NjksMzUxLjUgNDQxLjU3ODEsMzUxLjMxMjUgNDQxLjU3ODEsMzUwLjg5MDYgTDQ0MS41NzgxLDM0OS40Njg4IEM0NDEuNTc4MSwzNDkuMDMxMyA0NDEuNTYyNSwzNDguOTA2MyA0NDEuNDY4OCwzNDguNzUgQzQ0MS4zMTI1LDM0OC40ODQ0IDQ0MS4wMzEzLDM0OC4zNDM4IDQ0MC43MzQ0LDM0OC4zNDM4IEM0NDAuNDM3NSwzNDguMzQzOCA0NDAuMjM0NCwzNDguNDM3NSA0NDAuMDE1NiwzNDguNzUgTDQzOS44NDM4LDM0OC42NzE5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE2IiB4PSI0NTEuNSIgeT0iMzU3Ljg0NjciPlNyc0hsc0NvbnRyb2xsZXI8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDIzLjUiIHgyPSI1NjkuNSIgeTE9IjM2OSIgeTI9IjM2OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjQyMy41IiB4Mj0iNTY5LjUiIHkxPSIzNzciIHkyPSIzNzciLz48L2c+PCEtLU1ENT1bZTBkZjMwMTIyMjUxMTUyMjYyMWM1MDZlZTY1NDhiMmVdCmNsYXNzIFNyc1JlcXVlc3QtLT48ZyBpZD0iZWxlbV9TcnNSZXF1ZXN0Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiBpZD0iU3JzUmVxdWVzdCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTEzIiB4PSI3NzciIHk9IjQ0NSIvPjxlbGxpcHNlIGN4PSI3OTIiIGN5PSI0NjEiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNNzk0LjM0MzgsNDU2LjY3MTkgQzc5My40MDYzLDQ1Ni4yMzQ0IDc5Mi44MTI1LDQ1Ni4wOTM4IDc5MS45Mzc1LDQ1Ni4wOTM4IEM3ODkuMzEyNSw0NTYuMDkzOCA3ODcuMzEyNSw0NTguMTcxOSA3ODcuMzEyNSw0NjAuODkwNiBMNzg3LjMxMjUsNDYyLjAxNTYgQzc4Ny4zMTI1LDQ2NC41OTM4IDc4OS40MjE5LDQ2Ni40ODQ0IDc5Mi4zMTI1LDQ2Ni40ODQ0IEM3OTMuNTMxMyw0NjYuNDg0NCA3OTQuNjg3NSw0NjYuMTg3NSA3OTUuNDM3NSw0NjUuNjQwNiBDNzk2LjAxNTYsNDY1LjIzNDQgNzk2LjM0MzgsNDY0Ljc4MTMgNzk2LjM0MzgsNDY0LjM5MDYgQzc5Ni4zNDM4LDQ2My45Mzc1IDc5NS45NTMxLDQ2My41NDY5IDc5NS40ODQ0LDQ2My41NDY5IEM3OTUuMjY1Niw0NjMuNTQ2OSA3OTUuMDYyNSw0NjMuNjI1IDc5NC44NzUsNDYzLjgxMjUgQzc5NC40MjE5LDQ2NC4yOTY5IDc5NC40MjE5LDQ2NC4yOTY5IDc5NC4yMzQ0LDQ2NC4zOTA2IEM3OTMuODEyNSw0NjQuNjU2MyA3OTMuMTI1LDQ2NC43ODEzIDc5Mi4zNTk0LDQ2NC43ODEzIEM3OTAuMzEyNSw0NjQuNzgxMyA3ODkuMDE1Niw0NjMuNjg3NSA3ODkuMDE1Niw0NjEuOTg0NCBMNzg5LjAxNTYsNDYwLjg5MDYgQzc4OS4wMTU2LDQ1OS4xMDk0IDc5MC4yNjU2LDQ1Ny43OTY5IDc5Miw0NTcuNzk2OSBDNzkyLjU3ODEsNDU3Ljc5NjkgNzkzLjE4NzUsNDU3Ljk1MzEgNzkzLjY1NjMsNDU4LjIwMzEgQzc5NC4xNDA2LDQ1OC40ODQ0IDc5NC4zMTI1LDQ1OC43MDMxIDc5NC40MDYzLDQ1OS4xMDk0IEM3OTQuNDY4OCw0NTkuNTE1NiA3OTQuNSw0NTkuNjQwNiA3OTQuNjQwNiw0NTkuNzY1NiBDNzk0Ljc4MTMsNDU5LjkwNjMgNzk1LjAxNTYsNDYwLjAxNTYgNzk1LjIzNDQsNDYwLjAxNTYgQzc5NS41LDQ2MC4wMTU2IDc5NS43NjU2LDQ1OS44NzUgNzk1LjkzNzUsNDU5LjY1NjMgQzc5Ni4wNDY5LDQ1OS41IDc5Ni4wNzgxLDQ1OS4zMTI1IDc5Ni4wNzgxLDQ1OC44OTA2IEw3OTYuMDc4MSw0NTcuNDY4OCBDNzk2LjA3ODEsNDU3LjAzMTMgNzk2LjA2MjUsNDU2LjkwNjMgNzk1Ljk2ODgsNDU2Ljc1IEM3OTUuODEyNSw0NTYuNDg0NCA3OTUuNTMxMyw0NTYuMzQzOCA3OTUuMjM0NCw0NTYuMzQzOCBDNzk0LjkzNzUsNDU2LjM0MzggNzk0LjczNDQsNDU2LjQzNzUgNzk0LjUxNTYsNDU2Ljc1IEw3OTQuMzQzOCw0NTYuNjcxOSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgxIiB4PSI4MDYiIHk9IjQ2NS44NDY3Ij5TcnNSZXF1ZXN0PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9Ijc3OCIgeDI9Ijg4OSIgeTE9IjQ3NyIgeTI9IjQ3NyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9Ijc3OCIgeDI9Ijg4OSIgeTE9IjQ4NSIgeTI9IjQ4NSIvPjwvZz48IS0tTUQ1PVs5MDQ4ZWY2M2M5YWNjYjVjZjYzYTM5M2I2MTk1ZmQ3Ml0KY2xhc3MgU3JzVHNNZXNzYWdlQ2FjaGUtLT48ZyBpZD0iZWxlbV9TcnNUc01lc3NhZ2VDYWNoZSI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0OCIgaWQ9IlNyc1RzTWVzc2FnZUNhY2hlIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzUiIHg9IjIxNyIgeT0iNDQ1Ii8+PGVsbGlwc2UgY3g9IjIzMiIgY3k9IjQ2MSIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwYXRoIGQ9Ik0yMzQuMzQzOCw0NTYuNjcxOSBDMjMzLjQwNjMsNDU2LjIzNDQgMjMyLjgxMjUsNDU2LjA5MzggMjMxLjkzNzUsNDU2LjA5MzggQzIyOS4zMTI1LDQ1Ni4wOTM4IDIyNy4zMTI1LDQ1OC4xNzE5IDIyNy4zMTI1LDQ2MC44OTA2IEwyMjcuMzEyNSw0NjIuMDE1NiBDMjI3LjMxMjUsNDY0LjU5MzggMjI5LjQyMTksNDY2LjQ4NDQgMjMyLjMxMjUsNDY2LjQ4NDQgQzIzMy41MzEzLDQ2Ni40ODQ0IDIzNC42ODc1LDQ2Ni4xODc1IDIzNS40Mzc1LDQ2NS42NDA2IEMyMzYuMDE1Niw0NjUuMjM0NCAyMzYuMzQzOCw0NjQuNzgxMyAyMzYuMzQzOCw0NjQuMzkwNiBDMjM2LjM0MzgsNDYzLjkzNzUgMjM1Ljk1MzEsNDYzLjU0NjkgMjM1LjQ4NDQsNDYzLjU0NjkgQzIzNS4yNjU2LDQ2My41NDY5IDIzNS4wNjI1LDQ2My42MjUgMjM0Ljg3NSw0NjMuODEyNSBDMjM0LjQyMTksNDY0LjI5NjkgMjM0LjQyMTksNDY0LjI5NjkgMjM0LjIzNDQsNDY0LjM5MDYgQzIzMy44MTI1LDQ2NC42NTYzIDIzMy4xMjUsNDY0Ljc4MTMgMjMyLjM1OTQsNDY0Ljc4MTMgQzIzMC4zMTI1LDQ2NC43ODEzIDIyOS4wMTU2LDQ2My42ODc1IDIyOS4wMTU2LDQ2MS45ODQ0IEwyMjkuMDE1Niw0NjAuODkwNiBDMjI5LjAxNTYsNDU5LjEwOTQgMjMwLjI2NTYsNDU3Ljc5NjkgMjMyLDQ1Ny43OTY5IEMyMzIuNTc4MSw0NTcuNzk2OSAyMzMuMTg3NSw0NTcuOTUzMSAyMzMuNjU2Myw0NTguMjAzMSBDMjM0LjE0MDYsNDU4LjQ4NDQgMjM0LjMxMjUsNDU4LjcwMzEgMjM0LjQwNjMsNDU5LjEwOTQgQzIzNC40Njg4LDQ1OS41MTU2IDIzNC41LDQ1OS42NDA2IDIzNC42NDA2LDQ1OS43NjU2IEMyMzQuNzgxMyw0NTkuOTA2MyAyMzUuMDE1Niw0NjAuMDE1NiAyMzUuMjM0NCw0NjAuMDE1NiBDMjM1LjUsNDYwLjAxNTYgMjM1Ljc2NTYsNDU5Ljg3NSAyMzUuOTM3NSw0NTkuNjU2MyBDMjM2LjA0NjksNDU5LjUgMjM2LjA3ODEsNDU5LjMxMjUgMjM2LjA3ODEsNDU4Ljg5MDYgTDIzNi4wNzgxLDQ1Ny40Njg4IEMyMzYuMDc4MSw0NTcuMDMxMyAyMzYuMDYyNSw0NTYuOTA2MyAyMzUuOTY4OCw0NTYuNzUgQzIzNS44MTI1LDQ1Ni40ODQ0IDIzNS41MzEzLDQ1Ni4zNDM4IDIzNS4yMzQ0LDQ1Ni4zNDM4IEMyMzQuOTM3NSw0NTYuMzQzOCAyMzQuNzM0NCw0NTYuNDM3NSAyMzQuNTE1Niw0NTYuNzUgTDIzNC4zNDM4LDQ1Ni42NzE5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQzIiB4PSIyNDYiIHk9IjQ2NS44NDY3Ij5TcnNUc01lc3NhZ2VDYWNoZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMTgiIHgyPSIzOTEiIHkxPSI0NzciIHkyPSI0NzciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMTgiIHgyPSIzOTEiIHkxPSI0ODUiIHkyPSI0ODUiLz48L2c+PCEtLU1ENT1bODNlYzAwZTRiZmRmZmZiYzdlOWU1ZmM5NDMzZWE1ZjhdCmNsYXNzIFNyc0F1ZGlvRnJhbWUtLT48ZyBpZD0iZWxlbV9TcnNBdWRpb0ZyYW1lIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiBpZD0iU3JzQXVkaW9GcmFtZSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTM5IiB4PSI0MjciIHk9IjQ0NSIvPjxlbGxpcHNlIGN4PSI0NDIiIGN5PSI0NjEiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNNDQ0LjM0MzgsNDU2LjY3MTkgQzQ0My40MDYzLDQ1Ni4yMzQ0IDQ0Mi44MTI1LDQ1Ni4wOTM4IDQ0MS45Mzc1LDQ1Ni4wOTM4IEM0MzkuMzEyNSw0NTYuMDkzOCA0MzcuMzEyNSw0NTguMTcxOSA0MzcuMzEyNSw0NjAuODkwNiBMNDM3LjMxMjUsNDYyLjAxNTYgQzQzNy4zMTI1LDQ2NC41OTM4IDQzOS40MjE5LDQ2Ni40ODQ0IDQ0Mi4zMTI1LDQ2Ni40ODQ0IEM0NDMuNTMxMyw0NjYuNDg0NCA0NDQuNjg3NSw0NjYuMTg3NSA0NDUuNDM3NSw0NjUuNjQwNiBDNDQ2LjAxNTYsNDY1LjIzNDQgNDQ2LjM0MzgsNDY0Ljc4MTMgNDQ2LjM0MzgsNDY0LjM5MDYgQzQ0Ni4zNDM4LDQ2My45Mzc1IDQ0NS45NTMxLDQ2My41NDY5IDQ0NS40ODQ0LDQ2My41NDY5IEM0NDUuMjY1Niw0NjMuNTQ2OSA0NDUuMDYyNSw0NjMuNjI1IDQ0NC44NzUsNDYzLjgxMjUgQzQ0NC40MjE5LDQ2NC4yOTY5IDQ0NC40MjE5LDQ2NC4yOTY5IDQ0NC4yMzQ0LDQ2NC4zOTA2IEM0NDMuODEyNSw0NjQuNjU2MyA0NDMuMTI1LDQ2NC43ODEzIDQ0Mi4zNTk0LDQ2NC43ODEzIEM0NDAuMzEyNSw0NjQuNzgxMyA0MzkuMDE1Niw0NjMuNjg3NSA0MzkuMDE1Niw0NjEuOTg0NCBMNDM5LjAxNTYsNDYwLjg5MDYgQzQzOS4wMTU2LDQ1OS4xMDk0IDQ0MC4yNjU2LDQ1Ny43OTY5IDQ0Miw0NTcuNzk2OSBDNDQyLjU3ODEsNDU3Ljc5NjkgNDQzLjE4NzUsNDU3Ljk1MzEgNDQzLjY1NjMsNDU4LjIwMzEgQzQ0NC4xNDA2LDQ1OC40ODQ0IDQ0NC4zMTI1LDQ1OC43MDMxIDQ0NC40MDYzLDQ1OS4xMDk0IEM0NDQuNDY4OCw0NTkuNTE1NiA0NDQuNSw0NTkuNjQwNiA0NDQuNjQwNiw0NTkuNzY1NiBDNDQ0Ljc4MTMsNDU5LjkwNjMgNDQ1LjAxNTYsNDYwLjAxNTYgNDQ1LjIzNDQsNDYwLjAxNTYgQzQ0NS41LDQ2MC4wMTU2IDQ0NS43NjU2LDQ1OS44NzUgNDQ1LjkzNzUsNDU5LjY1NjMgQzQ0Ni4wNDY5LDQ1OS41IDQ0Ni4wNzgxLDQ1OS4zMTI1IDQ0Ni4wNzgxLDQ1OC44OTA2IEw0NDYuMDc4MSw0NTcuNDY4OCBDNDQ2LjA3ODEsNDU3LjAzMTMgNDQ2LjA2MjUsNDU2LjkwNjMgNDQ1Ljk2ODgsNDU2Ljc1IEM0NDUuODEyNSw0NTYuNDg0NCA0NDUuNTMxMyw0NTYuMzQzOCA0NDUuMjM0NCw0NTYuMzQzOCBDNDQ0LjkzNzUsNDU2LjM0MzggNDQ0LjczNDQsNDU2LjQzNzUgNDQ0LjUxNTYsNDU2Ljc1IEw0NDQuMzQzOCw0NTYuNjcxOSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNyIgeD0iNDU2IiB5PSI0NjUuODQ2NyI+U3JzQXVkaW9GcmFtZTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0MjgiIHgyPSI1NjUiIHkxPSI0NzciIHkyPSI0NzciLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI0MjgiIHgyPSI1NjUiIHkxPSI0ODUiIHkyPSI0ODUiLz48L2c+PCEtLU1ENT1bYWZiMGZjMzkzNTgwZTkxYzVjNTM1MDU5YjExNzI3NDJdCmNsYXNzIFNyc1ZpZGVvRnJhbWUtLT48ZyBpZD0iZWxlbV9TcnNWaWRlb0ZyYW1lIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiBpZD0iU3JzVmlkZW9GcmFtZSIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQwIiB4PSI2MDEuNSIgeT0iNDQ1Ii8+PGVsbGlwc2UgY3g9IjYxNi41IiBjeT0iNDYxIiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBhdGggZD0iTTYxOC44NDM4LDQ1Ni42NzE5IEM2MTcuOTA2Myw0NTYuMjM0NCA2MTcuMzEyNSw0NTYuMDkzOCA2MTYuNDM3NSw0NTYuMDkzOCBDNjEzLjgxMjUsNDU2LjA5MzggNjExLjgxMjUsNDU4LjE3MTkgNjExLjgxMjUsNDYwLjg5MDYgTDYxMS44MTI1LDQ2Mi4wMTU2IEM2MTEuODEyNSw0NjQuNTkzOCA2MTMuOTIxOSw0NjYuNDg0NCA2MTYuODEyNSw0NjYuNDg0NCBDNjE4LjAzMTMsNDY2LjQ4NDQgNjE5LjE4NzUsNDY2LjE4NzUgNjE5LjkzNzUsNDY1LjY0MDYgQzYyMC41MTU2LDQ2NS4yMzQ0IDYyMC44NDM4LDQ2NC43ODEzIDYyMC44NDM4LDQ2NC4zOTA2IEM2MjAuODQzOCw0NjMuOTM3NSA2MjAuNDUzMSw0NjMuNTQ2OSA2MTkuOTg0NCw0NjMuNTQ2OSBDNjE5Ljc2NTYsNDYzLjU0NjkgNjE5LjU2MjUsNDYzLjYyNSA2MTkuMzc1LDQ2My44MTI1IEM2MTguOTIxOSw0NjQuMjk2OSA2MTguOTIxOSw0NjQuMjk2OSA2MTguNzM0NCw0NjQuMzkwNiBDNjE4LjMxMjUsNDY0LjY1NjMgNjE3LjYyNSw0NjQuNzgxMyA2MTYuODU5NCw0NjQuNzgxMyBDNjE0LjgxMjUsNDY0Ljc4MTMgNjEzLjUxNTYsNDYzLjY4NzUgNjEzLjUxNTYsNDYxLjk4NDQgTDYxMy41MTU2LDQ2MC44OTA2IEM2MTMuNTE1Niw0NTkuMTA5NCA2MTQuNzY1Niw0NTcuNzk2OSA2MTYuNSw0NTcuNzk2OSBDNjE3LjA3ODEsNDU3Ljc5NjkgNjE3LjY4NzUsNDU3Ljk1MzEgNjE4LjE1NjMsNDU4LjIwMzEgQzYxOC42NDA2LDQ1OC40ODQ0IDYxOC44MTI1LDQ1OC43MDMxIDYxOC45MDYzLDQ1OS4xMDk0IEM2MTguOTY4OCw0NTkuNTE1NiA2MTksNDU5LjY0MDYgNjE5LjE0MDYsNDU5Ljc2NTYgQzYxOS4yODEzLDQ1OS45MDYzIDYxOS41MTU2LDQ2MC4wMTU2IDYxOS43MzQ0LDQ2MC4wMTU2IEM2MjAsNDYwLjAxNTYgNjIwLjI2NTYsNDU5Ljg3NSA2MjAuNDM3NSw0NTkuNjU2MyBDNjIwLjU0NjksNDU5LjUgNjIwLjU3ODEsNDU5LjMxMjUgNjIwLjU3ODEsNDU4Ljg5MDYgTDYyMC41NzgxLDQ1Ny40Njg4IEM2MjAuNTc4MSw0NTcuMDMxMyA2MjAuNTYyNSw0NTYuOTA2MyA2MjAuNDY4OCw0NTYuNzUgQzYyMC4zMTI1LDQ1Ni40ODQ0IDYyMC4wMzEzLDQ1Ni4zNDM4IDYxOS43MzQ0LDQ1Ni4zNDM4IEM2MTkuNDM3NSw0NTYuMzQzOCA2MTkuMjM0NCw0NTYuNDM3NSA2MTkuMDE1Niw0NTYuNzUgTDYxOC44NDM4LDQ1Ni42NzE5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA4IiB4PSI2MzAuNSIgeT0iNDY1Ljg0NjciPlNyc1ZpZGVvRnJhbWU8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNjAyLjUiIHgyPSI3NDAuNSIgeTE9IjQ3NyIgeTI9IjQ3NyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjYwMi41IiB4Mj0iNzQwLjUiIHkxPSI0ODUiIHkyPSI0ODUiLz48L2c+PCEtLU1ENT1bYmJjNGFmZjM0ZTE0OWIxY2U0MjA2ODhmNjMyYjE4MTldCmNsYXNzIFNyc0ZpbGVXcml0ZXItLT48ZyBpZD0iZWxlbV9TcnNGaWxlV3JpdGVyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiBpZD0iU3JzRmlsZVdyaXRlciIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI1IiB4PSI4IiB5PSI5NDYiLz48ZWxsaXBzZSBjeD0iMjMiIGN5PSI5NjIiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNMjUuMzQzOCw5NTcuNjcxOSBDMjQuNDA2Myw5NTcuMjM0NCAyMy44MTI1LDk1Ny4wOTM4IDIyLjkzNzUsOTU3LjA5MzggQzIwLjMxMjUsOTU3LjA5MzggMTguMzEyNSw5NTkuMTcxOSAxOC4zMTI1LDk2MS44OTA2IEwxOC4zMTI1LDk2My4wMTU2IEMxOC4zMTI1LDk2NS41OTM4IDIwLjQyMTksOTY3LjQ4NDQgMjMuMzEyNSw5NjcuNDg0NCBDMjQuNTMxMyw5NjcuNDg0NCAyNS42ODc1LDk2Ny4xODc1IDI2LjQzNzUsOTY2LjY0MDYgQzI3LjAxNTYsOTY2LjIzNDQgMjcuMzQzOCw5NjUuNzgxMyAyNy4zNDM4LDk2NS4zOTA2IEMyNy4zNDM4LDk2NC45Mzc1IDI2Ljk1MzEsOTY0LjU0NjkgMjYuNDg0NCw5NjQuNTQ2OSBDMjYuMjY1Niw5NjQuNTQ2OSAyNi4wNjI1LDk2NC42MjUgMjUuODc1LDk2NC44MTI1IEMyNS40MjE5LDk2NS4yOTY5IDI1LjQyMTksOTY1LjI5NjkgMjUuMjM0NCw5NjUuMzkwNiBDMjQuODEyNSw5NjUuNjU2MyAyNC4xMjUsOTY1Ljc4MTMgMjMuMzU5NCw5NjUuNzgxMyBDMjEuMzEyNSw5NjUuNzgxMyAyMC4wMTU2LDk2NC42ODc1IDIwLjAxNTYsOTYyLjk4NDQgTDIwLjAxNTYsOTYxLjg5MDYgQzIwLjAxNTYsOTYwLjEwOTQgMjEuMjY1Niw5NTguNzk2OSAyMyw5NTguNzk2OSBDMjMuNTc4MSw5NTguNzk2OSAyNC4xODc1LDk1OC45NTMxIDI0LjY1NjMsOTU5LjIwMzEgQzI1LjE0MDYsOTU5LjQ4NDQgMjUuMzEyNSw5NTkuNzAzMSAyNS40MDYzLDk2MC4xMDk0IEMyNS40Njg4LDk2MC41MTU2IDI1LjUsOTYwLjY0MDYgMjUuNjQwNiw5NjAuNzY1NiBDMjUuNzgxMyw5NjAuOTA2MyAyNi4wMTU2LDk2MS4wMTU2IDI2LjIzNDQsOTYxLjAxNTYgQzI2LjUsOTYxLjAxNTYgMjYuNzY1Niw5NjAuODc1IDI2LjkzNzUsOTYwLjY1NjMgQzI3LjA0NjksOTYwLjUgMjcuMDc4MSw5NjAuMzEyNSAyNy4wNzgxLDk1OS44OTA2IEwyNy4wNzgxLDk1OC40Njg4IEMyNy4wNzgxLDk1OC4wMzEzIDI3LjA2MjUsOTU3LjkwNjMgMjYuOTY4OCw5NTcuNzUgQzI2LjgxMjUsOTU3LjQ4NDQgMjYuNTMxMyw5NTcuMzQzOCAyNi4yMzQ0LDk1Ny4zNDM4IEMyNS45Mzc1LDk1Ny4zNDM4IDI1LjczNDQsOTU3LjQzNzUgMjUuNTE1Niw5NTcuNzUgTDI1LjM0MzgsOTU3LjY3MTkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5MyIgeD0iMzciIHk9Ijk2Ni44NDY3Ij5TcnNGaWxlV3JpdGVyPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjkiIHgyPSIxMzIiIHkxPSI5NzgiIHkyPSI5NzgiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI5IiB4Mj0iMTMyIiB5MT0iOTg2IiB5Mj0iOTg2Ii8+PC9nPjwhLS1NRDU9W2M1NDI1MjQ4ZDYxYzFkN2VmNDAzY2FlNDA4MzYxN2ZlXQpjbGFzcyBTcnNIbHNTZWdtZW50LS0+PGcgaWQ9ImVsZW1fU3JzSGxzU2VnbWVudCI+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSI0OCIgaWQ9IlNyc0hsc1NlZ21lbnQiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE0MSIgeD0iMTE2IiB5PSIxMDU0Ii8+PGVsbGlwc2UgY3g9IjEzMSIgY3k9IjEwNzAiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNMTMzLjM0MzgsMTA2NS42NzE5IEMxMzIuNDA2MywxMDY1LjIzNDQgMTMxLjgxMjUsMTA2NS4wOTM4IDEzMC45Mzc1LDEwNjUuMDkzOCBDMTI4LjMxMjUsMTA2NS4wOTM4IDEyNi4zMTI1LDEwNjcuMTcxOSAxMjYuMzEyNSwxMDY5Ljg5MDYgTDEyNi4zMTI1LDEwNzEuMDE1NiBDMTI2LjMxMjUsMTA3My41OTM4IDEyOC40MjE5LDEwNzUuNDg0NCAxMzEuMzEyNSwxMDc1LjQ4NDQgQzEzMi41MzEzLDEwNzUuNDg0NCAxMzMuNjg3NSwxMDc1LjE4NzUgMTM0LjQzNzUsMTA3NC42NDA2IEMxMzUuMDE1NiwxMDc0LjIzNDQgMTM1LjM0MzgsMTA3My43ODEzIDEzNS4zNDM4LDEwNzMuMzkwNiBDMTM1LjM0MzgsMTA3Mi45Mzc1IDEzNC45NTMxLDEwNzIuNTQ2OSAxMzQuNDg0NCwxMDcyLjU0NjkgQzEzNC4yNjU2LDEwNzIuNTQ2OSAxMzQuMDYyNSwxMDcyLjYyNSAxMzMuODc1LDEwNzIuODEyNSBDMTMzLjQyMTksMTA3My4yOTY5IDEzMy40MjE5LDEwNzMuMjk2OSAxMzMuMjM0NCwxMDczLjM5MDYgQzEzMi44MTI1LDEwNzMuNjU2MyAxMzIuMTI1LDEwNzMuNzgxMyAxMzEuMzU5NCwxMDczLjc4MTMgQzEyOS4zMTI1LDEwNzMuNzgxMyAxMjguMDE1NiwxMDcyLjY4NzUgMTI4LjAxNTYsMTA3MC45ODQ0IEwxMjguMDE1NiwxMDY5Ljg5MDYgQzEyOC4wMTU2LDEwNjguMTA5NCAxMjkuMjY1NiwxMDY2Ljc5NjkgMTMxLDEwNjYuNzk2OSBDMTMxLjU3ODEsMTA2Ni43OTY5IDEzMi4xODc1LDEwNjYuOTUzMSAxMzIuNjU2MywxMDY3LjIwMzEgQzEzMy4xNDA2LDEwNjcuNDg0NCAxMzMuMzEyNSwxMDY3LjcwMzEgMTMzLjQwNjMsMTA2OC4xMDk0IEMxMzMuNDY4OCwxMDY4LjUxNTYgMTMzLjUsMTA2OC42NDA2IDEzMy42NDA2LDEwNjguNzY1NiBDMTMzLjc4MTMsMTA2OC45MDYzIDEzNC4wMTU2LDEwNjkuMDE1NiAxMzQuMjM0NCwxMDY5LjAxNTYgQzEzNC41LDEwNjkuMDE1NiAxMzQuNzY1NiwxMDY4Ljg3NSAxMzQuOTM3NSwxMDY4LjY1NjMgQzEzNS4wNDY5LDEwNjguNSAxMzUuMDc4MSwxMDY4LjMxMjUgMTM1LjA3ODEsMTA2Ny44OTA2IEwxMzUuMDc4MSwxMDY2LjQ2ODggQzEzNS4wNzgxLDEwNjYuMDMxMyAxMzUuMDYyNSwxMDY1LjkwNjMgMTM0Ljk2ODgsMTA2NS43NSBDMTM0LjgxMjUsMTA2NS40ODQ0IDEzNC41MzEzLDEwNjUuMzQzOCAxMzQuMjM0NCwxMDY1LjM0MzggQzEzMy45Mzc1LDEwNjUuMzQzOCAxMzMuNzM0NCwxMDY1LjQzNzUgMTMzLjUxNTYsMTA2NS43NSBMMTMzLjM0MzgsMTA2NS42NzE5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTA5IiB4PSIxNDUiIHk9IjEwNzQuODQ2NyI+U3JzSGxzU2VnbWVudDwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIxMTciIHgyPSIyNTYiIHkxPSIxMDg2IiB5Mj0iMTA4NiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjExNyIgeDI9IjI1NiIgeTE9IjEwOTQiIHkyPSIxMDk0Ii8+PC9nPjwhLS1NRDU9W2EyN2NjYjM3Zjc0NDhjN2QwNjg5YThjMGY4M2UzZDBlXQpjbGFzcyBTcnNUc0NvbnRleHQtLT48ZyBpZD0iZWxlbV9TcnNUc0NvbnRleHQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIGlkPSJTcnNUc0NvbnRleHQiIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyOSIgeD0iMjQwIiB5PSI5NDYiLz48ZWxsaXBzZSBjeD0iMjU1IiBjeT0iOTYyIiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBhdGggZD0iTTI1Ny4zNDM4LDk1Ny42NzE5IEMyNTYuNDA2Myw5NTcuMjM0NCAyNTUuODEyNSw5NTcuMDkzOCAyNTQuOTM3NSw5NTcuMDkzOCBDMjUyLjMxMjUsOTU3LjA5MzggMjUwLjMxMjUsOTU5LjE3MTkgMjUwLjMxMjUsOTYxLjg5MDYgTDI1MC4zMTI1LDk2My4wMTU2IEMyNTAuMzEyNSw5NjUuNTkzOCAyNTIuNDIxOSw5NjcuNDg0NCAyNTUuMzEyNSw5NjcuNDg0NCBDMjU2LjUzMTMsOTY3LjQ4NDQgMjU3LjY4NzUsOTY3LjE4NzUgMjU4LjQzNzUsOTY2LjY0MDYgQzI1OS4wMTU2LDk2Ni4yMzQ0IDI1OS4zNDM4LDk2NS43ODEzIDI1OS4zNDM4LDk2NS4zOTA2IEMyNTkuMzQzOCw5NjQuOTM3NSAyNTguOTUzMSw5NjQuNTQ2OSAyNTguNDg0NCw5NjQuNTQ2OSBDMjU4LjI2NTYsOTY0LjU0NjkgMjU4LjA2MjUsOTY0LjYyNSAyNTcuODc1LDk2NC44MTI1IEMyNTcuNDIxOSw5NjUuMjk2OSAyNTcuNDIxOSw5NjUuMjk2OSAyNTcuMjM0NCw5NjUuMzkwNiBDMjU2LjgxMjUsOTY1LjY1NjMgMjU2LjEyNSw5NjUuNzgxMyAyNTUuMzU5NCw5NjUuNzgxMyBDMjUzLjMxMjUsOTY1Ljc4MTMgMjUyLjAxNTYsOTY0LjY4NzUgMjUyLjAxNTYsOTYyLjk4NDQgTDI1Mi4wMTU2LDk2MS44OTA2IEMyNTIuMDE1Niw5NjAuMTA5NCAyNTMuMjY1Niw5NTguNzk2OSAyNTUsOTU4Ljc5NjkgQzI1NS41NzgxLDk1OC43OTY5IDI1Ni4xODc1LDk1OC45NTMxIDI1Ni42NTYzLDk1OS4yMDMxIEMyNTcuMTQwNiw5NTkuNDg0NCAyNTcuMzEyNSw5NTkuNzAzMSAyNTcuNDA2Myw5NjAuMTA5NCBDMjU3LjQ2ODgsOTYwLjUxNTYgMjU3LjUsOTYwLjY0MDYgMjU3LjY0MDYsOTYwLjc2NTYgQzI1Ny43ODEzLDk2MC45MDYzIDI1OC4wMTU2LDk2MS4wMTU2IDI1OC4yMzQ0LDk2MS4wMTU2IEMyNTguNSw5NjEuMDE1NiAyNTguNzY1Niw5NjAuODc1IDI1OC45Mzc1LDk2MC42NTYzIEMyNTkuMDQ2OSw5NjAuNSAyNTkuMDc4MSw5NjAuMzEyNSAyNTkuMDc4MSw5NTkuODkwNiBMMjU5LjA3ODEsOTU4LjQ2ODggQzI1OS4wNzgxLDk1OC4wMzEzIDI1OS4wNjI1LDk1Ny45MDYzIDI1OC45Njg4LDk1Ny43NSBDMjU4LjgxMjUsOTU3LjQ4NDQgMjU4LjUzMTMsOTU3LjM0MzggMjU4LjIzNDQsOTU3LjM0MzggQzI1Ny45Mzc1LDk1Ny4zNDM4IDI1Ny43MzQ0LDk1Ny40Mzc1IDI1Ny41MTU2LDk1Ny43NSBMMjU3LjM0MzgsOTU3LjY3MTkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NyIgeD0iMjY5IiB5PSI5NjYuODQ2NyI+U3JzVHNDb250ZXh0PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI0MSIgeDI9IjM2OCIgeTE9Ijk3OCIgeTI9Ijk3OCIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgeDE9IjI0MSIgeDI9IjM2OCIgeTE9Ijk4NiIgeTI9Ijk4NiIvPjwvZz48IS0tTUQ1PVs1ZGMyMjBmNzIzODE1OWMzODEwZjdlZjQ0ZDQwZTA2OF0KY2xhc3MgU3JzQXN5bmNDYWxsV29ya2VyLS0+PGcgaWQ9ImVsZW1fU3JzQXN5bmNDYWxsV29ya2VyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiBpZD0iU3JzQXN5bmNDYWxsV29ya2VyIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzUiIHg9IjQwNCIgeT0iOTQ2Ii8+PGVsbGlwc2UgY3g9IjQxOSIgY3k9Ijk2MiIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwYXRoIGQ9Ik00MjEuMzQzOCw5NTcuNjcxOSBDNDIwLjQwNjMsOTU3LjIzNDQgNDE5LjgxMjUsOTU3LjA5MzggNDE4LjkzNzUsOTU3LjA5MzggQzQxNi4zMTI1LDk1Ny4wOTM4IDQxNC4zMTI1LDk1OS4xNzE5IDQxNC4zMTI1LDk2MS44OTA2IEw0MTQuMzEyNSw5NjMuMDE1NiBDNDE0LjMxMjUsOTY1LjU5MzggNDE2LjQyMTksOTY3LjQ4NDQgNDE5LjMxMjUsOTY3LjQ4NDQgQzQyMC41MzEzLDk2Ny40ODQ0IDQyMS42ODc1LDk2Ny4xODc1IDQyMi40Mzc1LDk2Ni42NDA2IEM0MjMuMDE1Niw5NjYuMjM0NCA0MjMuMzQzOCw5NjUuNzgxMyA0MjMuMzQzOCw5NjUuMzkwNiBDNDIzLjM0MzgsOTY0LjkzNzUgNDIyLjk1MzEsOTY0LjU0NjkgNDIyLjQ4NDQsOTY0LjU0NjkgQzQyMi4yNjU2LDk2NC41NDY5IDQyMi4wNjI1LDk2NC42MjUgNDIxLjg3NSw5NjQuODEyNSBDNDIxLjQyMTksOTY1LjI5NjkgNDIxLjQyMTksOTY1LjI5NjkgNDIxLjIzNDQsOTY1LjM5MDYgQzQyMC44MTI1LDk2NS42NTYzIDQyMC4xMjUsOTY1Ljc4MTMgNDE5LjM1OTQsOTY1Ljc4MTMgQzQxNy4zMTI1LDk2NS43ODEzIDQxNi4wMTU2LDk2NC42ODc1IDQxNi4wMTU2LDk2Mi45ODQ0IEw0MTYuMDE1Niw5NjEuODkwNiBDNDE2LjAxNTYsOTYwLjEwOTQgNDE3LjI2NTYsOTU4Ljc5NjkgNDE5LDk1OC43OTY5IEM0MTkuNTc4MSw5NTguNzk2OSA0MjAuMTg3NSw5NTguOTUzMSA0MjAuNjU2Myw5NTkuMjAzMSBDNDIxLjE0MDYsOTU5LjQ4NDQgNDIxLjMxMjUsOTU5LjcwMzEgNDIxLjQwNjMsOTYwLjEwOTQgQzQyMS40Njg4LDk2MC41MTU2IDQyMS41LDk2MC42NDA2IDQyMS42NDA2LDk2MC43NjU2IEM0MjEuNzgxMyw5NjAuOTA2MyA0MjIuMDE1Niw5NjEuMDE1NiA0MjIuMjM0NCw5NjEuMDE1NiBDNDIyLjUsOTYxLjAxNTYgNDIyLjc2NTYsOTYwLjg3NSA0MjIuOTM3NSw5NjAuNjU2MyBDNDIzLjA0NjksOTYwLjUgNDIzLjA3ODEsOTYwLjMxMjUgNDIzLjA3ODEsOTU5Ljg5MDYgTDQyMy4wNzgxLDk1OC40Njg4IEM0MjMuMDc4MSw5NTguMDMxMyA0MjMuMDYyNSw5NTcuOTA2MyA0MjIuOTY4OCw5NTcuNzUgQzQyMi44MTI1LDk1Ny40ODQ0IDQyMi41MzEzLDk1Ny4zNDM4IDQyMi4yMzQ0LDk1Ny4zNDM4IEM0MjEuOTM3NSw5NTcuMzQzOCA0MjEuNzM0NCw5NTcuNDM3NSA0MjEuNTE1Niw5NTcuNzUgTDQyMS4zNDM4LDk1Ny42NzE5IFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQzIiB4PSI0MzMiIHk9Ijk2Ni44NDY3Ij5TcnNBc3luY0NhbGxXb3JrZXI8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDA1IiB4Mj0iNTc4IiB5MT0iOTc4IiB5Mj0iOTc4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNDA1IiB4Mj0iNTc4IiB5MT0iOTg2IiB5Mj0iOTg2Ii8+PC9nPjwhLS1NRDU9W2IzMGJkN2Y1YTg0YmZiODEwMmM3NzcyZWNlMmM4Njk3XQpjbGFzcyBTcnNGcmFnbWVudFdpbmRvdy0tPjxnIGlkPSJlbGVtX1Nyc0ZyYWdtZW50V2luZG93Ij48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiBpZD0iU3JzRnJhZ21lbnRXaW5kb3ciIHJ4PSIyLjUiIHJ5PSIyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE4MCIgeD0iNjE0LjUiIHk9Ijk0NiIvPjxlbGxpcHNlIGN4PSI2MjkuNSIgY3k9Ijk2MiIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwYXRoIGQ9Ik02MzEuODQzOCw5NTcuNjcxOSBDNjMwLjkwNjMsOTU3LjIzNDQgNjMwLjMxMjUsOTU3LjA5MzggNjI5LjQzNzUsOTU3LjA5MzggQzYyNi44MTI1LDk1Ny4wOTM4IDYyNC44MTI1LDk1OS4xNzE5IDYyNC44MTI1LDk2MS44OTA2IEw2MjQuODEyNSw5NjMuMDE1NiBDNjI0LjgxMjUsOTY1LjU5MzggNjI2LjkyMTksOTY3LjQ4NDQgNjI5LjgxMjUsOTY3LjQ4NDQgQzYzMS4wMzEzLDk2Ny40ODQ0IDYzMi4xODc1LDk2Ny4xODc1IDYzMi45Mzc1LDk2Ni42NDA2IEM2MzMuNTE1Niw5NjYuMjM0NCA2MzMuODQzOCw5NjUuNzgxMyA2MzMuODQzOCw5NjUuMzkwNiBDNjMzLjg0MzgsOTY0LjkzNzUgNjMzLjQ1MzEsOTY0LjU0NjkgNjMyLjk4NDQsOTY0LjU0NjkgQzYzMi43NjU2LDk2NC41NDY5IDYzMi41NjI1LDk2NC42MjUgNjMyLjM3NSw5NjQuODEyNSBDNjMxLjkyMTksOTY1LjI5NjkgNjMxLjkyMTksOTY1LjI5NjkgNjMxLjczNDQsOTY1LjM5MDYgQzYzMS4zMTI1LDk2NS42NTYzIDYzMC42MjUsOTY1Ljc4MTMgNjI5Ljg1OTQsOTY1Ljc4MTMgQzYyNy44MTI1LDk2NS43ODEzIDYyNi41MTU2LDk2NC42ODc1IDYyNi41MTU2LDk2Mi45ODQ0IEw2MjYuNTE1Niw5NjEuODkwNiBDNjI2LjUxNTYsOTYwLjEwOTQgNjI3Ljc2NTYsOTU4Ljc5NjkgNjI5LjUsOTU4Ljc5NjkgQzYzMC4wNzgxLDk1OC43OTY5IDYzMC42ODc1LDk1OC45NTMxIDYzMS4xNTYzLDk1OS4yMDMxIEM2MzEuNjQwNiw5NTkuNDg0NCA2MzEuODEyNSw5NTkuNzAzMSA2MzEuOTA2Myw5NjAuMTA5NCBDNjMxLjk2ODgsOTYwLjUxNTYgNjMyLDk2MC42NDA2IDYzMi4xNDA2LDk2MC43NjU2IEM2MzIuMjgxMyw5NjAuOTA2MyA2MzIuNTE1Niw5NjEuMDE1NiA2MzIuNzM0NCw5NjEuMDE1NiBDNjMzLDk2MS4wMTU2IDYzMy4yNjU2LDk2MC44NzUgNjMzLjQzNzUsOTYwLjY1NjMgQzYzMy41NDY5LDk2MC41IDYzMy41NzgxLDk2MC4zMTI1IDYzMy41NzgxLDk1OS44OTA2IEw2MzMuNTc4MSw5NTguNDY4OCBDNjMzLjU3ODEsOTU4LjAzMTMgNjMzLjU2MjUsOTU3LjkwNjMgNjMzLjQ2ODgsOTU3Ljc1IEM2MzMuMzEyNSw5NTcuNDg0NCA2MzMuMDMxMyw5NTcuMzQzOCA2MzIuNzM0NCw5NTcuMzQzOCBDNjMyLjQzNzUsOTU3LjM0MzggNjMyLjIzNDQsOTU3LjQzNzUgNjMyLjAxNTYsOTU3Ljc1IEw2MzEuODQzOCw5NTcuNjcxOSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0OCIgeD0iNjQzLjUiIHk9Ijk2Ni44NDY3Ij5TcnNGcmFnbWVudFdpbmRvdzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI2MTUuNSIgeDI9Ijc5My41IiB5MT0iOTc4IiB5Mj0iOTc4Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB4MT0iNjE1LjUiIHgyPSI3OTMuNSIgeTE9Ijk4NiIgeTI9Ijk4NiIvPjwvZz48IS0tTUQ1PVs5MDdiZmNmMDhkNWZjYjRkZjAzNWRkYjZkYmU1M2QxOV0KY2xhc3MgU3JzVHNDb250ZXh0V3JpdGVyLS0+PGcgaWQ9ImVsZW1fU3JzVHNDb250ZXh0V3JpdGVyIj48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjQ4IiBpZD0iU3JzVHNDb250ZXh0V3JpdGVyIiByeD0iMi41IiByeT0iMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzUiIHg9IjciIHk9IjExNjIiLz48ZWxsaXBzZSBjeD0iMjIiIGN5PSIxMTc4IiBmaWxsPSIjQUREMUIyIiByeD0iMTEiIHJ5PSIxMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBhdGggZD0iTTI0LjM0MzgsMTE3My42NzE5IEMyMy40MDYzLDExNzMuMjM0NCAyMi44MTI1LDExNzMuMDkzOCAyMS45Mzc1LDExNzMuMDkzOCBDMTkuMzEyNSwxMTczLjA5MzggMTcuMzEyNSwxMTc1LjE3MTkgMTcuMzEyNSwxMTc3Ljg5MDYgTDE3LjMxMjUsMTE3OS4wMTU2IEMxNy4zMTI1LDExODEuNTkzOCAxOS40MjE5LDExODMuNDg0NCAyMi4zMTI1LDExODMuNDg0NCBDMjMuNTMxMywxMTgzLjQ4NDQgMjQuNjg3NSwxMTgzLjE4NzUgMjUuNDM3NSwxMTgyLjY0MDYgQzI2LjAxNTYsMTE4Mi4yMzQ0IDI2LjM0MzgsMTE4MS43ODEzIDI2LjM0MzgsMTE4MS4zOTA2IEMyNi4zNDM4LDExODAuOTM3NSAyNS45NTMxLDExODAuNTQ2OSAyNS40ODQ0LDExODAuNTQ2OSBDMjUuMjY1NiwxMTgwLjU0NjkgMjUuMDYyNSwxMTgwLjYyNSAyNC44NzUsMTE4MC44MTI1IEMyNC40MjE5LDExODEuMjk2OSAyNC40MjE5LDExODEuMjk2OSAyNC4yMzQ0LDExODEuMzkwNiBDMjMuODEyNSwxMTgxLjY1NjMgMjMuMTI1LDExODEuNzgxMyAyMi4zNTk0LDExODEuNzgxMyBDMjAuMzEyNSwxMTgxLjc4MTMgMTkuMDE1NiwxMTgwLjY4NzUgMTkuMDE1NiwxMTc4Ljk4NDQgTDE5LjAxNTYsMTE3Ny44OTA2IEMxOS4wMTU2LDExNzYuMTA5NCAyMC4yNjU2LDExNzQuNzk2OSAyMiwxMTc0Ljc5NjkgQzIyLjU3ODEsMTE3NC43OTY5IDIzLjE4NzUsMTE3NC45NTMxIDIzLjY1NjMsMTE3NS4yMDMxIEMyNC4xNDA2LDExNzUuNDg0NCAyNC4zMTI1LDExNzUuNzAzMSAyNC40MDYzLDExNzYuMTA5NCBDMjQuNDY4OCwxMTc2LjUxNTYgMjQuNSwxMTc2LjY0MDYgMjQuNjQwNiwxMTc2Ljc2NTYgQzI0Ljc4MTMsMTE3Ni45MDYzIDI1LjAxNTYsMTE3Ny4wMTU2IDI1LjIzNDQsMTE3Ny4wMTU2IEMyNS41LDExNzcuMDE1NiAyNS43NjU2LDExNzYuODc1IDI1LjkzNzUsMTE3Ni42NTYzIEMyNi4wNDY5LDExNzYuNSAyNi4wNzgxLDExNzYuMzEyNSAyNi4wNzgxLDExNzUuODkwNiBMMjYuMDc4MSwxMTc0LjQ2ODggQzI2LjA3ODEsMTE3NC4wMzEzIDI2LjA2MjUsMTE3My45MDYzIDI1Ljk2ODgsMTE3My43NSBDMjUuODEyNSwxMTczLjQ4NDQgMjUuNTMxMywxMTczLjM0MzggMjUuMjM0NCwxMTczLjM0MzggQzI0LjkzNzUsMTE3My4zNDM4IDI0LjczNDQsMTE3My40Mzc1IDI0LjUxNTYsMTE3My43NSBMMjQuMzQzOCwxMTczLjY3MTkgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDMiIHg9IjM2IiB5PSIxMTgyLjg0NjciPlNyc1RzQ29udGV4dFdyaXRlcjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4IiB4Mj0iMTgxIiB5MT0iMTE5NCIgeTI9IjExOTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSI4IiB4Mj0iMTgxIiB5MT0iMTIwMiIgeTI9IjEyMDIiLz48L2c+PCEtLU1ENT1bNzc5YmM1OWI2NmU5NmYwZWE5NjM1NjE4N2RmZGU5OTZdCmNsYXNzIFNyc0ZyYWdtZW50LS0+PGcgaWQ9ImVsZW1fU3JzRnJhZ21lbnQiPjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iNDgiIGlkPSJTcnNGcmFnbWVudCIgcng9IjIuNSIgcnk9IjIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTI0IiB4PSIyMTcuNSIgeT0iMTE2MiIvPjxlbGxpcHNlIGN4PSIyMzIuNSIgY3k9IjExNzgiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNMjM0Ljg0MzgsMTE3My42NzE5IEMyMzMuOTA2MywxMTczLjIzNDQgMjMzLjMxMjUsMTE3My4wOTM4IDIzMi40Mzc1LDExNzMuMDkzOCBDMjI5LjgxMjUsMTE3My4wOTM4IDIyNy44MTI1LDExNzUuMTcxOSAyMjcuODEyNSwxMTc3Ljg5MDYgTDIyNy44MTI1LDExNzkuMDE1NiBDMjI3LjgxMjUsMTE4MS41OTM4IDIyOS45MjE5LDExODMuNDg0NCAyMzIuODEyNSwxMTgzLjQ4NDQgQzIzNC4wMzEzLDExODMuNDg0NCAyMzUuMTg3NSwxMTgzLjE4NzUgMjM1LjkzNzUsMTE4Mi42NDA2IEMyMzYuNTE1NiwxMTgyLjIzNDQgMjM2Ljg0MzgsMTE4MS43ODEzIDIzNi44NDM4LDExODEuMzkwNiBDMjM2Ljg0MzgsMTE4MC45Mzc1IDIzNi40NTMxLDExODAuNTQ2OSAyMzUuOTg0NCwxMTgwLjU0NjkgQzIzNS43NjU2LDExODAuNTQ2OSAyMzUuNTYyNSwxMTgwLjYyNSAyMzUuMzc1LDExODAuODEyNSBDMjM0LjkyMTksMTE4MS4yOTY5IDIzNC45MjE5LDExODEuMjk2OSAyMzQuNzM0NCwxMTgxLjM5MDYgQzIzNC4zMTI1LDExODEuNjU2MyAyMzMuNjI1LDExODEuNzgxMyAyMzIuODU5NCwxMTgxLjc4MTMgQzIzMC44MTI1LDExODEuNzgxMyAyMjkuNTE1NiwxMTgwLjY4NzUgMjI5LjUxNTYsMTE3OC45ODQ0IEwyMjkuNTE1NiwxMTc3Ljg5MDYgQzIyOS41MTU2LDExNzYuMTA5NCAyMzAuNzY1NiwxMTc0Ljc5NjkgMjMyLjUsMTE3NC43OTY5IEMyMzMuMDc4MSwxMTc0Ljc5NjkgMjMzLjY4NzUsMTE3NC45NTMxIDIzNC4xNTYzLDExNzUuMjAzMSBDMjM0LjY0MDYsMTE3NS40ODQ0IDIzNC44MTI1LDExNzUuNzAzMSAyMzQuOTA2MywxMTc2LjEwOTQgQzIzNC45Njg4LDExNzYuNTE1NiAyMzUsMTE3Ni42NDA2IDIzNS4xNDA2LDExNzYuNzY1NiBDMjM1LjI4MTMsMTE3Ni45MDYzIDIzNS41MTU2LDExNzcuMDE1NiAyMzUuNzM0NCwxMTc3LjAxNTYgQzIzNiwxMTc3LjAxNTYgMjM2LjI2NTYsMTE3Ni44NzUgMjM2LjQzNzUsMTE3Ni42NTYzIEMyMzYuNTQ2OSwxMTc2LjUgMjM2LjU3ODEsMTE3Ni4zMTI1IDIzNi41NzgxLDExNzUuODkwNiBMMjM2LjU3ODEsMTE3NC40Njg4IEMyMzYuNTc4MSwxMTc0LjAzMTMgMjM2LjU2MjUsMTE3My45MDYzIDIzNi40Njg4LDExNzMuNzUgQzIzNi4zMTI1LDExNzMuNDg0NCAyMzYuMDMxMywxMTczLjM0MzggMjM1LjczNDQsMTE3My4zNDM4IEMyMzUuNDM3NSwxMTczLjM0MzggMjM1LjIzNDQsMTE3My40Mzc1IDIzNS4wMTU2LDExNzMuNzUgTDIzNC44NDM4LDExNzMuNjcxOSBaICIgZmlsbD0iIzAwMDAwMCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkyIiB4PSIyNDYuNSIgeT0iMTE4Mi44NDY3Ij5TcnNGcmFnbWVudDwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMTguNSIgeDI9IjM0MC41IiB5MT0iMTE5NCIgeTI9IjExOTQiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHgxPSIyMTguNSIgeDI9IjM0MC41IiB5MT0iMTIwMiIgeTI9IjEyMDIiLz48L2c+PCEtLU1ENT1bMTI1OWM1NDIyNjNmODllMWFiMzQxZmNjZjllMDdmY2VdCnJldmVyc2UgbGluayBTcnNPcmlnaW5IdWIgdG8gU3JzSGxzLS0+PGcgaWQ9ImxpbmtfU3JzT3JpZ2luSHViX1Nyc0hscyI+PHBhdGggY29kZUxpbmU9IjMzIiBkPSJNNDA4LjUsNjguMzUgQzQwOC41LDgyLjE0IDQwOC41LDk4LjQ0IDQwOC41LDExNC42OCAiIGZpbGw9Im5vbmUiIGlkPSJTcnNPcmlnaW5IdWItYmFja3RvLVNyc0hscyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MDguNSw1NS4wMSw0MDQuNSw2MS4wMSw0MDguNSw2Ny4wMSw0MTIuNSw2MS4wMSw0MDguNSw1NS4wMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1NRDU9W2QxZDU3ZDlkMmM4OTE5YjU4ZmI4MDc4ZTM5NGZkNzVjXQpyZXZlcnNlIGxpbmsgU3JzSGxzIHRvIFNyc0Zvcm1hdC0tPjxnIGlkPSJsaW5rX1Nyc0hsc19TcnNGb3JtYXQiPjxwYXRoIGNvZGVMaW5lPSIzNCIgZD0iTTMzOC45NTcsMjQ0LjAzNSBDMjkzLjg3NSwyNzQuNTI2IDIzNy4xMywzMTIuOTA2IDIwMS41NzQsMzM2Ljk1NCAiIGZpbGw9Im5vbmUiIGlkPSJTcnNIbHMtYmFja3RvLVNyc0Zvcm1hdCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheTo3LjAsNy4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzQzLjI4MiwyNDEuMTEsMzMzLjU4NjIsMjQyLjgzOTQsMzM5LjE0MDUsMjQzLjkxMTUsMzM4LjA2ODUsMjQ5LjQ2NTgsMzQzLjI4MiwyNDEuMTEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tTUQ1PVswMmY0NjZkNjEyYWY5OGQxYzg1NDZmMTIxNzczY2I2OV0KcmV2ZXJzZSBsaW5rIFNyc0hscyB0byBTcnNSdG1wSml0dGVyLS0+PGcgaWQ9ImxpbmtfU3JzSGxzX1Nyc1J0bXBKaXR0ZXIiPjxwYXRoIGNvZGVMaW5lPSIzNSIgZD0iTTM1OS42MTIsMjg4LjU5NCBDMzUwLjA0MywzMDYuNTIzIDM0MC44MjcsMzIzLjc4OSAzMzMuODU1LDMzNi44NTIgIiBmaWxsPSJub25lIiBpZD0iU3JzSGxzLWJhY2t0by1TcnNSdG1wSml0dGVyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM2NS43NjUsMjc3LjA2NywzNTkuNDEwOSwyODAuNDc2NywzNjAuMTE0NSwyODcuNjUzNCwzNjYuNDY4NSwyODQuMjQzNywzNjUuNzY1LDI3Ny4wNjciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tTUQ1PVs2ZjVlYTUyNWEyZjAyYmYzOGRjY2VjOTE5NDFlMDllNV0KcmV2ZXJzZSBsaW5rIFNyc0hscyB0byBTcnNIbHNDb250cm9sbGVyLS0+PGcgaWQ9ImxpbmtfU3JzSGxzX1Nyc0hsc0NvbnRyb2xsZXIiPjxwYXRoIGNvZGVMaW5lPSIzNiIgZD0iTTQ1Ny45NSwyODguNTk0IEM0NjcuNjI5LDMwNi41MjMgNDc2Ljk1MSwzMjMuNzg5IDQ4NC4wMDMsMzM2Ljg1MiAiIGZpbGw9Im5vbmUiIGlkPSJTcnNIbHMtYmFja3RvLVNyc0hsc0NvbnRyb2xsZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDUxLjcyNywyNzcuMDY3LDQ1MS4wNTc3LDI4NC4yNDcsNDU3LjQyOCwyODcuNjI2Myw0NTguMDk3MywyODAuNDQ2Myw0NTEuNzI3LDI3Ny4wNjciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjgiIHg9IjQ0Ny4yMjA3IiB5PSIyOTcuMDI0MyI+MTwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI4IiB4PSI0NzEuNzc1NiIgeT0iMzI1LjgyNjEiPjE8L3RleHQ+PC9nPjwhLS1NRDU9WzYyNTgzNjdhNDA4ZTQ4ZDFlYWQzM2RiYmMzY2MxMzhmXQpsaW5rIFNyc0hscyB0byBTcnNSZXF1ZXN0LS0+PGcgaWQ9ImxpbmtfU3JzSGxzX1Nyc1JlcXVlc3QiPjxwYXRoIGNvZGVMaW5lPSIzNyIgZD0iTTQ4My42Mjg5LDI0NC45MDYxIEM0ODMuNjI4OSwyNDQuOTA2MSA3MTMuMjQsMzkxLjMxNyA3ODYuMjUzLDQzNy44NzMgIiBmaWxsPSJub25lIiBpZD0iU3JzSGxzLVNyc1JlcXVlc3QiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNzk3LjM2OSw0NDQuOTYxLDc5MS45MzEsNDM2Ljc0OTUsNzkzLjE1MzEsNDQyLjI3MjgsNzg3LjYyOTksNDQzLjQ5NDksNzk3LjM2OSw0NDQuOTYxIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI3OTMuMTUzMSIgeDI9Ijc4Ni40MDgiIHkxPSI0NDIuMjcyOCIgeTI9IjQzNy45NzIiLz48cG9seWdvbiBmaWxsPSJub25lIiBwb2ludHM9IjQ3My41MTEsMjM4LjQ1NCw0NzYuNDE5MiwyNDUuMDUyNiw0ODMuNjI4OSwyNDQuOTA2MSw0ODAuNzIwNiwyMzguMzA3NCw0NzMuNTExLDIzOC40NTQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI0IiB4PSI3NjEuMDM1NCIgeT0iNDMzLjk2MyI+MC4uMTwvdGV4dD48L2c+PCEtLU1ENT1bZGU4ZmM5YWExYjhhZGNkNTJkYWFiNDg1MGNhZGI3ZWZdCmxpbmsgU3JzVHNNZXNzYWdlQ2FjaGUgdG8gU3JzSGxzTXV4ZXItLT48ZyBpZD0ibGlua19TcnNUc01lc3NhZ2VDYWNoZV9TcnNIbHNNdXhlciI+PHBhdGggY29kZUxpbmU9IjM4IiBkPSJNMzA0LjUsNDkzLjM3OCBDMzA0LjUsNTA3LjM2IDMwNC41LDUyNi41MjIgMzA0LjUsNTQ3LjgwOCAiIGZpbGw9Im5vbmUiIGlkPSJTcnNUc01lc3NhZ2VDYWNoZS10by1TcnNIbHNNdXhlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheTo3LjAsNy4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzA0LjUsNTUyLjk2NywzMDguNSw1NDMuOTY3LDMwNC41LDU0Ny45NjcsMzAwLjUsNTQzLjk2NywzMDQuNSw1NTIuOTY3IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLU1ENT1bMGZhNGI4NGNmOTU2MDNjOGQwYjg4Mjk4MzRjZTM3ZTRdCnJldmVyc2UgbGluayBTcnNIbHNDb250cm9sbGVyIHRvIFNyc1RzTWVzc2FnZUNhY2hlLS0+PGcgaWQ9ImxpbmtfU3JzSGxzQ29udHJvbGxlcl9TcnNUc01lc3NhZ2VDYWNoZSI+PHBhdGggY29kZUxpbmU9IjM5IiBkPSJNNDQzLjA5NywzOTEuNDgzIEM0MTIuNTU2LDQwOC4zNDQgMzc0LjgsNDI5LjE4OSAzNDYuNDExLDQ0NC44NjIgIiBmaWxsPSJub25lIiBpZD0iU3JzSGxzQ29udHJvbGxlci1iYWNrdG8tU3JzVHNNZXNzYWdlQ2FjaGUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDU0LjgzOSwzODUsNDQ3LjY1MzEsMzg0LjM5NzgsNDQ0LjMzMzQsMzkwLjc5OTQsNDUxLjUxOTMsMzkxLjQwMTUsNDU0LjgzOSwzODUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tTUQ1PVtlOTUxNzgxYTAxMjVhZWViOTllOTMzOGVmY2MzOGQ4Y10KcmV2ZXJzZSBsaW5rIFNyc0hsc0NvbnRyb2xsZXIgdG8gU3JzQXVkaW9GcmFtZS0tPjxnIGlkPSJsaW5rX1Nyc0hsc0NvbnRyb2xsZXJfU3JzQXVkaW9GcmFtZSI+PHBhdGggY29kZUxpbmU9IjQwIiBkPSJNNDk2LjUsMzkwLjEzMSBDNDk2LjUsNDA3LjE1NCA0OTYuNSw0MjguNjA0IDQ5Ni41LDQ0NC42NzggIiBmaWxsPSJub25lIiBpZD0iU3JzSGxzQ29udHJvbGxlci1iYWNrdG8tU3JzQXVkaW9GcmFtZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheTo3LjAsNy4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDk2LjUsMzg1LDQ5Mi41LDM5NCw0OTYuNSwzOTAsNTAwLjUsMzk0LDQ5Ni41LDM4NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1NRDU9WzFmZjZlYThlYjFjNTAxMGJkMmE0NWE4ODc5ZmYyYWJiXQpyZXZlcnNlIGxpbmsgU3JzSGxzQ29udHJvbGxlciB0byBTcnNWaWRlb0ZyYW1lLS0+PGcgaWQ9ImxpbmtfU3JzSGxzQ29udHJvbGxlcl9TcnNWaWRlb0ZyYW1lIj48cGF0aCBjb2RlTGluZT0iNDEiIGQ9Ik01MzkuMDExLDM4Ny43NSBDNTY3Ljc4Niw0MDUuMTc5IDYwNS40NzksNDI4LjAxIDYzMy4zLDQ0NC44NjIgIiBmaWxsPSJub25lIiBpZD0iU3JzSGxzQ29udHJvbGxlci1iYWNrdG8tU3JzVmlkZW9GcmFtZSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheTo3LjAsNy4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTM0LjQ3MiwzODUsNTQwLjA5NjcsMzkzLjA4NDgsNTM4Ljc0ODMsMzg3LjU5MDksNTQ0LjI0MjIsMzg2LjI0MjYsNTM0LjQ3MiwzODUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tTUQ1PVtjNmI3MjI5ODM5NGRjZmNiNzhjZGU4YTFkZmY3ZWNhM10KcmV2ZXJzZSBsaW5rIFNyc0hsc0NvbnRyb2xsZXIgdG8gU3JzSGxzTXV4ZXItLT48ZyBpZD0ibGlua19TcnNIbHNDb250cm9sbGVyX1Nyc0hsc011eGVyIj48cGF0aCBjb2RlTGluZT0iNDIiIGQ9Ik00MDkuNTQsMzg0Ljk1OCBDMzIzLjA4Myw0MDcuOTgyIDIwMi44MDgsNDQwLjY0MSAxOTkuNSw0NDUgQzE3NS4yMTEsNDc3LjAwOCAxNzUuOTExLDUxNS4zMDYgMTg4LjQ5Miw1NTIuOTY1ICIgZmlsbD0ibm9uZSIgaWQ9IlNyc0hsc0NvbnRyb2xsZXItYmFja3RvLVNyc0hsc011eGVyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQyMi4yOTksMzgxLjU2NCw0MTUuNDcyNSwzNzkuMjQwNCw0MTAuNzAyMSwzODQuNjQ4Miw0MTcuNTI4NiwzODYuOTcxNyw0MjIuMjk5LDM4MS41NjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tTUQ1PVs1Y2U1YTBjNzIxOTk3NjkzZGU5NTEwZjBlZjgzYjJiMl0KbGluayBTcnNSZXF1ZXN0IHRvIFNyc0hsc011eGVyLS0+PGcgaWQ9ImxpbmtfU3JzUmVxdWVzdF9TcnNIbHNNdXhlciI+PHBhdGggY29kZUxpbmU9IjQzIiBkPSJNNzcyLjIzMiw0OTguNzgxIEM2OTQuMDkzLDUzNS40ODcgNDQ5LjM4NTUsNjUwLjQ0MDIgNDQ5LjM4NTUsNjUwLjQ0MDIgIiBmaWxsPSJub25lIiBpZD0iU3JzUmVxdWVzdC1TcnNIbHNNdXhlciIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0ibm9uZSIgcG9pbnRzPSI0MzguNTI0LDY1NS41NDIsNDQ1LjY1NTMsNjU2LjYxMTYsNDQ5LjM4NTUsNjUwLjQ0MDIsNDQyLjI1NDIsNjQ5LjM3MDYsNDM4LjUyNCw2NTUuNTQyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijc4NC4yMDgsNDkzLjE1NSw3NzQuMzYxMyw0OTMuMzYwOCw3NzkuNjgyNCw0OTUuMjgwNyw3NzcuNzYyNSw1MDAuNjAxOCw3ODQuMjA4LDQ5My4xNTUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9Ijc3OS42ODI0IiB4Mj0iNzcyLjQ0MTUiIHkxPSI0OTUuMjgwNyIgeTI9IjQ5OC42ODI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjQiIHg9Ijc0NS40MDIxIiB5PSI1MTMuMDE1NiI+MC4uMTwvdGV4dD48L2c+PCEtLU1ENT1bYjQ2MDg0NDAzNWEzNjAzODM3OTgyNTg0MDk5NWU1MzZdCnJldmVyc2UgbGluayBTcnNIbHNNdXhlciB0byBTcnNGaWxlV3JpdGVyLS0+PGcgaWQ9ImxpbmtfU3JzSGxzTXV4ZXJfU3JzRmlsZVdyaXRlciI+PHBhdGggY29kZUxpbmU9IjQ0IiBkPSJNMTYxLjIwMiw4NzIuNjc4IEMxMzQuMjI4LDkwMS4zMjQgMTA5LjIyLDkyNy44OCA5Mi4zMjUzLDk0NS44MjIgIiBmaWxsPSJub25lIiBpZD0iU3JzSGxzTXV4ZXItYmFja3RvLVNyc0ZpbGVXcml0ZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTcwLjQxNiw4NjIuODkzLDE2My4zOTA3LDg2NC41MTkyLDE2Mi4xODk3LDg3MS42Mjk2LDE2OS4yMTUxLDg3MC4wMDM0LDE3MC40MTYsODYyLjg5MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1NRDU9WzAzOGUwNzExMDM4MjgzNDJmNTE3Y2M4ZjI0YTg1OTFmXQpsaW5rIFNyc0hsc011eGVyIHRvIFNyc0hsc1NlZ21lbnQtLT48ZyBpZD0ibGlua19TcnNIbHNNdXhlcl9TcnNIbHNTZWdtZW50Ij48cGF0aCBjb2RlTGluZT0iNDUiIGQ9Ik0yMzguNTkzOCw4OTcuNTcwMiBDMjM4LjU5MzgsODk3LjU3MDIgMjI3LjM5LDkzMC42NTQgMjIyLjUsOTQ2IEMyMTIuMzc3LDk3Ny43NjcgMjAyLjQ1NywxMDE0LjM5NSAxOTUuNjAyLDEwNDAuODI5ICIgZmlsbD0ibm9uZSIgaWQ9IlNyc0hsc011eGVyLVNyc0hsc1NlZ21lbnQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTkyLjMxMiwxMDUzLjY0MywxOTguNDI0NSwxMDQ1LjkyMDUsMTkzLjU1NTQsMTA0OC44MDAxLDE5MC42NzU4LDEwNDMuOTMxLDE5Mi4zMTIsMTA1My42NDMiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE5My41NTU0IiB4Mj0iMTk1LjU0NSIgeTE9IjEwNDguODAwMSIgeTI9IjEwNDEuMDUxNSIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iMjQyLjUxOCw4ODYuMjMsMjM2Ljc3NTgsODkwLjU5MiwyMzguNTkzOCw4OTcuNTcwMiwyNDQuMzM1OSw4OTMuMjA4MiwyNDIuNTE4LDg4Ni4yMyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjQiIHg9IjE2Ni44MDM3IiB5PSIxMDQyLjk2MDkiPjAuLjE8L3RleHQ+PC9nPjwhLS1NRDU9WzVkOTUwYTQ2ZmZiZThhMDQ3N2RjY2YxYWVlODE2NmNlXQpyZXZlcnNlIGxpbmsgU3JzSGxzTXV4ZXIgdG8gU3JzVHNDb250ZXh0LS0+PGcgaWQ9ImxpbmtfU3JzSGxzTXV4ZXJfU3JzVHNDb250ZXh0Ij48cGF0aCBjb2RlTGluZT0iNDYiIGQ9Ik0zMDQuNSw4OTkuMzc4IEMzMDQuNSw5MTcuNDQyIDMwNC41LDkzMy41ODQgMzA0LjUsOTQ1Ljc2NSAiIGZpbGw9Im5vbmUiIGlkPSJTcnNIbHNNdXhlci1iYWNrdG8tU3JzVHNDb250ZXh0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjMwNC41LDg4Ni4yNTMsMzAwLjUsODkyLjI1MywzMDQuNSw4OTguMjUzLDMwOC41LDg5Mi4yNTMsMzA0LjUsODg2LjI1MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1NRDU9WzQxM2E4OWM5MGM0ZWZjOTI0ZDc1NDQwMjAwODQyN2IxXQpyZXZlcnNlIGxpbmsgU3JzSGxzTXV4ZXIgdG8gU3JzQXN5bmNDYWxsV29ya2VyLS0+PGcgaWQ9ImxpbmtfU3JzSGxzTXV4ZXJfU3JzQXN5bmNDYWxsV29ya2VyIj48cGF0aCBjb2RlTGluZT0iNDciIGQ9Ik00MzcuMTI4LDg5Ni43NDcgQzQ1MS41MjIsOTE1Ljg3NCA0NjQuNDA2LDkzMi45OTUgNDc0LjAxNSw5NDUuNzY1ICIgZmlsbD0ibm9uZSIgaWQ9IlNyc0hsc011eGVyLWJhY2t0by1TcnNBc3luY0NhbGxXb3JrZXIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDI5LjIzMiw4ODYuMjUzLDQyOS42NDMyLDg5My40NTI0LDQzNi40NDcsODk1Ljg0MTgsNDM2LjAzNTcsODg4LjY0MjQsNDI5LjIzMiw4ODYuMjUzIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLU1ENT1bZDQ4Mjg0ZjQxOTE2Y2E1NzMxOTUwZDI3ZTlhMjliMzZdCnJldmVyc2UgbGluayBTcnNIbHNNdXhlciB0byBTcnNGcmFnbWVudFdpbmRvdy0tPjxnIGlkPSJsaW5rX1Nyc0hsc011eGVyX1Nyc0ZyYWdtZW50V2luZG93Ij48cGF0aCBjb2RlTGluZT0iNDgiIGQ9Ik00NDkuOTMsODEwLjg0OCBDNTI3LjgzOCw4NTkuMjQ5IDYxNy43MDgsOTE1LjA4MSA2NjcuMTA4LDk0NS43NyAiIGZpbGw9Im5vbmUiIGlkPSJTcnNIbHNNdXhlci1iYWNrdG8tU3JzRnJhZ21lbnRXaW5kb3ciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDM4LjUyOSw4MDMuNzY1LDQ0MS41MTQ1LDgxMC4zMjksNDQ4LjcyMTksODEwLjA5NzgsNDQ1LjczNjQsODAzLjUzMzgsNDM4LjUyOSw4MDMuNzY1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48L2c+PCEtLU1ENT1bNjkxZGQ0NDUyZDFmZDI1MjQ4ODExZTI3YTgzYTdhN2RdCmxpbmsgU3JzRmlsZVdyaXRlciB0byBTcnNIbHNTZWdtZW50LS0+PGcgaWQ9ImxpbmtfU3JzRmlsZVdyaXRlcl9TcnNIbHNTZWdtZW50Ij48cGF0aCBjb2RlTGluZT0iNDkiIGQ9Ik05NS42NzAzLDk5NCBDMTExLjg5OSwxMDA4LjgzIDEzMy4yNDIsMTAyOC4zMzMgMTUxLjE2LDEwNDQuNzA3ICIgZmlsbD0ibm9uZSIgaWQ9IlNyc0ZpbGVXcml0ZXItdG8tU3JzSGxzU2VnbWVudCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0ibm9uZSIgcG9pbnRzPSIxNjAuOTc4LDEwNTMuNjc4LDE1OS4yNDcxLDEwNDYuNjc3NywxNTIuMTE5NiwxMDQ1LjU4MywxNTMuODUwNSwxMDUyLjU4MzMsMTYwLjk3OCwxMDUzLjY3OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1NRDU9W2MwMTA1Nzc5MDNmOGQ0NzdlYTgwNzIyMWU5MDUzZDk2XQpsaW5rIFNyc1RzQ29udGV4dCB0byBTcnNIbHNTZWdtZW50LS0+PGcgaWQ9ImxpbmtfU3JzVHNDb250ZXh0X1Nyc0hsc1NlZ21lbnQiPjxwYXRoIGNvZGVMaW5lPSI1MCIgZD0iTTI3OC44OTYsOTk0IEMyNjAuNDY3LDEwMTAuNTU1IDIzNS41NTgsMTAzMi45MzEgMjE2LjI0NiwxMDUwLjI3OSAiIGZpbGw9Im5vbmUiIGlkPSJTcnNUc0NvbnRleHQtdG8tU3JzSGxzU2VnbWVudCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMTIuNDYyLDEwNTMuNjc4LDIyMS44MzA1LDEwNTAuNjM5NiwyMTYuMTgxNywxMDUwLjMzNjgsMjE2LjQ4NDYsMTA0NC42ODgxLDIxMi40NjIsMTA1My42NzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tTUQ1PVs1MmIxOTYwNDZmMTczYWJlY2E4ZTk5NDVkYzBlMjZkNF0KcmV2ZXJzZSBsaW5rIFNyc0hsc1NlZ21lbnQgdG8gU3JzVHNDb250ZXh0V3JpdGVyLS0+PGcgaWQ9ImxpbmtfU3JzSGxzU2VnbWVudF9TcnNUc0NvbnRleHRXcml0ZXIiPjxwYXRoIGNvZGVMaW5lPSI1MSIgZD0iTTE1Ny43ODUsMTExMi4wODQ0IEMxNDMuODIxLDExMjguMTczNiAxMjcuMzcsMTE0Ny4xMjggMTE0Ljc0MSwxMTYxLjY3ODQgIiBmaWxsPSJub25lIiBpZD0iU3JzSGxzU2VnbWVudC1iYWNrdG8tU3JzVHNDb250ZXh0V3JpdGVyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjE2Ni41MzcsMTEwMiwxNTkuNTgzMiwxMTAzLjkwOTIsMTU4LjY3MTEsMTExMS4wNjI0LDE2NS42MjQ4LDExMDkuMTUzMiwxNjYuNTM3LDExMDIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwvZz48IS0tTUQ1PVtjM2Y2MjA4ZDhhZDFiODBkYjM5YTkxZGEyMjMwYzc5NF0KbGluayBTcnNIbHNTZWdtZW50IHRvIFNyc0ZyYWdtZW50LS0+PGcgaWQ9ImxpbmtfU3JzSGxzU2VnbWVudF9TcnNGcmFnbWVudCI+PHBhdGggY29kZUxpbmU9IjUyIiBkPSJNMjA2LjY4LDExMDIgQzIxOC4wNTcsMTExNC45NjggMjMyLjU2OCwxMTMxLjUwODIgMjQ1LjYzOSwxMTQ2LjQwNTIgIiBmaWxsPSJub25lIiBpZD0iU3JzSGxzU2VnbWVudC10by1TcnNGcmFnbWVudCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHBvbHlnb24gZmlsbD0ibm9uZSIgcG9pbnRzPSIyNTEuMTEsMTE0Mi4wMjc5LDI1OS4wMzksMTE2MS42Nzg0LDI0MC41ODcsMTE1MS4yNjEsMjUxLjExLDExNDIuMDI3OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PC9nPjwhLS1NRDU9W2Y0YjU3MDgzZGE1ZWZlZTIwOGM4MWYyNTQ5OTc4ZjU3XQpAc3RhcnR1bWwNCmNsYXNzIFNyc0hscyB7DQogICtkaXNwb3NlKCkNCiAgK2N5Y2xlKCkNCiAgK2luaXRpYWxpemUoKQ0KICArb25fcHVibGlzaCgpDQogICtvbl91bnB1Ymxpc2goKQ0KICArb25fYXVkaW8oKQ0KICArb25fdmlkZW8oKQ0KfQ0KDQpjbGFzcyBTcnNIbHNNdXhlciB7DQogICtzZXF1ZW5jZV9ubygpDQogICt0c191cmwoKQ0KICArZHVyYXRpb24oKQ0KICArZGV2aWF0aW9uKCkNCiAgLi4NCiAgK2luaXRpYWxpemUoKQ0KICArb25fcHVibGlzaCgpDQogICtvbl91bnB1Ymxpc2goKQ0KICArdXBkYXRlX2NvbmZpZygpDQogICtzZWdtZW50X29wZW4oKQ0KICArb25fc2VxdWVuY2VfaGVhZGVyKCkNCiAgK2lzX3NlZ21lbnRfb3ZlcmZsb3coKQ0KICArd2FpdF9rZXlmcmFtZSgpDQogICtpc19zZWdtZW50X2Fic29sdXRlbHlfb3ZlcmZsb3coKQ0KICAuLg0KICArcHVyZV9hdWRpbygpDQogICtmbHVzaF9hdWRpbygpDQogICtmbHVzaF92aWRlbygpDQogICtzZWdtZW50X2Nsb3NlKCkNCn0NCg0KU3JzT3JpZ2luSHViICotIC0gIFNyc0hscw0KU3JzSGxzIDwuLiBTcnNGb3JtYXQNClNyc0hscyAqLSAtICBTcnNSdG1wSml0dGVyDQpTcnNIbHMgIjEiICotIC0gIjEiICBTcnNIbHNDb250cm9sbGVyDQpTcnNIbHMgby0gLT4gIjAuLjEiIFNyc1JlcXVlc3QNClNyc1RzTWVzc2FnZUNhY2hlICAuLj4gIFNyc0hsc011eGVyDQpTcnNIbHNDb250cm9sbGVyICotIC0gIFNyc1RzTWVzc2FnZUNhY2hlDQpTcnNIbHNDb250cm9sbGVyIDwuLiBTcnNBdWRpb0ZyYW1lIA0KU3JzSGxzQ29udHJvbGxlciA8Li4gU3JzVmlkZW9GcmFtZSANClNyc0hsc0NvbnRyb2xsZXIgKi0gLSAgU3JzSGxzTXV4ZXINClNyc1JlcXVlc3QgIjAuLjEiIDwtIC1vICBTcnNIbHNNdXhlcg0KU3JzSGxzTXV4ZXIgKi0gLSAgU3JzRmlsZVdyaXRlcg0KU3JzSGxzTXV4ZXIgby0gLT4gIjAuLjEiIFNyc0hsc1NlZ21lbnQNClNyc0hsc011eGVyICotIC0gIFNyc1RzQ29udGV4dA0KU3JzSGxzTXV4ZXIgKi0gLSAgU3JzQXN5bmNDYWxsV29ya2VyDQpTcnNIbHNNdXhlciAqLSAtICBTcnNGcmFnbWVudFdpbmRvdw0KU3JzRmlsZVdyaXRlciAtIC1vIFNyc0hsc1NlZ21lbnQNClNyc1RzQ29udGV4dCAtIC0+IFNyc0hsc1NlZ21lbnQNClNyc0hsc1NlZ21lbnQgKi0gLSBTcnNUc0NvbnRleHRXcml0ZXINClNyc0hsc1NlZ21lbnQgLSAtfD4gU3JzRnJhZ21lbnQNCkBlbmR1bWwNCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMi40YmV0YTIoVW5rbm93biBjb21waWxlIHRpbWUpCihHUEwgc291cmNlIGRpc3RyaWJ1dGlvbikKSmF2YSBSdW50aW1lOiBKYXZhKFRNKSBTRSBSdW50aW1lIEVudmlyb25tZW50CkpWTTogSmF2YSBIb3RTcG90KFRNKSA2NC1CaXQgU2VydmVyIFZNCkRlZmF1bHQgRW5jb2Rpbmc6IFVURi04Ckxhbmd1YWdlOiBlbgpDb3VudHJ5OiBVUwotLT48L2c+PC9zdmc+'><h3 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h3><ul><li>接收客户端 rtmp 推流请求，准备存储 ts 流</li></ul><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSIxMTUxcHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDoxMTYycHg7aGVpZ2h0OjExNTFweDtiYWNrZ3JvdW5kOiNGRkZGRkY7IiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAxMTYyIDExNTEiIHdpZHRoPSIxMTYycHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48ZWxsaXBzZSBjeD0iNTg0IiBjeT0iMjAiIGZpbGw9IiMyMjIyMjIiIHJ4PSIxMCIgcnk9IjEwIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjI0NC4xNzE5IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIyMjEiIHg9IjQ3My41IiB5PSI0MCIvPjxwYXRoIGQ9Ik01NjAuNSw0MCBMNTYwLjUsNDkuMjk2OSBMNTUwLjUsNTkuMjk2OSBMNDczLjUsNTkuMjk2OSAiIGZpbGw9Im5vbmUiIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc3IiB4PSI0NzYuNSIgeT0iNTMuOTk1MSI+bGlzdGVuQ29ubjwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTYzIiB4PSI1MDIuNSIgeT0iNzYuMjk2OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0MyIgeD0iNTEyLjUiIHk9Ijk3LjQzNTUiPlNyc1NUQ29yb3V0aW5lOjpjeWNsZSgpPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTciIHg9IjUwNS41IiB5PSIxMzAuMjY1NiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNyIgeD0iNTE1LjUiIHk9IjE1MS40MDQzIj5TcnNDb25uZWN0aW9uOjpjeWNsZSgpPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzIiIHg9IjQ5OCIgeT0iMTg0LjIzNDQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTIiIHg9IjUwOCIgeT0iMjA1LjM3MyI+U3JzUnRtcENvbm46OmRvX2N5Y2xlKCk8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjIwMSIgeD0iNDgzLjUiIHk9IjIzOC4yMDMxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTgxIiB4PSI0OTMuNSIgeT0iMjU5LjM0MTgiPlNyc1J0bXBDb25uOjpzZXJ2aWNlX2N5Y2xlKCk8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI0OSIgeD0iNDU5LjUiIHk9IjM0OC4xNzE5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjI5IiB4PSI0NjkuNSIgeT0iMzY5LjMxMDUiPlNyc1J0bXBDb25uOjpzdHJlYW1fc2VydmljZV9jeWNsZSgpPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iNTMxLjUsNDAyLjE0MDYsNjM2LjUsNDAyLjE0MDYsNjQ4LjUsNDE0LjE0MDYsNjM2LjUsNDI2LjE0MDYsNTMxLjUsNDI2LjE0MDYsNTE5LjUsNDE0LjE0MDYsNTMxLjUsNDAyLjE0MDYiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNSIgeD0iNTMxLjUiIHk9IjQxNy45NDg3Ij5TcnNSdG1wQ29ublR5cGU8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE2MSIgeD0iNDQiIHk9IjQ2MS43NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0MSIgeD0iNTQiIHk9IjQ4Mi44ODg3Ij5TcnNSdG1wQ29ubjo6cGxheWluZygpPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIzMyIgeD0iMTA4IiB5PSI1MTUuNzE4OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjkiIHg9IjEyMiIgeT0iNTM2Ljg1NzQiPi4uLjwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTc5IiB4PSIyNTgiIHk9IjQ2MS43NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OSIgeD0iMjY4IiB5PSI0ODIuODg4NyI+U3JzUnRtcENvbm46OnB1Ymxpc2hpbmcoKTwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjEyIiB4PSIyNDEuNSIgeT0iNTE1LjcxODgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTIiIHg9IjI1MS41IiB5PSI1MzYuODU3NCI+U3JzUnRtcENvbm46OmFjcXVpcmVfcHVibGlzaCgpPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjUiIHg9IjI2NSIgeT0iNTY5LjY4NzUiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDUiIHg9IjI3NSIgeT0iNTkwLjgyNjIiPlNyc1NvdXJjZTo6b25fcHVibGlzaCgpPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNzgiIHg9IjI1OC41IiB5PSI2MjMuNjU2MyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OCIgeD0iMjY4LjUiIHk9IjY0NC43OTQ5Ij5TcnNPcmlnaW5IdWI6b25fcHVibGlzaCgpPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMzciIHg9IjI3OSIgeT0iNjc3LjYyNSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjExNyIgeD0iMjg5IiB5PSI2OTguNzYzNyI+U3JzSGxzOm9uX3B1Ymxpc2goKTwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTkwIiB4PSIyNTIuNSIgeT0iNzMxLjU5MzgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNzAiIHg9IjI2Mi41IiB5PSI3NTIuNzMyNCI+U3JzSGxzQ29udHJvbGxlcjo6b25fcHVibGlzaDwvdGV4dD48cmVjdCBmaWxsPSJub25lIiBoZWlnaHQ9IjMwOC4zNjg3IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIzMzgiIHg9IjI1MSIgeT0iNzc1LjU2MjUiLz48cGF0aCBkPSJNMzQxLDc3NS41NjI1IEwzNDEsNzg0Ljg1OTQgTDMzMSw3OTQuODU5NCBMMjUxLDc5NC44NTk0ICIgZmlsbD0ibm9uZSIgc3R5bGU9InN0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iODAiIHg9IjI1NCIgeT0iNzg5LjU1NzYiPnRzU2VnbWVudDwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iODkiIHg9IjMwMyIgeT0iODExLjg1OTQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2OSIgeD0iMzEzIiB5PSI4MzIuOTk4Ij5yZWFkIGNvbmZpZzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTQ3IiB4PSIyNzQiIHk9Ijg4Ny4yMjcxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTI3IiB4PSIyODQiIHk9IjkwOC4zNjU3Ij5tdXhlci0mZ3Q7b25fcHVibGlzaCgpPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNjgiIHg9IjI2My41IiB5PSI5NjIuNTk0NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0OCIgeD0iMjczLjUiIHk9Ijk4My43MzM0Ij5tdXhlci0mZ3Q7dXBkYXRlX2NvbmZpZygpPC90ZXh0PjxwYXRoIGQ9Ik00NTQsMTA0Mi4zODA0IEw0NTQsMTA2Ny41MTMyIEw1NzksMTA2Ny41MTMyIEw1NzksMTA1Mi4zODA0IEw1NjksMTA0Mi4zODA0IEw0NTQsMTA0Mi4zODA0ICIgZmlsbD0iI0ZFRkZERCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHBhdGggZD0iTTU2OSwxMDQyLjM4MDQgTDU2OSwxMDUyLjM4MDQgTDU3OSwxMDUyLjM4MDQgTDU2OSwxMDQyLjM4MDQgIiBmaWxsPSIjRkVGRkREIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMDQiIHg9IjQ2MCIgeT0iMTA1OS40NDczIj7lh4blpIcgaGxzIOWIh+eJh+aWh+S7tjwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTczIiB4PSIyNjEiIHk9IjEwMzcuOTYyNCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1MyIgeD0iMjcxIiB5PSIxMDU5LjEwMTEiPm11eGVyLSZndDtzZWdtZW50X29wZW4oKTwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTc5IiB4PSI2MDkiIHk9IjQ2MS43NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OSIgeD0iNjE5IiB5PSI0ODIuODg4NyI+U3JzUnRtcENvbm46OnB1Ymxpc2hpbmcoKTwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjkiIHg9IjY4NCIgeT0iNTE1LjcxODgiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5IiB4PSI2OTQiIHk9IjUzNi44NTc0Ij4uLi48L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE3OSIgeD0iODYwLjUiIHk9IjQ2MS43NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1OSIgeD0iODcwLjUiIHk9IjQ4Mi44ODg3Ij5TcnNSdG1wQ29ubjo6cHVibGlzaGluZygpPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyOSIgeD0iOTM1LjUiIHk9IjUxNS43MTg4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOSIgeD0iOTQ1LjUiIHk9IjUzNi44NTc0Ij4uLi48L3RleHQ+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSI1ODQsMTA5My45MzEyLDU4NCwxMDkzLjkzMTIsNTk2LDExMDUuOTMxMiw1ODQsMTExNy45MzEyLDU4NCwxMTE3LjkzMTIsNTcyLDExMDUuOTMxMiw1ODQsMTA5My45MzEyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjU3MiwzMDQuMTcxOSw1OTYsMzA0LjE3MTksNjA4LDMxNi4xNzE5LDU5NiwzMjguMTcxOSw1NzIsMzI4LjE3MTksNTYwLDMxNi4xNzE5LDU3MiwzMDQuMTcxOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjMiIHg9IjU3Mi41IiB5PSIzMTkuOTgiPnRydWU8L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNTIiIHg9IjUwOCIgeT0iMzEzLjU3NzYiPmtpbGwgc2lnbmFsPC90ZXh0PjxlbGxpcHNlIGN4PSIyNCIgY3k9IjM1OC4xNzE5IiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxLjU7ZmlsbDpub25lOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6Mi41O2ZpbGw6bm9uZTsiIHgxPSIxNy44MTI4IiB4Mj0iMzAuMTg3MiIgeTE9IjM1MS45ODQ3IiB5Mj0iMzY0LjM1OTEiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjIuNTtmaWxsOm5vbmU7IiB4MT0iMzAuMTg3MiIgeDI9IjE3LjgxMjgiIHkxPSIzNTEuOTg0NyIgeTI9IjM2NC4zNTkxIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7ZmlsbDpub25lOyIgeDE9IjU4NCIgeDI9IjU4NCIgeTE9IjExMC4yNjU2IiB5Mj0iMTMwLjI2NTYiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU4MCwxMjAuMjY1Niw1ODQsMTMwLjI2NTYsNTg4LDEyMC4yNjU2LDU4NCwxMjQuMjY1NiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTg0IiB4Mj0iNTg0IiB5MT0iMTY0LjIzNDQiIHkyPSIxODQuMjM0NCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTgwLDE3NC4yMzQ0LDU4NCwxODQuMjM0NCw1ODgsMTc0LjIzNDQsNTg0LDE3OC4yMzQ0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI1ODQiIHgyPSI1ODQiIHkxPSIyMTguMjAzMSIgeTI9IjIzOC4yMDMxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1ODAsMjI4LjIwMzEsNTg0LDIzOC4yMDMxLDU4OCwyMjguMjAzMSw1ODQsMjMyLjIwMzEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjU4NCIgeDI9IjU4NCIgeTE9IjMwIiB5Mj0iNzYuMjk2OSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTgwLDY2LjI5NjksNTg0LDc2LjI5NjksNTg4LDY2LjI5NjksNTg0LDcwLjI5NjkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjEyNC41IiB4Mj0iMTI0LjUiIHkxPSI0OTUuNzE4OCIgeTI9IjUxNS43MTg4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMjAuNSw1MDUuNzE4OCwxMjQuNSw1MTUuNzE4OCwxMjguNSw1MDUuNzE4OCwxMjQuNSw1MDkuNzE4OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzQ3LjUiIHgyPSIzNDcuNSIgeTE9IjQ5NS43MTg4IiB5Mj0iNTE1LjcxODgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM0My41LDUwNS43MTg4LDM0Ny41LDUxNS43MTg4LDM1MS41LDUwNS43MTg4LDM0Ny41LDUwOS43MTg4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIzNDcuNSIgeDI9IjM0Ny41IiB5MT0iNTQ5LjY4NzUiIHkyPSI1NjkuNjg3NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzQzLjUsNTU5LjY4NzUsMzQ3LjUsNTY5LjY4NzUsMzUxLjUsNTU5LjY4NzUsMzQ3LjUsNTYzLjY4NzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM0Ny41IiB4Mj0iMzQ3LjUiIHkxPSI2MDMuNjU2MyIgeTI9IjYyMy42NTYzIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNDMuNSw2MTMuNjU2MywzNDcuNSw2MjMuNjU2MywzNTEuNSw2MTMuNjU2MywzNDcuNSw2MTcuNjU2MyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzQ3LjUiIHgyPSIzNDcuNSIgeTE9IjY1Ny42MjUiIHkyPSI2NzcuNjI1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNDMuNSw2NjcuNjI1LDM0Ny41LDY3Ny42MjUsMzUxLjUsNjY3LjYyNSwzNDcuNSw2NzEuNjI1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIzNDcuNSIgeDI9IjM0Ny41IiB5MT0iNzExLjU5MzgiIHkyPSI3MzEuNTkzOCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMzQzLjUsNzIxLjU5MzgsMzQ3LjUsNzMxLjU5MzgsMzUxLjUsNzIxLjU5MzgsMzQ3LjUsNzI1LjU5MzgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM0Ny41IiB4Mj0iMzQ3LjUiIHkxPSI4NDUuODI4MSIgeTI9Ijg4Ny4yMjcxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNDMuNSw4NzcuMjI3MSwzNDcuNSw4ODcuMjI3MSwzNTEuNSw4NzcuMjI3MSwzNDcuNSw4ODEuMjI3MSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTIzIiB4PSIzNTEuNSIgeT0iODY3LjEzMjgiPm5ldyBtdXhlciBzdCByb3V0aW5lPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM0Ny41IiB4Mj0iMzQ3LjUiIHkxPSI5MjEuMTk1OCIgeTI9Ijk2Mi41OTQ3Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNDMuNSw5NTIuNTk0NywzNDcuNSw5NjIuNTk0NywzNTEuNSw5NTIuNTk0NywzNDcuNSw5NTYuNTk0NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE5IiB4PSIzNTEuNSIgeT0iOTQyLjUwMDUiPnVwZGF0ZSBtdXhlciBjb25maWc8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzQ3LjUiIHgyPSIzNDcuNSIgeTE9Ijk5Ni41NjM1IiB5Mj0iMTAzNy45NjI0Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIzNDMuNSwxMDI3Ljk2MjQsMzQ3LjUsMTAzNy45NjI0LDM1MS41LDEwMjcuOTYyNCwzNDcuNSwxMDMxLjk2MjQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwNiIgeD0iMzUxLjUiIHk9IjEwMTcuODY4MiI+Y3JlYXRlIHRzIHNlZ21lbnQ8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMzQ3LjUiIHgyPSIzNDcuNSIgeTE9Ijc2NS41NjI1IiB5Mj0iODExLjg1OTQiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM0My41LDgwMS44NTk0LDM0Ny41LDgxMS44NTk0LDM1MS41LDgwMS44NTk0LDM0Ny41LDgwNS44NTk0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI2OTguNSIgeDI9IjY5OC41IiB5MT0iNDk1LjcxODgiIHkyPSI1MTUuNzE4OCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjk0LjUsNTA1LjcxODgsNjk4LjUsNTE1LjcxODgsNzAyLjUsNTA1LjcxODgsNjk4LjUsNTA5LjcxODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9Ijk1MCIgeDI9Ijk1MCIgeTE9IjQ5NS43MTg4IiB5Mj0iNTE1LjcxODgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9Ijk0Niw1MDUuNzE4OCw5NTAsNTE1LjcxODgsOTU0LDUwNS43MTg4LDk1MCw1MDkuNzE4OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTE5LjUiIHgyPSIxMjQuNSIgeTE9IjQxNC4xNDA2IiB5Mj0iNDE0LjE0MDYiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxMjQuNSIgeDI9IjEyNC41IiB5MT0iNDE0LjE0MDYiIHkyPSI0NjEuNzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEyMC41LDQ1MS43NSwxMjQuNSw0NjEuNzUsMTI4LjUsNDUxLjc1LDEyNC41LDQ1NS43NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iOTkiIHg9IjEyOC41IiB5PSI0NDEuNzUzNCI+U3JzUnRtcENvbm5QbGF5PC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjY0OC41IiB4Mj0iOTUwIiB5MT0iNDE0LjE0MDYiIHkyPSI0MTQuMTQwNiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9Ijk1MCIgeDI9Ijk1MCIgeTE9IjQxNC4xNDA2IiB5Mj0iNDYxLjc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI5NDYsNDUxLjc1LDk1MCw0NjEuNzUsOTU0LDQ1MS43NSw5NTAsNDU1Ljc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjYiIHg9Ijk1NCIgeT0iNDQxLjc1MzQiPlNyc1J0bXBDb25uSGFpdmlzaW9uUHVibGlzaDwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIzNDcuNSIgeDI9IjM0Ny41IiB5MT0iNDE0LjE0MDYiIHkyPSI0NjEuNzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM0My41LDQ1MS43NSwzNDcuNSw0NjEuNzUsMzUxLjUsNDUxLjc1LDM0Ny41LDQ1NS43NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQzIiB4PSIzNTEuNSIgeT0iNDM2Ljc1MzQiPlNyc1J0bXBDb25uRk1MRVB1Ymxpc2g8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNjk4LjUiIHgyPSI2OTguNSIgeTE9IjQxNC4xNDA2IiB5Mj0iNDYxLjc1Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2OTQuNSw0NTEuNzUsNjk4LjUsNDYxLjc1LDcwMi41LDQ1MS43NSw2OTguNSw0NTUuNzUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0NCIgeD0iNzAyLjUiIHk9IjQzNi43NTM0Ij5TcnNSdG1wQ29ubkZsYXNoUHVibGlzaDwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxMjQuNSIgeDI9IjEyNC41IiB5MT0iNTQ5LjY4NzUiIHkyPSIxMTA1LjkzMTIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxMjQuNSIgeDI9IjU3MiIgeTE9IjExMDUuOTMxMiIgeTI9IjExMDUuOTMxMiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTYyLDExMDEuOTMxMiw1NzIsMTEwNS45MzEyLDU2MiwxMTA5LjkzMTIsNTY2LDExMDUuOTMxMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iOTUwIiB4Mj0iOTUwIiB5MT0iNTQ5LjY4NzUiIHkyPSIxMTA1LjkzMTIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI5NTAiIHgyPSI1OTYiIHkxPSIxMTA1LjkzMTIiIHkyPSIxMTA1LjkzMTIiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjYwNiwxMTAxLjkzMTIsNTk2LDExMDUuOTMxMiw2MDYsMTEwOS45MzEyLDYwMiwxMTA1LjkzMTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjM0Ny41IiB4Mj0iMzQ3LjUiIHkxPSIxMDcxLjkzMTIiIHkyPSIxMTA1LjkzMTIiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM0My41LDEwOTUuOTMxMiwzNDcuNSwxMTA1LjkzMTIsMzUxLjUsMTA5NS45MzEyLDM0Ny41LDEwOTkuOTMxMiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNjk4LjUiIHgyPSI2OTguNSIgeTE9IjU0OS42ODc1IiB5Mj0iMTEwNS45MzEyIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2OTQuNSwxMDk1LjkzMTIsNjk4LjUsMTEwNS45MzEyLDcwMi41LDEwOTUuOTMxMiw2OTguNSwxMDk5LjkzMTIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjU4NCIgeDI9IjU4NCIgeTE9IjM4Mi4xNDA2IiB5Mj0iNDAyLjE0MDYiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU4MCwzOTIuMTQwNiw1ODQsNDAyLjE0MDYsNTg4LDM5Mi4xNDA2LDU4NCwzOTYuMTQwNiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTg0IiB4Mj0iNTg0IiB5MT0iMzI4LjE3MTkiIHkyPSIzNDguMTcxOSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTgwLDMzOC4xNzE5LDU4NCwzNDguMTcxOSw1ODgsMzM4LjE3MTksNTg0LDM0Mi4xNzE5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI1ODQiIHgyPSI1ODQiIHkxPSIxMTE3LjkzMTIiIHkyPSIxMTI3LjkzMTIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI1ODQiIHgyPSIxMTM2IiB5MT0iMTEyNy45MzEyIiB5Mj0iMTEyNy45MzEyIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMTMyLDc2Mi4xNjAyLDExMzYsNzUyLjE2MDIsMTE0MCw3NjIuMTYwMiwxMTM2LDc1OC4xNjAyIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxMTM2IiB4Mj0iMTEzNiIgeTE9IjMxNi4xNzE5IiB5Mj0iMTEyNy45MzEyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTEzNiIgeDI9IjYwOCIgeTE9IjMxNi4xNzE5IiB5Mj0iMzE2LjE3MTkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjYxOCwzMTIuMTcxOSw2MDgsMzE2LjE3MTksNjE4LDMyMC4xNzE5LDYxNCwzMTYuMTcxOSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTYwIiB4Mj0iMjQiIHkxPSIzMTYuMTcxOSIgeTI9IjMxNi4xNzE5Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMjQiIHgyPSIyNCIgeTE9IjMxNi4xNzE5IiB5Mj0iMzQ4LjE3MTkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjIwLDMzOC4xNzE5LDI0LDM0OC4xNzE5LDI4LDMzOC4xNzE5LDI0LDM0Mi4xNzE5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI1ODQiIHgyPSI1ODQiIHkxPSIyNzIuMTcxOSIgeTI9IjMwNC4xNzE5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1ODAsMjk0LjE3MTksNTg0LDMwNC4xNzE5LDU4OCwyOTQuMTcxOSw1ODQsMjk4LjE3MTkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjwhLS1NRDU9W2U3ZDYxYWU2M2FhYmRhMmI2ZmQ4YmI3MTgzNmIxMjk0XQpAc3RhcnR1bWwNCnN0YXJ0DQpwYXJ0aXRpb24gbGlzdGVuQ29ubiB7DQogIDpTcnNTVENvcm91dGluZTo6Y3ljbGUoKTsNCiAgOlNyc0Nvbm5lY3Rpb246OmN5Y2xlKCk7DQogIDpTcnNSdG1wQ29ubjo6ZG9fY3ljbGUoKTsNCiAgOlNyc1J0bXBDb25uOjpzZXJ2aWNlX2N5Y2xlKCk7DQp9DQp3aGlsZSAodHJ1ZSkNCiAgOlNyc1J0bXBDb25uOjpzdHJlYW1fc2VydmljZV9jeWNsZSgpOw0KICBzd2l0Y2ggKFNyc1J0bXBDb25uVHlwZSkNCiAgY2FzZSAoIFNyc1J0bXBDb25uUGxheSApDQogICAgOlNyc1J0bXBDb25uOjpwbGF5aW5nKCk7DQogICAgOiAuLi47DQogIGNhc2UgKCBTcnNSdG1wQ29ubkZNTEVQdWJsaXNoICkgDQogICAgOlNyc1J0bXBDb25uOjpwdWJsaXNoaW5nKCk7DQogICAgOlNyc1J0bXBDb25uOjphY3F1aXJlX3B1Ymxpc2goKTsNCiAgICA6U3JzU291cmNlOjpvbl9wdWJsaXNoKCk7DQogICAgOlNyc09yaWdpbkh1Yjpvbl9wdWJsaXNoKCk7DQogICAgOlNyc0hsczpvbl9wdWJsaXNoKCk7DQogICAgOlNyc0hsc0NvbnRyb2xsZXI6Om9uX3B1Ymxpc2g7DQogICAgcGFydGl0aW9uIHRzU2VnbWVudCB7DQogICAgICA6cmVhZCBjb25maWc7DQogICAgICAtPiBuZXcgbXV4ZXIgc3Qgcm91dGluZTsNCiAgICAgIDptdXhlci0+b25fcHVibGlzaCgpOw0KICAgICAgLT4gdXBkYXRlIG11eGVyIGNvbmZpZzsNCiAgICAgIDptdXhlci0+dXBkYXRlX2NvbmZpZygpOw0KICAgICAgLT4gY3JlYXRlIHRzIHNlZ21lbnQ7DQogICAgICA6bXV4ZXItPnNlZ21lbnRfb3BlbigpOw0KICAgICAgZmxvYXRpbmcgbm90ZSByaWdodDog5YeG5aSHIGhscyDliIfniYfmlofku7YNCiAgICB9DQogIGNhc2UgKCBTcnNSdG1wQ29ubkZsYXNoUHVibGlzaCApDQogICAgOlNyc1J0bXBDb25uOjpwdWJsaXNoaW5nKCk7DQogICAgOi4uLjsNCiAgY2FzZSAoIFNyc1J0bXBDb25uSGFpdmlzaW9uUHVibGlzaCApDQogICAgOlNyc1J0bXBDb25uOjpwdWJsaXNoaW5nKCk7DQogICAgOi4uLjsNCiAgZW5kc3dpdGNoDQplbmR3aGlsZSAoa2lsbCBzaWduYWwpDQplbmQNCkBlbmR1bWwNCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMi40YmV0YTIoVW5rbm93biBjb21waWxlIHRpbWUpCihHUEwgc291cmNlIGRpc3RyaWJ1dGlvbikKSmF2YSBSdW50aW1lOiBKYXZhKFRNKSBTRSBSdW50aW1lIEVudmlyb25tZW50CkpWTTogSmF2YSBIb3RTcG90KFRNKSA2NC1CaXQgU2VydmVyIFZNCkRlZmF1bHQgRW5jb2Rpbmc6IFVURi04Ckxhbmd1YWdlOiBlbgpDb3VudHJ5OiBVUwotLT48L2c+PC9zdmc+'><ul><li>recv_thread 接收音视频流</li></ul><img src='data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U3R5bGVUeXBlPSJ0ZXh0L2NzcyIgaGVpZ2h0PSI4NTlweCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSIgc3R5bGU9IndpZHRoOjExMTFweDtoZWlnaHQ6ODU5cHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMTExMSA4NTkiIHdpZHRoPSIxMTExcHgiIHpvb21BbmRQYW49Im1hZ25pZnkiPjxkZWZzLz48Zz48ZWxsaXBzZSBjeD0iNTczLjc1IiBjeT0iMjAiIGZpbGw9IiMyMjIyMjIiIHJ4PSIxMCIgcnk9IjEwIiBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjE4IiB4PSI0NjQuNzUiIHk9IjExMC44MDQ3Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTk4IiB4PSI0NzQuNzUiIHk9IjEzMS45NDM0Ij5TcnNSdG1wU2VydmVyOjpyZWN2X21lc3NhZ2UoKTwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjI1IiB4PSI0NjEuMjUiIHk9IjE2NC43NzM0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjA1IiB4PSI0NzEuMjUiIHk9IjE4NS45MTIxIj5TcnNQdWJsaXNoUmVjdlRocmVhZDo6Y29uc3VtZSgpPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIyNjkiIHg9IjQzOS4yNSIgeT0iMjQwLjE0MTEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIyNDkiIHg9IjQ0OS4yNSIgeT0iMjYxLjI3OTgiPlNyc1J0bXBDb25uOjpoYW5kbGVfcHVibGlzaF9tZXNzYWdlKCk8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjI3OSIgeD0iNDM0LjI1IiB5PSIzMTUuNTA4OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI1OSIgeD0iNDQ0LjI1IiB5PSIzMzYuNjQ3NSI+U3JzUnRtcENvbm46OnByb2Nlc3NfcHVibGlzaF9tZXNzYWdlKCk8L3RleHQ+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSI3OC41LDM2OS40Nzc1LDIwNC41LDM2OS40Nzc1LDIxNi41LDM4MS40Nzc1LDIwNC41LDM5My40Nzc1LDc4LjUsMzkzLjQ3NzUsNjYuNSwzODEuNDc3NSw3OC41LDM2OS40Nzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NiIgeD0iMTQ1LjUiIHk9IjQwMy42ODgiPuWkhOeQhumfs+mikea2iOaBrzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjYiIHg9Ijc4LjUiIHk9IjM4NS4yODU2Ij5tc2ctJmd0O2hlYWRlciBpcyBhdWRpbzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTU1IiB4PSI2NCIgeT0iNDI1LjE4OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNSIgeD0iNzQiIHk9IjQ0Ni4zMjY3Ij5TcnNTb3VyY2U6Om9uX2F1ZGlvKCk8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE4MyIgeD0iNTAiIHk9IjQ5MS4yNTQ0Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTYzIiB4PSI2MCIgeT0iNTEyLjM5MzEiPlNyc1NvdXJjZTo6b25fYXVkaW9faW1wKCk8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE3MiIgeD0iNTUuNSIgeT0iNTY2LjYyMjEiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNTIiIHg9IjY1LjUiIHk9IjU4Ny43NjA3Ij5TcnNPcmlnaW5IdWI6Om9uX2F1ZGlvKCk8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1NCIgeD0iNjQuNSIgeT0iNjQxLjk4OTciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMzQiIHg9Ijc0LjUiIHk9IjY2My4xMjg0Ij5TcnNGb3JtYXQ6Om9uX2F1ZGlvKCk8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjEyMSIgeD0iODEiIHk9IjY5NS45NTg1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTAxIiB4PSI5MSIgeT0iNzE3LjA5NzIiPlNyc0hsczo6b25fYXVkaW88L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE5NSIgeD0iNDQiIHk9Ijc3MS4zMjYyIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTc1IiB4PSI1NCIgeT0iNzkyLjQ2NDgiPlNyc0hsc0NvbnRyb2xsZXI6OndyaXRlX2F1ZGlvPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iMzY2LDM2OS40Nzc1LDQ5MywzNjkuNDc3NSw1MDUsMzgxLjQ3NzUsNDkzLDM5My40Nzc1LDM2NiwzOTMuNDc3NSwzNTQsMzgxLjQ3NzUsMzY2LDM2OS40Nzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI2NiIgeD0iNDMzLjUiIHk9IjQwMy42ODgiPuWkhOeQhuinhumikea2iOaBrzwvdGV4dD48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxMjciIHg9IjM2NiIgeT0iMzg1LjI4NTYiPm1zZy0mZ3Q7aGVhZGVyIGlzIHZpZGVvPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxNTYiIHg9IjM1MS41IiB5PSI0MjUuMTg4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTM2IiB4PSIzNjEuNSIgeT0iNDQ2LjMyNjciPlNyc1NvdXJjZTo6b25fdmlkZW8oKTwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTg0IiB4PSIzMzcuNSIgeT0iNDkxLjI1NDQiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNjQiIHg9IjM0Ny41IiB5PSI1MTIuMzkzMSI+U3JzU291cmNlOjpvbl92aWRlb19pbXAoKTwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMTczIiB4PSIzNDMiIHk9IjU2Ni42MjIxIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTUzIiB4PSIzNTMiIHk9IjU4Ny43NjA3Ij5TcnNPcmlnaW5IdWI6Om9uX3ZpZGVvKCk8L3RleHQ+PHJlY3QgZmlsbD0iI0YxRjFGMSIgaGVpZ2h0PSIzMy45Njg4IiByeD0iMTIuNSIgcnk9IjEyLjUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MC41OyIgd2lkdGg9IjE1NSIgeD0iMzUyIiB5PSI2NDEuOTg5NyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEzNSIgeD0iMzYyIiB5PSI2NjMuMTI4NCI+U3JzRm9ybWF0Ojpvbl92aWRlbygpPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxMjIiIHg9IjM2OC41IiB5PSI2OTUuOTU4NSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMiIgeD0iMzc4LjUiIHk9IjcxNy4wOTcyIj5TcnNIbHM6Om9uX3ZpZGVvPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxOTYiIHg9IjMzMS41IiB5PSI3NzEuMzI2MiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE3NiIgeD0iMzQxLjUiIHk9Ijc5Mi40NjQ4Ij5TcnNIbHNDb250cm9sbGVyOjp3cml0ZV92aWRlbzwvdGV4dD48cG9seWdvbiBmaWxsPSIjRjFGMUYxIiBwb2ludHM9IjYzNiwzNjkuNDc3NSw3OTAsMzY5LjQ3NzUsODAyLDM4MS40Nzc1LDc5MCwzOTMuNDc3NSw2MzYsMzkzLjQ3NzUsNjI0LDM4MS40Nzc1LDYzNiwzNjkuNDc3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzciIHg9IjcxNyIgeT0iNDAzLjY4OCI+5aSE55CG6IGa5ZCI5YyF5raI5oGvPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE1NCIgeD0iNjM2IiB5PSIzODUuMjg1NiI+bXNnLSZndDtoZWFkZXIgaXMgYWdncmVnYXRlPC90ZXh0PjxyZWN0IGZpbGw9IiNGMUYxRjEiIGhlaWdodD0iMzMuOTY4OCIgcng9IjEyLjUiIHJ5PSIxMi41IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiIHdpZHRoPSIxODUiIHg9IjYyMC41IiB5PSI0MjUuMTg4Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTY1IiB4PSI2MzAuNSIgeT0iNDQ2LjMyNjciPlNyc1NvdXJjZTo6b25fYWdncmVnYXRlKCk8L3RleHQ+PHBvbHlnb24gZmlsbD0iI0YxRjFGMSIgcG9pbnRzPSI4NjAuNSwzNjkuNDc3NSwxMDA4LjUsMzY5LjQ3NzUsMTAyMC41LDM4MS40Nzc1LDEwMDguNSwzOTMuNDc3NSw4NjAuNSwzOTMuNDc3NSw4NDguNSwzODEuNDc3NSw4NjAuNSwzNjkuNDc3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNzciIHg9IjkzOC41IiB5PSI0MDMuNjg4Ij7lpITnkIblhYPmlbDmja7mtojmga88L3RleHQ+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTQ4IiB4PSI4NjAuNSIgeT0iMzg1LjI4NTYiPm1zZy0mZ3Q7aGVhZGVyIGlzIGFtZl9kYXRhPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0IiB4PSIxMDIwLjUiIHk9IjM3OC44ODMzIj5ubzwvdGV4dD48cmVjdCBmaWxsPSIjRjFGMUYxIiBoZWlnaHQ9IjMzLjk2ODgiIHJ4PSIxMi41IiByeT0iMTIuNSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDowLjU7IiB3aWR0aD0iMjM4IiB4PSI4MTUuNSIgeT0iNDI1LjE4OCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIxOCIgeD0iODI1LjUiIHk9IjQ0Ni4zMjY3Ij5TcnNSdG1wU2VydmVyOjpkZWNvZGVfbWVzc2FnZSgpPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNGMUYxRjEiIHBvaW50cz0iNTYxLjc1LDUwLDU4NS43NSw1MCw1OTcuNzUsNjIsNTg1Ljc1LDc0LDU2MS43NSw3NCw1NDkuNzUsNjIsNTYxLjc1LDUwIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjAuNTsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxNDgiIHg9IjU3Ny43NSIgeT0iODQuMjEwNCI+cnRtcCBzZXJ2ZXIg5o6l5pS25Yiw5o6o5rWB5raI5oGvPC90ZXh0Pjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjIzIiB4PSI1NjIuMjUiIHk9IjY1LjgwODEiPnRydWU8L3RleHQ+PGVsbGlwc2UgY3g9IjI0IiBjeT0iMTA4IiByeD0iMTAiIHJ5PSIxMCIgc3R5bGU9InN0cm9rZTojMjIyMjIyO3N0cm9rZS13aWR0aDoxLjU7ZmlsbDpub25lOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzIyMjIyMjtzdHJva2Utd2lkdGg6Mi41O2ZpbGw6bm9uZTsiIHgxPSIxNy44MTI4IiB4Mj0iMzAuMTg3MiIgeTE9IjEwMS44MTI4IiB5Mj0iMTE0LjE4NzIiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMyMjIyMjI7c3Ryb2tlLXdpZHRoOjIuNTtmaWxsOm5vbmU7IiB4MT0iMzAuMTg3MiIgeDI9IjE3LjgxMjgiIHkxPSIxMDEuODEyOCIgeTI9IjExNC4xODcyIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7ZmlsbDpub25lOyIgeDE9IjU3My43NSIgeDI9IjU3My43NSIgeTE9IjE0NC43NzM0IiB5Mj0iMTY0Ljc3MzQiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU2OS43NSwxNTQuNzczNCw1NzMuNzUsMTY0Ljc3MzQsNTc3Ljc1LDE1NC43NzM0LDU3My43NSwxNTguNzczNCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTczLjc1IiB4Mj0iNTczLjc1IiB5MT0iMTk4Ljc0MjIiIHkyPSIyNDAuMTQxMSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTY5Ljc1LDIzMC4xNDExLDU3My43NSwyNDAuMTQxMSw1NzcuNzUsMjMwLjE0MTEsNTczLjc1LDIzNC4xNDExIiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NCIgeD0iNTc3Ljc1IiB5PSIyMjAuMDQ2OSI+5aSE55CG5raI5oGvPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjU3My43NSIgeDI9IjU3My43NSIgeTE9IjI3NC4xMDk5IiB5Mj0iMzE1LjUwODgiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjU2OS43NSwzMDUuNTA4OCw1NzMuNzUsMzE1LjUwODgsNTc3Ljc1LDMwNS41MDg4LDU3My43NSwzMDkuNTA4OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTU0IiB4PSI1NzcuNzUiIHk9IjI5NS40MTQ2Ij7lpITnkIbljIXlkKvpn7Pop4bpopHjgIHlhYPmlbDmja7nmoTmtojmga88L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTQxLjUiIHgyPSIxNDEuNSIgeTE9IjQ1OS4xNTY3IiB5Mj0iNDkxLjI1NDQiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzNy41LDQ4MS4yNTQ0LDE0MS41LDQ5MS4yNTQ0LDE0NS41LDQ4MS4yNTQ0LDE0MS41LDQ4NS4yNTQ0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNDEuNSIgeDI9IjE0MS41IiB5MT0iNTI1LjIyMzEiIHkyPSI1NjYuNjIyMSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTM3LjUsNTU2LjYyMjEsMTQxLjUsNTY2LjYyMjEsMTQ1LjUsNTU2LjYyMjEsMTQxLjUsNTYwLjYyMjEiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjQ0IiB4PSIxNDUuNSIgeT0iNTQ2LjUyNzgiPuWkhOeQhumfs+mikTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNDEuNSIgeDI9IjE0MS41IiB5MT0iNjAwLjU5MDgiIHkyPSI2NDEuOTg5NyIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTM3LjUsNjMxLjk4OTcsMTQxLjUsNjQxLjk4OTcsMTQ1LjUsNjMxLjk4OTcsMTQxLjUsNjM1Ljk4OTciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE0MSIgeD0iMTQ1LjUiIHk9IjYyMS44OTU1Ij7liJ3lp4vljJbpn7PpopHnvJbnoIHlmaggYWFjL21wMzwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNDEuNSIgeDI9IjE0MS41IiB5MT0iNjc1Ljk1ODUiIHkyPSI2OTUuOTU4NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTM3LjUsNjg1Ljk1ODUsMTQxLjUsNjk1Ljk1ODUsMTQ1LjUsNjg1Ljk1ODUsMTQxLjUsNjg5Ljk1ODUiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjE0MS41IiB4Mj0iMTQxLjUiIHkxPSI3MjkuOTI3MiIgeTI9Ijc3MS4zMjYyIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMzcuNSw3NjEuMzI2MiwxNDEuNSw3NzEuMzI2MiwxNDUuNSw3NjEuMzI2MiwxNDEuNSw3NjUuMzI2MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTc2IiB4PSIxNDUuNSIgeT0iNzUxLjIzMTkiPuiuvue9rumHh+agt+eOh++8jOW5tuWwhumfs+mikeaVsOaNruWGmeWFpeaWh+S7tjwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0MjkuNSIgeDI9IjQyOS41IiB5MT0iNDU5LjE1NjciIHkyPSI0OTEuMjU0NCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDI1LjUsNDgxLjI1NDQsNDI5LjUsNDkxLjI1NDQsNDMzLjUsNDgxLjI1NDQsNDI5LjUsNDg1LjI1NDQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjQyOS41IiB4Mj0iNDI5LjUiIHkxPSI1MjUuMjIzMSIgeTI9IjU2Ni42MjIxIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MjUuNSw1NTYuNjIyMSw0MjkuNSw1NjYuNjIyMSw0MzMuNSw1NTYuNjIyMSw0MjkuNSw1NjAuNjIyMSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iNDQiIHg9IjQzMy41IiB5PSI1NDYuNTI3OCI+5aSE55CG6KeG6aKRPC90ZXh0PjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjQyOS41IiB4Mj0iNDI5LjUiIHkxPSI2MDAuNTkwOCIgeTI9IjY0MS45ODk3Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MjUuNSw2MzEuOTg5Nyw0MjkuNSw2NDEuOTg5Nyw0MzMuNSw2MzEuOTg5Nyw0MjkuNSw2MzUuOTg5NyIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTEiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMTE2IiB4PSI0MzMuNSIgeT0iNjIxLjg5NTUiPuWIneWni+WMluinhumikee8lueggeWZqCBBVkM8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNDI5LjUiIHgyPSI0MjkuNSIgeTE9IjY3NS45NTg1IiB5Mj0iNjk1Ljk1ODUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjQyNS41LDY4NS45NTg1LDQyOS41LDY5NS45NTg1LDQzMy41LDY4NS45NTg1LDQyOS41LDY4OS45NTg1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0MjkuNSIgeDI9IjQyOS41IiB5MT0iNzI5LjkyNzIiIHkyPSI3NzEuMzI2MiIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDI1LjUsNzYxLjMyNjIsNDI5LjUsNzcxLjMyNjIsNDMzLjUsNzYxLjMyNjIsNDI5LjUsNzY1LjMyNjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjE2NyIgeD0iNDMzLjUiIHk9Ijc1MS4yMzE5Ij7orr7nva5EVFPvvIzlubblsIbop4bpopHmlbDmja7lhpnlhaXmlofku7Y8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTQxLjUiIHgyPSIxNDEuNSIgeTE9IjM5My40Nzc1IiB5Mj0iNDI1LjE4OCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTM3LjUsNDE1LjE4OCwxNDEuNSw0MjUuMTg4LDE0NS41LDQxNS4xODgsMTQxLjUsNDE5LjE4OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTQxLjUiIHgyPSIxNDEuNSIgeTE9IjgwNS4yOTQ5IiB5Mj0iODI1LjI5NDkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzNy41LDgxNS4yOTQ5LDE0MS41LDgyNS4yOTQ5LDE0NS41LDgxNS4yOTQ5LDE0MS41LDgxOS4yOTQ5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0MjkuNSIgeDI9IjQyOS41IiB5MT0iMzkzLjQ3NzUiIHkyPSI0MjUuMTg4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI0MjUuNSw0MTUuMTg4LDQyOS41LDQyNS4xODgsNDMzLjUsNDE1LjE4OCw0MjkuNSw0MTkuMTg4IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI0MjkuNSIgeDI9IjQyOS41IiB5MT0iODA1LjI5NDkiIHkyPSI4MjUuMjk0OSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNDI1LjUsODE1LjI5NDksNDI5LjUsODI1LjI5NDksNDMzLjUsODE1LjI5NDksNDI5LjUsODE5LjI5NDkiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjcxMyIgeDI9IjcxMyIgeTE9IjM5My40Nzc1IiB5Mj0iNDI1LjE4OCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNzA5LDQxNS4xODgsNzEzLDQyNS4xODgsNzE3LDQxNS4xODgsNzEzLDQxOS4xODgiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjcxMyIgeDI9IjcxMyIgeTE9IjQ1OS4xNTY3IiB5Mj0iODI1LjI5NDkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjcwOSw4MTUuMjk0OSw3MTMsODI1LjI5NDksNzE3LDgxNS4yOTQ5LDcxMyw4MTkuMjk0OSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iOTM0LjUiIHgyPSI5MzQuNSIgeTE9IjM5My40Nzc1IiB5Mj0iNDI1LjE4OCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iOTMwLjUsNDE1LjE4OCw5MzQuNSw0MjUuMTg4LDkzOC41LDQxNS4xODgsOTM0LjUsNDE5LjE4OCIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iOTM0LjUiIHgyPSI5MzQuNSIgeTE9IjQ1OS4xNTY3IiB5Mj0iODI1LjI5NDkiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjkzMC41LDgxNS4yOTQ5LDkzNC41LDgyNS4yOTQ5LDkzOC41LDgxNS4yOTQ5LDkzNC41LDgxOS4yOTQ5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyMTYuNSIgeDI9IjM1NCIgeTE9IjM4MS40Nzc1IiB5Mj0iMzgxLjQ3NzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjM0NCwzNzcuNDc3NSwzNTQsMzgxLjQ3NzUsMzQ0LDM4NS40Nzc1LDM0OCwzODEuNDc3NSIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTA1IiB4Mj0iNjI0IiB5MT0iMzgxLjQ3NzUiIHkyPSIzODEuNDc3NSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNjE0LDM3Ny40Nzc1LDYyNCwzODEuNDc3NSw2MTQsMzg1LjQ3NzUsNjE4LDM4MS40Nzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI4MDIiIHgyPSI4NDguNSIgeTE9IjM4MS40Nzc1IiB5Mj0iMzgxLjQ3NzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjgzOC41LDM3Ny40Nzc1LDg0OC41LDM4MS40Nzc1LDgzOC41LDM4NS40Nzc1LDg0Mi41LDM4MS40Nzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI1NzMuNzUiIHgyPSI1NzMuNzUiIHkxPSIzNDkuNDc3NSIgeTI9IjM1NC40Nzc1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTczLjc1IiB4Mj0iMTQxLjUiIHkxPSIzNTQuNDc3NSIgeTI9IjM1NC40Nzc1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTQxLjUiIHgyPSIxNDEuNSIgeTE9IjM1NC40Nzc1IiB5Mj0iMzY5LjQ3NzUiLz48cG9seWdvbiBmaWxsPSIjMTgxODE4IiBwb2ludHM9IjEzNy41LDM1OS40Nzc1LDE0MS41LDM2OS40Nzc1LDE0NS41LDM1OS40Nzc1LDE0MS41LDM2My40Nzc1IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxMDIwLjUiIHgyPSIxMDY3LjUiIHkxPSIzODEuNDc3NSIgeTI9IjM4MS40Nzc1Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iMTA2Ny41IiB4Mj0iMTA2Ny41IiB5MT0iMzgxLjQ3NzUiIHkyPSI4MjUuMjk0OSIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iMTA2My41LDgxNS4yOTQ5LDEwNjcuNSw4MjUuMjk0OSwxMDcxLjUsODE1LjI5NDksMTA2Ny41LDgxOS4yOTQ5IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxNDEuNSIgeDI9IjEwNjcuNSIgeTE9IjgyNS4yOTQ5IiB5Mj0iODI1LjI5NDkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI1NzMuNzUiIHgyPSI1NzMuNzUiIHkxPSI3NCIgeTI9IjExMC44MDQ3Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI1NjkuNzUsMTAwLjgwNDcsNTczLjc1LDExMC44MDQ3LDU3Ny43NSwxMDAuODA0Nyw1NzMuNzUsMTA0LjgwNDciIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjU3My43NSIgeDI9IjU3My43NSIgeTE9IjgyNS4yOTQ5IiB5Mj0iODM1LjI5NDkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSI1NzMuNzUiIHgyPSIxMDg1LjUiIHkxPSI4MzUuMjk0OSIgeTI9IjgzNS4yOTQ5Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIxMDgxLjUsNDcxLjI1NDQsMTA4NS41LDQ2MS4yNTQ0LDEwODkuNSw0NzEuMjU0NCwxMDg1LjUsNDY3LjI1NDQiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjEwODUuNSIgeDI9IjEwODUuNSIgeTE9IjYyIiB5Mj0iODM1LjI5NDkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIxMDg1LjUiIHgyPSI1OTcuNzUiIHkxPSI2MiIgeTI9IjYyIi8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSI2MDcuNzUsNTgsNTk3Ljc1LDYyLDYwNy43NSw2Niw2MDMuNzUsNjIiIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjU0OS43NSIgeDI9IjI0IiB5MT0iNjIiIHkyPSI2MiIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzE4MTgxODtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjI0IiB4Mj0iMjQiIHkxPSI2MiIgeTI9Ijk4Ii8+PHBvbHlnb24gZmlsbD0iIzE4MTgxOCIgcG9pbnRzPSIyMCw4OCwyNCw5OCwyOCw4OCwyNCw5MiIgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojMTgxODE4O3N0cm9rZS13aWR0aDoxLjA7IiB4MT0iNTczLjc1IiB4Mj0iNTczLjc1IiB5MT0iMzAiIHkyPSI1MCIvPjxwb2x5Z29uIGZpbGw9IiMxODE4MTgiIHBvaW50cz0iNTY5Ljc1LDQwLDU3My43NSw1MCw1NzcuNzUsNDAsNTczLjc1LDQ0IiBzdHlsZT0ic3Ryb2tlOiMxODE4MTg7c3Ryb2tlLXdpZHRoOjEuMDsiLz48IS0tTUQ1PVswMGU0MjE2MWNmMDFhMTE1MDIwMDcxYjE0YTk1NDM5ZF0KQHN0YXJ0dW1sDQpzdGFydA0Kd2hpbGUgKHRydWUpDQogIC0+IHJ0bXAgc2VydmVyIOaOpeaUtuWIsOaOqOa1gea2iOaBrzsNCiAgOlNyc1J0bXBTZXJ2ZXI6OnJlY3ZfbWVzc2FnZSgpOw0KICA6U3JzUHVibGlzaFJlY3ZUaHJlYWQ6OmNvbnN1bWUoKTsNCiAgLT4g5aSE55CG5raI5oGvOw0KICA6U3JzUnRtcENvbm46OmhhbmRsZV9wdWJsaXNoX21lc3NhZ2UoKTsNCiAgLT4g5aSE55CG5YyF5ZCr6Z+z6KeG6aKR44CB5YWD5pWw5o2u55qE5raI5oGvOw0KICA6U3JzUnRtcENvbm46OnByb2Nlc3NfcHVibGlzaF9tZXNzYWdlKCk7DQogIGlmIChtc2ctPmhlYWRlciBpcyBhdWRpbykgdGhlbiAoeWVzKQ0KICAgIC0+IOWkhOeQhumfs+mikea2iOaBrzsNCiAgICA6U3JzU291cmNlOjpvbl9hdWRpbygpOw0KICAgIDpTcnNTb3VyY2U6Om9uX2F1ZGlvX2ltcCgpOw0KICAgIC0+IOWkhOeQhumfs+mikTsNCiAgICA6U3JzT3JpZ2luSHViOjpvbl9hdWRpbygpOw0KICAgIC0+IOWIneWni+WMlumfs+mikee8lueggeWZqCBhYWMvbXAzOw0KICAgIDpTcnNGb3JtYXQ6Om9uX2F1ZGlvKCk7DQogICAgOlNyc0hsczo6b25fYXVkaW87DQogICAgLT4g6K6+572u6YeH5qC3546H77yM5bm25bCG6Z+z6aKR5pWw5o2u5YaZ5YWl5paH5Lu2Ow0KICAgIDpTcnNIbHNDb250cm9sbGVyOjp3cml0ZV9hdWRpbzsNCiAgZWxzZWlmIChtc2ctPmhlYWRlciBpcyB2aWRlbykgdGhlbiAoeWVzKQ0KICAgIC0+IOWkhOeQhuinhumikea2iOaBrzsNCiAgICA6U3JzU291cmNlOjpvbl92aWRlbygpOw0KICAgIDpTcnNTb3VyY2U6Om9uX3ZpZGVvX2ltcCgpOw0KICAgIC0+IOWkhOeQhuinhumikTsNCiAgICA6U3JzT3JpZ2luSHViOjpvbl92aWRlbygpOw0KICAgIC0+IOWIneWni+WMluinhumikee8lueggeWZqCBBVkM7DQogICAgOlNyc0Zvcm1hdDo6b25fdmlkZW8oKTsNCiAgICA6U3JzSGxzOjpvbl92aWRlbzsNCiAgICAtPiDorr7nva5EVFPvvIzlubblsIbop4bpopHmlbDmja7lhpnlhaXmlofku7Y7DQogICAgOlNyc0hsc0NvbnRyb2xsZXI6OndyaXRlX3ZpZGVvOw0KICBlbHNlaWYgKG1zZy0+aGVhZGVyIGlzIGFnZ3JlZ2F0ZSkgdGhlbiAoeWVzKQ0KICAgIC0+IOWkhOeQhuiBmuWQiOWMhea2iOaBrzsNCiAgICA6U3JzU291cmNlOjpvbl9hZ2dyZWdhdGUoKTsNCiAgZWxzZWlmIChtc2ctPmhlYWRlciBpcyBhbWZfZGF0YSkgdGhlbiAoeWVzKQ0KICAgIC0+IOWkhOeQhuWFg+aVsOaNrua2iOaBrzsNCiAgICA6U3JzUnRtcFNlcnZlcjo6ZGVjb2RlX21lc3NhZ2UoKTsNCiAgZWxzZSAobm8pDQogIGVuZGlmDQplbmR3aGlsZQ0KZW5kDQpAZW5kdW1sDQoKUGxhbnRVTUwgdmVyc2lvbiAxLjIwMjIuNGJldGEyKFVua25vd24gY29tcGlsZSB0aW1lKQooR1BMIHNvdXJjZSBkaXN0cmlidXRpb24pCkphdmEgUnVudGltZTogSmF2YShUTSkgU0UgUnVudGltZSBFbnZpcm9ubWVudApKVk06IEphdmEgSG90U3BvdChUTSkgNjQtQml0IFNlcnZlciBWTQpEZWZhdWx0IEVuY29kaW5nOiBVVEYtOApMYW5ndWFnZTogZW4KQ291bnRyeTogVVMKLS0+PC9nPjwvc3ZnPg=='>]]></content>
      
      
      <categories>
          
          <category> 音视频 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> srs </tag>
            
            <tag> hls </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动态规划--完全平方数</title>
      <link href="algorithm/num-squares-39caa79f7778/"/>
      <url>algorithm/num-squares-39caa79f7778/</url>
      
        <content type="html"><![CDATA[<p>每天一道算法题解</p><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>给定正整数 <code>n</code>，找到若干个完全平方数（比如 <code>1, 4, 9, 16, ...</code>）使得它们的和等于 <code>n</code>。你需要让组成和的完全平方数的个数最少。<br>给你一个整数 <code>n</code> ，返回和为 <code>n</code> 的完全平方数的<strong>最少数量</strong>。<br><strong>完全平方数</strong> 是一个整数，其值等于另一个整数的平方；换句话说，其值等于一个整数自乘的积。例如，<code>1、4、9</code> 和 <code>16</code> 都是完全平方数，而 <code>3</code> 和 <code>11</code> 不是。</p><p>示例 1：</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">输入：n &#x3D; 12输出：3 解释：12 &#x3D; 4 + 4 + 4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>示例 2：</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">输入：n &#x3D; 13输出：2解释：13 &#x3D; 4 + 9<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>提示：1 &lt;= n &lt;= 104</p><p>来源：力扣（LeetCode）<br>链接：<a href="https://leetcode-cn.com/problems/perfect-squares">https://leetcode-cn.com/problems/perfect-squares</a><br>著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p><h2 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h2><p>由于题目让求<strong>最值</strong>，是可以使用动态规划来解决。完全平方数是整数的平方，所以从小到大可以用 <code>i*i （i=1，2，3...）</code> 表示 因为 <code>n</code> 是多个完全平方数的和，所以最大完全平方数一定不大于 <code>n</code>, 因此有 <code>i*i&lt;=n</code>，根据这个关系可以得到一个有限的完全平方数的序列，用序列中的数拼凑 <code>n</code>。  </p><p>既然是动态规划，我们按照3步走，找到题目问题的子问题，并得到状态转移方程，以及确定边界</p><ol><li>确定子问题</li></ol><p>因为题目要求和为 <code>n</code> 的完全平方数的<strong>最少数量</strong>，我们可以定义 <code>dp[i]</code> 表示 可以拼凑成 <code>i</code> 的完全平方数的最少个数</p><ol start="2"><li>确定状态转移方程</li></ol><p>假设 <code>n = 12</code>, 可以得到可用完全平方数的序列为 <code>[1, 4, 9]</code>, 即拼成<code>12</code>的最后一个完全平方数可以是三者其一，因此，有三种可能可以拼凑成<code>12</code>，他们完全平方数的个数分别是<code>dp[12-1]+1</code>、<code>dp[12-4]+1</code>和<code>dp[12-9]+1</code>, 要求最少的个数，就要对三者取<code>min</code>，即<code>dp[12] = min(dp[12-1]+1, dp[12-4]+1, dp[12-9]+1)</code><br>那么，对于 <code>dp[11]</code> ，同样可以得到可用序列为 <code>[1, 4, 9]</code>, 根据上面的推论，可以得到 <code>dp[11] = min(dp[11-1]+1, dp[11-4]+1, dp[11-9]+1)</code><br>以此类推<br>我们可以得到 状态转移方程 <code>dp[i]= min(dp[i-k]+1)， k∈square numbers</code></p><ol start="3"><li>确定边界</li></ol><p>对于<code>n=0</code>，不需要平方数，即<code>dp[0]=0</code>，因为要求最小值，所以，<code>dp[i]</code> 均大于 <code>n</code></p><h2 id="算法实现"><a href="#算法实现" class="headerlink" title="算法实现"></a>算法实现</h2><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">numSquares</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 确定最大平方数索引</span>  maxSquareIndex <span class="token operator">:=</span> <span class="token function">int</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">Sqrt</span><span class="token punctuation">(</span><span class="token function">float64</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>  squares <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> maxSquareIndex<span class="token punctuation">)</span>  <span class="token comment">// 列出所有可用的平方数</span>  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> maxSquareIndex<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>    squares<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">*</span> i  <span class="token punctuation">&#125;</span>  <span class="token comment">// 创建动态数组</span>  dp <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>  dp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>    dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> n <span class="token comment">// 数组初始值设为 n，只要比 n 大都行</span>    <span class="token keyword">for</span> j <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> maxSquareIndex<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> i <span class="token operator">&lt;</span> squares<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 平方数大于 i 则不可能拼凑 i</span>        <span class="token keyword">break</span>      <span class="token punctuation">&#125;</span>      <span class="token comment">// 求最小数量</span>      dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> dp<span class="token punctuation">[</span>i<span class="token operator">-</span>squares<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> dp<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token keyword">func</span> <span class="token function">min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> a <span class="token operator">&lt;</span> b <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> b<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面解法，平方数序列除了最后几次能用到全部，前几次都直接<code>break</code>了，所以可以将这部分放在计算时进行，优化如下</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">numSquares</span><span class="token punctuation">(</span>n <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">&#123;</span>    dp <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> n<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>    dp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span>        dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token comment">// 数组初始化为最坏情况，即平方数全为 1 的情况</span>        <span class="token keyword">for</span> j <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> j<span class="token operator">*</span>j <span class="token operator">&lt;=</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 计算时比较平方数是否超出i</span>            dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> dp<span class="token punctuation">[</span>i<span class="token operator">-</span>j<span class="token operator">*</span>j<span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> dp<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="数学定理"><a href="#数学定理" class="headerlink" title="数学定理"></a>数学定理</h2><p>四平方和定理： 每个自然数都可以表示为四个整数平方和</p><p>$$p=a0{^2}+a1{^2}+a2{^2}+a3{^2}$$</p><p>其中 $a0$,$a1$,$a2$,$a3$ 均为整数</p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> dynamic programming </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cgo 的魔法</title>
      <link href="language/go/cgo-c53862e8fd29/"/>
      <url>language/go/cgo-c53862e8fd29/</url>
      
        <content type="html"><![CDATA[<h2 id="cgo-访问-c-标准库"><a href="#cgo-访问-c-标准库" class="headerlink" title="cgo 访问 c 标准库"></a>cgo 访问 c 标准库</h2><p>当我们需要用 go 调用 c 语言写的接口时，就需要用 <code>cgo</code> 进行连接，<code>cgo</code> 属于 go 语言的一个特殊工具，直接通过一个例子来看</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token comment">/*         #include &lt;stdio.h>#include &lt;stdlib.h>*/</span><span class="token keyword">import</span> <span class="token string">"C"</span>     <span class="token comment">// 上面注释部分是导入 c 的标准库头文件， 必须用注释包裹在内且在 import "C" 上面一行，</span><span class="token comment">// go编译器读到上面的注释时，会自行跳转至 gcc 编译, 所以注释中不能出现除 c 语言以外的语法</span><span class="token comment">// "C" 并不是 go 的基础包，相当于一个虚拟包，import 相当于一个启用开关，该句表示该程序已经启用 cgo 的特性，并且只能单独一行，不能和其他包一块导入</span><span class="token keyword">import</span> <span class="token string">"unsafe"</span>    <span class="token comment">// unsafe 包如其名，并不安全，该包常用于 c 和 go 之间的指针转换和地址运算         </span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// CString() 是 go 内部的接口，可以转换 go 的字符串为 c 语言字符串格式 char*</span>  cs <span class="token operator">:=</span> C<span class="token punctuation">.</span><span class="token function">CString</span><span class="token punctuation">(</span><span class="token string">"Hello, World\n"</span><span class="token punctuation">)</span>  <span class="token comment">// 因为 CString 使用 c 的 malloc 申请空间，go GC 不会清理，用完后需要手动 free</span>  <span class="token comment">// unsafe.Pointer 相当于 c 的 void*，这里做了强制转换</span>  <span class="token keyword">defer</span> C<span class="token punctuation">.</span><span class="token function">free</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>cs<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 调用c接口方式为 C.api(), </span>  C<span class="token punctuation">.</span><span class="token function">puts</span><span class="token punctuation">(</span>cs<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>想要看具体的实现，可以通过命令行 <code>go tool cgo [filename.go]</code> 查看编译过程中间生成的文件，看到具体的类型转换，更多 <code>cgo</code> 命令用法见<a href="https://golang.org/cmd/cgo/#hdr-Using_cgo_directly">官方cgo</a></p><h2 id="cgo-类型转换"><a href="#cgo-类型转换" class="headerlink" title="cgo 类型转换"></a>cgo 类型转换</h2><p>go 传给 c 的参数都必须使用 <code>C.cType</code> 转换成 c 的类型，这里着重谈一下 <code>string</code> 的转换，更多类型转换请阅读 <a href="https://chai2010.cn/advanced-go-programming-book/ch2-cgo/ch2-03-cgo-types.html">Go语言高级编程</a></p><p>因为 c 并没有 <code>string</code> 类型，只有 <code>char[]</code>, 所以 go 内置了 <code>string</code> 的转换函数，如下所示，可以根据需要自行选择</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// Go string to C string</span><span class="token comment">// The C string is allocated in the C heap using malloc.</span><span class="token comment">// It is the caller's responsibility to arrange for it to be</span><span class="token comment">// freed, such as by calling C.free (be sure to include stdlib.h</span><span class="token comment">// if C.free is needed).</span><span class="token keyword">func</span> C<span class="token punctuation">.</span><span class="token function">CString</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>C<span class="token punctuation">.</span>char<span class="token comment">// Go []byte slice to C array</span><span class="token comment">// The C array is allocated in the C heap using malloc.</span><span class="token comment">// It is the caller's responsibility to arrange for it to be</span><span class="token comment">// freed, such as by calling C.free (be sure to include stdlib.h</span><span class="token comment">// if C.free is needed).</span><span class="token keyword">func</span> C<span class="token punctuation">.</span><span class="token function">CBytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> unsafe<span class="token punctuation">.</span>Pointer<span class="token comment">// C string to Go string</span><span class="token keyword">func</span> C<span class="token punctuation">.</span><span class="token function">GoString</span><span class="token punctuation">(</span><span class="token operator">*</span>C<span class="token punctuation">.</span>char<span class="token punctuation">)</span> <span class="token builtin">string</span><span class="token comment">// C data with explicit length to Go string</span><span class="token keyword">func</span> C<span class="token punctuation">.</span><span class="token function">GoStringN</span><span class="token punctuation">(</span><span class="token operator">*</span>C<span class="token punctuation">.</span>char<span class="token punctuation">,</span> C<span class="token punctuation">.</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">string</span><span class="token comment">// C data with explicit length to Go []byte</span><span class="token keyword">func</span> C<span class="token punctuation">.</span><span class="token function">GoBytes</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span>Pointer<span class="token punctuation">,</span> C<span class="token punctuation">.</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上述的函数，均是通过拷贝的方式进行数据转换，将 go <code>string</code>转为 c <code>char*</code>时，使用 <code>malloc</code> 申请内存空间并拷贝数据到对应的地址，通过手动调用 <code>free</code> 释放内存；将 c <code>char*</code> 转换为 <code>string</code> 时，go 自行申请内存空间，并将 c 的数据拷贝出来，内存交由 <code>GC</code> 处理。通过拷贝 可以使 go 的内存和 c 的内存互不干扰，简化了内存管理和接口调用，但是内存申请和拷贝也增加了性能的损耗。  </p><p>除了上述字符串、字节数组以外的类型转换，都是 c 和 go 共用地址，取决于内存是谁申请的，如下面代码所示：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">package</span> main<span class="token comment">/*int arr[10];void add(int *a, int n) &#123;  for (int i = 0; i&lt; n; i++) &#123;    printf("%d ",a[i]);    a[i]++;  &#125;&#125;*/</span><span class="token keyword">import</span> <span class="token string">"C"</span><span class="token keyword">import</span> <span class="token punctuation">(</span>  <span class="token string">"fmt"</span>  <span class="token string">"unsafe"</span><span class="token punctuation">)</span><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  arr1 <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token builtin">int32</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>C<span class="token punctuation">.</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token comment">// 将 C.arr 转换成[10]int32 数组，然后从数组中截取长度和容量均为10切片，</span>  arr1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">123</span>           <span class="token comment">// 修改会直接修改 c 的内存</span>  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%+v %[1]T %v\n"</span><span class="token punctuation">,</span> arr1<span class="token punctuation">,</span> C<span class="token punctuation">.</span>arr<span class="token punctuation">)</span> <span class="token comment">// [0 123 0 0 0 0 0 0 0 0]   []int32 [0 123 0 0 0 0 0 0 0 0]</span>  C<span class="token punctuation">.</span>arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> C<span class="token punctuation">.</span><span class="token function">int</span><span class="token punctuation">(</span><span class="token number">456</span><span class="token punctuation">)</span>  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%+v %[1]T %v\n"</span><span class="token punctuation">,</span> arr1<span class="token punctuation">,</span> C<span class="token punctuation">.</span>arr<span class="token punctuation">)</span> <span class="token comment">// [0 123 456 0 0 0 0 0 0 0] []int32 [0 123 456 0 0 0 0 0 0 0]</span>  arr1 <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// 这里 arr1 切片已经扩容，重新分配内存，脱离了 C.arr</span>  arr1<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>  C<span class="token punctuation">.</span>arr<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> C<span class="token punctuation">.</span><span class="token function">int</span><span class="token punctuation">(</span><span class="token number">789</span><span class="token punctuation">)</span>  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%+v %v len(arr1):%d cap(arr1):%d\n"</span><span class="token punctuation">,</span> arr1<span class="token punctuation">,</span> C<span class="token punctuation">.</span>arr<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [0 123 456 1 0 0 0 0 0 0 1] [0 123 456 789 0 0 0 0 0 0] len(arr1):11 cap(arr1):20</span>  a <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int32</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>  C<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>C<span class="token punctuation">.</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> C<span class="token punctuation">.</span><span class="token function">int</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token comment">// [2 3 4]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以需要额外注意, go 传给 c 的参数若是像 <code>slice</code>、<code>map</code> 等内存可能发生改变的类型，尽可能不要发生扩容现象，或者申请内存时，直接用 <code>C.malloc()</code> 申请固定大小 c 的地址，确保内存不会发生改变,</p><h2 id="unsafe-Pointer"><a href="#unsafe-Pointer" class="headerlink" title="unsafe.Pointer"></a>unsafe.Pointer</h2><p><code>unsafe</code> 包是 go 提供的针对类型安全操作，具体接口查看<a href="https://pkg.go.dev/unsafe">官网doc</a>，这里主要谈一下 <code>unsafe.Pointer</code> 类型</p><p>在使用 cgo 过程中不可避免要传递指针参数，因为 go 的指针类型不能像 c 的指针类型可以隐式转换，go 需要用到类似于 <code>void*</code> 的 <code>unsafe.Pointer</code> 类型强制转换成 c 可以用的指针，而且可以转换任意类型的指针，而且可以绕过类型检测读写内存，所以，使用时需要格外小心。 <code>Pointer</code> 有如下四种特殊操作：</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">-</span> 任何类型的指针值都可以转换为 Pointer。 <span class="token list punctuation">-</span> Pointer 可以转换为任何类型的指针值。 <span class="token list punctuation">-</span> uintptr 可以转换为指针。 <span class="token list punctuation">-</span> 指针可以转换为 uintptr。 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Pointer转换实例"><a href="#Pointer转换实例" class="headerlink" title="Pointer转换实例"></a>Pointer转换实例</h3><blockquote><p>下面内容翻译自 go <a href="https://pkg.go.dev/unsafe">unsafe</a></p></blockquote><p>以下涉及 <code>Pointer</code> 的模式是有效的。不使用这些模式的代码今天可能无效，或者将来可能无效。甚至下面的有效模式也带有重要的警告。</p><p>运行 <code>go vet</code> 可以帮助查找不符合这些模式的 <code>Pointer</code> 用法，但是运行 <code>go vet</code> 没警告不能保证这些代码是有效。</p><h4 id="1-将-T1-转换为指向-T2-的指针"><a href="#1-将-T1-转换为指向-T2-的指针" class="headerlink" title="1. 将 *T1 转换为指向 *T2 的指针"></a>1. 将 <code>*T1</code> 转换为指向 <code>*T2</code> 的指针</h4><p>假设T2不大于T1，并且两个共享相同的内存布局，则此转换允许将一种类型的数据重新解释为另一种类型的数据。一个示例是<code>math.Float64bits</code>的实现：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">Float64bits</span><span class="token punctuation">(</span>f <span class="token builtin">float64</span><span class="token punctuation">)</span> <span class="token builtin">uint64</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">uint64</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="2-将Pointer转换为uintptr（但不转换回Pointer）"><a href="#2-将Pointer转换为uintptr（但不转换回Pointer）" class="headerlink" title="2. 将Pointer转换为uintptr（但不转换回Pointer）"></a>2. 将<code>Pointer</code>转换为<code>uintptr</code>（但不转换回<code>Pointer</code>）</h4><p>将 <code>Pointer</code> 转换为 <code>uintptr</code> 会生成所指向的值的内存地址（整数）。这种 <code>uintptr</code> 的通常用法是打印它。通常，将 <code>uintptr</code> 转换回 <code>Pointer</code> 是无效的。<br><code>uintptr</code>是整数，而不是引用。 将 <code>Pointer</code> 转换为 <code>uintptr</code> 会创建一个没有指针语义的整数值。 即使<code>uintptr</code>保留了某个对象的地址，垃圾回收器也不会在对象移动时更新该<code>uintptr</code>的值，该<code>uintptr</code>也不会使该对象被回收。</p><p>其余的模式枚举了从<code>uintptr</code>到<code>Pointer</code>的唯一有效转换。</p><h4 id="3-用算术将Pointer转换为uintptr并返回"><a href="#3-用算术将Pointer转换为uintptr并返回" class="headerlink" title="3. 用算术将Pointer转换为uintptr并返回"></a>3. 用算术将<code>Pointer</code>转换为<code>uintptr</code>并返回</h4><p>如果p指向已分配的对象，则可以通过转换为 <code>uintptr</code>，添加偏移量并将其转换回 <code>Pointer</code> 的方式将其推进对象。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">p <span class="token operator">=</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token function">uintptr</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">+</span> offset<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>此模式最常见的用法是访问数组的结构或元素中的字段：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// equivalent to f := unsafe.Pointer(&amp;s.f)</span>f <span class="token operator">:=</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> unsafe<span class="token punctuation">.</span><span class="token function">Offsetof</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// equivalent to e := unsafe.Pointer(&amp;x[i])</span>e <span class="token operator">:=</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token operator">*</span>unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以这种方式从指针添加和减去偏移量都是有效的。通常使用 <code>＆^</code> 舍入指针（通常用于对齐）也是有效的。在所有情况下，结果都必须继续指向原始分配的对象。<br>与C语言不同，将指针移到其原始分配的末尾是无效的：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// INVALID: end points outside allocated space.</span><span class="token keyword">var</span> s thingend <span class="token operator">=</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> unsafe<span class="token punctuation">.</span><span class="token function">Sizeof</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// INVALID: end points outside allocated space.</span>b <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>end <span class="token operator">=</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注意</strong>：<code>uintptr</code> 和 <code>Pointer</code> 两个转换必须出现在相同的表达式中，并且它们之间只有中间的算术运算：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// INVALID: uintptr cannot be stored in variable</span><span class="token comment">// before conversion back to Pointer.</span>u <span class="token operator">:=</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>p <span class="token operator">=</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>u <span class="token operator">+</span> offset<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注意</strong>：待转换的指针必须指向已分配的对象，不能为nil。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// INVALID: conversion of nil pointer</span>u <span class="token operator">:=</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span>p <span class="token operator">:=</span> unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token function">uintptr</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span> <span class="token operator">+</span> offset<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="4-调用-syscall-Syscall-时将指针转换为-uintptr"><a href="#4-调用-syscall-Syscall-时将指针转换为-uintptr" class="headerlink" title="4. 调用 syscall.Syscall 时将指针转换为 uintptr"></a>4. 调用 <code>syscall.Syscall</code> 时将指针转换为 <code>uintptr</code></h4><p><code>syscall</code> 包中的 <code>Syscall</code> 函数将其 <code>uintptr</code> 参数直接传递给操作系统，然后，操作系统可以根据调用的详细信息将其中一些参数重新解释为指针。 也就是说，系统调用实现正在将某些参数从 <code>uintptr</code> 隐式转换回指针。<br>如果必须将指针参数转换为 <code>uintptr</code> 用作参数，则该转换必须出现在调用表达式本身中：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">syscall<span class="token punctuation">.</span><span class="token function">Syscall</span><span class="token punctuation">(</span>SYS_READ<span class="token punctuation">,</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编译器通过安排保留引用的分配对象（如果有的话），直到调用完成（即使从类型本身而言）也不会移动，来处理在汇编中实现的函数的调用的参数列表中转换为<code>uintptr</code>的 <code>Pointer</code>。 似乎在调用过程中不再需要该对象。<br>为了使编译器能够识别这种模式，转换必须出现在参数列表中：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// INVALID: uintptr cannot be stored in variable</span><span class="token comment">// before implicit conversion back to Pointer during system call.</span>u <span class="token operator">:=</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>syscall<span class="token punctuation">.</span><span class="token function">Syscall</span><span class="token punctuation">(</span>SYS_READ<span class="token punctuation">,</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">,</span> u<span class="token punctuation">,</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-将-reflect-Value-Pointer-或-reflect-Value-UnsafeAddr-的结果从-uintptr-转换为-Pointer"><a href="#5-将-reflect-Value-Pointer-或-reflect-Value-UnsafeAddr-的结果从-uintptr-转换为-Pointer" class="headerlink" title="5. 将 reflect.Value.Pointer 或 reflect.Value.UnsafeAddr 的结果从 uintptr 转换为 Pointer"></a>5. 将 <code>reflect.Value.Pointer</code> 或 <code>reflect.Value.UnsafeAddr</code> 的结果从 <code>uintptr</code> 转换为 <code>Pointer</code></h4><p>包反射的名为 <code>Pointer</code> 和 <code>UnsafeAddr</code> 的 <code>Value</code> 方法返回类型 <code>uintptr</code> 而不是 <code>unsafe.Pointer</code>，以防止调用者在不首先导入 <code>&quot;unsafe&quot;</code> 的情况下将结果更改为任意类型。 但是，这意味着结果很脆弱，必须在调用后立即使用相同的表达式将其转换为Pointer：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">p <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>与上述情况一样，在转换之前存储结果是无效的：</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// INVALID: uintptr cannot be stored in variable</span><span class="token comment">// before conversion back to Pointer.</span>u <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>p <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6-将一个-reflect-SliceHeader-或-reflect-StringHeader-数据字段与指针进行转换"><a href="#6-将一个-reflect-SliceHeader-或-reflect-StringHeader-数据字段与指针进行转换" class="headerlink" title="6. 将一个 reflect.SliceHeader 或 reflect.StringHeader 数据字段与指针进行转换"></a>6. 将一个 <code>reflect.SliceHeader</code> 或 <code>reflect.StringHeader</code> 数据字段与指针进行转换</h4><p>与前面的情况一样，反射数据结构 <code>SliceHeader</code> 和 <code>StringHeader</code> 将字段 <code>Data</code> 声明为 <code>uintptr</code>，以防止调用者在不首先导入 <code>&quot;unsafe&quot;</code> 的情况下将结果更改为任意类型。 但是，这意味着 <code>SliceHeader</code> 和 <code>StringHeader</code> 仅在解释实际切片或字符串值的内容时才有效。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> s <span class="token builtin">string</span>hdr <span class="token operator">:=</span> <span class="token punctuation">(</span><span class="token operator">*</span>reflect<span class="token punctuation">.</span>StringHeader<span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// case 1</span>hdr<span class="token punctuation">.</span>Data <span class="token operator">=</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token comment">// case 6 (this case)</span>hdr<span class="token punctuation">.</span>Len <span class="token operator">=</span> n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>在这种用法中，<code>hdr.Data</code> 实际上是在字符串标题中引用基础指针的另一种方法，而不是 <code>uintptr</code> 变量本身。<br>通常，<code>reflect.SliceHeader</code> 和 <code>reflect.StringHeader</code> 只能用作指向实际切片或字符串的 <code>*reflect.SliceHeader</code> 和 <code>*reflect.StringHeader</code>，而不能用作纯结构。 程序不应声明或分配这些结构类型的变量。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// INVALID: a directly-declared header will not hold Data as a reference.</span><span class="token keyword">var</span> hdr reflect<span class="token punctuation">.</span>StringHeaderhdr<span class="token punctuation">.</span>Data <span class="token operator">=</span> <span class="token function">uintptr</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span>hdr<span class="token punctuation">.</span>Len <span class="token operator">=</span> ns <span class="token operator">:=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">(</span>unsafe<span class="token punctuation">.</span><span class="token function">Pointer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hdr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// p possibly already lost</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cgo </tag>
            
            <tag> unsafe </tag>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>对 golang map 的认识</title>
      <link href="language/go/go-map-7470048e7d3c/"/>
      <url>language/go/go-map-7470048e7d3c/</url>
      
        <content type="html"><![CDATA[<p>谈一谈对 golang map 的认识，map 是属于哈希结构数据类型，用于存储键值对，键值唯一，存储没有先后顺序。和切片类似，都是引用传值。</p><h2 id="初始化及基本操作"><a href="#初始化及基本操作" class="headerlink" title="初始化及基本操作"></a>初始化及基本操作</h2><p>map 一般情况下用 <code>make</code> 函数初始化, 也可以使用字面量直接初始化一些初值</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">m <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span>m<span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">// 若 'a' 不存在，新建键值对，若存在，则修改</span>fate <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span>    <span class="token string">"fsn"</span><span class="token punctuation">:</span> <span class="token string">"fate stay night"</span><span class="token punctuation">,</span>    <span class="token string">"fz"</span><span class="token punctuation">:</span> <span class="token string">"fate zero"</span><span class="token punctuation">,</span>    <span class="token string">"fgo"</span><span class="token punctuation">:</span> <span class="token string">"fate grand order"</span><span class="token punctuation">,</span>  <span class="token comment">// 每行结尾需要逗号，若与花括号写在同一行，则最后一个元素不需要</span><span class="token punctuation">&#125;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>fate<span class="token punctuation">[</span><span class="token string">"fsn"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// 通过 key 访问 value， 元素不存在返回类型的零值</span><span class="token function">delete</span><span class="token punctuation">(</span>fate<span class="token punctuation">,</span> <span class="token string">"fgo"</span><span class="token punctuation">)</span>      <span class="token comment">// 使用 delete 函数删除键值对，无论元素是否存在都会执行，且没有返回值</span><span class="token keyword">if</span> val<span class="token punctuation">,</span> ok <span class="token operator">:=</span> fate<span class="token punctuation">[</span><span class="token string">"fsn-ubw"</span><span class="token punctuation">]</span><span class="token punctuation">;</span> ok <span class="token punctuation">&#123;</span>    <span class="token comment">// 可以使用第二返回值 ok 检测键值对是否存在</span>    <span class="token comment">// 并且返回的 val 不能进行取地址操作，当 map 扩容后，该键值的地址会发生改变，</span>    <span class="token comment">// fmt.Println(&amp;val) // 编译不会通过</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> fate <span class="token punctuation">&#123;</span>    <span class="token comment">// 使用 range 对键值对进行遍历，每次返回的顺序是随机的，是因为要考虑到 map 扩容带来的内存变动，故意设定每次随机返回</span>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全"></a>线程安全</h2><p>map 在单个 <code>goroutine</code> 内是安全的，因为存取都是顺序操作。<br>当有多个 <code>goroutine</code> 同时对 map 进行读写操作时，会发生 <code>panic</code>，因为 map 内部有写状态检测标志 <code>flag</code>，当 <code>flag==1</code> 时，表示正在写操作，此时再有 <code>goroutine</code> 的写操作进来，就会直接抛出异常。  </p><p>解决方法也非常简单，一种方法是将 map 放在结构体中，并添加锁 <code>sync.RWMutex</code>，当然这会减缓服务器的速度，所以为了效率，尽量确保多个 <code>goroutine</code> 对 map 都是读操作。</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span>    sync<span class="token punctuation">.</span>RWMutex    m <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>m<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// 读取操作</span>counter<span class="token punctuation">.</span><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>n <span class="token operator">:=</span> counter<span class="token punctuation">.</span>m<span class="token punctuation">[</span><span class="token string">"some_key"</span><span class="token punctuation">]</span>counter<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"some_key:"</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token comment">// 写操作</span>counter<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>counter<span class="token punctuation">.</span>m<span class="token punctuation">[</span><span class="token string">"some_key"</span><span class="token punctuation">]</span><span class="token operator">++</span>counter<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>另一种方法是使用 golang 官方的 <code>sync</code> 包中的 <a href="https://golang.org/pkg/sync/#Map">Map</a>，可以实现安全读写操作。</p><h2 id="底层结构"><a href="#底层结构" class="headerlink" title="底层结构"></a>底层结构</h2><p>关于 map 的底层结构，我没有深入研究，有兴趣可以研读下面的文章：</p><ul><li><a href="https://www.bookstack.cn/read/qcrao-Go-Questions/map-map%20%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E6%98%AF%E4%BB%80%E4%B9%88.md">Go 语言问题集(Go Questions)</a></li><li><a href="https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-hashmap/#332-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">Go 语言设计与实现</a></li></ul><p>这里简单讲一下扩容的过程</p><h3 id="扩容"><a href="#扩容" class="headerlink" title="扩容"></a>扩容</h3><p>map 为了提高哈希查找速率，将键值对数据存储在多个容量只有 8 的桶内，也就是一桶内最多存储8对数据，桶之间通过链表连接。当 map 到达扩容条件时，创建新桶并进行数据迁移。</p><p>了解扩容前，需要知道一个概念，go 定义了一个变量 <code>装载因子</code>，如下所示</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 装载因子  =  元素个数 / 桶的数量</span>loadFactor <span class="token operator">:=</span> count <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">^</span>B<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>扩容有两个条件可以触发：</p><ol><li>装载因子超过 6.5 时</li><li>溢出桶(overflow buckets)过多</li></ol><p>溢出桶简单理解就是已经存满了的桶额外添加的桶，</p><p>针对不同的条件，有不同的扩容策略</p><ul><li>对于条件1，go 会添加新桶，<strong>容量翻倍</strong>，并将旧桶中的数据迁移到新桶中</li><li>对于条件2，go 开辟新的内存区，<strong>容量和之前相等</strong>，并将之前旧桶中的数据全部迁移过去，通过 GC 机制释放之前的内存区，达到整理内存，提高访问效率的目的</li></ul><p>扩容完成后就需要迁移数据，但是迁移并不是一次性完成的，而是在每次进行写操作之后会迁移部分数据，直到旧桶中的数据迁移完成</p>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Map </tag>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go 数组和切片的区别</title>
      <link href="language/go/go-arrvsslice-c249fb4a9bc7/"/>
      <url>language/go/go-arrvsslice-c249fb4a9bc7/</url>
      
        <content type="html"><![CDATA[<p>golang 集合类型包含数组和切片两种，存储相同类型的序列数据</p><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><ul><li>数组：初始化后长度固定不变，不可赋值为其他长度的类型，可以通过索引修改内部元素</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 数组 type: [len]Type</span>arr <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [0] 1 1</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>arr <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span> <span class="token comment">// 编译器根据内容推导类型： [3]int</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>切片：初始化后长度动态可变，可增长可收缩，底层数据是基于数组指针的结构体，</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// 切片 type: []Type</span>sli <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 切片初始化建议使用 make 指定长度，</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>sli<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>sli<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>sli<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [0 0] 2 2</span>sli<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>sli <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>sli<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 切片使用 append 进行追加元素并在容量不足时进行扩容</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>sli<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>sli<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>sli<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1 0 2] 3 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="访问和赋值"><a href="#访问和赋值" class="headerlink" title="访问和赋值"></a>访问和赋值</h2><ul><li>数组和切片：均通过 <code>[n]</code> 获取或修改对应位置元素</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go">arr <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">&#125;</span>arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>arr<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+=</span> arr<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token comment">// 8</span>sli <span class="token operator">:=</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>  <span class="token comment">// 通过 : 符号初始化切片</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%T: %[1]v len: %d cap: %d\n"</span><span class="token punctuation">,</span> sli<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>sli<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>sli<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// []int: [-1 8 4] len: 3 cap: 4</span>sli <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>sli<span class="token punctuation">,</span> sli<span class="token operator">...</span><span class="token punctuation">)</span> <span class="token comment">// 复制并合并切片</span>sli1 <span class="token operator">:=</span> sli<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment">// 截取部分切片</span>sli1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>     <span class="token comment">// 切片修改 sli 底层数据</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>sli<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>sli<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>sli<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// [-1 8 4 -1 0 4] 6 8</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>sli1<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>sli1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>sli1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//      [4 -1 0 4] 4 6</span>sli1 <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>sli1<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ptr: %p %[1]v %d %d\n"</span><span class="token punctuation">,</span> sli1<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>sli1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>sli1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ptr: 0xc000020090 [4 -1 0 4] 4 6</span>sli1 <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>sli1<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">&#125;</span><span class="token operator">...</span><span class="token punctuation">)</span>  <span class="token comment">// 容量不够，进行扩容，内存地址发生变动</span>sli1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment">// 此时修改不会影响 sli</span>fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ptr: %p %[1]v %d %d\n"</span><span class="token punctuation">,</span> sli1<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>sli1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>sli1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ptr: 0xc00007c060 [4 2 0 4 5 6 7] 7 12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><code>fmt</code> 占位符小知识<br><code>%T</code>: 打印变量类型<br><code>%[n]v</code>: 使用 <code>[n]</code> 访问第n个参数，不用重复传入参数<br><code>%p</code>: 打印变量指针</p></blockquote><h3 id="切片结构"><a href="#切片结构" class="headerlink" title="切片结构"></a>切片结构</h3><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token keyword">type</span> SliceHeader <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>    Data <span class="token builtin">uintptr</span> <span class="token comment">// 底层数组的指针</span>    Len  <span class="token builtin">int</span>     <span class="token comment">// 切片的长度</span>    Cap  <span class="token builtin">int</span>     <span class="token comment">// 截取底层数据的容量  >= Len</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于结构体中引用了底层数组的指针，所以slice传值是引用传递，修改形参内部元素会影响实参的数据</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">slice <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">&#125;</span>s1 <span class="token operator">:=</span> slice<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>s2 <span class="token operator">:=</span> s1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span>  <span class="token comment">// 截取 s1 从索引 [2,6) 且容量为 7以前的部分</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>slice<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// [0 1 2 3 4 5 6 7 8 9] 10 10</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">)</span>           <span class="token comment">//     [2 3 4]           3 8</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s2<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">cap</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">)</span>           <span class="token comment">//         [4 5 6 7]     4 5</span>s2 <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>s2<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment">// 容量(5)等于长度(5)，修改原底层数组</span>s2 <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>s2<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token comment">// 长度(6)超出容量(5)，重新分配内存</span>s1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">20</span>           <span class="token comment">// 修改原底层数组，不影响 s2</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span>   <span class="token comment">// [0 1 2 3 20 5 6 7 100 9]</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span>      <span class="token comment">//     [2 3 20]</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span>      <span class="token comment">//          [4 5 6 7 100 200]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因此多个切片可以共用同一个底层数组，实际内容却不相同，想了解更多深层内容，请移步<a href="https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-array-and-slice/#321-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">Go语言设计与实现</a></p><h3 id="切片扩容"><a href="#切片扩容" class="headerlink" title="切片扩容"></a>切片扩容</h3><ul><li>一般情况下：<ul><li>若切片当前长度小于1024时，容量会翻倍增长</li><li>若切片当前长度大于1024时，容量会每次增长1/4</li></ul></li><li><strong>特殊情况</strong>：当数组中元素所占的字节大小为 1、8 或者 2 的倍数时，会发生内存对齐</li></ul><p>具体源码解析可参见下面两文：</p><ul><li><a href="https://www.bookstack.cn/read/qcrao-Go-Questions/%E6%95%B0%E7%BB%84%E5%92%8C%E5%88%87%E7%89%87-%E5%88%87%E7%89%87%E7%9A%84%E5%AE%B9%E9%87%8F%E6%98%AF%E6%80%8E%E6%A0%B7%E5%A2%9E%E9%95%BF%E7%9A%84.md">Go语言问题集</a></li><li><a href="https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-array-and-slice/#324-%E8%BF%BD%E5%8A%A0%E5%92%8C%E6%89%A9%E5%AE%B9">Go语言设计与实现</a></li></ul><h2 id="可比较性"><a href="#可比较性" class="headerlink" title="可比较性"></a>可比较性</h2><ul><li>数组：当长度和内容相同时可以视为相等，可以用 <code>==</code> 比较</li><li>切片：因为底层数组可能变化，不可以直接用 <code>==</code> 比较，<strong>特别的</strong>：空切片 <code>[]T(nil)</code> 与 <code>nil</code> 是相等的</li></ul><pre class="line-numbers language-go" data-language="go"><code class="language-go">arr1 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span>arr2 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span>arr3 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>arr1<span class="token operator">==</span>arr2<span class="token punctuation">,</span> arr1<span class="token operator">==</span>arr3<span class="token punctuation">)</span> <span class="token comment">// true false</span><span class="token keyword">var</span> slice <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>slice <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">int</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">nil</span><span class="token punctuation">)</span> <span class="token comment">// true false true</span><span class="token comment">// 一般切片不直接和 nil 比较，检测长度是否为零进行判断</span>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>slice<span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><ul><li>相同点：<ul><li>都用于存储单一类型序列元素</li><li>底层均基于数组结构</li><li>均通过索引下标访问元素</li></ul></li><li>区别：</li></ul><table><thead><tr><th align="center">-</th><th align="center">数组</th><th align="center">切片</th></tr></thead><tbody><tr><td align="center">初始化</td><td align="center">长度固定，不可修改</td><td align="center">长度、容量动态增长<br> 追加元素超出容量，进行扩容，内存重新分配</td></tr><tr><td align="center">赋值</td><td align="center">新数组与原数组是两个变量，修改新数组对原数组不产生影响</td><td align="center">新切片与原切片指向同一个底层数组，修改内容会影响原切片</td></tr><tr><td align="center">可比较</td><td align="center">可相互比较</td><td align="center">仅可与 <code>nil</code> 比较</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Slice </tag>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo config</title>
      <link href="hexo-78a05338e7be/"/>
      <url>hexo-78a05338e7be/</url>
      
        <content type="html"><![CDATA[<p><a href="https://hexo.io/zh-cn/">Hexo</a> 是一款快速、简洁并且高效博客框架，几乎不需要了解前端知识就能搭建，有很多主题可供选择，容易上手，非常适合自建博客网站。</p><h2 id="Prepare-the-environment"><a href="#Prepare-the-environment" class="headerlink" title="Prepare the environment"></a>Prepare the environment</h2><ul><li>Node.js &gt;= 12.0</li><li>npm</li><li>git</li><li>hexo &gt;= 5.0</li></ul><p>前三个环境搭建若不会建议问 Google，这里着重介绍 hexo 的安装及部署</p><h3 id="Init-hexo"><a href="#Init-hexo" class="headerlink" title="Init hexo"></a>Init hexo</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 全局安装 hexo 命令行客户端</span><span class="token function">npm</span> <span class="token function">install</span> hexo-cli -g<span class="token comment"># 新建空文件夹</span><span class="token function">mkdir</span> blog<span class="token builtin class-name">cd</span> blog<span class="token comment"># 初始化基础文件</span>hexo init<span class="token comment"># 安装 Node.js 相关依赖库</span><span class="token function">npm</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上述命令完成后，应该会有如下目录</p><pre class="line-numbers language-text" data-language="text"><code class="language-text">.├── _config.yml     &#x2F;&#x2F; 基本配置信息├── node_modules    &#x2F;&#x2F; 依赖库├── package.json    &#x2F;&#x2F; 项目信息├── scaffolds       &#x2F;&#x2F; 文章模板文件夹├── source          &#x2F;&#x2F; 文章资源|   ├── _drafts     &#x2F;&#x2F; 草稿目录|   └── _posts      &#x2F;&#x2F; 文章目录└── themes          &#x2F;&#x2F; 可配置主题，用于生成静态页面<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 默认使用 _config.yml 中的 default_layout 参数代替。默认参数为 post, 即要发布的文章</span>hexo new <span class="token string">"My New Post"</span><span class="token comment"># 可以在 new 后面添加 `post` `draft` `page` 等选项创建不同的文件</span><span class="token comment"># 新建草稿</span>hexo new draft <span class="token string">"new draft"</span><span class="token comment"># 发布草稿, 将草稿移动至文章目录下</span>hexo publish draft <span class="token string">"new draft"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>More info: <a href="https://hexo.io/zh-cn/docs/writing">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo server<span class="token comment"># 简化</span>hexo s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>More info: <a href="https://hexo.io/zh-cn/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo generate<span class="token comment"># 简化</span>hexo g<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>More info: <a href="https://hexo.io/zh-cn/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo deploy<span class="token comment"># 简化</span>hexo d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注意</strong>：若 Github 设置自定义域名，部署之后，<code>CNAME</code> 文件会被覆盖，导致网站不可用,可以将 <code>CNAME</code> 文件放在<code>themes/[theme-name]/source</code>目录下，这样编译静态文件会自动带过去，之后会一同推送到远端</p></blockquote><p>More info: <a href="https://hexo.io/zh-cn/docs/one-command-deployment.html">Deployment</a></p><h3 id="Clean"><a href="#Clean" class="headerlink" title="Clean"></a>Clean</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo clean<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>清除缓存文件 (db.json) 和已生成的静态文件 (public)。建议有删除文章后先 <code>clean</code>，再编译</p><h2 id="Change-theme"><a href="#Change-theme" class="headerlink" title="Change theme"></a>Change theme</h2><p>hexo 有许多优秀主题可供切换，本博客使用的主题是<a href="https://github.com/blinkfox/hexo-theme-matery/blob/develop/README_CN.md">matery</a>，具体修改配置参见README</p>]]></content>
      
      
      <categories>
          
          <category> 环境搭建 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
